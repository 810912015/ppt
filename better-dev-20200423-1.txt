{"l":"https://robertheaton.com/2020/04/06/systems-design-for-advanced-beginners/","n":"Systems design for advanced beginners","html":"\n    <header>\n  <div class=\"container\" style=\"margin-top: -25px\">\n    <h1 style=\"position: relative; top: 10px;\">\n      <a href=\"/\">Robert Heaton</a>\n    </h1>\n    <br>\n\n    <p class=\"tagline\" aria-hidden=\"true\">\n      Software Engineer / One-track lover / Down a two-way lane\n    </p>\n\n    <nav role=\"navigation\" style=\"margin-top: -5px\">\n      <ul>\n        <li><a href=\"/about\">About</a></li>\n        <li><a href=\"/archive\">Archive</a></li>\n        <li><a href=\"https://twitter.com/RobJHeaton\">Twitter</a></li>\n        <li><a style=\"color: #f92672;\" href=\"https://advancedbeginners.substack.com\">NEW: Programming Feedback for Advanced Beginners</a></li>\n      </ul>\n    </nav>\n  </div>\n</header>\n\n    <div class=\"container site\">\n      <section class=\"post blogpost\">\n        <h1 class=\"subject\"><a href=\"/2020/04/06/systems-design-for-advanced-beginners/\">Systems design for advanced beginners</a></h1>\n        <div class=\"date muted\">06 Apr 2020</div>\n        <blockquote>\n  <p>This post is part of my <a href=\"https://advancedbeginners.substack.com/\">Programming for Advanced Beginners series</a>. <a href=\"https://advancedbeginners.substack.com/\">Subscribe now</a> to receive specific, actionable ways to make your code cleaner, every other week, entirely free.</p>\n</blockquote>\n\n<p>You’ve started <a href=\"https://robertheaton.com/2018/07/09/how-tinder-keeps-your-location-a-bit-private/\">yet another</a> <a href=\"https://robertheaton.com/2017/10/09/tracking-friends-and-strangers-using-whatsapp/\">company</a> with your good friend, Steve Steveington. It’s an online marketplace where people can buy and sell things and where no one asks too many questions. It’s basically a rip-off of Craigslist, but with Steve’s name instead of Craig’s.</p>\n\n<p><img src=\"/images/systems-cover.png\"></p>\n\n<p>You’re going to be responsible for building the entire Steveslist technical platform, including all of its websites, mobile apps, databases, and other infrastructure. You’re excited, but also very nervous. You figure that you can probably cobble together a small website, since you’ve done that a few times before as part of your previous <a href=\"https://robertheaton.com/2018/07/09/how-tinder-keeps-your-location-a-bit-private/\">entertaining</a>-<a href=\"https://robertheaton.com/2017/10/09/tracking-friends-and-strangers-using-whatsapp/\">if</a>-<a href=\"https://robertheaton.com/2014/12/08/fun-with-your-friends-facebook-and-tinder-session-tokens/\">morally</a>-<a href=\"https://robertheaton.com/2016/10/22/a-tale-of-love-betrayal-social-engineering-and-whatsapp/\">questionable</a> <a href=\"https://robertheaton.com/2019/01/15/a-brief-history-of-wi-fi-privacy-vulnerabilities/\">escapades</a> with the Stevester. But you have no idea how to even start building out all of the other infrastructure and tools that you assume lie behind large, successful online platforms.</p>\n\n<p>You are in desperate need of a detailed yet concise overview of how real companies do this. How do they store their data? How do their different applications talk to each other? How do they scale their systems to work for millions of users? How do they keep them secure? How do they make sure nothing goes wrong? What are APIs, webhooks and client libraries, when you really get down to it?</p>\n\n<hr>\n\n<p>You send a quick WhatsApp to your other good friend, Kate Kateberry, to see if she can help. You’ve <a href=\"https://robertheaton.com/2019/01/15/a-brief-history-of-wi-fi-privacy-vulnerabilities/\">worked together very effectively in the past</a>, and she has decades of experience creating these types of systems at Silicon Valley’s biggest and most controversial companies.</p>\n\n<p>She instantly accepts your job offer. You had actually only been ringing for some rough guidance and a good gossip, but you nonetheless instantly accept her acceptance. No point looking a gift horse in the mouth, even when you don’t have any money to pay her. Kate proposes that her first day be 5 weeks ago in order to help her smooth over some accounting irregularities. She can come into the office sometime next week. You feel encouraged and threatened by her eagerness.</p>\n\n<hr>\n\n<p>Kate bounces into your offices in the 19th Century Literature section of the San Francisco Public Library. “OK let’s do this!” she shouts quietly. “What have we got so far? How are all our systems set up? What’s the plan?” You lean back in your chair and close your laptop, which was not turned on because you have left your charger at home. You steeple your fingers in a manner that you hope can be described as “thoughtful”.</p>\n\n<p>“Let me flip that question around, Kate. What do <em>you</em> think the plan should be?”</p>\n\n<p>Kate takes a deep breath and paints an extremely detailed vision of the Steveslist platform five years into the future and the infrastructure that will power it.</p>\n\n<hr>\n\n<p>Before we start (says Kate), I want to make it clear that I’m not saying that any of this is necessarily the “right” way to set up our infrastructure. If someone you trust more than me says something different then you should probably do what they say. There are many tools out there, each with different strengths and weaknesses, and many ways to build a technology company. The real, honest reasons that we will make many of our technological choices will be “we chose X because Sara knows a lot about X” and “we chose Y on the spur of the moment when it didn’t seem like a big decision and we never found the time to re-evaluate.”</p>\n\n<p>Nonetheless, let’s fast-forward five years into the future. Now Steveslist has two main consumer-facing products:</p>\n\n<ul>\n  <li>The Steveslist web app</li>\n  <li>The Steveslist smartphone apps</li>\n</ul>\n\n<p>These are the main ways in which users directly interact with the Steveslist platform. In addition, we also provide an API that allows programmers to build power-tools on top of the Steveslist platform that, for example, create listings for hundreds of items programmatically. To support this, we offer:</p>\n\n<ul>\n  <li>A Steveslist API</li>\n  <li>Steveslist API <em>client libraries</em> that make it easy for programmers to write code that talks to our API</li>\n</ul>\n\n<p>Here, I’ll draw a diagram on the whiteboard:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>+-----------+   +--------------+   +-----------------+\n|Web Browser|   |Smartphone App|   |Client Libraries/|\n+-----+-----+   +------+-------+   |Other API code   |\n      |                |           +-------+---------+\n      |                v                   |\n      |          +-----+------+            |\n      +---------&gt;+ Steveslist +&lt;-----------+\n                 |  Servers   |\n                 +------------+\n</code></pre></div></div>\n\n<p>Finally, we have many, many services running in the background that provide the data and power to these external-facing applications:</p>\n\n<ul>\n  <li>Webhooks - to notify users when something happens to their account, such as “order placed”</li>\n  <li>User password authentication - to securely log users in</li>\n  <li>SQL database - the main Steveslist data store. Needs to be highly scalable and reliable</li>\n  <li>Free-text searching system - to power the search box where people can look for broad search terms like “TVs” or “motorbikes”</li>\n  <li>Internal tools - to help us administer the Steveslist platform, and to take actions like issuing sternly-worded warnings to malicious users</li>\n  <li>Cron jobs - to run regular tasks that do anything from generating invoices, to billing customers, to sending as much of our users’ data as possible to third-party ad networks</li>\n  <li>“Pubsub” system - to allow us to take asynchronous actions on different trigger events (such as “when a new user signs up, send them a welcome email”)</li>\n  <li>Big data analytics system - to allow us to run enormous queries over the entirety of Steveslist’s data</li>\n  <li>And many more that we’ll talk about another day</li>\n</ul>\n\n<p>Let’s go through each of these systems in turn. <a href=\"https://robertheaton.com/about/\">Let me know</a> if anything isn’t clear, if you have any questions, or if you think I’ve got something wrong.</p>\n\n<h2 id=\"before-we-start---what-is-a-server-really\">Before we start - what is a server really?</h2>\n\n<p>Before we start, let’s define some important terms. In fact, let’s just define one. We’re going to talk a lot about “servers” today. But what is a server, when you really get down to it?</p>\n\n<p>For our purposes, a server is a computer that runs on a network and listens for communications from other computers. When it receives some data from another computer it performs some sort of action in response and - usually - sends back some data of its own. For example, a web server listens on a network for HTTP requests and sends back webpages and information in response. A database server listens for database queries and reads and writes data to the database that it is running.</p>\n\n<p>This brief description skips out entire degrees and careers of detail, and there are of course far more precise and accurate ways to define the word “server”. But this should get us through until dinnertime. What did you say? What’s a “network” really? A good question for another day.</p>\n\n<p>Now we’re ready to talk about the Steveslist platform.</p>\n\n<h2 id=\"steveslist-web-app\">Steveslist web app</h2>\n\n<p>This is the main Steveslist product. It’s just a normal web app, very similar to any website that you’ve built before, except much bigger. It’s a modern “single-page app” (SPA). The “single” in “single-page app” refers to the fact that the user’s browser almost never has to fully reload the page as the user clicks around our site. Instead, when the browser makes its first <em>HTTP request</em> to our servers, we send it back a basic, skeleton HTML page and a big pile of <em>JavaScript</em> code. This JavaScript code executes inside the browser, and updates the view of the page in response to the user’s actions. When the JavaScript wants to send or retrieve data from Steveslist, it sends an Asynchronous JavaScript XML Request (almost always called AJAX for short) in the background to a URL. When our server responds, the JavaScript uses the response to update the browser view accordingly.</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>+----------+1.User's browser visits steveslist.com. +----------+\n|          |  It sends an HTTP request to the       |          |\n|          |  Steveslist servers                    |          |\n|          +---------------------------------------&gt;|          |\n|User's Web|                                        |Steveslist|\n| Browser  |2.Steveslist server responds with a     | Servers  |\n|          |  skeleton HTML page that instructs the |          |\n|          |  browser to request additional         |          |\n|          |  JavaScript files.                     |          |\n|          |&lt;---------------------------------------+          |\n|          |                                        |          |\n|          |3.User's browser requests and receives  |          |\n|          |  these JavaScript files from the       |          |\n|          |  Steveslist server.                    |          |\n|          +---------------------------------------&gt;|          |\n|          |&lt;---------------------------------------+          |\n|          |                                        |          |\n|          |4.User's browser executes the JavaScript|          |\n|          |  code. The code sends more requests for|          |\n|          |  the user's data to the Stevelist      |          |\n|          |  server, and updates the browser UI to |          |\n|          |  display it.                           |          |\n|          +---------------------------------------&gt;|          |\n|          |&lt;---------------------------------------+          |\n+----------+                                        +----------+\n</code></pre></div></div>\n\n<p><code class=\"language-plaintext highlighter-rouge\">robertheaton.com</code> is not a single-page app. Whenever you click on a link, the browser has to reload the entire page. <code class=\"language-plaintext highlighter-rouge\">twitter.com</code> <em>is</em> a single-page app. Whenever you click on a link, the browser dynamically updates a small portion of tthe page without forcing a full refresh.</p>\n\n<p>SPAs are a lot of work to build and maintain, but they sure look good.</p>\n\n<h2 id=\"steveslist-smartphone-apps\">Steveslist smartphone apps</h2>\n\n<p>We provide Steveslist smartphone apps for both iOS and Android. They are conceptually very similar to our single-page web app. Both our smartphone and web apps make HTTP requests to our servers. Then our servers receive these requests, do some work and return an HTTP response. Finally, both our smartphone and web apps update their display in order to communicate with the user.</p>\n\n<p>Since our smartphone apps are performing the same operations as the web app (for example, create listing, send message, etc), they can usually even send their requests to the exact same URLs as the web app. The only extra work that we have to do is to develop the frontends of the apps themselves. Some frameworks even make it possible to write mobile apps using JavaScript, allowing you to reuse code and logic across platforms.</p>\n\n<h2 id=\"steveslist-api\">Steveslist API</h2>\n\n<p>We allow users and third-parties to write code that programmatically interacts with our platform. In the same way that people can use the Twitter API to write code that reads; likes; and creates Tweets, we allow them to use the Steveslist API to search; buy; and list items.</p>\n\n<p>Programmers use our API by writing code that makes HTTP requests to our <em>API endpoints</em>. For example, in order to retrieve a list of all their listings, the programmer sends an HTTP <code class=\"language-plaintext highlighter-rouge\">GET</code> request to <code class=\"language-plaintext highlighter-rouge\">api.steveslist.com/v1/listings</code>. We respond with the data they requested, formatted as <em>JSON</em>. JSON stands for JavaScript Object Notation, but JSON is not specific to JavaScript and can easily be interpreted by any programming language. A JSON response to a request to retrieve all of a user’s listings might look something like this:</p>\n\n<div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"p\">{</span>\n  <span class=\"dl\">\"</span><span class=\"s2\">listings</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n    <span class=\"p\">{</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">id</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"mi\">2178123867</span><span class=\"p\">,</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">name</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">Stolen TV</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">country</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">US</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">city</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">San Francisco</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">price_amount</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"mi\">1000</span><span class=\"p\">,</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">price_currency</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">usd</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n      <span class=\"err\">#</span> <span class=\"nx\">etc</span><span class=\"p\">...</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">id</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"mi\">182312679</span><span class=\"p\">,</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">name</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">Stolen Bicycle</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">country</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">US</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">city</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">San Francisco</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">price_amount</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"mi\">2000</span><span class=\"p\">,</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">price_currency</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">usd</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n      <span class=\"err\">#</span> <span class=\"nx\">etc</span><span class=\"p\">...</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n\n<p>This structured response format is very easy for a program to parse, which means that the code that made the request can trivially interpret and use the data from our API.</p>\n\n<p>Users identify or <em>authenticate</em> themselves to our API using an API key. This is, roughly speaking, the API equivalent of a password. It is a long, random string that we generate and display on a user’s “Settings” page. Users include their API key as an <em>HTTP header</em> with every HTTP request that they (or their code) makes to the API. When we receive an API request we check to see whether the attached API key corresponds to a Steveslist user. If it does then we perform the request on behalf of that user.</p>\n\n<p>If a programmer wants to, they can manually build HTTP requests to our API themselves, using their language’s standard HTTP library. For example, in Python they might write:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">import</span> <span class=\"nn\">requests</span>\n\n<span class=\"n\">url</span> <span class=\"o\">=</span> <span class=\"s\">'https://api.steveslist.com/v1/listings/'</span>\n<span class=\"n\">listing_params</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n  <span class=\"s\">\"name\"</span><span class=\"p\">:</span> <span class=\"s\">\"Stolen TV\"</span><span class=\"p\">,</span>\n  <span class=\"s\">\"country\"</span><span class=\"p\">:</span> <span class=\"s\">\"US\"</span><span class=\"p\">,</span>\n  <span class=\"s\">\"city\"</span><span class=\"p\">:</span> <span class=\"s\">\"San Francisco\"</span><span class=\"p\">,</span>\n  <span class=\"s\">\"price_amount\"</span><span class=\"p\">:</span> <span class=\"mi\">1000</span><span class=\"p\">,</span>\n  <span class=\"s\">\"price_currency\"</span><span class=\"p\">:</span> <span class=\"s\">\"usd\"</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n<span class=\"n\">api_key</span> <span class=\"o\">=</span> <span class=\"s\">\"YOUR_API_KEY_GOES_HERE\"</span>\n\n<span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">requests</span><span class=\"o\">.</span><span class=\"n\">post</span><span class=\"p\">(</span>\n  <span class=\"n\">url</span><span class=\"p\">,</span>\n  <span class=\"n\">data</span><span class=\"o\">=</span><span class=\"n\">listing_params</span><span class=\"p\">,</span>\n  <span class=\"n\">headers</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s\">\"X-Steveslist-API-Key\"</span><span class=\"p\">:</span> <span class=\"n\">api_key</span><span class=\"p\">},</span>\n<span class=\"p\">)</span>\n</code></pre></div></div>\n\n<p>However, we make life easier for programmers by providing <em>client libraries</em>.</p>\n\n<h2 id=\"steveslist-client-libraries\">Steveslist client libraries</h2>\n\n<p>A client library is a library that “wraps” the functionality of the Steveslist API. This means that anyone using the client library doesn’t need to know anything about the fine details of the Steveslist API. Instead, they can just write:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">import</span> <span class=\"nn\">steveslist</span>\n\n<span class=\"n\">listing</span> <span class=\"o\">=</span> <span class=\"n\">steveslist</span><span class=\"o\">.</span><span class=\"n\">Listing</span><span class=\"o\">.</span><span class=\"n\">create</span><span class=\"p\">(</span>\n  <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s\">\"Stolen TV\"</span><span class=\"p\">,</span>\n  <span class=\"n\">country</span><span class=\"o\">=</span><span class=\"s\">\"US\"</span><span class=\"p\">,</span>\n  <span class=\"n\">city</span><span class=\"o\">=</span><span class=\"s\">\"San Francisco\"</span><span class=\"p\">,</span>\n  <span class=\"n\">price_amount</span><span class=\"o\">=</span><span class=\"mi\">1000</span><span class=\"p\">,</span>\n  <span class=\"n\">price_currency</span><span class=\"o\">=</span><span class=\"s\">\"usd\"</span><span class=\"p\">,</span>\n  <span class=\"n\">api_key</span><span class=\"o\">=</span><span class=\"s\">\"YOUR_API_KEY_GOES_HERE\"</span>\n<span class=\"p\">)</span>\n</code></pre></div></div>\n\n<p>Our libraries turn the parameters that they are given into appropriately formatted HTTP requests, which they send to the Steveslist API as normal. We’ve written client libraries for every major programming language that we could think of, and they are by far the most common way that people interact with our API.</p>\n\n<h2 id=\"webhooks\">Webhooks</h2>\n\n<p>We’ve seen how Steveslist users can use our API to programmatically interact with their account. In addition, many users also want <em>us</em> to proactively tell <em>them</em> whenever something happens to their Steveslist profile. For example, suppose that someone wanted to fully automate the process of selling items on Steveslist. Whenever a customer pays for an item using our new, mostly-secure StevePay system, they want to send the customer a thank you email and automatically instruct their warehouse to ship a stolen TV to the order address. Our seller could constantly and repeatedly query the Steveslist API asking “Any new sales? Any new sales?” However, this would be very inefficient, and would put a lot of unnecessary load on our servers.</p>\n\n<p>Instead, we provide an industry standard system called <em>webhooks</em>. A webhook is an HTTP request that we send to our users whenever something interesting happens to their account. It contains all the data describing the event that just happened - for example, the item ID, the price, the buyer ID, buyer address, and so on. Webhooks allow users to automatically perform response actions, such as the aforementioned email and auto-shipping.</p>\n\n<p>To use webhooks, the user tells us the URL to which they would like us to send their webhooks (for example, <code class=\"language-plaintext highlighter-rouge\">steveslistwebhooks.robertheaton.com</code>. They set up a web server at that URL that will receive and action these webhook notifications.</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>1.Buyer purchases an      3.The seller's server receives the webhook,\n  item as normal.           and uses the information in it to\n                            automatically process the order.\n+---------------+           +-----------------+\n|Buyer's Browser|           |Seller's Webhook-+\n+------+--------+           |Receiving Server |\n       |                    +------+----------+\n       |                           ^\n       |                           | \n       |                           |   \n       |    +-----------+          |\n       +---&gt;+ Steveslist+----------+\n            |   Server  |\n            +-----------+\n       2.Once the transaction has been completed,\n         Steveslist looks up the seller's\n         webhook URL (if set). We then send\n         an HTTP request to this URL,\n         containing the details of the purchase.\n</code></pre></div></div>\n\n<p>The user deploys code on their web server that performs the appropriate response actions whenever it receives a webhook from us. We don’t only send webhooks when an item is purchased - we also send them when a user receives a message; when one of their items is removed by an admin; or when a buyer makes a complaint. This enables Steveslist sellers to automate not just the listing of items, but also the selling and shipping of them too.</p>\n\n<h3 id=\"webhook-complications\">Webhook complications</h3>\n\n<p>Webhooks come with two main complications - security and reliability. First, let’s talk security. The endpoint to which the seller instructs us to send their webhooks is accessible to anyone on the internet. Anyone who knows the URL can send it fake webhooks, and if our seller isn’t careful this could allow an attacker to trick them into, for example, sending the attacker free stuff. A seller’s webhook URL should be difficult to find, since the seller won’t publicize its existence, but obscurity is not the same as security.</p>\n\n<p>To allow our sellers to verify that a webhook really was sent by Steveslist, we <em>cryptographically sign</em> our webhook contents.</p>\n\n<h4 id=\"cryptographic-signing\">Cryptographic signing</h4>\n\n<p>Cryptographic signing is a deep and subtle topic. Here’s a condensed version of how we use it to secure our webhooks.</p>\n\n<p>When a seller enables webhooks for their account, we generate a random “shared secret key”. We tell the seller to copy this key over to their webhook-receiving server and keep it secure, so that its value is known only by us and the seller. Whenever we send a webhook, we take this shared secret, combine it with the contents of the webhook by using a <em>cryptographic hash function</em> called <em>HMAC</em>, and get back a long, random-seeming, but entirely deterministic “signature” for the webhook.</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>Webhook contents   +----------+\n(eg. {\"id\": 123...})          |\n                              v\n                          +---+----------+\n                          |HMAC Algorithm|-----&gt;Webhook signature\n                          +---+----------+\n                              ^\nShared secret key             |\n(eg. 123mhu23jy8xdwgmd...)+---+\n</code></pre></div></div>\n\n<p>We include this signature in our webhook body, for example:</p>\n\n<div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"p\">{</span>\n  <span class=\"dl\">\"</span><span class=\"s2\">action</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">item_sold</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n  <span class=\"dl\">\"</span><span class=\"s2\">price</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"mi\">100</span><span class=\"p\">,</span>\n  <span class=\"c1\">// ...more params...</span>\n  <span class=\"dl\">\"</span><span class=\"s2\">signature</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">234gj98d49j834978gf39t78ndn98g7dq3ng897308y7</span><span class=\"dl\">\"</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n\n<p>When the seller’s webhook-receiving server receives a webhook, it takes the shared secret and webhook contents and calculates what it expects the signature to be in exactly the same way that we did. It compares the result to the signature attached to the webhook; if they match then it accepts and processes the webhook. Since the signature can only be generated using the shared secret known only by us and the seller, the webhook-receiving server can be confident that the webhook was sent by us. If the signatures don’t match, however, the server rejects the webhook.</p>\n\n<p>Note that all of the signature verification code must be written and maintained by the sellers. We can provide them with encouragement and examples, but we can’t force them to verify signatures correctly, or even at all. For some real-world examples, look at how <a href=\"https://stripe.com/docs/webhooks/signatures\">Stripe</a> and <a href=\"https://developer.github.com/webhooks/securing/\">GitHub</a> sign their webhooks.</p>\n\n<h3 id=\"reliability\">Reliability</h3>\n\n<p>We also need to consider what happens when our webhooks go wrong and what guarantees we want to make to our users about them. If we try to send a webhook but can’t connect to the user’s server, what should we do? What if we successfully connect to their server and send the webhook, but their server sends back an error? What if we send the webhook but the server hangs for twenty seconds before disconnecting without telling us what happened?</p>\n\n<p>There are tradeoffs involved here that require clear communication and a surprising amount of infrastructure to manage. We at Steveslist choose to guarantee that we will deliver webhooks “at least once”. This means that if a webhook fails to send then we will keep trying (a large but not infinite number of times) until it does. If we’re not sure whether a webhook succeeded or failed, we will keep trying until we are sure that an attempt has succeeded. This might occasionally result in us sending the same webhook twice, but it’s the seller’s responsibility to have their code handle this gracefully instead of sending the same customer five stolen TVs instead of the one that they ordered.</p>\n\n<hr>\n\n<p>“What do you think so far?” asks Kate. “Is this roughly what you’ve been thinking?” You make a non-committal face and take a big bite of a nearby sandwich in order to preclude any further discussion. Kate continues:</p>\n\n<hr>\n\n<p>Let’s talk about the backend systems that will power some of our most important features.</p>\n\n<h2 id=\"user-authentication-via-a-password\">User authentication via a password</h2>\n\n<p>Most users sign into the Steveslist website and smartphone apps using a username and password. There are other ways of signing into the website, like <em>OAuth</em> - we’ll cover them another time.</p>\n\n<p>We will have to store our users’ passwords very securely. Not only is a user’s password the thing they use to sign in (or <em>authenticate</em>) to Stevelist, but for many users they’re probably the same password that they use to sign in to many other services too, despite all the warnings that this is a bad idea. They only have so many children with so many birthdays, after all.</p>\n\n<p>Rupert Herpton has written <a href=\"https://robertheaton.com/2019/08/12/programming-projects-for-advanced-beginners-user-logins/\">the seminal tutorial</a> on how to secure passwords, which I’m sure you’ve read already. Just in case you need a refresher, the crux of the matter is that we mustn’t ever store passwords in their original, <em>plaintext</em> form, anywhere. We mustn’t store them in plaintext in a database, in a log file, or in any other part of our system. Instead, before storing a password, we must first <em>hash</em> it using a <em>hash function</em> such as <em>bcrypt</em>.</p>\n\n<p>A hash function is a “one-way” function that takes an input and deterministically converts it into a new, seemingly-random string. Calculating a hash value from an input is computationally very easy, but reversing the transformation and recovering the original input from its hash value takes so much time and computing power that it is, practically-speaking, impossible.</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>+---------+     Easy    +----------+\n|         |------------&gt;|          |\n|Plaintext|             |Hash value|\n|         |&lt;------------|          |\n+---------+ Essentially +----------+\n            Impossible\n</code></pre></div></div>\n\n<p>Since we only store the hash values of our users’ passwords, if a hacker somehow stole our password database (heaven forbid) (touch wood) then they would only be able to see the passwords’ hash values. They wouldn’t be able to easily turn these hash values back into <em>plaintext</em> passwords, meaning that they wouldn’t be able to use them to login to Steveslist, and they won’t be able to take advantage of all the people who re-use passwords across different services.</p>\n\n<p>Since we only store password hash values, when we want to check whether a login password that a user has given us is correct we first calculate its hash value, and compare the result to the hash value in our password database.</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>                 +--------------+\n                 |User's Browser|\n                 +-----------+--+\n1.User attempts to  |        ^\nlog in:             |        |  3. Server logs the user in\n                    |        |  if password matches, and\n   username: steve  |        |  returns an error if it does not.\n   password: 12345  v        |  \n                 +--+--------+--+\n                 |  Steveslist  |\n                 |    Server    |\n                 +--------------+\n                        |\n2.Server computes       |     |username|password_hash|\nthe hash of the         |     +----------------------+\npassword and compares   +----&gt;+steve   |23jy7213y7jO |\nit to the value in the        |kate    |21897213hh21 |\ndatabase.                     |...     |...          |\n</code></pre></div></div>\n\n<p>As previously mentioned, we also have to be careful not to log passwords in any of our debug output. This can be an easy mistake to make - if you log all of the parameters of every HTTP request, just in case you need it, you will certainly be logging user passwords. Facebook logged passwords in plaintext for many years, and whilst it didn’t seem to affect their stock price I’m sure it made them feel pretty silly for a day or two.</p>\n\n<hr>\n\n<p>Kate pauses for breath. You pretend to take notes on your out-of-battery laptop.</p>\n\n<hr>\n\n<p>Let’s talk about infrastructure.</p>\n\n<h2 id=\"database-servers\">Database servers</h2>\n\n<p>Steveslist’s primary data store runs a common flavor of SQL database called <em>MySQL</em>. I won’t talk much about SQL here - the specifics of how it works aren’t too important, and you can find them on Google if you’re interested. Since we are so successful, we have a huge and growing amount of data to manage. We’ve started to become acutely aware that databases aren’t magic. They run on computers, just like any other program. As the volume of data in a database grows, the computer’s hard drive and memory starts to fill up. At the start of the company the easiest way to deal with this problem was to run our database on a single computer (or <em>machine</em>) with an enormous hard drive. But this could only stave off the problem for so long. Eventually our database contained more data than could be stored on any reasonable hard drive, and the database started to get slower and slower as we forced it to search through more and more records.</p>\n\n<p>We had to take an entirely new approach, and reconfigure our database to store its data on multiple computers. We did this using <em>sharding</em>.</p>\n\n<h3 id=\"sharding\">Sharding</h3>\n\n<p>Sharding a database means splitting its data into chunks (or “shards”) and storing each chunk on a separate machine. All of the machines that make up a database are together known as a <em>database cluster</em>. How you split data between machine in your cluster depends on your application and the types of operations you will be performing. For Steveslist we chose to split out our data by user. This means that all of the data for a given user is stored on the same machine. This includes their profile information, their listings, their messages, and so on. Data that doesn’t have a corresponding user (like “Deals of the Day”) can be sharded using a <em>shard key</em> other than user, or not sharded at all if the dataset is sufficiently small.</p>\n\n<p>This means that we need an extra “routing” layer in front of our database, which knows which database machine is able to service which queries. We could either make our <em>application servers</em> (the servers that execute our code) responsible for knowing the mapping of user IDs to database shards, or have a centralized “router” that all servers send their requests to, and which is responsible for working out the appropriate machine to forward the request on to. Both approaches have their advantages. Making application servers responsible for maintaining the mapping reduces the number of hops that a request has to make, speeding them up. But having a centralized router makes updating the shard mapping much easier, since you only have to update it in one place.</p>\n\n<p>If application servers are responsible for knowing the shard layout, we have a system that looks like this:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>            +          +          +\n            |          |          |\n            | Requests from users |\n            |          |          |\n            v          v          v\n     +------+----------+--------------------+\n     |            Application               |\n     |               Server                 |\n     |                                      |\n     |Database sharding config:             |\n     |* DB Server 1: IDs between 1-10000    |\n     |* DB Server 2: IDs between 10000-20000|\n     |* DB Server 3: IDs between 20000-30000|\n     +-+----------------+-----------------+-+\n       |                |                 |\n       |ID:501          |ID:15362         |ID:22361\n       |                |                 |\n       v                v                 v\n+-----------+     +-----------+     +-----------+\n|DB Server 1|     |DB Server 2|     |DB Server 3|\n+-----------+     +-----------+     +-----------+\n</code></pre></div></div>\n\n<p>If we have a centralized database router, we have a system that looks like this:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>            +          +          +\n            |          |          |\n            | Requests from users |\n            |          |          |\n            v          v          v\n     +------+----------+--------------------+\n     |            Application               |\n     |               Server                 |\n     |                                      |\n     |Database sharding config:             |\n     |* ??? Application Server has no idea  |\n     +------------+-----------+-------------+\n                  |           |\n      Application server sends all database\n      queries to the database router, which\n      forwards them to the correct shard.\n                  |           |\n                  v           v\n   +--------------+-----------+-------------+\n   |            Database router             |\n   |                                        |\n   |Database sharding config:               |\n   |* DB Server 1: IDs between 1-10000      |\n   |* DB Server 2: IDs between 10000-20000  |\n   |* DB Server 3: IDs between 20000-30000  |\n   +---+----------------+---------------+---+\n       |                |               |\n       |ID:501          |ID:15362       |ID:22361\n       |                |               |\n       v                v               v\n+-----------+    +-----------+   +-----------+\n|DB Server 1|    |DB Server 2|   |DB Server 3|\n+-----------+    +-----------+   +-----------+\n</code></pre></div></div>\n\n<p>How do we decide which database to assign each user to? However we want. We could start by saying that users with odd-numbered IDs are assigned to shard machine 1, and those with even-numbered ones are assigned to shard machine 2. We could hope that this random assignment results in balancing our data relatively evenly between our shards.</p>\n\n<p>However, it’s possible that we might have a small number of power users who create much, much more data than others. Maybe they create so much data that we want to allocate them a shard of their own. This is completely fine - we have complete control over how users are assigned to shards. Random assignments are usually easiest, but are by no means the only option. We can choose to assign users to shards randomly - except for user 367823, who is assigned to shard 15, which no other user is assigned to.</p>\n\n<p>If a shard gets too big and starts to fill up its machine’s hard-drive, we can split it up into multiple, smaller shards. How do we migrate the data to these new shards without having to turn off our platform for a while? Probably using a sequential process like:</p>\n\n<ol>\n  <li>“Double-write” new data to both the old and new shards. Continue reading data from the old shard</li>\n  <li>Copy over all existing data from the old shard to the new shard. Continue double-writing to old and new shards</li>\n  <li>Convince ourselves that the old and new shards contain the same data. We could do this by comparing snapshots of the databases, and/or by reading every query from both databases, comparing them, and alerting if the data is different</li>\n  <li>Once we’re confident that the new and old shards contain the same data, we switch to reading from the new shards. We continue double-writing in case we need to switch back</li>\n  <li>Once we’re confident that this step has been successful, stop double-writing and delete the old shard</li>\n</ol>\n\n<p>Rupert Herpton has written <a href=\"https://robertheaton.com/2015/08/31/migrating-bajillions-of-database-records-at-stripe/\">a great article about a broadly-similar type of migration</a> that goes into much more detail. In short, the process of migrating data between database shards is detailed and finicky, but also entirely doable and logical. Some types of database can even automatically take care of sharding for you.</p>\n\n<h3 id=\"replication\">Replication</h3>\n\n<p>We will take great care to make sure that our data doesn’t get accidentally deleted and our database servers don’t randomly stop working. But accidents happen, and sometimes computers do randomly stop working. To mitigate the fallout of a database-related disaster, we <em>replicate</em> our data across multiple machines in (close to) realtime.</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>       Client writes new\n       data to DB Server A\n                |\n                v\n          +-----+-----+\n          |DB Server A|\n          ++---------++\n           |         | DB Server A quickly replicates\n           v         v the new data to DB Servers B and C\n+----------++      +-+---------+\n|DB Server B|      |DB Server C|\n+-----------+      +-----------+\n</code></pre></div></div>\n\n<p>Realtime replication has two main benefits. First, it means that if one of our database servers explodes, catches fire, or otherwise stops working, we have multiple almost-perfect copies of it that can seamlessly pick up the slack. In a straightforward, vanilla failure, users of our services may never know that anything has gone wrong. The second benefit of replication is that we can distribute queries for the same data across multiple database servers. If lots of users are asking to read data from the same database, we can split their queries up across all of our copies, meaning that we can handle more queries in parallel.</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>  Clients can query the same data\n  from any of DB Servers A,B,or C\n    |  |    |   |   |    |  |\n    |  |    v   v   v    |  |\n    |  |  +-+---+---+-+  |  |\n    |  |  |DB Server A|  |  |\n    |  |  +-----------+  |  |\n    |  |                 |  |\n    v  v                 v  v\n+---+-------+      +-----+-+---+\n|DB Server B|      |DB Server C|\n+-----------+      +-----------+\n</code></pre></div></div>\n\n<p>Note that database replication is not the same concept as making database backups. Replication happens in (close to) realtime, and is designed to deal on-the-fly with isolated problems in your live (or <em>production</em>) systems. Database backups are performed on a schedule (for example, once a day), and the copies of the data are stored separately, away from production systems. Backups are designed as a final safeguard against widespread, catastrophic data loss, as might happen if all your data centers burned down.</p>\n\n<p>Pretend that you work in the call centre of a big bank, where people are constantly calling you up in order to send money transfers and ask about their current balance. Replication is the equivalent of hurriedly writing down transfer details into multiple books, as you receive them, just in case you lose one of the books. Making backups is the equivalent of photocopying those books once a day and storing the copies in your filing cabinet.</p>\n\n<h3 id=\"replication-1\">Replication</h3>\n\n<p>The process of replication is conceptually quite straightforward. Whenever new data is written to our database, we copy it to multiple machines. This means that if/when a machine fails we can continue querying its siblings, with no user-facing impact. It also means that we can spread our queries out across multiple copies of the same data, resulting in faster query response times.</p>\n\n<p>However, the details of how we do this are important, subtle, and situation-dependent. There’s no right way to do replication - as is so often the case, the exact approach that you take depends on the specific requirements and constraints of your system.</p>\n\n<p>Replication is complicated by two inconvenient facts about the real world. First, database operations randomly fail sometimes. When we attempt to replicate our data from one server to another, things <em>will</em> occasionally go wrong, causing our machines to become out of sync, at least for a period. Second, even in periods of smooth operation, replication is not instantaneous. When new data is written to our database cluster, some servers in the cluster will always know about the update sooner than others. When choosing a replication strategy we must be aware of these limitations and how they impact our particular application. For example, maybe it’s OK to risk the number of “likes” on a post being slightly out of sync and out of date, but not the amount of money in a user’s bank account.</p>\n\n<p>One of the biggest decisions we must make when choosing a replication strategy is whether we want our replication to be <em>synchronous</em> or <em>asynchronous</em>.</p>\n\n<h3 id=\"asynchronous-vs-synchronous-replication\">Asynchronous vs synchronous replication</h3>\n\n<p>Replication can be handled either synchronously or asynchronously. These words come up in a lot of different places in systems design, but they always fundamentally mean the same thing. If an action is performed “synchronously” then this means that it is performed while something waits for it. If you wanted to send a letter synchronously then you would got to the Post Office, give your letter to a postal worker, sit and wait in the corner of the Post Office for a few days, and only go home when the postal worker confirmed that your letter had arrived safely.</p>\n\n<p>By contrast, if an action is performed “asynchronously” then this means that the initiator of the action doesn’t wait around for it to be finished. Instead, they just continue with the rest of their work while the action is worked on in the background. The real Postal Service is asynchronous; you give your letter to a postal worker, then leave and continue with your life while the Postal Service delivers your letter. Asynchronous actions can send back notifications of the outcome of the action if they want (“Your letter has arrived and was signed for” or “Mr. Heaton, your dry-cleaning is ready”), but they don’t have to.</p>\n\n<p>How do these principles apply to database replication? In synchronous replication a client writes its new data to a database server and then waits. This server doesn’t tell the client whether their write has been completed successfully until it has finished fully replicating the client’s data across all of its sibling servers. Then, and only then, does the client continue executing the rest of its code.</p>\n\n<p>In asynchronous replication the client writes its data to the first database server, as before. But this time the first server tells the client that the write was successful as soon as it has written the data to its own data store. It kicks off the replication process in the background, and doesn’t wait for it to complete, or even start, before it tells the client that the write was successful. This means that the asynchronous operation appears much faster than the synchronous one, because the client doesn’t have to wait for all the replication to complete before it can continue on with the rest of its work. However, if the background replication fails then the client will believe that it has successfully written its data to the database when it actually has not. This could cause problems, the imagination of which is left as an exercise for the reader.</p>\n\n<p>The synchronous approach is slower but “safer” than an asynchronous approach. The database never claims to have successfully received and stored any data until it has finished every single step of doing so. Because the client waits for full confirmation before proceeding, it is guaranteed to never encounter a situation where the client believes that it has written some data to the database, but the database has secretly partially dropped the data on the floor.</p>\n\n<p>Which approach is better? It depends. Do you care more about speed or correctness? Is it OK to occasionally have inconsistent data if it significantly speeds up the system’s operation? Or will even a single mistake cause airplanes to start falling out of the sky?</p>\n\n<p>Database replication systems face other interesting problems too. Many of these problems are “logical” rather than “technical”, and don’t require a detailed understanding of the complex software and networking protocols underlying the system. To help picture some of them, imagine that you’re back in the call centre from a few paragraphs ago. You work with many other colleagues. Together you play the role of database servers. People call you up to transfer money and ask about their current balance. You and your colleagues write information about new transfers down on paper, and replicate it between yourselves by calling each other up.</p>\n\n<p>The problems faced by our database cluster are identical to those faced by our call-centre. What happens if two people call in and try to update the same piece of data at the same time by talking to two different employees? Maybe we solve that by having a “leader” employee who is the only one authorized to serve calls from people trying to create transfers. All the other employees are only allowed to answer queries about current balances. OK, so what happens if the leader has a stroke and dies after they’ve received some new data, but before they’ve told everyone else about it? What if a “follower” employee has a temporary seizure for a few seconds and misses some data updates from the leader? What if we’re never entirely sure which of our employees are dead or alive?</p>\n\n<p>This is not an approximate metaphor that breaks down if you look too hard or start asking awkward questions. Understand this weird call-centre and you understand database replication. <a href=\"https://www.brianstorti.com/replication/\">Read this blog post</a> and you <em>really</em> understand replication.</p>\n\n<h3 id=\"backups\">Backups</h3>\n\n<p>In addition to realtime replication, we also store regular backups of our entire database in order to protect against catastrophic disaster. We copy all of the data in our database, store it somewhere safe, and mark it as something like “database backup, 2020-05-11:01:00”.</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>+----------+  \n| Database +----------------&gt; database backup, 2020-05-11:01:00\n+----------+                  database backup, 2020-05-10:01:00\n                              database backup, 2020-05-09:01:00\n</code></pre></div></div>\n\n<p>If our entire database - or some fraction of it - somehow gets wiped out, we grab the most recent backup available and load it into new database machines.</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>+----------+\n|   New    |\n| Database +&lt;---------------- database backup, 2020-05-11:01:00\n+----------+                  database backup, 2020-05-10:01:00\n                              database backup, 2020-05-09:01:00\n</code></pre></div></div>\n\n<p>Such a calamity could be caused by a cyberattack, a disaster in our data centre, a database migration gone horribly wrong, or any number of unlikely but potentially company-destroying reasons. Unlike realtime replication, restoring a database from a backup is a slow process that our users will definitely notice. Our entire system will likely be offline until the restoration is complete. We will have lost all database updates that occurred after the last backup but before the disaster. And there will no doubt be a large number of knock-on effects as users and systems try to access data that used to be there but is now lost forever. Nonetheless, these are all much less terrible than the complete, irrevocable loss of all our company’s data and with it, our company.</p>\n\n<p>That’s a whole lot of detail about our primary SQL database. Let’s talk about some other ways in which we store and query data.</p>\n\n<h2 id=\"free-text-searching\">Free-text searching</h2>\n\n<p>A standard SQL database is very good at answering well-defined and specific queries. For example:</p>\n\n<ul>\n  <li>Give me all the item listings created by user #145122 in the last 90 days</li>\n  <li>Give me the listing details for item #237326921</li>\n  <li>Give me the count of new listings per day created in San Francisco with the label “Electronics”</li>\n</ul>\n\n<p>You can retrieve this kind of data using SQL queries that look something like this:</p>\n\n<div class=\"language-sql highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">SELECT</span> <span class=\"o\">*</span>\n<span class=\"k\">FROM</span> <span class=\"n\">items</span>\n<span class=\"k\">WHERE</span>\n  <span class=\"n\">user_id</span> <span class=\"o\">=</span> <span class=\"mi\">145122</span> <span class=\"k\">AND</span>\n  <span class=\"n\">created</span> <span class=\"o\">&gt;</span> <span class=\"n\">currentDate</span><span class=\"p\">()</span> <span class=\"o\">-</span> <span class=\"mi\">90</span>\n</code></pre></div></div>\n\n<p>or</p>\n\n<div class=\"language-sql highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">SELECT</span>\n  <span class=\"n\">DATE_TRUNC</span><span class=\"p\">(</span><span class=\"s1\">'day'</span><span class=\"p\">,</span> <span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">created</span><span class=\"p\">)</span> <span class=\"k\">AS</span> <span class=\"k\">day</span><span class=\"p\">,</span>\n  <span class=\"k\">COUNT</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span>\n<span class=\"k\">FROM</span> <span class=\"n\">items</span> <span class=\"k\">AS</span> <span class=\"n\">i</span>\n<span class=\"k\">INNER</span> <span class=\"k\">JOIN</span> <span class=\"n\">labels</span> <span class=\"k\">as</span> <span class=\"n\">l</span>\n  <span class=\"k\">ON</span> <span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">id</span> <span class=\"o\">=</span> <span class=\"n\">l</span><span class=\"p\">.</span><span class=\"n\">item_id</span>\n<span class=\"k\">WHERE</span>\n  <span class=\"n\">i</span><span class=\"p\">.</span><span class=\"n\">city</span> <span class=\"o\">=</span> <span class=\"s1\">'San Francisco'</span> <span class=\"k\">AND</span>\n  <span class=\"n\">l</span><span class=\"p\">.</span><span class=\"nb\">text</span> <span class=\"o\">=</span> <span class=\"s1\">'electronics'</span>\n<span class=\"k\">GROUP</span> <span class=\"k\">BY</span> <span class=\"mi\">1</span>\n<span class=\"k\">ORDER</span> <span class=\"k\">BY</span> <span class=\"mi\">1</span> <span class=\"k\">DESC</span>\n</code></pre></div></div>\n\n<p>You’ll notice that these queries contain a lot of very “precise” operators, like equals- and greater-than-signs. But how would you write a SQL query that could return a list of items that match a Google-style “full-text” search, like “second-hand TV”?</p>\n\n<p><img src=\"/images/systems-design-search.png\"></p>\n\n<p>This would be difficult. You could try the SQL <code class=\"language-plaintext highlighter-rouge\">LIKE</code> operator, which allows you to find records containing a pattern, such as a sub-string. For example, the following query finds all items with a description containing the sub-string <code class=\"language-plaintext highlighter-rouge\">second-hand TV</code>:</p>\n\n<div class=\"language-sql highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">SELECT</span> <span class=\"o\">*</span>\n<span class=\"k\">FROM</span> <span class=\"n\">items</span>\n<span class=\"k\">WHERE</span> <span class=\"n\">description</span> <span class=\"k\">LIKE</span> <span class=\"s1\">'%second-hand TV%'</span>\n</code></pre></div></div>\n\n<p>However, this query will only match the very specific sub-string that it was given. It won’t match “TV that is second-hand” or “2nd-hand TV”, or “sceond-hnad TV”. Given enough perseverance you could theoretically construct a giant SQL-query that covered as many of these permutations as you had patience for:</p>\n\n<div class=\"language-sql highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">SELECT</span> <span class=\"o\">*</span>\n<span class=\"k\">FROM</span> <span class=\"n\">items</span>\n<span class=\"k\">WHERE</span>\n  <span class=\"n\">description</span> <span class=\"k\">LIKE</span> <span class=\"s1\">'%second%hand%TV'</span> <span class=\"k\">OR</span>\n  <span class=\"n\">description</span> <span class=\"k\">LIKE</span> <span class=\"s1\">'%second%TV%hand'</span> <span class=\"k\">OR</span>\n  <span class=\"c1\">-- …and so on and so on for another bajillion ORs…</span>\n</code></pre></div></div>\n\n<p>However, the resulting query would be slow and cumbersome, and would still miss many important edge-cases that you hadn’t thought of. And even if you did get back a useful list of search results, you’d still have a lot of work left to do in order to decide how to order them. The ordering you want isn’t something strict like “most-recent first” or “alphabetically by title”. Instead it’s some much woolier notion of “best” or “most-relevant” first.</p>\n\n<p>All of this means that SQL databases are generally not very good at full-text searches. Fortunately, other types of database are, including one called <em>Elasticsearch</em>. Elasticsearch is often described as a <em>document-oriented database</em>. We don’t need to go into the details of how exactly it works, but the important part for us is that, unlike SQL databases, Elasticsearch is very good at taking queries like “second-hand TV” and returning a list, ordered by “relevance,” of the fuzzy matches that users have come to expect from their search engines.</p>\n\n<p>“Sounds like Elasticsearch is just better than SQL,” you might say. “Should we throw away our SQL databases and put everything in Elasticsearch instead?” Not so fast. Elasticsearch, and other databases like it, have their strengths, but they also have their weaknesses. They’re typically somewhat less reliable than SQL databases, and are somewhat more likely to accidentally lose data at large scale. They’re also often much slower to write new data to.</p>\n\n<p>As we’ve already noted, there’s rarely a single, universally “best” tool for any type of job. There’s certainly no such thing as “the best” database. Instead, different databases have different strengths and weaknesses, and different solutions are appropriate for different tasks. At Steveslist, we care so much about making sure that we use the right tool for the right job that we store our data in both a SQL database <em>and</em> a document-oriented database like Elasticsearch.</p>\n\n<p>We use our SQL database as our primary data store. It is our authoritative “source-of-truth”, and we write all our new data to it before we write it anywhere else. We do all our simple, precise reads from it, especially when accuracy and up-to-date-ness are our principal requirements. If we want to show a user a list of all their open listings, we read it from our SQL database. If we want to validate a users password, we read that from our SQL database too. This plays to the strengths of SQL databases.</p>\n\n<p>However, in the background we also copy data from our SQL database into an Elasticsearch database, and send any full-text search queries made via our search box to Elasticsearch. This means that we benefit from the strengths of Elasticsearch, and are not impacted too much by its weaknesses. We copy over batches of records every few minutes, hours, or days, depending on the requirements of the specific dataset. Alternatively, we could watch the logs of our SQL database for new or updated records, and create or update the corresponding Elasticsearch records in near-realtime.</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>                   |      |                   |\nNew data is always |      |Queries for        |Full-text search \nwritten to the SQL |      |specific data go   |queries go to\nDB first           |      |to the SQL DB too  |Elasticsearch\n                   V      V                   V\n               +--------------+       +---------------+\n               | SQL Database +------&gt;+ Elasticsearch |\n               +--------------+       +---------------+\n                       New data is copied over from\n                       the SQL DB to Elasticsearch\n</code></pre></div></div>\n\n<p>When scouting Steveslist’s competition, I noticed that when you create a new Craigslist listing it says “your listing will be visible in search within the next 15 minutes”. I’ll bet pesos to pizza that this is because their primary datastore is a SQL database, but their search box is powered by an Elasticsearch-like engine. Their pipeline for replicating data from SQL to search probably takes around 15 minutes, which they’ve decided (very reasonably) is an acceptable delay for their particular use-case.</p>\n\n<p>We’ve said that Elasticsearch is somewhat less reliable than most SQL databases. If Elasticsearch accidentally loses a few of our records then they won’t appear in search results. This would be a shame that would make our product a bit worse, and we try our hardest to avoid it happening. However, it wouldn’t be a disaster in the same way that losing data from our primary data store would be. We only copy data over to Elasticsearch once it has been written to and safely captured by our source-of-truth SQL database, which is what really matters.</p>\n\n<hr>\n\n<p>It’s 6pm, and the library is closing. A librarian tries to ask you to leave. Kate shoos him away with a barrage of crumpled-up balls of paper.</p>\n\n<hr>\n\n<h2 id=\"internal-tools\">Internal tools</h2>\n\n<p>Managing the Steveslist platform requires bespoke internal tools. We need to perform a wide range of administrative tasks, like deleting listings that are too illegal (even for us), issuing refunds, viewing a user’s personal details in order to help with support requests, and so on. Many of these tools will be used by people who work on other teams at Steveslist, like finance, compliance, legal, sales, and support. Since the tasks they need to perform are so specific to the way that Steveslist works, we can’t do them using third-party tools, and have to build our own instead.</p>\n\n<p>In the early days, we baked this functionality into the main Stevelist product and only exposed it to users who had the <code class=\"language-plaintext highlighter-rouge\">is_steveslist_employee = True</code> database flag set. This was an OK approach for a small company, but was also fragile and easy to mess up. It was scary to think that we were exposing all of our superuser powers through the same servers that run our main product. It made the potential consequences of a security flaw in our application much worse, and created new types of mistake for us to make, such as forgetting to disable the <code class=\"language-plaintext highlighter-rouge\">is_steveslist_employee</code> flag for an acrimoniously fired employee.</p>\n\n<p>Once Steveslist reached a certain level of maturity, we built ourselves an entirely separate admin platform, with separate, hardened authentication and authorization. The service runs on entirely separate servers, and requires a <em>VPN</em> and a <em>TLS client certificate</em> to access (which we’ll talk about another day). This separated out our internal- and external-facing products, and drastically reduced the chance of a boneheaded error exposing our admin tools to the world. We’re frequently building new internal tools - one for user administration, one for server management, one for fraud detection, and so on. These services all talk to the same database as our user-facing products, so they all have access to the same data. They just run on different servers that are completely inaccessible to the outside world.</p>\n\n<h2 id=\"cron-jobs\">Cron jobs</h2>\n\n<p>There are lots of tasks that we’ll want our system to perform at fixed times and intervals. For example:</p>\n\n<ul>\n  <li>Emailing ourselves weekly usage reports</li>\n  <li>Sending marketing emails to users</li>\n  <li>Charging the credit cards users who have a subscription plan with us</li>\n  <li>Copying data from our SQL database to Elasticsearch</li>\n</ul>\n\n<p>The most common tool used for running scheduled jobs is called <em>cron</em>, a tool that is built into Unix operating systems. It’s so common that people will often call any kind of scheduled job a “cron job”, even when it’s not actually being run by cron.</p>\n\n<p>You can set up a cron job on your own computer by running:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>crontab -e\n</code></pre></div></div>\n\n<p>Then typing into the prompt:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>*/5 * * * * $YOUR_COMMAND\n</code></pre></div></div>\n\n<p>This will cause your computer to execute <code class=\"language-plaintext highlighter-rouge\">$YOUR_COMMAND</code> every 5 minutes.</p>\n\n<p>Steveslist currently has a very simple and slightly fragile cron setup. We have a single “scheduled jobs server”. We use <code class=\"language-plaintext highlighter-rouge\">crontab</code> on this server (as above) to tell it the commands that we want it to run, and the schedule that we want it to run them on. This setup isn’t scaling very well - if the scheduled jobs server explodes or even hiccups then we don’t always know which jobs it did and didn’t run, and have to scramble to bring up a replacement server. And even though the server is very beefy and powerful, eventually we’re going to want to run more jobs than it can handle at once. We’re considering either splitting up our cron jobs into multiple servers, or setting up a new system using a modern tool like <em>Kubernetes</em>.</p>\n\n<h2 id=\"pubsub\">Pubsub</h2>\n\n<p>Actions have consequences. This is both the subject line of the sinister emails that we send to people who write mean things about us on the internet, and the reason we have a <em>pubsub</em> system.</p>\n\n<p>When a new user signs up, we want to send them an email welcoming them to Steveslist and reminding them about the action-consequence relationship I just described. When a new listing is added for a stolen TV in San Francisco, we want to notify users who have set up search alerts for TVs in the Bay Area. When a card is declined for a subscription, we want to email the responsible user to politely threaten them. When a new listing is added, we want to perform some extremely cursory anti-fraud checks. When an item is purchased, we want to sent a webhook to its seller. And so on.</p>\n\n<p>Technically, all of these actions could be performed synchronously (rememberer that word?) by the server executing the initiating action. However, this is often a bad idea, for two reasons. First, the response action (such as emailing all the users who are subscribed for notifications about new stolen TVs) may be very slow. Performing the response action synchronously means that if the initiating action was performed by a user then they will have to wait for all the response actions to finish too. This might not be the end of the world if the response action is small and quick, like sending a single email. But if it’s larger - like searching for and notifying all users who might be interested in a new item - then, well, it still won’t be the end of the world, but it will be a bad user experience.</p>\n\n<p>To mitigate this problem we have built a “publish-subscribe” or “pubsub” system. When a trigger action is performed, the code that performs it “publishes an event” describing the action, such as <code class=\"language-plaintext highlighter-rouge\">NewListingCreated</code> or <code class=\"language-plaintext highlighter-rouge\">SubscriptionCardDeclined</code>. The words “event” and “publish” are quite loosely defined in this context, and don’t have a rigorous technical definition. An event is just some sort of record of something that happened, and to publish an event just means that you somehow make a note that something happened. The details of how you do so depend entirely on the pubsub system in question. In a simple system events might be stored in tables in a SQL database, and code would publish events by writing new records to a table.</p>\n\n<p>If a programmer at Steveslist wants a response action to be performed whenever a new event of a particular type is published, they can write a <em>consumer</em>. This is a piece of code that “subscribes” to a type of event, and which is executed whenever a new event of that type is published. It uses the details of the event (for example, the user whose subscription payment failed) to asynchronously execute whatever actions the programmer wants (for example, sending the user a menacing email).</p>\n\n<p>Pubsub systems are often managed by a central <em>message broker</em>. Systems publish events to the broker, and the broker is then responsible for getting the events to any subscribed consumers. This can be achieved using either a <em>push</em> or a <em>pull</em> mechanism. Consumers can pull messages from the broker by polling it and repeatedly asking “any new events? any new events?” or they can wait and listen and the broker can push notifications of new events out to them, for example by sending them an HTTP request.</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>1. New user signs|\nup to Steveslist |\n                 v\n       +-----------------+               +------------------------+\n       |Steveslist Server|           +--&gt;+SendWelcomeEmailConsumer|\n       +---------+-------+           |   +------------------------+\n                 |                   v\n2. Server reports|     +-------------++  4. Consumers send welcome\na NewUserSignup  +----&gt;+Pub/Sub Broker|  emails, check for spam,\nevent to the           +-------------++  etc.\nPub/Sub system                       ^\n              3. Pub/Sub broker      |   +------------------------+\n              notifies consumers     +--&gt;+NewUserSpamCheckConsumer|\n              that have subscribed to    +------------------------+\n              NewUserSignup events.\n</code></pre></div></div>\n\n<p>Pubsub systems have many benefits:</p>\n\n<ul>\n  <li>Non-critical actions are performed asynchronously, keeping the user experience snappy</li>\n  <li>Our code is kept clean and well-separated. The code that publishes an event doesn’t have to care about what the events’ subscribers do in response</li>\n  <li>If a subscriber’s action fails for some reason (for example, the email-sending system has a hiccup), the pubsub system can note this failure and retry again later</li>\n</ul>\n\n<p>Next, let’s talk big data.</p>\n\n<h2 id=\"big-data-and-analytics\">Big data and analytics</h2>\n\n<p>In order to understand and optimize our business, we need to be able to calculate complex statistics across the entire Steveslist platform. How many listings are created every day, segmented by country and city? How many users who signed up each month have created a listing within 90 days of signing up?</p>\n\n<p>To do this, we need to write database queries that aggregate over the entirety of our data. We don’t want to run these queries against our production SQL database, because they could put an enormous amount of load on it. We don’t want a huge query issued by an internal analyst to be able to bring our production database to a grinding halt, but we do want to provide this analyst with a tool that is well-suited to their needs. To complicate matters further, database engines that are quick at small queries (like returning all the listings belonging to a single user) are typically unacceptably slow (or indeed incapable) of answering giant queries (like calculating the total dollars spent on listings in each category, per day, for the last 90 days).</p>\n\n<p>Despite this, for the first year or so after Steveslist was founded, we took a risk and simply ran our analytics queries against the main production database. This was a gamble, but it just about worked. We didn’t have much data anyway, and we had more important things to focus on, like attracting the customers who would create the big data that would one day mean that we had to find a more scalable solution.</p>\n\n<p>Eventually we did bring down the production database with an overly-ambitious query, and decided that the time had come to invest in a data warehouse. A data warehouse is a data store that is well-suited to large, system-wide queries. Our warehouse is powered by a database engine called <em>Hive</em>, but we could also have chosen Presto, Impala, Redshift, or any number of competing alternatives. Hive accepts queries written in SQL, but is much better at executing these queries against giant datasets than our MySQL database is.</p>\n\n<p>We replicate our data from our production SQL database to Hive, once a day, overnight. Steveslist analysts and programmers can query the same dataset using whichever database engine best suits their needs. They can use the production SQL database for small, precise, source-of-truth queries from production systems; Elasticsearch for full-text search queries; or the data warehouse for huge queries that aggregate over vast volumes of data.</p>\n\n<hr>\n\n<p>It’s dark outside and you’re hungry. Is that pretty much it? you ask.</p>\n\n<p>“Oh god no,” Kate replies, “we could keep going forever. But this is a pretty good start. It’s helpful to have a broad understanding of a wide range of topics, but no one needs to know the details about everything. I find that once you know some basics you can keep picking up more basics and even a couple of details as you go along.”</p>\n\n<p>You ask if Kate could perhaps continue to elaborate on her five-year vision for Steveslist tomorrow.</p>\n\n<p>“Absolutely,” says Kate. We’ll talk about more of what goes on inside a real, large online platform, including:”</p>\n\n<h3 id=\"security\">Security</h3>\n\n<ul>\n  <li>HTTPS and other forms of encryption</li>\n  <li>Two-factor authentication</li>\n  <li>SAML</li>\n  <li>Secret key management</li>\n</ul>\n\n<h3 id=\"server-management\">Server management</h3>\n\n<ul>\n  <li>Deploying new code</li>\n  <li>AWS and competitors</li>\n  <li>Terraform</li>\n  <li>Load balancers</li>\n  <li>Containers</li>\n  <li>Alerting when code breaks</li>\n</ul>\n\n<h3 id=\"big-data\">Big data</h3>\n\n<ul>\n  <li>Map-reduce and other big data jobs</li>\n  <li>Machine learning</li>\n  <li>User tracking</li>\n</ul>\n\n<p>“See you tomorrow at 7am?”</p>\n\n\n        \n        <hr>\n        <div style=\"\">\n          <a href=\"https://twitter.com/robjheaton\">\n            Follow me on Twitter\n          </a>\n          or\n          <a href=\"https://robertheaton.com/feed.xml\">\n            RSS\n          </a>\n        </div>\n\n        <section style=\" padding-top: 60px;\">\n  <form action=\"https://ifoundthishelped.us4.list-manage.com/subscribe/post?u=84f18d8141e4ba155f81fb4eb&amp;id=264b2ba598\" method=\"post\" id=\"mc-embedded-subscribe-form\" name=\"mc-embedded-subscribe-form\" class=\"validate\" target=\"_blank\" novalidate=\"\">\n    <label for=\"mce-EMAIL\">\n      <h3 style=\"font-size: 1.5em; margin-top:-10px; margin-bottom:-6px;\">Get new essays sent to you</h3>\n    </label>\n    <p id=\"mce-email-describe\">\n      Subscribe to my new work on programming, security, and a few other\n      topics. Published a few times a month.\n    </p>\n\n    <input type=\"email\" value=\"\" name=\"EMAIL\" class=\"required email\" id=\"mce-EMAIL\" placeholder=\"Your email address\" style=\"width:200px;font-size: 1.1em; padding-left:4px; line-height:1.7em\">\n    <input type=\"submit\" value=\"Subscribe\" name=\"subscribe\" id=\"mc-embedded-subscribe\" class=\"button as-link green\" style=\"position:relative; top: -1px; border-radius: 3px;\n    border: 1px solid #97d69c;\n    cursor: pointer;\n    height: 37px;background-color: #3eb542;\n    color: white;\n    font-size:1.1em\">\n\n    <div id=\"mce-responses\" class=\"clear\" style=\"margin-top:15px\">\n      <div class=\"response\" id=\"mce-error-response\" style=\"display:none\"></div>\n      <div class=\"response\" id=\"mce-success-response\" style=\"display:none\"></div>\n    </div>  \n    <p><span style=\"color: #f92672;\">NEW:</span> Also subscribe to my new series, <a href=\"https://advancedbeginners.substack.com\">Programming Feedback for Advanced Beginners</a></p>\n\n  </form>\n  <div style=\"clear:both\"></div>\n</section>\n\n        \n  <h3 style=\"font-size: 1.5em;padding-top:30px;\">More on Programming Projects for Advanced Beginners</h3>\n  <ul>\n    \n      \n        \n          \n          <li>\n            <a href=\"/2020/04/19/pfab13-when-code-is-too-clever-to-be-clean/\">PFAB #13: When code is too clever to be clean</a>\n          </li>\n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n      \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2020/03/07/pfab11-separating-logic-and-data/\">PFAB #11: Separating logic and data</a>\n          </li>\n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2020/02/23/pfab10-first-class-functions-dependency-injection/\">PFAB #10: First-class functions and dependency injection</a>\n          </li>\n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2020/02/08/pfab9-batch-vs-stream-processing/\">PFAB #9: Batch vs Stream processing</a>\n          </li>\n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2020/01/26/pfab8-input-validation/\">PFAB #8: Input validation - tradeoffs between convenience and surprise</a>\n          </li>\n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2020/01/04/pfab7-how-to-write-a-library/\">PFAB#7: How to write a library</a>\n          </li>\n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2019/12/28/pfab6-real-world-debugging-practice/\">PFAB#6: Real-world debugging practice</a>\n          </li>\n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2019/12/21/ppab5-how-to-make-your-programs-shorter/\">PFAB#5: How to make your programs shorter</a>\n          </li>\n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2019/12/14/pfab4-exception-handling-dealing-with-failure/\">PFAB#4: Exception handling and coping with failure</a>\n          </li>\n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2019/12/07/pfab3-analyze-commute/\">PFAB#3: How to rigorously analyze your journey to work</a>\n          </li>\n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2019/11/30/pfab2-how-to-structure-your-programs/\">PFAB#2: How to structure your programs</a>\n          </li>\n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2019/11/11/pfab1/\">PFAB#1: Define your boundaries</a>\n          </li>\n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2019/11/08/programming-feedback-for-advanced-beginners-0/\">Programming Feedback for Advanced Beginners #0</a>\n          </li>\n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2019/11/08/i-will-give-you-feedback-on-your-code/\">I will give you feedback on your code</a>\n          </li>\n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2019/08/12/programming-projects-for-advanced-beginners-user-logins/\">Programming Projects for Advanced Beginners #6: User Logins</a>\n          </li>\n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2019/08/11/real-world-programming-projects-for-advanced-beginners/\">Real-World Programming Projects for Advanced Beginners</a>\n          </li>\n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2019/07/27/programming-videos-for-advanced-beginners-battleships/\">Programming Videos for Advanced Beginners #1: Battleships</a>\n          </li>\n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2019/04/14/open-source-for-advanced-beginners-1-bashplotlib/\">Open Source for Advanced Beginners #1: bashplotlib</a>\n          </li>\n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2019/04/13/open-source-for-advanced-beginners/\">Open Source for Advanced Beginners</a>\n          </li>\n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2019/03/25/what-beginners-mind-is-really-like/\">What beginner's mind is really like</a>\n          </li>\n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2018/12/08/programming-projects-for-advanced-beginners/\">Programming Projects for Advanced Beginners</a>\n          </li>\n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2018/12/02/programming-project-5-snake/\">Programming Projects for Advanced Beginners #5: Snake</a>\n          </li>\n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2018/11/03/programming-project-4-photomosaics/\">Programming Projects for Advanced Beginners #4: Photomosaics</a>\n          </li>\n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2018/10/09/programming-projects-for-advanced-beginners-3-b/\">Programming Projects for Advanced Beginners #3b: Tic-Tac-Toe AI</a>\n          </li>\n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2018/10/09/programming-projects-for-advanced-beginners-3-a/\">Programming Projects for Advanced Beginners #3a: Tic-Tac-Toe AI</a>\n          </li>\n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2018/07/20/project-2-game-of-life/\">Programming Projects for Advanced Beginners #2: Game of Life</a>\n          </li>\n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n          <li>\n            <a href=\"/2018/06/12/programming-projects-for-advanced-beginners-ascii-art/\">Programming Projects for Advanced Beginners #1: ASCII art</a>\n          </li>\n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n    \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n    \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n    \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n    \n      \n    \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n        \n          \n        \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n  </ul>\n\n\n        <section class=\"navigation\" style=\"padding-top:13; margin:0\">\n  \n    <div class=\"pull-left\">\n      <a href=\"/2020/03/18/yourself-happier-iphone-worse/\" id=\"next\">\n        <span>◀ How to make yourself happier by making your iPhone worse</span>\n      </a>\n    </div>\n  \n  \n    <div class=\"pull-right\">\n      <a href=\"/2020/04/13/hundreds-of-companies-assert-usage-rights-over-all-ideas/\" id=\"prev\">\n        <span>Hundreds of companies assert usage rights over all ideas sent through their services ▶</span>\n      </a>\n    </div>\n  \n</section>\n\n        <br>\n      </section>\n    </div>\n    <footer>\n  <div class=\"stuff\" style=\"text-align: center; padding:5px;\">\n    <a href=\"/\">Home</a> /\n    <a href=\"/archive\">Archive</a> /\n    <a href=\"/feed.xml\">RSS</a> /\n    <a href=\"https://twitter.com/robjheaton\">Twitter</a> /\n    <a href=\"/office-hours\">Office hours</a> /\n    <a href=\"/tipoffs\">Tipoffs</a> /\n    <a href=\"https://soundcloud.com/rob24242/\">SoundCloud</a> /\n  </div>\n</footer>\n\n  \n\n","text":"Robert Heaton\n\n\nSoftware Engineer / One-track lover / Down a two-way lane\n\nAbout\nArchive\nTwitter\nNEW: Programming Feedback for Advanced Beginners\nSystems design for advanced beginners\n06 Apr 2020\n\nThis post is part of my Programming for Advanced Beginners series. Subscribe now to receive specific, actionable ways to make your code cleaner, every other week, entirely free.\n\nYou’ve started yet another company with your good friend, Steve Steveington. It’s an online marketplace where people can buy and sell things and where no one asks too many questions. It’s basically a rip-off of Craigslist, but with Steve’s name instead of Craig’s.\n\nYou’re going to be responsible for building the entire Steveslist technical platform, including all of its websites, mobile apps, databases, and other infrastructure. You’re excited, but also very nervous. You figure that you can probably cobble together a small website, since you’ve done that a few times before as part of your previous entertaining-if-morally-questionable escapades with the Stevester. But you have no idea how to even start building out all of the other infrastructure and tools that you assume lie behind large, successful online platforms.\n\nYou are in desperate need of a detailed yet concise overview of how real companies do this. How do they store their data? How do their different applications talk to each other? How do they scale their systems to work for millions of users? How do they keep them secure? How do they make sure nothing goes wrong? What are APIs, webhooks and client libraries, when you really get down to it?\n\nYou send a quick WhatsApp to your other good friend, Kate Kateberry, to see if she can help. You’ve worked together very effectively in the past, and she has decades of experience creating these types of systems at Silicon Valley’s biggest and most controversial companies.\n\nShe instantly accepts your job offer. You had actually only been ringing for some rough guidance and a good gossip, but you nonetheless instantly accept her acceptance. No point looking a gift horse in the mouth, even when you don’t have any money to pay her. Kate proposes that her first day be 5 weeks ago in order to help her smooth over some accounting irregularities. She can come into the office sometime next week. You feel encouraged and threatened by her eagerness.\n\nKate bounces into your offices in the 19th Century Literature section of the San Francisco Public Library. “OK let’s do this!” she shouts quietly. “What have we got so far? How are all our systems set up? What’s the plan?” You lean back in your chair and close your laptop, which was not turned on because you have left your charger at home. You steeple your fingers in a manner that you hope can be described as “thoughtful”.\n\n“Let me flip that question around, Kate. What do you think the plan should be?”\n\nKate takes a deep breath and paints an extremely detailed vision of the Steveslist platform five years into the future and the infrastructure that will power it.\n\nBefore we start (says Kate), I want to make it clear that I’m not saying that any of this is necessarily the “right” way to set up our infrastructure. If someone you trust more than me says something different then you should probably do what they say. There are many tools out there, each with different strengths and weaknesses, and many ways to build a technology company. The real, honest reasons that we will make many of our technological choices will be “we chose X because Sara knows a lot about X” and “we chose Y on the spur of the moment when it didn’t seem like a big decision and we never found the time to re-evaluate.”\n\nNonetheless, let’s fast-forward five years into the future. Now Steveslist has two main consumer-facing products:\n\nThe Steveslist web app\nThe Steveslist smartphone apps\n\nThese are the main ways in which users directly interact with the Steveslist platform. In addition, we also provide an API that allows programmers to build power-tools on top of the Steveslist platform that, for example, create listings for hundreds of items programmatically. To support this, we offer:\n\nA Steveslist API\nSteveslist API client libraries that make it easy for programmers to write code that talks to our API\n\nHere, I’ll draw a diagram on the whiteboard:\n\n+-----------+   +--------------+   +-----------------+\n|Web Browser|   |Smartphone App|   |Client Libraries/|\n+-----+-----+   +------+-------+   |Other API code   |\n      |                |           +-------+---------+\n      |                v                   |\n      |          +-----+------+            |\n      +--------->+ Steveslist +<-----------+\n                 |  Servers   |\n                 +------------+\n\n\nFinally, we have many, many services running in the background that provide the data and power to these external-facing applications:\n\nWebhooks - to notify users when something happens to their account, such as “order placed”\nUser password authentication - to securely log users in\nSQL database - the main Steveslist data store. Needs to be highly scalable and reliable\nFree-text searching system - to power the search box where people can look for broad search terms like “TVs” or “motorbikes”\nInternal tools - to help us administer the Steveslist platform, and to take actions like issuing sternly-worded warnings to malicious users\nCron jobs - to run regular tasks that do anything from generating invoices, to billing customers, to sending as much of our users’ data as possible to third-party ad networks\n“Pubsub” system - to allow us to take asynchronous actions on different trigger events (such as “when a new user signs up, send them a welcome email”)\nBig data analytics system - to allow us to run enormous queries over the entirety of Steveslist’s data\nAnd many more that we’ll talk about another day\n\nLet’s go through each of these systems in turn. Let me know if anything isn’t clear, if you have any questions, or if you think I’ve got something wrong.\n\nBefore we start - what is a server really?\n\nBefore we start, let’s define some important terms. In fact, let’s just define one. We’re going to talk a lot about “servers” today. But what is a server, when you really get down to it?\n\nFor our purposes, a server is a computer that runs on a network and listens for communications from other computers. When it receives some data from another computer it performs some sort of action in response and - usually - sends back some data of its own. For example, a web server listens on a network for HTTP requests and sends back webpages and information in response. A database server listens for database queries and reads and writes data to the database that it is running.\n\nThis brief description skips out entire degrees and careers of detail, and there are of course far more precise and accurate ways to define the word “server”. But this should get us through until dinnertime. What did you say? What’s a “network” really? A good question for another day.\n\nNow we’re ready to talk about the Steveslist platform.\n\nSteveslist web app\n\nThis is the main Steveslist product. It’s just a normal web app, very similar to any website that you’ve built before, except much bigger. It’s a modern “single-page app” (SPA). The “single” in “single-page app” refers to the fact that the user’s browser almost never has to fully reload the page as the user clicks around our site. Instead, when the browser makes its first HTTP request to our servers, we send it back a basic, skeleton HTML page and a big pile of JavaScript code. This JavaScript code executes inside the browser, and updates the view of the page in response to the user’s actions. When the JavaScript wants to send or retrieve data from Steveslist, it sends an Asynchronous JavaScript XML Request (almost always called AJAX for short) in the background to a URL. When our server responds, the JavaScript uses the response to update the browser view accordingly.\n\n+----------+1.User's browser visits steveslist.com. +----------+\n|          |  It sends an HTTP request to the       |          |\n|          |  Steveslist servers                    |          |\n|          +--------------------------------------->|          |\n|User's Web|                                        |Steveslist|\n| Browser  |2.Steveslist server responds with a     | Servers  |\n|          |  skeleton HTML page that instructs the |          |\n|          |  browser to request additional         |          |\n|          |  JavaScript files.                     |          |\n|          |<---------------------------------------+          |\n|          |                                        |          |\n|          |3.User's browser requests and receives  |          |\n|          |  these JavaScript files from the       |          |\n|          |  Steveslist server.                    |          |\n|          +--------------------------------------->|          |\n|          |<---------------------------------------+          |\n|          |                                        |          |\n|          |4.User's browser executes the JavaScript|          |\n|          |  code. The code sends more requests for|          |\n|          |  the user's data to the Stevelist      |          |\n|          |  server, and updates the browser UI to |          |\n|          |  display it.                           |          |\n|          +--------------------------------------->|          |\n|          |<---------------------------------------+          |\n+----------+                                        +----------+\n\n\nrobertheaton.com is not a single-page app. Whenever you click on a link, the browser has to reload the entire page. twitter.com is a single-page app. Whenever you click on a link, the browser dynamically updates a small portion of tthe page without forcing a full refresh.\n\nSPAs are a lot of work to build and maintain, but they sure look good.\n\nSteveslist smartphone apps\n\nWe provide Steveslist smartphone apps for both iOS and Android. They are conceptually very similar to our single-page web app. Both our smartphone and web apps make HTTP requests to our servers. Then our servers receive these requests, do some work and return an HTTP response. Finally, both our smartphone and web apps update their display in order to communicate with the user.\n\nSince our smartphone apps are performing the same operations as the web app (for example, create listing, send message, etc), they can usually even send their requests to the exact same URLs as the web app. The only extra work that we have to do is to develop the frontends of the apps themselves. Some frameworks even make it possible to write mobile apps using JavaScript, allowing you to reuse code and logic across platforms.\n\nSteveslist API\n\nWe allow users and third-parties to write code that programmatically interacts with our platform. In the same way that people can use the Twitter API to write code that reads; likes; and creates Tweets, we allow them to use the Steveslist API to search; buy; and list items.\n\nProgrammers use our API by writing code that makes HTTP requests to our API endpoints. For example, in order to retrieve a list of all their listings, the programmer sends an HTTP GET request to api.steveslist.com/v1/listings. We respond with the data they requested, formatted as JSON. JSON stands for JavaScript Object Notation, but JSON is not specific to JavaScript and can easily be interpreted by any programming language. A JSON response to a request to retrieve all of a user’s listings might look something like this:\n\n{\n  \"listings\": [\n    {\n      \"id\": 2178123867,\n      \"name\": \"Stolen TV\",\n      \"country\": \"US\",\n      \"city\": \"San Francisco\",\n      \"price_amount\": 1000,\n      \"price_currency\": \"usd\",\n      # etc...\n    },\n    {\n      \"id\": 182312679,\n      \"name\": \"Stolen Bicycle\",\n      \"country\": \"US\",\n      \"city\": \"San Francisco\",\n      \"price_amount\": 2000,\n      \"price_currency\": \"usd\",\n      # etc...\n    }\n  ]\n}\n\n\nThis structured response format is very easy for a program to parse, which means that the code that made the request can trivially interpret and use the data from our API.\n\nUsers identify or authenticate themselves to our API using an API key. This is, roughly speaking, the API equivalent of a password. It is a long, random string that we generate and display on a user’s “Settings” page. Users include their API key as an HTTP header with every HTTP request that they (or their code) makes to the API. When we receive an API request we check to see whether the attached API key corresponds to a Steveslist user. If it does then we perform the request on behalf of that user.\n\nIf a programmer wants to, they can manually build HTTP requests to our API themselves, using their language’s standard HTTP library. For example, in Python they might write:\n\nimport requests\n\nurl = 'https://api.steveslist.com/v1/listings/'\nlisting_params = {\n  \"name\": \"Stolen TV\",\n  \"country\": \"US\",\n  \"city\": \"San Francisco\",\n  \"price_amount\": 1000,\n  \"price_currency\": \"usd\",\n}\napi_key = \"YOUR_API_KEY_GOES_HERE\"\n\nresponse = requests.post(\n  url,\n  data=listing_params,\n  headers={\"X-Steveslist-API-Key\": api_key},\n)\n\n\nHowever, we make life easier for programmers by providing client libraries.\n\nSteveslist client libraries\n\nA client library is a library that “wraps” the functionality of the Steveslist API. This means that anyone using the client library doesn’t need to know anything about the fine details of the Steveslist API. Instead, they can just write:\n\nimport steveslist\n\nlisting = steveslist.Listing.create(\n  name=\"Stolen TV\",\n  country=\"US\",\n  city=\"San Francisco\",\n  price_amount=1000,\n  price_currency=\"usd\",\n  api_key=\"YOUR_API_KEY_GOES_HERE\"\n)\n\n\nOur libraries turn the parameters that they are given into appropriately formatted HTTP requests, which they send to the Steveslist API as normal. We’ve written client libraries for every major programming language that we could think of, and they are by far the most common way that people interact with our API.\n\nWebhooks\n\nWe’ve seen how Steveslist users can use our API to programmatically interact with their account. In addition, many users also want us to proactively tell them whenever something happens to their Steveslist profile. For example, suppose that someone wanted to fully automate the process of selling items on Steveslist. Whenever a customer pays for an item using our new, mostly-secure StevePay system, they want to send the customer a thank you email and automatically instruct their warehouse to ship a stolen TV to the order address. Our seller could constantly and repeatedly query the Steveslist API asking “Any new sales? Any new sales?” However, this would be very inefficient, and would put a lot of unnecessary load on our servers.\n\nInstead, we provide an industry standard system called webhooks. A webhook is an HTTP request that we send to our users whenever something interesting happens to their account. It contains all the data describing the event that just happened - for example, the item ID, the price, the buyer ID, buyer address, and so on. Webhooks allow users to automatically perform response actions, such as the aforementioned email and auto-shipping.\n\nTo use webhooks, the user tells us the URL to which they would like us to send their webhooks (for example, steveslistwebhooks.robertheaton.com. They set up a web server at that URL that will receive and action these webhook notifications.\n\n1.Buyer purchases an      3.The seller's server receives the webhook,\n  item as normal.           and uses the information in it to\n                            automatically process the order.\n+---------------+           +-----------------+\n|Buyer's Browser|           |Seller's Webhook-+\n+------+--------+           |Receiving Server |\n       |                    +------+----------+\n       |                           ^\n       |                           | \n       |                           |   \n       |    +-----------+          |\n       +--->+ Steveslist+----------+\n            |   Server  |\n            +-----------+\n       2.Once the transaction has been completed,\n         Steveslist looks up the seller's\n         webhook URL (if set). We then send\n         an HTTP request to this URL,\n         containing the details of the purchase.\n\n\nThe user deploys code on their web server that performs the appropriate response actions whenever it receives a webhook from us. We don’t only send webhooks when an item is purchased - we also send them when a user receives a message; when one of their items is removed by an admin; or when a buyer makes a complaint. This enables Steveslist sellers to automate not just the listing of items, but also the selling and shipping of them too.\n\nWebhook complications\n\nWebhooks come with two main complications - security and reliability. First, let’s talk security. The endpoint to which the seller instructs us to send their webhooks is accessible to anyone on the internet. Anyone who knows the URL can send it fake webhooks, and if our seller isn’t careful this could allow an attacker to trick them into, for example, sending the attacker free stuff. A seller’s webhook URL should be difficult to find, since the seller won’t publicize its existence, but obscurity is not the same as security.\n\nTo allow our sellers to verify that a webhook really was sent by Steveslist, we cryptographically sign our webhook contents.\n\nCryptographic signing\n\nCryptographic signing is a deep and subtle topic. Here’s a condensed version of how we use it to secure our webhooks.\n\nWhen a seller enables webhooks for their account, we generate a random “shared secret key”. We tell the seller to copy this key over to their webhook-receiving server and keep it secure, so that its value is known only by us and the seller. Whenever we send a webhook, we take this shared secret, combine it with the contents of the webhook by using a cryptographic hash function called HMAC, and get back a long, random-seeming, but entirely deterministic “signature” for the webhook.\n\nWebhook contents   +----------+\n(eg. {\"id\": 123...})          |\n                              v\n                          +---+----------+\n                          |HMAC Algorithm|----->Webhook signature\n                          +---+----------+\n                              ^\nShared secret key             |\n(eg. 123mhu23jy8xdwgmd...)+---+\n\n\nWe include this signature in our webhook body, for example:\n\n{\n  \"action\": \"item_sold\",\n  \"price\": 100,\n  // ...more params...\n  \"signature\": \"234gj98d49j834978gf39t78ndn98g7dq3ng897308y7\"\n}\n\n\nWhen the seller’s webhook-receiving server receives a webhook, it takes the shared secret and webhook contents and calculates what it expects the signature to be in exactly the same way that we did. It compares the result to the signature attached to the webhook; if they match then it accepts and processes the webhook. Since the signature can only be generated using the shared secret known only by us and the seller, the webhook-receiving server can be confident that the webhook was sent by us. If the signatures don’t match, however, the server rejects the webhook.\n\nNote that all of the signature verification code must be written and maintained by the sellers. We can provide them with encouragement and examples, but we can’t force them to verify signatures correctly, or even at all. For some real-world examples, look at how Stripe and GitHub sign their webhooks.\n\nReliability\n\nWe also need to consider what happens when our webhooks go wrong and what guarantees we want to make to our users about them. If we try to send a webhook but can’t connect to the user’s server, what should we do? What if we successfully connect to their server and send the webhook, but their server sends back an error? What if we send the webhook but the server hangs for twenty seconds before disconnecting without telling us what happened?\n\nThere are tradeoffs involved here that require clear communication and a surprising amount of infrastructure to manage. We at Steveslist choose to guarantee that we will deliver webhooks “at least once”. This means that if a webhook fails to send then we will keep trying (a large but not infinite number of times) until it does. If we’re not sure whether a webhook succeeded or failed, we will keep trying until we are sure that an attempt has succeeded. This might occasionally result in us sending the same webhook twice, but it’s the seller’s responsibility to have their code handle this gracefully instead of sending the same customer five stolen TVs instead of the one that they ordered.\n\n“What do you think so far?” asks Kate. “Is this roughly what you’ve been thinking?” You make a non-committal face and take a big bite of a nearby sandwich in order to preclude any further discussion. Kate continues:\n\nLet’s talk about the backend systems that will power some of our most important features.\n\nUser authentication via a password\n\nMost users sign into the Steveslist website and smartphone apps using a username and password. There are other ways of signing into the website, like OAuth - we’ll cover them another time.\n\nWe will have to store our users’ passwords very securely. Not only is a user’s password the thing they use to sign in (or authenticate) to Stevelist, but for many users they’re probably the same password that they use to sign in to many other services too, despite all the warnings that this is a bad idea. They only have so many children with so many birthdays, after all.\n\nRupert Herpton has written the seminal tutorial on how to secure passwords, which I’m sure you’ve read already. Just in case you need a refresher, the crux of the matter is that we mustn’t ever store passwords in their original, plaintext form, anywhere. We mustn’t store them in plaintext in a database, in a log file, or in any other part of our system. Instead, before storing a password, we must first hash it using a hash function such as bcrypt.\n\nA hash function is a “one-way” function that takes an input and deterministically converts it into a new, seemingly-random string. Calculating a hash value from an input is computationally very easy, but reversing the transformation and recovering the original input from its hash value takes so much time and computing power that it is, practically-speaking, impossible.\n\n+---------+     Easy    +----------+\n|         |------------>|          |\n|Plaintext|             |Hash value|\n|         |<------------|          |\n+---------+ Essentially +----------+\n            Impossible\n\n\nSince we only store the hash values of our users’ passwords, if a hacker somehow stole our password database (heaven forbid) (touch wood) then they would only be able to see the passwords’ hash values. They wouldn’t be able to easily turn these hash values back into plaintext passwords, meaning that they wouldn’t be able to use them to login to Steveslist, and they won’t be able to take advantage of all the people who re-use passwords across different services.\n\nSince we only store password hash values, when we want to check whether a login password that a user has given us is correct we first calculate its hash value, and compare the result to the hash value in our password database.\n\n                 +--------------+\n                 |User's Browser|\n                 +-----------+--+\n1.User attempts to  |        ^\nlog in:             |        |  3. Server logs the user in\n                    |        |  if password matches, and\n   username: steve  |        |  returns an error if it does not.\n   password: 12345  v        |  \n                 +--+--------+--+\n                 |  Steveslist  |\n                 |    Server    |\n                 +--------------+\n                        |\n2.Server computes       |     |username|password_hash|\nthe hash of the         |     +----------------------+\npassword and compares   +---->+steve   |23jy7213y7jO |\nit to the value in the        |kate    |21897213hh21 |\ndatabase.                     |...     |...          |\n\n\nAs previously mentioned, we also have to be careful not to log passwords in any of our debug output. This can be an easy mistake to make - if you log all of the parameters of every HTTP request, just in case you need it, you will certainly be logging user passwords. Facebook logged passwords in plaintext for many years, and whilst it didn’t seem to affect their stock price I’m sure it made them feel pretty silly for a day or two.\n\nKate pauses for breath. You pretend to take notes on your out-of-battery laptop.\n\nLet’s talk about infrastructure.\n\nDatabase servers\n\nSteveslist’s primary data store runs a common flavor of SQL database called MySQL. I won’t talk much about SQL here - the specifics of how it works aren’t too important, and you can find them on Google if you’re interested. Since we are so successful, we have a huge and growing amount of data to manage. We’ve started to become acutely aware that databases aren’t magic. They run on computers, just like any other program. As the volume of data in a database grows, the computer’s hard drive and memory starts to fill up. At the start of the company the easiest way to deal with this problem was to run our database on a single computer (or machine) with an enormous hard drive. But this could only stave off the problem for so long. Eventually our database contained more data than could be stored on any reasonable hard drive, and the database started to get slower and slower as we forced it to search through more and more records.\n\nWe had to take an entirely new approach, and reconfigure our database to store its data on multiple computers. We did this using sharding.\n\nSharding\n\nSharding a database means splitting its data into chunks (or “shards”) and storing each chunk on a separate machine. All of the machines that make up a database are together known as a database cluster. How you split data between machine in your cluster depends on your application and the types of operations you will be performing. For Steveslist we chose to split out our data by user. This means that all of the data for a given user is stored on the same machine. This includes their profile information, their listings, their messages, and so on. Data that doesn’t have a corresponding user (like “Deals of the Day”) can be sharded using a shard key other than user, or not sharded at all if the dataset is sufficiently small.\n\nThis means that we need an extra “routing” layer in front of our database, which knows which database machine is able to service which queries. We could either make our application servers (the servers that execute our code) responsible for knowing the mapping of user IDs to database shards, or have a centralized “router” that all servers send their requests to, and which is responsible for working out the appropriate machine to forward the request on to. Both approaches have their advantages. Making application servers responsible for maintaining the mapping reduces the number of hops that a request has to make, speeding them up. But having a centralized router makes updating the shard mapping much easier, since you only have to update it in one place.\n\nIf application servers are responsible for knowing the shard layout, we have a system that looks like this:\n\n            +          +          +\n            |          |          |\n            | Requests from users |\n            |          |          |\n            v          v          v\n     +------+----------+--------------------+\n     |            Application               |\n     |               Server                 |\n     |                                      |\n     |Database sharding config:             |\n     |* DB Server 1: IDs between 1-10000    |\n     |* DB Server 2: IDs between 10000-20000|\n     |* DB Server 3: IDs between 20000-30000|\n     +-+----------------+-----------------+-+\n       |                |                 |\n       |ID:501          |ID:15362         |ID:22361\n       |                |                 |\n       v                v                 v\n+-----------+     +-----------+     +-----------+\n|DB Server 1|     |DB Server 2|     |DB Server 3|\n+-----------+     +-----------+     +-----------+\n\n\nIf we have a centralized database router, we have a system that looks like this:\n\n            +          +          +\n            |          |          |\n            | Requests from users |\n            |          |          |\n            v          v          v\n     +------+----------+--------------------+\n     |            Application               |\n     |               Server                 |\n     |                                      |\n     |Database sharding config:             |\n     |* ??? Application Server has no idea  |\n     +------------+-----------+-------------+\n                  |           |\n      Application server sends all database\n      queries to the database router, which\n      forwards them to the correct shard.\n                  |           |\n                  v           v\n   +--------------+-----------+-------------+\n   |            Database router             |\n   |                                        |\n   |Database sharding config:               |\n   |* DB Server 1: IDs between 1-10000      |\n   |* DB Server 2: IDs between 10000-20000  |\n   |* DB Server 3: IDs between 20000-30000  |\n   +---+----------------+---------------+---+\n       |                |               |\n       |ID:501          |ID:15362       |ID:22361\n       |                |               |\n       v                v               v\n+-----------+    +-----------+   +-----------+\n|DB Server 1|    |DB Server 2|   |DB Server 3|\n+-----------+    +-----------+   +-----------+\n\n\nHow do we decide which database to assign each user to? However we want. We could start by saying that users with odd-numbered IDs are assigned to shard machine 1, and those with even-numbered ones are assigned to shard machine 2. We could hope that this random assignment results in balancing our data relatively evenly between our shards.\n\nHowever, it’s possible that we might have a small number of power users who create much, much more data than others. Maybe they create so much data that we want to allocate them a shard of their own. This is completely fine - we have complete control over how users are assigned to shards. Random assignments are usually easiest, but are by no means the only option. We can choose to assign users to shards randomly - except for user 367823, who is assigned to shard 15, which no other user is assigned to.\n\nIf a shard gets too big and starts to fill up its machine’s hard-drive, we can split it up into multiple, smaller shards. How do we migrate the data to these new shards without having to turn off our platform for a while? Probably using a sequential process like:\n\n“Double-write” new data to both the old and new shards. Continue reading data from the old shard\nCopy over all existing data from the old shard to the new shard. Continue double-writing to old and new shards\nConvince ourselves that the old and new shards contain the same data. We could do this by comparing snapshots of the databases, and/or by reading every query from both databases, comparing them, and alerting if the data is different\nOnce we’re confident that the new and old shards contain the same data, we switch to reading from the new shards. We continue double-writing in case we need to switch back\nOnce we’re confident that this step has been successful, stop double-writing and delete the old shard\n\nRupert Herpton has written a great article about a broadly-similar type of migration that goes into much more detail. In short, the process of migrating data between database shards is detailed and finicky, but also entirely doable and logical. Some types of database can even automatically take care of sharding for you.\n\nReplication\n\nWe will take great care to make sure that our data doesn’t get accidentally deleted and our database servers don’t randomly stop working. But accidents happen, and sometimes computers do randomly stop working. To mitigate the fallout of a database-related disaster, we replicate our data across multiple machines in (close to) realtime.\n\n       Client writes new\n       data to DB Server A\n                |\n                v\n          +-----+-----+\n          |DB Server A|\n          ++---------++\n           |         | DB Server A quickly replicates\n           v         v the new data to DB Servers B and C\n+----------++      +-+---------+\n|DB Server B|      |DB Server C|\n+-----------+      +-----------+\n\n\nRealtime replication has two main benefits. First, it means that if one of our database servers explodes, catches fire, or otherwise stops working, we have multiple almost-perfect copies of it that can seamlessly pick up the slack. In a straightforward, vanilla failure, users of our services may never know that anything has gone wrong. The second benefit of replication is that we can distribute queries for the same data across multiple database servers. If lots of users are asking to read data from the same database, we can split their queries up across all of our copies, meaning that we can handle more queries in parallel.\n\n  Clients can query the same data\n  from any of DB Servers A,B,or C\n    |  |    |   |   |    |  |\n    |  |    v   v   v    |  |\n    |  |  +-+---+---+-+  |  |\n    |  |  |DB Server A|  |  |\n    |  |  +-----------+  |  |\n    |  |                 |  |\n    v  v                 v  v\n+---+-------+      +-----+-+---+\n|DB Server B|      |DB Server C|\n+-----------+      +-----------+\n\n\nNote that database replication is not the same concept as making database backups. Replication happens in (close to) realtime, and is designed to deal on-the-fly with isolated problems in your live (or production) systems. Database backups are performed on a schedule (for example, once a day), and the copies of the data are stored separately, away from production systems. Backups are designed as a final safeguard against widespread, catastrophic data loss, as might happen if all your data centers burned down.\n\nPretend that you work in the call centre of a big bank, where people are constantly calling you up in order to send money transfers and ask about their current balance. Replication is the equivalent of hurriedly writing down transfer details into multiple books, as you receive them, just in case you lose one of the books. Making backups is the equivalent of photocopying those books once a day and storing the copies in your filing cabinet.\n\nReplication\n\nThe process of replication is conceptually quite straightforward. Whenever new data is written to our database, we copy it to multiple machines. This means that if/when a machine fails we can continue querying its siblings, with no user-facing impact. It also means that we can spread our queries out across multiple copies of the same data, resulting in faster query response times.\n\nHowever, the details of how we do this are important, subtle, and situation-dependent. There’s no right way to do replication - as is so often the case, the exact approach that you take depends on the specific requirements and constraints of your system.\n\nReplication is complicated by two inconvenient facts about the real world. First, database operations randomly fail sometimes. When we attempt to replicate our data from one server to another, things will occasionally go wrong, causing our machines to become out of sync, at least for a period. Second, even in periods of smooth operation, replication is not instantaneous. When new data is written to our database cluster, some servers in the cluster will always know about the update sooner than others. When choosing a replication strategy we must be aware of these limitations and how they impact our particular application. For example, maybe it’s OK to risk the number of “likes” on a post being slightly out of sync and out of date, but not the amount of money in a user’s bank account.\n\nOne of the biggest decisions we must make when choosing a replication strategy is whether we want our replication to be synchronous or asynchronous.\n\nAsynchronous vs synchronous replication\n\nReplication can be handled either synchronously or asynchronously. These words come up in a lot of different places in systems design, but they always fundamentally mean the same thing. If an action is performed “synchronously” then this means that it is performed while something waits for it. If you wanted to send a letter synchronously then you would got to the Post Office, give your letter to a postal worker, sit and wait in the corner of the Post Office for a few days, and only go home when the postal worker confirmed that your letter had arrived safely.\n\nBy contrast, if an action is performed “asynchronously” then this means that the initiator of the action doesn’t wait around for it to be finished. Instead, they just continue with the rest of their work while the action is worked on in the background. The real Postal Service is asynchronous; you give your letter to a postal worker, then leave and continue with your life while the Postal Service delivers your letter. Asynchronous actions can send back notifications of the outcome of the action if they want (“Your letter has arrived and was signed for” or “Mr. Heaton, your dry-cleaning is ready”), but they don’t have to.\n\nHow do these principles apply to database replication? In synchronous replication a client writes its new data to a database server and then waits. This server doesn’t tell the client whether their write has been completed successfully until it has finished fully replicating the client’s data across all of its sibling servers. Then, and only then, does the client continue executing the rest of its code.\n\nIn asynchronous replication the client writes its data to the first database server, as before. But this time the first server tells the client that the write was successful as soon as it has written the data to its own data store. It kicks off the replication process in the background, and doesn’t wait for it to complete, or even start, before it tells the client that the write was successful. This means that the asynchronous operation appears much faster than the synchronous one, because the client doesn’t have to wait for all the replication to complete before it can continue on with the rest of its work. However, if the background replication fails then the client will believe that it has successfully written its data to the database when it actually has not. This could cause problems, the imagination of which is left as an exercise for the reader.\n\nThe synchronous approach is slower but “safer” than an asynchronous approach. The database never claims to have successfully received and stored any data until it has finished every single step of doing so. Because the client waits for full confirmation before proceeding, it is guaranteed to never encounter a situation where the client believes that it has written some data to the database, but the database has secretly partially dropped the data on the floor.\n\nWhich approach is better? It depends. Do you care more about speed or correctness? Is it OK to occasionally have inconsistent data if it significantly speeds up the system’s operation? Or will even a single mistake cause airplanes to start falling out of the sky?\n\nDatabase replication systems face other interesting problems too. Many of these problems are “logical” rather than “technical”, and don’t require a detailed understanding of the complex software and networking protocols underlying the system. To help picture some of them, imagine that you’re back in the call centre from a few paragraphs ago. You work with many other colleagues. Together you play the role of database servers. People call you up to transfer money and ask about their current balance. You and your colleagues write information about new transfers down on paper, and replicate it between yourselves by calling each other up.\n\nThe problems faced by our database cluster are identical to those faced by our call-centre. What happens if two people call in and try to update the same piece of data at the same time by talking to two different employees? Maybe we solve that by having a “leader” employee who is the only one authorized to serve calls from people trying to create transfers. All the other employees are only allowed to answer queries about current balances. OK, so what happens if the leader has a stroke and dies after they’ve received some new data, but before they’ve told everyone else about it? What if a “follower” employee has a temporary seizure for a few seconds and misses some data updates from the leader? What if we’re never entirely sure which of our employees are dead or alive?\n\nThis is not an approximate metaphor that breaks down if you look too hard or start asking awkward questions. Understand this weird call-centre and you understand database replication. Read this blog post and you really understand replication.\n\nBackups\n\nIn addition to realtime replication, we also store regular backups of our entire database in order to protect against catastrophic disaster. We copy all of the data in our database, store it somewhere safe, and mark it as something like “database backup, 2020-05-11:01:00”.\n\n+----------+  \n| Database +----------------> database backup, 2020-05-11:01:00\n+----------+                  database backup, 2020-05-10:01:00\n                              database backup, 2020-05-09:01:00\n\n\nIf our entire database - or some fraction of it - somehow gets wiped out, we grab the most recent backup available and load it into new database machines.\n\n+----------+\n|   New    |\n| Database +<---------------- database backup, 2020-05-11:01:00\n+----------+                  database backup, 2020-05-10:01:00\n                              database backup, 2020-05-09:01:00\n\n\nSuch a calamity could be caused by a cyberattack, a disaster in our data centre, a database migration gone horribly wrong, or any number of unlikely but potentially company-destroying reasons. Unlike realtime replication, restoring a database from a backup is a slow process that our users will definitely notice. Our entire system will likely be offline until the restoration is complete. We will have lost all database updates that occurred after the last backup but before the disaster. And there will no doubt be a large number of knock-on effects as users and systems try to access data that used to be there but is now lost forever. Nonetheless, these are all much less terrible than the complete, irrevocable loss of all our company’s data and with it, our company.\n\nThat’s a whole lot of detail about our primary SQL database. Let’s talk about some other ways in which we store and query data.\n\nFree-text searching\n\nA standard SQL database is very good at answering well-defined and specific queries. For example:\n\nGive me all the item listings created by user #145122 in the last 90 days\nGive me the listing details for item #237326921\nGive me the count of new listings per day created in San Francisco with the label “Electronics”\n\nYou can retrieve this kind of data using SQL queries that look something like this:\n\nSELECT *\nFROM items\nWHERE\n  user_id = 145122 AND\n  created > currentDate() - 90\n\n\nor\n\nSELECT\n  DATE_TRUNC('day', i.created) AS day,\n  COUNT(*)\nFROM items AS i\nINNER JOIN labels as l\n  ON i.id = l.item_id\nWHERE\n  i.city = 'San Francisco' AND\n  l.text = 'electronics'\nGROUP BY 1\nORDER BY 1 DESC\n\n\nYou’ll notice that these queries contain a lot of very “precise” operators, like equals- and greater-than-signs. But how would you write a SQL query that could return a list of items that match a Google-style “full-text” search, like “second-hand TV”?\n\nThis would be difficult. You could try the SQL LIKE operator, which allows you to find records containing a pattern, such as a sub-string. For example, the following query finds all items with a description containing the sub-string second-hand TV:\n\nSELECT *\nFROM items\nWHERE description LIKE '%second-hand TV%'\n\n\nHowever, this query will only match the very specific sub-string that it was given. It won’t match “TV that is second-hand” or “2nd-hand TV”, or “sceond-hnad TV”. Given enough perseverance you could theoretically construct a giant SQL-query that covered as many of these permutations as you had patience for:\n\nSELECT *\nFROM items\nWHERE\n  description LIKE '%second%hand%TV' OR\n  description LIKE '%second%TV%hand' OR\n  -- …and so on and so on for another bajillion ORs…\n\n\nHowever, the resulting query would be slow and cumbersome, and would still miss many important edge-cases that you hadn’t thought of. And even if you did get back a useful list of search results, you’d still have a lot of work left to do in order to decide how to order them. The ordering you want isn’t something strict like “most-recent first” or “alphabetically by title”. Instead it’s some much woolier notion of “best” or “most-relevant” first.\n\nAll of this means that SQL databases are generally not very good at full-text searches. Fortunately, other types of database are, including one called Elasticsearch. Elasticsearch is often described as a document-oriented database. We don’t need to go into the details of how exactly it works, but the important part for us is that, unlike SQL databases, Elasticsearch is very good at taking queries like “second-hand TV” and returning a list, ordered by “relevance,” of the fuzzy matches that users have come to expect from their search engines.\n\n“Sounds like Elasticsearch is just better than SQL,” you might say. “Should we throw away our SQL databases and put everything in Elasticsearch instead?” Not so fast. Elasticsearch, and other databases like it, have their strengths, but they also have their weaknesses. They’re typically somewhat less reliable than SQL databases, and are somewhat more likely to accidentally lose data at large scale. They’re also often much slower to write new data to.\n\nAs we’ve already noted, there’s rarely a single, universally “best” tool for any type of job. There’s certainly no such thing as “the best” database. Instead, different databases have different strengths and weaknesses, and different solutions are appropriate for different tasks. At Steveslist, we care so much about making sure that we use the right tool for the right job that we store our data in both a SQL database and a document-oriented database like Elasticsearch.\n\nWe use our SQL database as our primary data store. It is our authoritative “source-of-truth”, and we write all our new data to it before we write it anywhere else. We do all our simple, precise reads from it, especially when accuracy and up-to-date-ness are our principal requirements. If we want to show a user a list of all their open listings, we read it from our SQL database. If we want to validate a users password, we read that from our SQL database too. This plays to the strengths of SQL databases.\n\nHowever, in the background we also copy data from our SQL database into an Elasticsearch database, and send any full-text search queries made via our search box to Elasticsearch. This means that we benefit from the strengths of Elasticsearch, and are not impacted too much by its weaknesses. We copy over batches of records every few minutes, hours, or days, depending on the requirements of the specific dataset. Alternatively, we could watch the logs of our SQL database for new or updated records, and create or update the corresponding Elasticsearch records in near-realtime.\n\n                   |      |                   |\nNew data is always |      |Queries for        |Full-text search \nwritten to the SQL |      |specific data go   |queries go to\nDB first           |      |to the SQL DB too  |Elasticsearch\n                   V      V                   V\n               +--------------+       +---------------+\n               | SQL Database +------>+ Elasticsearch |\n               +--------------+       +---------------+\n                       New data is copied over from\n                       the SQL DB to Elasticsearch\n\n\nWhen scouting Steveslist’s competition, I noticed that when you create a new Craigslist listing it says “your listing will be visible in search within the next 15 minutes”. I’ll bet pesos to pizza that this is because their primary datastore is a SQL database, but their search box is powered by an Elasticsearch-like engine. Their pipeline for replicating data from SQL to search probably takes around 15 minutes, which they’ve decided (very reasonably) is an acceptable delay for their particular use-case.\n\nWe’ve said that Elasticsearch is somewhat less reliable than most SQL databases. If Elasticsearch accidentally loses a few of our records then they won’t appear in search results. This would be a shame that would make our product a bit worse, and we try our hardest to avoid it happening. However, it wouldn’t be a disaster in the same way that losing data from our primary data store would be. We only copy data over to Elasticsearch once it has been written to and safely captured by our source-of-truth SQL database, which is what really matters.\n\nIt’s 6pm, and the library is closing. A librarian tries to ask you to leave. Kate shoos him away with a barrage of crumpled-up balls of paper.\n\nInternal tools\n\nManaging the Steveslist platform requires bespoke internal tools. We need to perform a wide range of administrative tasks, like deleting listings that are too illegal (even for us), issuing refunds, viewing a user’s personal details in order to help with support requests, and so on. Many of these tools will be used by people who work on other teams at Steveslist, like finance, compliance, legal, sales, and support. Since the tasks they need to perform are so specific to the way that Steveslist works, we can’t do them using third-party tools, and have to build our own instead.\n\nIn the early days, we baked this functionality into the main Stevelist product and only exposed it to users who had the is_steveslist_employee = True database flag set. This was an OK approach for a small company, but was also fragile and easy to mess up. It was scary to think that we were exposing all of our superuser powers through the same servers that run our main product. It made the potential consequences of a security flaw in our application much worse, and created new types of mistake for us to make, such as forgetting to disable the is_steveslist_employee flag for an acrimoniously fired employee.\n\nOnce Steveslist reached a certain level of maturity, we built ourselves an entirely separate admin platform, with separate, hardened authentication and authorization. The service runs on entirely separate servers, and requires a VPN and a TLS client certificate to access (which we’ll talk about another day). This separated out our internal- and external-facing products, and drastically reduced the chance of a boneheaded error exposing our admin tools to the world. We’re frequently building new internal tools - one for user administration, one for server management, one for fraud detection, and so on. These services all talk to the same database as our user-facing products, so they all have access to the same data. They just run on different servers that are completely inaccessible to the outside world.\n\nCron jobs\n\nThere are lots of tasks that we’ll want our system to perform at fixed times and intervals. For example:\n\nEmailing ourselves weekly usage reports\nSending marketing emails to users\nCharging the credit cards users who have a subscription plan with us\nCopying data from our SQL database to Elasticsearch\n\nThe most common tool used for running scheduled jobs is called cron, a tool that is built into Unix operating systems. It’s so common that people will often call any kind of scheduled job a “cron job”, even when it’s not actually being run by cron.\n\nYou can set up a cron job on your own computer by running:\n\ncrontab -e\n\n\nThen typing into the prompt:\n\n*/5 * * * * $YOUR_COMMAND\n\n\nThis will cause your computer to execute $YOUR_COMMAND every 5 minutes.\n\nSteveslist currently has a very simple and slightly fragile cron setup. We have a single “scheduled jobs server”. We use crontab on this server (as above) to tell it the commands that we want it to run, and the schedule that we want it to run them on. This setup isn’t scaling very well - if the scheduled jobs server explodes or even hiccups then we don’t always know which jobs it did and didn’t run, and have to scramble to bring up a replacement server. And even though the server is very beefy and powerful, eventually we’re going to want to run more jobs than it can handle at once. We’re considering either splitting up our cron jobs into multiple servers, or setting up a new system using a modern tool like Kubernetes.\n\nPubsub\n\nActions have consequences. This is both the subject line of the sinister emails that we send to people who write mean things about us on the internet, and the reason we have a pubsub system.\n\nWhen a new user signs up, we want to send them an email welcoming them to Steveslist and reminding them about the action-consequence relationship I just described. When a new listing is added for a stolen TV in San Francisco, we want to notify users who have set up search alerts for TVs in the Bay Area. When a card is declined for a subscription, we want to email the responsible user to politely threaten them. When a new listing is added, we want to perform some extremely cursory anti-fraud checks. When an item is purchased, we want to sent a webhook to its seller. And so on.\n\nTechnically, all of these actions could be performed synchronously (rememberer that word?) by the server executing the initiating action. However, this is often a bad idea, for two reasons. First, the response action (such as emailing all the users who are subscribed for notifications about new stolen TVs) may be very slow. Performing the response action synchronously means that if the initiating action was performed by a user then they will have to wait for all the response actions to finish too. This might not be the end of the world if the response action is small and quick, like sending a single email. But if it’s larger - like searching for and notifying all users who might be interested in a new item - then, well, it still won’t be the end of the world, but it will be a bad user experience.\n\nTo mitigate this problem we have built a “publish-subscribe” or “pubsub” system. When a trigger action is performed, the code that performs it “publishes an event” describing the action, such as NewListingCreated or SubscriptionCardDeclined. The words “event” and “publish” are quite loosely defined in this context, and don’t have a rigorous technical definition. An event is just some sort of record of something that happened, and to publish an event just means that you somehow make a note that something happened. The details of how you do so depend entirely on the pubsub system in question. In a simple system events might be stored in tables in a SQL database, and code would publish events by writing new records to a table.\n\nIf a programmer at Steveslist wants a response action to be performed whenever a new event of a particular type is published, they can write a consumer. This is a piece of code that “subscribes” to a type of event, and which is executed whenever a new event of that type is published. It uses the details of the event (for example, the user whose subscription payment failed) to asynchronously execute whatever actions the programmer wants (for example, sending the user a menacing email).\n\nPubsub systems are often managed by a central message broker. Systems publish events to the broker, and the broker is then responsible for getting the events to any subscribed consumers. This can be achieved using either a push or a pull mechanism. Consumers can pull messages from the broker by polling it and repeatedly asking “any new events? any new events?” or they can wait and listen and the broker can push notifications of new events out to them, for example by sending them an HTTP request.\n\n1. New user signs|\nup to Steveslist |\n                 v\n       +-----------------+               +------------------------+\n       |Steveslist Server|           +-->+SendWelcomeEmailConsumer|\n       +---------+-------+           |   +------------------------+\n                 |                   v\n2. Server reports|     +-------------++  4. Consumers send welcome\na NewUserSignup  +---->+Pub/Sub Broker|  emails, check for spam,\nevent to the           +-------------++  etc.\nPub/Sub system                       ^\n              3. Pub/Sub broker      |   +------------------------+\n              notifies consumers     +-->+NewUserSpamCheckConsumer|\n              that have subscribed to    +------------------------+\n              NewUserSignup events.\n\n\nPubsub systems have many benefits:\n\nNon-critical actions are performed asynchronously, keeping the user experience snappy\nOur code is kept clean and well-separated. The code that publishes an event doesn’t have to care about what the events’ subscribers do in response\nIf a subscriber’s action fails for some reason (for example, the email-sending system has a hiccup), the pubsub system can note this failure and retry again later\n\nNext, let’s talk big data.\n\nBig data and analytics\n\nIn order to understand and optimize our business, we need to be able to calculate complex statistics across the entire Steveslist platform. How many listings are created every day, segmented by country and city? How many users who signed up each month have created a listing within 90 days of signing up?\n\nTo do this, we need to write database queries that aggregate over the entirety of our data. We don’t want to run these queries against our production SQL database, because they could put an enormous amount of load on it. We don’t want a huge query issued by an internal analyst to be able to bring our production database to a grinding halt, but we do want to provide this analyst with a tool that is well-suited to their needs. To complicate matters further, database engines that are quick at small queries (like returning all the listings belonging to a single user) are typically unacceptably slow (or indeed incapable) of answering giant queries (like calculating the total dollars spent on listings in each category, per day, for the last 90 days).\n\nDespite this, for the first year or so after Steveslist was founded, we took a risk and simply ran our analytics queries against the main production database. This was a gamble, but it just about worked. We didn’t have much data anyway, and we had more important things to focus on, like attracting the customers who would create the big data that would one day mean that we had to find a more scalable solution.\n\nEventually we did bring down the production database with an overly-ambitious query, and decided that the time had come to invest in a data warehouse. A data warehouse is a data store that is well-suited to large, system-wide queries. Our warehouse is powered by a database engine called Hive, but we could also have chosen Presto, Impala, Redshift, or any number of competing alternatives. Hive accepts queries written in SQL, but is much better at executing these queries against giant datasets than our MySQL database is.\n\nWe replicate our data from our production SQL database to Hive, once a day, overnight. Steveslist analysts and programmers can query the same dataset using whichever database engine best suits their needs. They can use the production SQL database for small, precise, source-of-truth queries from production systems; Elasticsearch for full-text search queries; or the data warehouse for huge queries that aggregate over vast volumes of data.\n\nIt’s dark outside and you’re hungry. Is that pretty much it? you ask.\n\n“Oh god no,” Kate replies, “we could keep going forever. But this is a pretty good start. It’s helpful to have a broad understanding of a wide range of topics, but no one needs to know the details about everything. I find that once you know some basics you can keep picking up more basics and even a couple of details as you go along.”\n\nYou ask if Kate could perhaps continue to elaborate on her five-year vision for Steveslist tomorrow.\n\n“Absolutely,” says Kate. We’ll talk about more of what goes on inside a real, large online platform, including:”\n\nSecurity\nHTTPS and other forms of encryption\nTwo-factor authentication\nSAML\nSecret key management\nServer management\nDeploying new code\nAWS and competitors\nTerraform\nLoad balancers\nContainers\nAlerting when code breaks\nBig data\nMap-reduce and other big data jobs\nMachine learning\nUser tracking\n\n“See you tomorrow at 7am?”\n\nFollow me on Twitter or RSS\nGet new essays sent to you\n\nSubscribe to my new work on programming, security, and a few other topics. Published a few times a month.\n\n \n\nNEW: Also subscribe to my new series, Programming Feedback for Advanced Beginners\n\nMore on Programming Projects for Advanced Beginners\nPFAB #13: When code is too clever to be clean\nPFAB #11: Separating logic and data\nPFAB #10: First-class functions and dependency injection\nPFAB #9: Batch vs Stream processing\nPFAB #8: Input validation - tradeoffs between convenience and surprise\nPFAB#7: How to write a library\nPFAB#6: Real-world debugging practice\nPFAB#5: How to make your programs shorter\nPFAB#4: Exception handling and coping with failure\nPFAB#3: How to rigorously analyze your journey to work\nPFAB#2: How to structure your programs\nPFAB#1: Define your boundaries\nProgramming Feedback for Advanced Beginners #0\nI will give you feedback on your code\nProgramming Projects for Advanced Beginners #6: User Logins\nReal-World Programming Projects for Advanced Beginners\nProgramming Videos for Advanced Beginners #1: Battleships\nOpen Source for Advanced Beginners #1: bashplotlib\nOpen Source for Advanced Beginners\nWhat beginner's mind is really like\nProgramming Projects for Advanced Beginners\nProgramming Projects for Advanced Beginners #5: Snake\nProgramming Projects for Advanced Beginners #4: Photomosaics\nProgramming Projects for Advanced Beginners #3b: Tic-Tac-Toe AI\nProgramming Projects for Advanced Beginners #3a: Tic-Tac-Toe AI\nProgramming Projects for Advanced Beginners #2: Game of Life\nProgramming Projects for Advanced Beginners #1: ASCII art\n◀ How to make yourself happier by making your iPhone worse\nHundreds of companies assert usage rights over all ideas sent through their services ▶\n\n\nHome / Archive / RSS / Twitter / Office hours / Tipoffs / SoundCloud /"}

{"l":"https://tomassetti.me/parsing-sql/","n":"Parsing sql","html":"<div id=\"wrap_all\"><header id=\"header\" class=\"all_colors header_color light_bg_color av_header_top av_logo_left av_main_nav_header av_menu_right av_slim av_header_sticky av_header_shrinking_disabled av_header_stretch_disabled av_mobile_menu_tablet av_header_searchicon av_header_unstick_top av_minimal_header av_bottom_nav_disabled av_header_border_disabled\" role=\"banner\" itemscope=\"itemscope\" itemtype=\"https://schema.org/WPHeader\" style=\"margin-top: 0px;\"><div id=\"header_meta\" class=\"container_wrap container_wrap_meta av_icon_active_left av_extra_header_active av_secondary_right av_entry_id_6033\"><div class=\"container\"><ul class=\"noLightbox social_bookmarks icon_count_4\"><li class=\"social_bookmarks_twitter av-social-link-twitter social_icon_1\"><a target=\"_blank\" aria-label=\"Link to Twitter\" href=\"https://twitter.com/ftomasse\" aria-hidden=\"true\" data-av_icon=\"\" data-av_iconfont=\"entypo-fontello\" title=\"Twitter\"><span class=\"avia_hidden_link_text\">Twitter</span></a></li><li class=\"social_bookmarks_linkedin av-social-link-linkedin social_icon_2\"><a target=\"_blank\" aria-label=\"Link to Linkedin\" href=\"https://ie.linkedin.com/in/federicotomassetti\" aria-hidden=\"true\" data-av_icon=\"\" data-av_iconfont=\"entypo-fontello\" title=\"Linkedin\"><span class=\"avia_hidden_link_text\">Linkedin</span></a></li><li class=\"social_bookmarks_mail av-social-link-mail social_icon_3\"><a aria-label=\"Link to Mail\" href=\"mailto:federico@tomassetti.me\" aria-hidden=\"true\" data-av_icon=\"\" data-av_iconfont=\"entypo-fontello\" title=\"Mail\"><span class=\"avia_hidden_link_text\">Mail</span></a></li><li class=\"social_bookmarks_rss av-social-link-rss social_icon_4\"><a aria-label=\"Link to Rss this site\" href=\"https://tomassetti.me/feed/\" aria-hidden=\"true\" data-av_icon=\"\" data-av_iconfont=\"entypo-fontello\" title=\"Rss\"><span class=\"avia_hidden_link_text\">Rss</span></a></li></ul></div></div><div id=\"header_main\" class=\"container_wrap container_wrap_logo\"><div class=\"container av-logo-container\" style=\"\"><div class=\"inner-container\"><span class=\"logo\"><a href=\"https://tomassetti.me/\"><img height=\"100\" width=\"300\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/07/federico-tomassetti-software-architect-300.png\" alt=\"Federico Tomassetti - Software Architect\" data-lazy-src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/07/federico-tomassetti-software-architect-300.png\" class=\"lazyloaded\" data-was-processed=\"true\"><noscript><img height='100' width='300' src='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/07/federico-tomassetti-software-architect-300.png' alt='Federico Tomassetti - Software Architect' /></noscript></a></span><nav class=\"main_menu\" data-selectname=\"Select a page\" role=\"navigation\" itemscope=\"itemscope\" itemtype=\"https://schema.org/SiteNavigationElement\"><div class=\"avia-menu av-main-nav-wrap\"><ul id=\"avia-menu\" class=\"menu av-main-nav\"><li id=\"menu-item-4159\" class=\"menu-item menu-item-type-custom menu-item-object-custom menu-item-top-level menu-item-top-level-1\"><a href=\"https://strumenta.com/services/\" itemprop=\"url\" style=\"\"><span class=\"avia-bullet\"></span><span class=\"avia-menu-text\">Services</span><span class=\"avia-menu-fx\"><span class=\"avia-arrow-wrap\"><span class=\"avia-arrow\"></span></span></span></a></li><li id=\"menu-item-4164\" class=\"menu-item menu-item-type-custom menu-item-object-custom menu-item-top-level menu-item-top-level-2\"><a href=\"https://strumenta.com/products\" itemprop=\"url\" style=\"\"><span class=\"avia-bullet\"></span><span class=\"avia-menu-text\">Products</span><span class=\"avia-menu-fx\"><span class=\"avia-arrow-wrap\"><span class=\"avia-arrow\"></span></span></span></a></li><li id=\"menu-item-3277\" class=\"menu-item menu-item-type-post_type menu-item-object-page menu-item-top-level menu-item-top-level-3\"><a href=\"https://tomassetti.me/learning-build-languages/\" itemprop=\"url\" style=\"\"><span class=\"avia-bullet\"></span><span class=\"avia-menu-text\">Learning to build languages</span><span class=\"avia-menu-fx\"><span class=\"avia-arrow-wrap\"><span class=\"avia-arrow\"></span></span></span></a></li><li id=\"menu-item-3276\" class=\"menu-item menu-item-type-post_type menu-item-object-page menu-item-top-level menu-item-top-level-4\"><a href=\"https://tomassetti.me/learning-process-code/\" itemprop=\"url\" style=\"\"><span class=\"avia-bullet\"></span><span class=\"avia-menu-text\">Learning to process code</span><span class=\"avia-menu-fx\"><span class=\"avia-arrow-wrap\"><span class=\"avia-arrow\"></span></span></span></a></li><li id=\"menu-item-3996\" class=\"menu-item menu-item-type-post_type menu-item-object-page menu-item-top-level menu-item-top-level-5\"><a href=\"https://tomassetti.me/antlr-course/\" itemprop=\"url\" style=\"\"><span class=\"avia-bullet\"></span><span class=\"avia-menu-text\">Using ANTLR Like a Professional</span><span class=\"avia-menu-fx\"><span class=\"avia-arrow-wrap\"><span class=\"avia-arrow\"></span></span></span></a></li><li id=\"menu-item-3278\" class=\"menu-item menu-item-type-post_type menu-item-object-page menu-item-top-level menu-item-top-level-6\"><a href=\"https://tomassetti.me/newsletter/\" itemprop=\"url\" style=\"\"><span class=\"avia-bullet\"></span><span class=\"avia-menu-text\">Newsletter</span><span class=\"avia-menu-fx\"><span class=\"avia-arrow-wrap\"><span class=\"avia-arrow\"></span></span></span></a></li><li id=\"menu-item-2572\" class=\"menu-item menu-item-type-post_type menu-item-object-page menu-item-top-level menu-item-top-level-7\"><a href=\"https://tomassetti.me/about-me/\" itemprop=\"url\" style=\"\"><span class=\"avia-bullet\"></span><span class=\"avia-menu-text\">About me</span><span class=\"avia-menu-fx\"><span class=\"avia-arrow-wrap\"><span class=\"avia-arrow\"></span></span></span></a></li><li id=\"menu-item-5959\" class=\"menu-item menu-item-type-custom menu-item-object-custom menu-item-top-level menu-item-top-level-8\"><a href=\"https://strumenta.com/contact-us/\" itemprop=\"url\" style=\"\"><span class=\"avia-bullet\"></span><span class=\"avia-menu-text\">Let’s Talk</span><span class=\"avia-menu-fx\"><span class=\"avia-arrow-wrap\"><span class=\"avia-arrow\"></span></span></span></a></li><li id=\"menu-item-search\" class=\"noMobile menu-item menu-item-search-dropdown menu-item-avia-special\"> <a href=\"?s=\" rel=\"nofollow\" data-avia-search-tooltip=\" <form action=&quot;https://tomassetti.me/&quot; id=&quot;searchform&quot; method=&quot;get&quot; class=&quot;&quot;> <div> <input type=&quot;submit&quot; value=&quot;&quot; id=&quot;searchsubmit&quot; class=&quot;button avia-font-entypo-fontello&quot; /> <input type=&quot;text&quot; id=&quot;s&quot; name=&quot;s&quot; value=&quot;&quot; placeholder='Search' /> </div> </form>\" aria-hidden=\"true\" data-av_icon=\"\" data-av_iconfont=\"entypo-fontello\" style=\"\"><span class=\"avia_hidden_link_text\">Search</span></a></li><li class=\"av-burger-menu-main menu-item-avia-special \"> <a href=\"#\" style=\"\"> <span class=\"av-hamburger av-hamburger--spin av-js-hamburger\"> <span class=\"av-hamburger-box\"> <span class=\"av-hamburger-inner\"></span> <strong>Menu</strong> </span> </span> </a></li></ul></div></nav></div></div></div><div class=\"header_bg\"></div></header><div id=\"main\" class=\"all_colors\" data-scroll-offset=\"88\"><div class=\"stretch_full container_wrap alternate_color light_bg_color title_container\"><div class=\"container\"><strong class=\"main-title entry-title \"><a href=\"https://tomassetti.me/blog/\" rel=\"bookmark\" title=\"Permanent Link: Blog\" itemprop=\"headline\">Blog</a></strong></div></div><div class=\"container_wrap container_wrap_first main_color sidebar_right\"><div class=\"container template-blog template-single-blog \"><main class=\"content units av-content-small alpha av-blog-meta-comments-disabled\" role=\"main\" itemscope=\"itemscope\" itemtype=\"https://schema.org/Blog\"><article class=\"post-entry post-entry-type-standard post-entry-6033 post-loop-1 post-parity-odd post-entry-last single-small with-slider post-6033 post type-post status-publish format-standard has-post-thumbnail hentry category-antlr category-static-analysis category-parsing tag-c tag-kotlin tag-sql tag-tools\" itemscope=\"itemscope\" itemtype=\"https://schema.org/BlogPosting\" itemprop=\"blogPost\"><div class=\"entry-content-wrapper clearfix standard-content\"><header class=\"entry-content-header\"><h1 class=\"post-title entry-title \" itemprop=\"headline\"> <a href=\"https://tomassetti.me/parsing-sql/\" rel=\"bookmark\" title=\"Permanent Link: Parsing SQL\">Parsing SQL <span class=\"post-format-icon minor-meta\"></span> </a></h1><span class=\"post-meta-infos\"><time class=\"date-container minor-meta updated\">April 15, 2020</time><span class=\"text-sep text-sep-date\">/</span><span class=\"blog-categories minor-meta\">in <a href=\"https://tomassetti.me/category/language-engineering/antlr/\" rel=\"tag\">ANTLR</a>, <a href=\"https://tomassetti.me/category/static-analysis/\" rel=\"tag\">Code processing</a>, <a href=\"https://tomassetti.me/category/language-engineering/parsing/\" rel=\"tag\">Parsing</a> </span><span class=\"text-sep text-sep-cat\">/</span><span class=\"blog-author minor-meta\">by <span class=\"entry-author-link\"><span class=\"vcard author\"><span class=\"fn\"><a href=\"https://tomassetti.me/author/gtomassetti/\" title=\"Posts by Gabriele Tomassetti\" rel=\"author\">Gabriele Tomassetti</a></span></span></span></span></span></header><div class=\"entry-content\" itemprop=\"text\"><div class=\"ttr_start\"></div><p><em><img class=\"aligncenter size-full wp-image-6066 lazyloaded\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Parsing-SQL.jpg\" alt=\"\" width=\"1024\" height=\"512\" data-lazy-srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Parsing-SQL.jpg 1024w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Parsing-SQL-300x150.jpg 300w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Parsing-SQL-768x384.jpg 768w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Parsing-SQL-705x353.jpg 705w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Parsing-SQL-450x225.jpg 450w\" data-lazy-sizes=\"(max-width: 1024px) 100vw, 1024px\" data-lazy-src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Parsing-SQL.jpg\" sizes=\"(max-width: 1024px) 100vw, 1024px\" srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Parsing-SQL.jpg 1024w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Parsing-SQL-300x150.jpg 300w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Parsing-SQL-768x384.jpg 768w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Parsing-SQL-705x353.jpg 705w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Parsing-SQL-450x225.jpg 450w\" data-was-processed=\"true\"><noscript><img class=\"aligncenter size-full wp-image-6066\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Parsing-SQL.jpg\" alt=\"\" width=\"1024\" height=\"512\" srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Parsing-SQL.jpg 1024w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Parsing-SQL-300x150.jpg 300w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Parsing-SQL-768x384.jpg 768w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Parsing-SQL-705x353.jpg 705w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Parsing-SQL-450x225.jpg 450w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" /></noscript>You can find the code presented in this article in the <a href=\"https://github.com/unosviluppatore/parsing-sql\">companion repository</a></em></p><p>SQL is a language to handle data in a relational database. If you worked with data you have probably worked with SQL.</p><p>It is in the same league of HTML: maybe you never learned it formally but you kinda know how to use it. That is great because <strong>if you know SQL, you know how to handle data</strong>. However, it has limitations and when you hit them your only course of action might be to work with a traditional programming language. This does not necessarily mean migrating away from SQL. You might need to move from one SQL dialect to another one or to analyze the SQL code you use. And to do that, you need to parse SQL, and that is what this article is about.</p><p>What are the limits of SQL? After a while you learn of a couple of issues:</p><ul><li><strong>there is not one SQL</strong>, but many variations of it. The SQLs implemented in SQLite, MySQL, PostgreSQL, etc. are all a bit different</li><li><strong>you cannot do everything related to data in SQL</strong>. In some cases, you need a traditional programming language to work with the data</li></ul><p>These issues became real problems when you need to make big changes. For instance, if you need to change the database used by a large application. It can also be a problem when you need to make transformations that SQL and your database cannot handle them. In that case, you have some transformations done in SQL (and run on the database) and some other in your source code. So you spend a lot of time working on glue code and around the limitations of SQL.</p><p>SQL can also be a constraint, simply for what it lacks: unit testing integrated with your source code and all the other tools that you can use with Java, C#, etc. SQL is an old language and not designed for large scale programming, it is not a language that developers will love. Even worse, they will not be very productive with it. And what happens if your application requires you to verify that something gets executed in a certain way, or to offer some guarantees? It can be a business need or a regulatory requirement. Then you need to parse SQL or to find a way to move from SQL world to your programming language world.</p><p>That is what this article is about: parsing SQL. We are going to see <strong>ready-to-use libraries and tools to parse SQL</strong>, and an example project in which <strong>we will build our own SQL parser</strong>.</p><div class=\"wp-block-group\"><div class=\"wp-block-group__inner-container\"><h2>What is SQL</h2><p><strong>SQL (Structured Query Language) is a domain-specific language designed to handle data in relational database</strong>. It is a declarative language, so you describe what you want to achieve (e.g., <em>get me a row of data with id=5</em>) and not how to achieve it (e.g. <em>loop through the rows until id=5</em>). It has a formal mathematical foundation in relational algebra and calculus. The language is an ISO/IEC standard that is periodically updated, the latest version is <a href=\"https://en.wikipedia.org/wiki/SQL:2016\">SQL2016</a>. This means that there is a very formal and clear description of the language if you need it.</p><p>SQL is designed to handle many aspects of the life cycle of working with data: yes, you can query data, but you can also create the format of data (i.e., the schema of a table) and regulate access control to the data.</p><h3>SQL Procedural Extensions</h3><p>Actual SQL implementation comes with procedural extensions that implement some form of procedural programming. These are even more varied from database engine to database engine. They were added to perform complex elaborations on the data directly on the database, so they can be as powerful as traditional programming languages. And this can also be an additional headache if you try to parse SQL. See, for instance, this is a PL/SQL (the procedural SQL from Oracle databases) example from Wikipedia.</p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"sql\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">DECLARE\n    var NUMBER;\nBEGIN\n     /*N.B. for loop variables in pl/sql are new declarations, with scope only inside the loop */\n     FOR var IN 0 .. 10 LOOP\n          DBMS_OUTPUT.PUT_LINE(var);\n     END LOOP;\n\n     IF (var IS NULL) THEN\n          DBMS_OUTPUT.PUT_LINE('var is null');\n     ELSE\n          DBMS_OUTPUT.PUT_LINE('var is not null');\n     END IF;\nEND;</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"kw1\">DECLARE</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">    var NUMBER;</span></li><li class=\" odd\"><span class=\"\"></span><span class=\"kw1\">BEGIN</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">     </span><span class=\"co2\">/*N.B. for loop variables in pl/sql are new declarations, with scope only inside the loop */</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">     </span><span class=\"kw1\">FOR</span><span class=\"\"> var </span><span class=\"kw3\">IN</span><span class=\"\"> </span><span class=\"nu0\">0</span><span class=\"\"> .. </span><span class=\"nu0\">10</span><span class=\"\"> LOOP</span></li><li class=\" even\"><span class=\"\">          DBMS_OUTPUT.PUT_LINE(var);</span></li><li class=\" odd\"><span class=\"\">     </span><span class=\"kw1\">END</span><span class=\"\"> LOOP;</span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">     </span><span class=\"kw3\">IF</span><span class=\"\"> (var </span><span class=\"kw1\">IS</span><span class=\"\"> </span><span class=\"kw3\">NULL</span><span class=\"\">) </span><span class=\"kw1\">THEN</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">          DBMS_OUTPUT.PUT_LINE(</span><span class=\"st0\">'var is null'</span><span class=\"\">);</span></li><li class=\" odd\"><span class=\"\">     </span><span class=\"kw1\">ELSE</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">          DBMS_OUTPUT.PUT_LINE(</span><span class=\"st0\">'var is not null'</span><span class=\"\">);</span></li><li class=\" odd\"><span class=\"\">     </span><span class=\"kw1\">END</span><span class=\"\"> </span><span class=\"kw3\">IF</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\"></span><span class=\"kw1\">END</span><span class=\"\">;</span></li></ol><pre style=\"display: none;\">DECLARE\n    var NUMBER;\nBEGIN\n     /*N.B. for loop variables in pl/sql are new declarations, with scope only inside the loop */\n     FOR var IN 0 .. 10 LOOP\n          DBMS_OUTPUT.PUT_LINE(var);\n     END LOOP;\n\n     IF (var IS NULL) THEN\n          DBMS_OUTPUT.PUT_LINE('var is null');\n     ELSE\n          DBMS_OUTPUT.PUT_LINE('var is not null');\n     END IF;\nEND;</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div></div></div><div class=\"wp-block-group\"><div class=\"wp-block-group__inner-container\"><h2>Resources</h2><p>As we have seen handling SQL can be a daunting task, so let’s see a few resources to help you. They range from grammars to kick start your parsing efforts, to ready-to-use tools.</p><h3>Knowledge</h3><h4>Official Sources</h4><p>The latest official SQL standard is formally known as ISO/IEC 9075 SQL:2016. You can find every information you need about it in the official sources either the <a href=\"https://www.iso.org/standard/63555.html\">ISO</a> or <a href=\"https://webstore.iec.ch/publication/59678\">IEC</a> websites. However, keep in mind that there are several documents describing the standard and you have to pay for each of them. This means, depending on the exchange rate, the total cost could be more than 2,000 USD.</p><h4>Official References from Database Documentation</h4><p>Other than the official SQL standard, you can look up the official documentation of the database producers, which contains a reference for their SQL implementation. Here is a list of the few major ones:</p><ul><li><a href=\"https://www.oracle.com/database/technologies/appdev/plsql.html\">Oracle PL/SQL Documentation</a></li><li><a href=\"https://dev.mysql.com/doc/refman/8.0/en/sql-statements.html\">MySQL 8 SQL Reference</a></li><li><a href=\"https://docs.microsoft.com/it-it/sql/t-sql/language-reference?view=sql-server-ver15\">Microsoft Transact-SQL Reference</a></li><li><a href=\"https://www.postgresql.org/docs/12/sql.html\">PostgreSQL 12 SQL Language</a></li><li><a href=\"https://www.ibm.com/support/knowledgecenter/SSEPGG_11.5.0/com.ibm.db2.luw.sql.ref.doc/doc/c0004100.html\">IBM DB2 SQL</a></li><li><a href=\"https://www.sqlite.org/lang.html\">SQL as understood by SQLite</a></li></ul><h4>Grammars</h4><p>There are a few (usually partial) grammars available in different formats. They can be a good starting point for getting where you need.</p><ul><li><a href=\"https://github.com/ronsavage/SQL\">BNF Grammars for SQL-92, SQL-99 and SQL-2003 </a></li><li>Partial <a href=\"https://github.com/cmedved/Teradata-SQL-Parser\">Teradata SQL grammar for ANTLR4</a></li><li>The ANTLR v4 Grammars repository contains grammars for <a href=\"https://github.com/antlr/grammars-v4/tree/master/sql\">MySQL, PL/SQL, T-SQL and SQLite</a>. In our <a href=\"https://tomassetti.me/antlr-course/\">ANTLR Course</a> we analyze the SQLite grammar to explain its structure and how you can parse a declarative language like SQL.</li></ul><h3>Libraries</h3><p>There are many libraries to parse SQL in different languages. Some support different databases and different programming languages. Here it is a list of the most used ones. Unless otherwise noted, the libraries are released under an opensource license.</p><h4>Multi-lingual and/or multi-databases</h4><ul><li><strong><a href=\"http://www.sqlparser.com/index.php\">General SQL Parser</a></strong> is a commercial library that supports many databases (DB2, Greenplum, Hana, Hive, Impala, Informix, MySQL, Netezza, Oracle, PostgreSQL, Redshift SQL Server, Sybase, and Teradata) and languages (<strong>C#, VB.NET, Java, C/C++, Delphi, VB</strong>). It can validate SQL syntax, format SQL and work with the parse tree</li><li><em><a href=\"https://github.com/JSQLParser/JSqlParser\">JSqlParser</a> parses an SQL statement and translates it into a hierarchy of <strong>Java</strong> classes</em>. It is opensource, with a double LGPL and Apache license, and supports many databases: Oracle, SqlServer, MySQL, PostgreSQL, etc.</li></ul><h4>MySQL parsers</h4><ul><li><a href=\"https://github.com/pingcap/parser\">Pingcap parser</a> is a MySQL parser in <strong>Go</strong>.</li><li><a href=\"https://github.com/xwb1989/sqlparser\">xwb1989/sqlparser</a> is a MySQL parser for <strong>Go</strong>. This parser has been extracted from <a href=\"https://github.com/vitessio/vitess\">Vitess</a>, a database clustering system for horizontal scaling of MySQL.</li><li><a href=\"https://github.com/greenlion/PHP-SQL-Parser\">PHP SQL Parser</a> is a (mainly) MySQL (non-validating) parser written in <strong>PHP</strong>. It can parse other SQL dialects with some modifications. It fully supports parsing the <a href=\"https://github.com/greenlion/PHP-SQL-Parser#full-support-for-the-mysql-dialect-for-the-following-statement-types\">most used SQL statements</a>, but it just returns some information on other statements.</li><li>The <a href=\"https://github.com/phpmyadmin/sql-parser\">SQL Parser of <strong>phpmyadmin</strong></a> is <em>a validating SQL lexer and parser with a focus on MySQL dialect</em>. Given its use in PHPMyAdmin, it is certainly well tested.</li><li><strong><a href=\"https://github.com/JavaScriptor/js-sql-parser\">js-sql-parser</a></strong> is SQL (only select) parser for JavaScript that parses the MySQL 5.7 version of SQL into an AST.</li></ul><h4>SQLite Parsers</h4><ul><li><a href=\"https://github.com/codeschool/sqlite-parser\">sqlite-parser</a> is a parser for SQLite v3 written in <strong>JavaScript</strong> that generates ASTs.</li></ul><h4>SQL Parsers</h4><ul><li><a href=\"https://github.com/forward/sql-parser\">sql-parser</a> is a parser for SQL written in pure <strong>JavaScript</strong>. It is not maintained anymore and it only supports some SELECT queries, but it is probably better than starting from scratch if you need to use JavaScript.</li><li><a href=\"https://github.com/hyrise/sql-parser\">hyrise/sql-parser</a> is a SQL parser for <strong>C++</strong>. It parses the given SQL query into C++ objects. It is developed together with Hyrise, an in-memory database, but it can be used on its own.</li><li><a href=\"https://github.com/andialbrecht/sqlparse\">andialbrecht/<em>sqlparse</em></a><em> is a non-validating SQL parser for <strong>Python</strong>. It provides support for parsing, splitting and formatting SQL statements. </em></li><li><em><a href=\"https://github.com/K2InformaticsGmbH/sqlparse\">K2InformaticsGmbH/sqlparse</a> is a production-ready SQL parser written in pure Erlang</em>. It targets the Oracle PL/SQL dialect.</li><li><strong><a href=\"https://github.com/andygrove/sqlparser-rs\">sqlparser-rs</a></strong> is SQL parser written in <strong>Rust</strong>. It supports the SQL-92, plus some addition for MS-SQL, PostgreSQL, and SQL:2011. The developers say: <em>if you are assessing whether this project will be suitable for your needs, you’ll likely need to experimentally verify whether it supports the subset of SQL that you need</em>.</li><li><strong><a href=\"https://github.com/mozilla/moz-sql-parser\">moz-sql-parser</a></strong> is a peculiar SQL parser in <strong>Python</strong> written by Mozilla. <em>The primary objective of this library is to convert some subset of SQL-92 queries to JSON-izable parse trees</em>.</li><li><a href=\"https://github.com/uber/queryparser\">queryparser</a> is a parser written in <strong>Haskell</strong> for <em>parsing and analysis of <strong>Vertica, Hive, and Presto SQL</strong></em>.</li></ul><h3>Tools</h3><h4>From SQL to a Programming Language or another SQL</h4><ul><li><a href=\"http://www.io64.com/plsql-to-java-migration/\">IO64</a> offers a tool to convert PL/SQL to Java. We have also seen this tool in our previous article <a href=\"https://tomassetti.me/convert-pl-sql-code-to-java/\">Convert PL/SQL code to Java</a></li><li><a href=\"https://www.ispirer.com/\">Ispirer</a> is a company that provides a tool to perform database migration from different SQL dialects to another SQL dialect or a programming language: Ispirer MnMTK. We have seen it in our previous article <a href=\"https://tomassetti.me/convert-pl-sql-code-to-java/\">Convert PL/SQL code to Java</a></li><li><a href=\"http://SQLines SQL Converter\">SQLines SQL Converter</a> is an open-source tool to convert a SQL dialect to a different SQL dialect. It is written in C++ and implements its own SQL parser.</li></ul></div></div><h2>How Hard Could it be to Parse a Declarative Language?</h2><p>Declarative languages tend to have simpler structures than your average programming language. For instance, you do not see many nested lambdas used inside declarative languages. A program in a declarative language is usually a long list of simple statements. <strong>The issue is that any single statement can be fairly complicated in some cases</strong>. And that is what happens in SQL.</p><p>Furthermore, there are actually several versions of SQL. This is true both in the sense that each database can implement it differently, and that there are <a href=\"https://en.wikipedia.org/wiki/ISO/IEC_9075\">many versions of the SQL standard</a>&nbsp;because the language is evolving.</p><p>As an example, you are certainly familiar with a SELECT statement. In its basic format, like <code>SELECT name FROM customers WHERE id = 1</code> it is quite easy to parse. However, the complete statement can be fairly complex. This image represents the SELECT statement as implemented in SQLite.</p><figure class=\"wp-block-image size-large\"><img class=\"wp-image-6048\" src=\"data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%200%200'%3E%3C/svg%3E\" alt=\"\" data-lazy-srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/03/SQLite_select.png 623w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/03/SQLite_select-212x300.png 212w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/03/SQLite_select-499x705.png 499w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/03/SQLite_select-450x636.png 450w\" data-lazy-sizes=\"(max-width: 623px) 100vw, 623px\" data-lazy-src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/03/SQLite_select.png\"><noscript><img class=\"wp-image-6048\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/03/SQLite_select.png\" alt=\"\" srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/03/SQLite_select.png 623w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/03/SQLite_select-212x300.png 212w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/03/SQLite_select-499x705.png 499w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/03/SQLite_select-450x636.png 450w\" sizes=\"(max-width: 623px) 100vw, 623px\" /></noscript></figure><p>So, to implement support for parsing the general case will certainly take some time.</p><h2>Try to Parse for Your Application</h2><p><strong>The reality is that to implement support for parsing the whole SQL requires a lot of effort</strong>, probably as much as parsing any average programming language. Even more, if you need to parse many different SQL dialects. Then, if you need to parse SQL and cannot rely on a ready-to-use library, you should start with an analysis of your needs. You should try to understand first exactly what you need to parse and then try to parse in light of your application. This means both to parse just what you need and to structure the grammar in a way that makes your life easier.</p><p>For instance, if you just need to translate a series of SQL files just once, it may be acceptable to just ignore 40 complex statements. Maybe translating them manually would take less time than creating a large grammar to do it automatically. This does not work if you either have a lot of code or you need to do the translation repeatedly, not just once.</p><p>In this tutorial we are going to use this pragmatic approach: we are going to create a SQL grammar from scratch to parse just what we need and to ignore the rest.</p><h2>Writing a (Very Partial) Grammar</h2><p>In our example, we will parse a simple SQL file (an exported database) to generate classes that could represent that database. We are going to ignore everything else, even any exported data present in the file. That’s it. The advantage of dealing with SQL files is that we do not need to interact with a database. In fact, the database might not even exist anymore.</p><h3>Designing a Partial Grammar</h3><p>To do that we are going to start with a grammar. We are going to write a very simple one, but there are a couple of things to keep in mind:</p><ul><li>SQL is not case-sensitive, while ANTLR grammars by default are</li><li>Our input (the SQL files) will contain some data that we do not care about. We still need to parse the file successfully while ignoring the extraneous input</li></ul><p>These are notable issues that are specific to SQL and to our approach; they would not probably appear with other languages or if we wanted to create a complete grammar.</p><p>Before starting, just to give you an idea of what we have to deal with, this is a sample SQL file.</p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"sql\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">--\n-- Table structure for table actor\n--\n--DROP TABLE actor;\n\nCREATE TABLE actor (\n  actor_id numeric NOT NULL ,\n  first_name VARCHAR(45) NOT NULL,\n  last_name VARCHAR(45) NOT NULL,\n  last_update TIMESTAMP NOT NULL,\n  PRIMARY KEY  (actor_id)\n  )\n  ;\n\nCREATE  INDEX idx_actor_last_name ON actor(last_name)\n;\n \nCREATE TRIGGER actor_trigger_ai AFTER INSERT ON actor\n BEGIN\n  UPDATE actor SET last_update = DATETIME('NOW')  WHERE rowid = new.rowid;\n END\n;</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"\">--</span></li><li class=\" even\"><span class=\"\">--</span><span class=\"co1\"> Table structure for table actor</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">--</span></li><li class=\" even\"><span class=\"\">--</span><span class=\"kw1\">DROP</span><span class=\"\"> </span><span class=\"kw1\">TABLE</span><span class=\"\"> actor;</span></li><li class=\" odd\"><span class=\"\"></span></li><li class=\" even\"><span class=\"\"></span><span class=\"kw1\">CREATE</span><span class=\"\"> </span><span class=\"kw1\">TABLE</span><span class=\"\"> actor (</span></li><li class=\" odd\"><span class=\"\">  actor_id </span><span class=\"kw1\">numeric</span><span class=\"\"> </span><span class=\"kw3\">NOT</span><span class=\"\"> </span><span class=\"kw3\">NULL</span><span class=\"\"> ,</span></li><li class=\" even\"><span class=\"\">  first_name </span><span class=\"kw1\">VARCHAR</span><span class=\"\">(</span><span class=\"nu0\">45</span><span class=\"\">) </span><span class=\"kw3\">NOT</span><span class=\"\"> </span><span class=\"kw3\">NULL</span><span class=\"\">,</span></li><li class=\" odd\"><span class=\"\">  last_name </span><span class=\"kw1\">VARCHAR</span><span class=\"\">(</span><span class=\"nu0\">45</span><span class=\"\">) </span><span class=\"kw3\">NOT</span><span class=\"\"> </span><span class=\"kw3\">NULL</span><span class=\"\">,</span></li><li class=\" even\"><span class=\"\">  last_update </span><span class=\"kw1\">TIMESTAMP</span><span class=\"\"> </span><span class=\"kw3\">NOT</span><span class=\"\"> </span><span class=\"kw3\">NULL</span><span class=\"\">,</span></li><li class=\" odd\"><span class=\"\">  </span><span class=\"kw1\">PRIMARY</span><span class=\"\"> </span><span class=\"kw1\">KEY</span><span class=\"\">  (actor_id)</span></li><li class=\" even\"><span class=\"\">  )</span></li><li class=\" odd\"><span class=\"\">  ;</span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\"></span><span class=\"kw1\">CREATE</span><span class=\"\">  </span><span class=\"kw1\">INDEX</span><span class=\"\"> idx_actor_last_name </span><span class=\"kw1\">ON</span><span class=\"\"> actor(last_name)</span></li><li class=\" even\"><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\"> </span></li><li class=\" even\"><span class=\"\"></span><span class=\"kw1\">CREATE</span><span class=\"\"> </span><span class=\"kw1\">TRIGGER</span><span class=\"\"> actor_trigger_ai </span><span class=\"kw1\">AFTER</span><span class=\"\"> </span><span class=\"kw1\">INSERT</span><span class=\"\"> </span><span class=\"kw1\">ON</span><span class=\"\"> actor</span></li><li class=\" odd\"><span class=\"\"> </span><span class=\"kw1\">BEGIN</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">  </span><span class=\"kw1\">UPDATE</span><span class=\"\"> actor </span><span class=\"kw1\">SET</span><span class=\"\"> last_update = DATETIME(</span><span class=\"st0\">'NOW'</span><span class=\"\">)  </span><span class=\"kw1\">WHERE</span><span class=\"\"> rowid = new.rowid;</span></li><li class=\" odd\"><span class=\"\"> </span><span class=\"kw1\">END</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">;</span></li></ol><pre style=\"display: none;\">--\n-- Table structure for table actor\n--\n--DROP TABLE actor;\n\nCREATE TABLE actor (\n  actor_id numeric NOT NULL ,\n  first_name VARCHAR(45) NOT NULL,\n  last_name VARCHAR(45) NOT NULL,\n  last_update TIMESTAMP NOT NULL,\n  PRIMARY KEY  (actor_id)\n  )\n  ;\n\nCREATE  INDEX idx_actor_last_name ON actor(last_name)\n;\n \nCREATE TRIGGER actor_trigger_ai AFTER INSERT ON actor\n BEGIN\n  UPDATE actor SET last_update = DATETIME('NOW')  WHERE rowid = new.rowid;\n END\n;</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div><p>As you can see at a first glance, we need to parse CREATE TABLE statements and ignore the other ones. We also need to ignore some parts of the CREATE TABLE statements, because they do not contain any information we care about for our task.</p><h3>How to Ignore Stuff</h3><p><strong>The key to design a partial grammar is understanding how to ignore everything except for what we care about</strong>. This is not trivial because we have two conflicting needs: to ignore or drop most information and to keep all the necessary context to parse what we need. The more we ignore, the hardest is to parse what we need. This is tricky particularly for lexing since the lexer has less information available to make a decision.</p><p>For instance, we cannot just say ignore anything until we find a <code>CREATE</code> token. That is because the lexer would still find tokens for the elements in row definition, like the ones for naming the columns (e.g. <code>last_name</code>) in INSERT statements or CREATE INDEX. One possible way to deal with this would be lexical modes. These are a way to include multiple sets of lexer rules and switch between them. See our <a href=\"https://tomassetti.me/antlr-mega-tutorial/#lexical-modes\">ANTLR Mega Tutorial</a>, if you need to know more.</p><p>Essentially we would treat SQL as if it were a markup language: bits of structured information in a sea of free text that we could ignore. This could work in our case because SQL has a regular structure and we are just interested in CREATE TABLE statements. For regular structure, we mean that a SQL file is just a list of statements, each of them ends with a semicolon. So, we could just make a <code>CREATE TABLE</code> token to start the special lexical mode and use the <code>semicolon</code> to end the special lexical mode. However, it is not flexible, so it would be risky in case we need to use our grammar for something else.</p><h4>The Cognizant Way of Ignoring Stuff</h4><p>Our preferred approach is more flexible, and can also be used for regular programming languages.</p><p>On the lexer side, we just put as the last lexer rule this ANY rule.</p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">ANY             : . -&gt; skip;</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"\">ANY             : . -&gt; skip;</span></li></ol><pre style=\"display: none;\">ANY             : . -&gt; skip;</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div><p>We skip every character, that was not already recognized by some previous token.</p><p>On the parser side, these would be our main rules.</p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">statements          : (statement | ignore)+ EOF\n                    ;\n\nstatement           : createStmt\n                    ;\n\nignore              : .*? SEMICOLON\n                    | COMMENT\n                    ;</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"\">statements          : </span><span class=\"br0\">(</span><span class=\"\">statement | ignore</span><span class=\"br0\">)</span><span class=\"\">+ EOF</span></li><li class=\" even\"><span class=\"\">                    ;</span></li><li class=\" odd\"><span class=\"\"></span></li><li class=\" even\"><span class=\"\">statement           : createStmt</span></li><li class=\" odd\"><span class=\"\">                    ;</span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">ignore              : .*? SEMICOLON</span></li><li class=\" even\"><span class=\"\">                    | COMMENT</span></li><li class=\" odd\"><span class=\"\">                    ;</span></li></ol><pre style=\"display: none;\">statements          : (statement | ignore)+ EOF\n                    ;\n\nstatement           : createStmt\n                    ;\n\nignore              : .*? SEMICOLON\n                    | COMMENT\n                    ;</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div><p>The main rule is <code>statements</code>, which captures both the stuff we care about and the stuff to ignore. This approach allows us to start using our grammar while we build it. For this example, we only need to parse CREATE TABLE statements, but you could slowly add support for parsing more statements with this structure.</p><p>We need the <code>ignore</code> rule to maintain an understanding of the structure of the SQL file. <strong>Without this rule, we would not be able to recognize and parse the statements we are interested in</strong>. The negative side-effect is that it will clutter our parse tree with <em>ignore</em> nodes. For instance, this is a graphical representation of a sample parse tree made with <code>grun</code>, the ANTLR testing utility.</p><figure class=\"wp-block-image size-large\"><img class=\"wp-image-6052\" src=\"data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%200%200'%3E%3C/svg%3E\" alt=\"Sample parse tree with a partial SQL grammar\" data-lazy-srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar-1030x772.png 1030w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar-300x225.png 300w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar-768x576.png 768w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar-1536x1151.png 1536w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar-1500x1124.png 1500w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar-705x528.png 705w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar-450x337.png 450w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar-205x155.png 205w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar.png 1628w\" data-lazy-sizes=\"(max-width: 1030px) 100vw, 1030px\" data-lazy-src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar-1030x772.png\"><noscript><img class=\"wp-image-6052\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar-1030x772.png\" alt=\"Sample parse tree with a partial SQL grammar\" srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar-1030x772.png 1030w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar-300x225.png 300w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar-768x576.png 768w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar-1536x1151.png 1536w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar-1500x1124.png 1500w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar-705x528.png 705w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar-450x337.png 450w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar-205x155.png 205w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/sample_parse_tree_sql_partial_grammar.png 1628w\" sizes=\"(max-width: 1030px) 100vw, 1030px\" /></noscript></figure><h3>Parsing Create Statements</h3><p>We use a similar approach to parsing the CREATE TABLE statements.</p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">createStmt          : CREATE TABLE (IF NOT EXISTS)? tableName=name\n                        LPAREN element (COMMA element)* RPAREN?\n                        SEMICOLON\n                    ;\n\nelement             : definition\n                    | ignorable\n                    ;\n\nignorable           : (PRIMARY? KEY | CONSTRAINT | SPECIAL_FEATURES | FULLTEXT) .*? (COMMA|RPAREN)                    \n                    ;\n\ndefinition          : name type defaultValue? nullability? attributes*;</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"\">createStmt          : CREATE </span><span class=\"kw1\">TABLE</span><span class=\"\"> </span><span class=\"br0\">(</span><span class=\"\">IF NOT EXISTS</span><span class=\"br0\">)</span><span class=\"\">? tableName=name</span></li><li class=\" even\"><span class=\"\">                        LPAREN </span><span class=\"kw1\">element</span><span class=\"\"> </span><span class=\"br0\">(</span><span class=\"\">COMMA element</span><span class=\"br0\">)</span><span class=\"\">* RPAREN?</span></li><li class=\" odd\"><span class=\"\">                        SEMICOLON</span></li><li class=\" even\"><span class=\"\">                    ;</span></li><li class=\" odd\"><span class=\"\"></span></li><li class=\" even\"><span class=\"\">element             : definition</span></li><li class=\" odd\"><span class=\"\">                    | ignorable</span></li><li class=\" even\"><span class=\"\">                    ;</span></li><li class=\" odd\"><span class=\"\"></span></li><li class=\" even\"><span class=\"\">ignorable           : </span><span class=\"br0\">(</span><span class=\"\">PRIMARY? KEY | CONSTRAINT | SPECIAL_FEATURES | FULLTEXT</span><span class=\"br0\">)</span><span class=\"\"> .*? </span><span class=\"br0\">(</span><span class=\"\">COMMA|RPAREN</span><span class=\"br0\">)</span><span class=\"\">                    </span></li><li class=\" odd\"><span class=\"\">                    ;</span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">definition          : name type defaultValue? nullability? attributes*;</span></li></ol><pre style=\"display: none;\">createStmt          : CREATE TABLE (IF NOT EXISTS)? tableName=name\n                        LPAREN element (COMMA element)* RPAREN?\n                        SEMICOLON\n                    ;\n\nelement             : definition\n                    | ignorable\n                    ;\n\nignorable           : (PRIMARY? KEY | CONSTRAINT | SPECIAL_FEATURES | FULLTEXT) .*? (COMMA|RPAREN)                    \n                    ;\n\ndefinition          : name type defaultValue? nullability? attributes*;</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div><p>The statement includes both definitions of columns, that we need, and settings for the table, that we could ignore. So, our <code>element</code> rule can accept both the definition for a row and the information about primary keys, constraints, etc. Later, in our code, we will simply ignore both the nodes <code>ignore</code> and <code>ignorable</code>.</p><p>The rules themselves are fairly easy to understand and should be obvious for everybody that has seen SQL. There is only a dirty trick that needs to be explained. You can see that the closing parenthesis (<code>RPAREN</code>) that should be at the end of the list of column definitions is optional. Technically this is not correct, it should always be there. However, we use this to fix an issue regarding the <code>ignorable</code> rule.</p><h4>Getting Around the Need to Actually Parse Settings</h4><p>The issue is that the <code>ignorable</code> rule is only a partial implementation of the parsing of these settings that you will find in a SQL file. In fact, this is the bare minimum necessary to parse correctly a bunch of sample SQL files we encountered. It is not a good design, but this is a very realistic implementation. Look at this example and see if you can spot our problem.</p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">CREATE TABLE city (\n  city_id int NOT NULL,\n  city VARCHAR(50) NOT NULL,\n  country_id SMALLINT NOT NULL,\n  last_update TIMESTAMP NOT NULL,\n  PRIMARY KEY  (city_id),\n  CONSTRAINT fk_city_country FOREIGN KEY (country_id) REFERENCES country (country_id) ON DELETE NO ACTION ON UPDATE CASCADE\n);</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"\">CREATE TABLE </span><span class=\"kw1\">city</span><span class=\"\"> </span><span class=\"br0\">(</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">  city_id int NOT NULL,</span></li><li class=\" odd\"><span class=\"\">  city </span><span class=\"kw1\">VARCHAR</span><span class=\"br0\">(</span><span class=\"nu0\">50</span><span class=\"br0\">)</span><span class=\"\"> NOT NULL,</span></li><li class=\" even\"><span class=\"\">  country_id SMALLINT NOT NULL,</span></li><li class=\" odd\"><span class=\"\">  last_update TIMESTAMP NOT NULL,</span></li><li class=\" even\"><span class=\"\">  PRIMARY </span><span class=\"kw1\">KEY</span><span class=\"\">  </span><span class=\"br0\">(</span><span class=\"\">city_id</span><span class=\"br0\">)</span><span class=\"\">,</span></li><li class=\" odd\"><span class=\"\">  CONSTRAINT fk_city_country FOREIGN </span><span class=\"kw1\">KEY</span><span class=\"\"> </span><span class=\"br0\">(</span><span class=\"\">country_id</span><span class=\"br0\">)</span><span class=\"\"> REFERENCES </span><span class=\"kw1\">country</span><span class=\"\"> </span><span class=\"br0\">(</span><span class=\"\">country_id</span><span class=\"br0\">)</span><span class=\"\"> ON DELETE NO ACTION ON UPDATE CASCADE</span></li><li class=\" even\"><span class=\"\"></span><span class=\"br0\">)</span><span class=\"\">;</span></li></ol><pre style=\"display: none;\">CREATE TABLE city (\n  city_id int NOT NULL,\n  city VARCHAR(50) NOT NULL,\n  country_id SMALLINT NOT NULL,\n  last_update TIMESTAMP NOT NULL,\n  PRIMARY KEY  (city_id),\n  CONSTRAINT fk_city_country FOREIGN KEY (country_id) REFERENCES country (country_id) ON DELETE NO ACTION ON UPDATE CASCADE\n);</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div><p><strong>This partial implementation has the issue that it does not parse well enough to understand when it found the end of a setting</strong>. So, it uses as a clue the comma (i.e., the start of a new setting) or the final closing parenthesis (i.e., the end of the list of elements) for the final setting.</p><p>Now, how safe is it to use this dirty trick? In this case, it is safe because SQL files are not written by humans, they are exported with tools. This means that there will not be missing parenthesis that will mess up the recognition of subsequent statements. So, we actually can be sure that every CREATE TABLE will end with a closing parenthesis and a semicolon. This may vary with different languages, different sources of SQL statements or different databases.</p><p>When you need to only partially implement a grammar these sorts of tricks can be quite helpful to speed up development and get your task done quicker. You have to be careful and aware of the risks, but they can be useful.</p><h3>The Rest of the Grammar</h3><p>The rest of the grammar is also fairly simple to understand. We just mention a couple of things.</p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">name                : QUOTE? NAME QUOTE? ;</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"\">name                : QUOTE? NAME QUOTE? ;</span></li></ol><pre style=\"display: none;\">name                : QUOTE? NAME QUOTE? ;</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div><p>The rule <code>name</code> is a parser rule instead of a lexer rule. That is because some tools wrap the name of the column with quotation marks (these are also used as apostrophes in some languages) like <code>`</code> or <code>'</code>. With this definition, later in our code, we can easily extract the real name of the column without any check for quotation marks.</p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">type                : (INTEGER | INT) UNSIGNED?                                                     #integerType\n                    | (TINYINT | SMALLINT) UNSIGNED?                                                #smallIntegerType\n                    | TEXT                                                                          #textType\n                    | BLOB (SUBTYPE type)?                                                          #blobType\n                    | (VARCHAR|CHARVAR) LPAREN NUMBER RPAREN                                        #varcharType\n                    | CHAR LPAREN NUMBER RPAREN                                                     #charType\n                    | YEAR                                                                          #yearType\n                    | DATETIME                                                                      #datetimeType\n                    | TIMESTAMP TIMEZONE?                                                           #timestampType\n                    | (NUMERIC | DECIMAL) (LPAREN precision=NUMBER (COMMA scale=NUMBER)? RPAREN)?   #decimalType\n                    ;</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"\">type                : </span><span class=\"br0\">(</span><span class=\"\">INTEGER | INT</span><span class=\"br0\">)</span><span class=\"\"> UNSIGNED?                                                     </span><span class=\"co1\">#integerType</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">                    | </span><span class=\"br0\">(</span><span class=\"\">TINYINT | SMALLINT</span><span class=\"br0\">)</span><span class=\"\"> UNSIGNED?                                                </span><span class=\"co1\">#smallIntegerType</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">                    | TEXT                                                                          </span><span class=\"co1\">#textType</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">                    | </span><span class=\"kw1\">BLOB</span><span class=\"\"> </span><span class=\"br0\">(</span><span class=\"\">SUBTYPE type</span><span class=\"br0\">)</span><span class=\"\">?                                                          </span><span class=\"co1\">#blobType</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">                    | </span><span class=\"br0\">(</span><span class=\"\">VARCHAR|CHARVAR</span><span class=\"br0\">)</span><span class=\"\"> LPAREN NUMBER RPAREN                                        </span><span class=\"co1\">#varcharType</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">                    | CHAR LPAREN NUMBER RPAREN                                                     </span><span class=\"co1\">#charType</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">                    | YEAR                                                                          </span><span class=\"co1\">#yearType</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">                    | DATETIME                                                                      </span><span class=\"co1\">#datetimeType</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">                    | TIMESTAMP TIMEZONE?                                                           </span><span class=\"co1\">#timestampType</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">                    | </span><span class=\"br0\">(</span><span class=\"\">NUMERIC | DECIMAL</span><span class=\"br0\">)</span><span class=\"\"> </span><span class=\"br0\">(</span><span class=\"\">LPAREN precision=</span><span class=\"kw1\">NUMBER</span><span class=\"\"> </span><span class=\"br0\">(</span><span class=\"\">COMMA scale=NUMBER</span><span class=\"br0\">)</span><span class=\"\">? RPAREN</span><span class=\"br0\">)</span><span class=\"\">?   </span><span class=\"co1\">#decimalType</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">                    ;</span></li></ol><pre style=\"display: none;\">type                : (INTEGER | INT) UNSIGNED?                                                     #integerType\n                    | (TINYINT | SMALLINT) UNSIGNED?                                                #smallIntegerType\n                    | TEXT                                                                          #textType\n                    | BLOB (SUBTYPE type)?                                                          #blobType\n                    | (VARCHAR|CHARVAR) LPAREN NUMBER RPAREN                                        #varcharType\n                    | CHAR LPAREN NUMBER RPAREN                                                     #charType\n                    | YEAR                                                                          #yearType\n                    | DATETIME                                                                      #datetimeType\n                    | TIMESTAMP TIMEZONE?                                                           #timestampType\n                    | (NUMERIC | DECIMAL) (LPAREN precision=NUMBER (COMMA scale=NUMBER)? RPAREN)?   #decimalType\n                    ;</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div><p>The rule to parse the type of the column includes rule labels. We designed this way to simplify our job, later in the code where we use the parser. This is also the reason because the VARCHAR rule is separated from the CHAR rule. Structurally the rules are obviously identical, but they mean something different. <strong>Remember: you should parse for your application, to make the parse effective for your needs.</strong></p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">fragment A      : [aA];\nfragment B      : [bB];\nfragment C      : [cC];\nfragment D      : [dD];\nfragment E      : [eE];\n// etc.</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"\">fragment A      : </span><span class=\"br0\">[</span><span class=\"\">aA</span><span class=\"br0\">]</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">fragment B      : </span><span class=\"br0\">[</span><span class=\"\">bB</span><span class=\"br0\">]</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">fragment C      : </span><span class=\"br0\">[</span><span class=\"\">cC</span><span class=\"br0\">]</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">fragment D      : </span><span class=\"br0\">[</span><span class=\"\">dD</span><span class=\"br0\">]</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">fragment E      : </span><span class=\"br0\">[</span><span class=\"\">eE</span><span class=\"br0\">]</span><span class=\"\">;</span><span class=\"co1\"></span></li><li class=\" even\"><span class=\"co1\">// etc.</span></li></ol><pre style=\"display: none;\">fragment A      : [aA];\nfragment B      : [bB];\nfragment C      : [cC];\nfragment D      : [dD];\nfragment E      : [eE];\n// etc.</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div><p>Since SQL is case-insensitive we use fragments for letters everywhere we need, to ensure that we parse everything correctly.</p><p>You can see the rest of the grammar on the companion repository.</p><h2>CREATING THE C# PROJECT</h2><p>We can finally see some code. We are going to create a C# project from the command line since we are using VS Code as our editor. These are the instructions to create the project and to add the ANTLR library.</p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"shell\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">// create a new directory somewhere\n// to create a new C# project\ndotnet new console -lang C#\n// to install the standard ANTLR 4 Runtime\ndotnet add package Antlr4.Runtime.Standard</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"\">// create a new directory somewhere</span></li><li class=\" even\"><span class=\"\">// to create a new C# project</span></li><li class=\" odd\"><span class=\"\">dotnet new console -lang C#</span></li><li class=\" even\"><span class=\"\">// to install the standard ANTLR 4 Runtime</span></li><li class=\" odd\"><span class=\"\">dotnet add package Antlr4.Runtime.Standard</span></li></ol><pre style=\"display: none;\">// create a new directory somewhere\n// to create a new C# project\ndotnet new console -lang C#\n// to install the standard ANTLR 4 Runtime\ndotnet add package Antlr4.Runtime.Standard</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div><p>These are the instructions to generate the parser and to run the program.</p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"shell\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">// to generate the parser\nantlr4 SQL.g4 -Dlanguage=CSharp -o generated\\ -encoding UTF-8\n// to run the program\ndotnet run</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"\">// to generate the parser</span></li><li class=\" even\"><span class=\"\">antlr4 SQL.g4 -Dlanguage=CSharp -o generated\\ -encoding UTF-8</span></li><li class=\" odd\"><span class=\"\">// to run the program</span></li><li class=\" even\"><span class=\"\">dotnet run</span></li></ol><pre style=\"display: none;\">// to generate the parser\nantlr4 SQL.g4 -Dlanguage=CSharp -o generated\\ -encoding UTF-8\n// to run the program\ndotnet run</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div><p>Even our main source code file is fairly standard.</p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"csharp\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">static void Main(string[] args)\n{\n    // standard ANTLR code\n    // we get the input\n    ICharStream chars = CharStreams.fromPath(args[0]);\n    // we set up the lexer\n    SQLLexer lexer = new SQLLexer(chars);            \n    // we use the lexer\n    CommonTokenStream stream = new CommonTokenStream(lexer);\n    // we set up the parser\n    SQLParser parser = new SQLParser(stream);\n\n    // we find the root node of our parse tree             \n    var tree = parser.statements();                                    \n    \n    // we create our visitor\n    CreateVisitor createVisitor = new CreateVisitor();   \n    List&lt;ClassDescriptor&gt; classes = createVisitor.VisitStatements(tree);\n\n    // we choose our code generator...\n    ICodeGenerator generator;\n\n    // ...depending on the command line argument\n    if(args.Count() &gt; 1 &amp;&amp; args[1] == \"kotlin\")\n        generator = new KotlinCodeGenerator();\n    else\n        generator = new CSharpCodeGenerator();\n    \n    Console.WriteLine(generator.ToSourceCode(\"SQLDataTypes\", classes));\n}</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"kw3\">static</span><span class=\"\"> </span><span class=\"kw1\">void</span><span class=\"\"> </span><span class=\"me0\">Main</span><span class=\"br0\">(</span><span class=\"kw2\">string</span><span class=\"br0\">[</span><span class=\"br0\">]</span><span class=\"\"> args</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\"></span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">   </span><span class=\"co1\"> // standard ANTLR code</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">   </span><span class=\"co1\"> // we get the input</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">    ICharStream chars = CharStreams.</span><span class=\"me0\">fromPath</span><span class=\"br0\">(</span><span class=\"\">args</span><span class=\"br0\">[</span><span class=\"nu0\">0</span><span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">   </span><span class=\"co1\"> // we set up the lexer</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">    SQLLexer lexer = </span><span class=\"kw1\">new</span><span class=\"\"> </span><span class=\"me0\">SQLLexer</span><span class=\"br0\">(</span><span class=\"\">chars</span><span class=\"br0\">)</span><span class=\"\">;            </span></li><li class=\" even\"><span class=\"\">   </span><span class=\"co1\"> // we use the lexer</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">    CommonTokenStream stream = </span><span class=\"kw1\">new</span><span class=\"\"> </span><span class=\"me0\">CommonTokenStream</span><span class=\"br0\">(</span><span class=\"\">lexer</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">   </span><span class=\"co1\"> // we set up the parser</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">    SQLParser parser = </span><span class=\"kw1\">new</span><span class=\"\"> </span><span class=\"me0\">SQLParser</span><span class=\"br0\">(</span><span class=\"\">stream</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">   </span><span class=\"co1\"> // we find the root node of our parse tree             </span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">    var tree = parser.</span><span class=\"me0\">statements</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;                                    </span></li><li class=\" odd\"><span class=\"\">    </span></li><li class=\" even\"><span class=\"\">   </span><span class=\"co1\"> // we create our visitor</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">    CreateVisitor createVisitor = </span><span class=\"kw1\">new</span><span class=\"\"> </span><span class=\"me0\">CreateVisitor</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;   </span></li><li class=\" even\"><span class=\"\">    List&lt;ClassDescriptor&gt; classes = createVisitor.</span><span class=\"me0\">VisitStatements</span><span class=\"br0\">(</span><span class=\"\">tree</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\"></span></li><li class=\" even\"><span class=\"\">   </span><span class=\"co1\"> // we choose our code generator...</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">    ICodeGenerator generator;</span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">   </span><span class=\"co1\"> // ...depending on the command line argument</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">    </span><span class=\"kw1\">if</span><span class=\"br0\">(</span><span class=\"\">args.</span><span class=\"me0\">Count</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\"> &gt; </span><span class=\"nu0\">1</span><span class=\"\"> &amp;&amp; args</span><span class=\"br0\">[</span><span class=\"nu0\">1</span><span class=\"br0\">]</span><span class=\"\"> == </span><span class=\"st1\">\"kotlin\"</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">        generator = </span><span class=\"kw1\">new</span><span class=\"\"> </span><span class=\"me0\">KotlinCodeGenerator</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">    </span><span class=\"kw1\">else</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">        generator = </span><span class=\"kw1\">new</span><span class=\"\"> </span><span class=\"me0\">CSharpCodeGenerator</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">    </span></li><li class=\" odd\"><span class=\"\">    Console.</span><span class=\"me0\">WriteLine</span><span class=\"br0\">(</span><span class=\"\">generator.</span><span class=\"me0\">ToSourceCode</span><span class=\"br0\">(</span><span class=\"st1\">\"SQLDataTypes\"</span><span class=\"\">, classes</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\"></span><span class=\"br0\">}</span></li></ol><pre style=\"display: none;\">static void Main(string[] args)\n{\n    // standard ANTLR code\n    // we get the input\n    ICharStream chars = CharStreams.fromPath(args[0]);\n    // we set up the lexer\n    SQLLexer lexer = new SQLLexer(chars);            \n    // we use the lexer\n    CommonTokenStream stream = new CommonTokenStream(lexer);\n    // we set up the parser\n    SQLParser parser = new SQLParser(stream);\n\n    // we find the root node of our parse tree             \n    var tree = parser.statements();                                    \n    \n    // we create our visitor\n    CreateVisitor createVisitor = new CreateVisitor();   \n    List&lt;ClassDescriptor&gt; classes = createVisitor.VisitStatements(tree);\n\n    // we choose our code generator...\n    ICodeGenerator generator;\n\n    // ...depending on the command line argument\n    if(args.Count() &gt; 1 &amp;&amp; args[1] == \"kotlin\")\n        generator = new KotlinCodeGenerator();\n    else\n        generator = new CSharpCodeGenerator();\n    \n    Console.WriteLine(generator.ToSourceCode(\"SQLDataTypes\", classes));\n}</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div><p>The comments are self-explanatory. After our standard code to setup ANTLR and parse the input, we employ our <code>CreateVisitor</code>. We use the visitor to visit the create table statements and to generate an internal representation of them. Then we use this representation to generate a source code file in our chosen language. In our example we choose to generate either in Kotlin or C#, to show how easy it can be to work with our SQL data once you parse it.</p><p>This is the simple overall structure; we can now move on the individual parts.</p><h2>Visiting the Statements</h2><p>Let’s start by looking at the general organization of our visitor.</p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"csharp\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">public class CreateVisitor\n{\n    public  List&lt;ClassDescriptor&gt; VisitStatements(StatementsContext context)    \n    {\n        List&lt;ClassDescriptor&gt; tables = new List&lt;ClassDescriptor&gt;();\n        \n        foreach(var statement in context.statement())\n        {\n            tables.Add(VisitStmt(statement));\n        }\n\n        return tables;\n    }\n\n    public ClassDescriptor VisitStmt(StatementContext context)\n    {                      \n        return VisitCreateStmt(context.createStmt());\n    }\n\n    public ClassDescriptor VisitCreateStmt(CreateStmtContext context)\n    {\n        ClassDescriptor table = new ClassDescriptor();\n\n        table.Name = context.tableName.NAME().GetText();\n        table.Fields = new List&lt;FieldDescriptor&gt;();\n\n        foreach (var el in context.element())\n        {\n            if(el.definition() != null)\n            {\n                table.Fields.Add(VisitDefinition(el.definition()));\n            }                 \n        }        \n\n        return table;\n    }\n\t\n    [..]</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"kw1\">public</span><span class=\"\"> </span><span class=\"kw3\">class</span><span class=\"\"> CreateVisitor</span></li><li class=\" even\"><span class=\"\"></span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">    </span><span class=\"kw1\">public</span><span class=\"\">  List&lt;ClassDescriptor&gt; </span><span class=\"me0\">VisitStatements</span><span class=\"br0\">(</span><span class=\"\">StatementsContext context</span><span class=\"br0\">)</span><span class=\"\">    </span></li><li class=\" even\"><span class=\"\">    </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">        List&lt;ClassDescriptor&gt; tables = </span><span class=\"kw1\">new</span><span class=\"\"> List&lt;ClassDescriptor&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">        </span></li><li class=\" odd\"><span class=\"\">        </span><span class=\"kw1\">foreach</span><span class=\"br0\">(</span><span class=\"\">var statement </span><span class=\"kw3\">in</span><span class=\"\"> context.</span><span class=\"me0\">statement</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">        </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">            tables.</span><span class=\"me0\">Add</span><span class=\"br0\">(</span><span class=\"me0\">VisitStmt</span><span class=\"br0\">(</span><span class=\"\">statement</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">        </span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\"></span></li><li class=\" even\"><span class=\"\">        </span><span class=\"kw1\">return</span><span class=\"\"> tables;</span></li><li class=\" odd\"><span class=\"\">    </span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">    </span><span class=\"kw1\">public</span><span class=\"\"> ClassDescriptor </span><span class=\"me0\">VisitStmt</span><span class=\"br0\">(</span><span class=\"\">StatementContext context</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">    </span><span class=\"br0\">{</span><span class=\"\">                      </span></li><li class=\" odd\"><span class=\"\">        </span><span class=\"kw1\">return</span><span class=\"\"> </span><span class=\"me0\">VisitCreateStmt</span><span class=\"br0\">(</span><span class=\"\">context.</span><span class=\"me0\">createStmt</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">    </span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\"></span></li><li class=\" even\"><span class=\"\">    </span><span class=\"kw1\">public</span><span class=\"\"> ClassDescriptor </span><span class=\"me0\">VisitCreateStmt</span><span class=\"br0\">(</span><span class=\"\">CreateStmtContext context</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">    </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">        ClassDescriptor table = </span><span class=\"kw1\">new</span><span class=\"\"> </span><span class=\"me0\">ClassDescriptor</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\"></span></li><li class=\" even\"><span class=\"\">        table.Name = context.tableName.</span><span class=\"me0\">NAME</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">.</span><span class=\"me0\">GetText</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">        table.Fields = </span><span class=\"kw1\">new</span><span class=\"\"> List&lt;FieldDescriptor&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">        </span><span class=\"kw1\">foreach</span><span class=\"\"> </span><span class=\"br0\">(</span><span class=\"\">var el </span><span class=\"kw3\">in</span><span class=\"\"> context.</span><span class=\"me0\">element</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">        </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">            </span><span class=\"kw1\">if</span><span class=\"br0\">(</span><span class=\"\">el.</span><span class=\"me0\">definition</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\"> != </span><span class=\"kw1\">null</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">            </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">                table.Fields.</span><span class=\"me0\">Add</span><span class=\"br0\">(</span><span class=\"me0\">VisitDefinition</span><span class=\"br0\">(</span><span class=\"\">el.</span><span class=\"me0\">definition</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">            </span><span class=\"br0\">}</span><span class=\"\">                 </span></li><li class=\" odd\"><span class=\"\">        </span><span class=\"br0\">}</span><span class=\"\">        </span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">        </span><span class=\"kw1\">return</span><span class=\"\"> table;</span></li><li class=\" even\"><span class=\"\">    </span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">  </span></li><li class=\" even\"><span class=\"\">    </span><span class=\"br0\">[</span><span class=\"\">..</span><span class=\"br0\">]</span></li></ol><pre style=\"display: none;\">public class CreateVisitor\n{\n    public  List&lt;ClassDescriptor&gt; VisitStatements(StatementsContext context)    \n    {\n        List&lt;ClassDescriptor&gt; tables = new List&lt;ClassDescriptor&gt;();\n        \n        foreach(var statement in context.statement())\n        {\n            tables.Add(VisitStmt(statement));\n        }\n\n        return tables;\n    }\n\n    public ClassDescriptor VisitStmt(StatementContext context)\n    {                      \n        return VisitCreateStmt(context.createStmt());\n    }\n\n    public ClassDescriptor VisitCreateStmt(CreateStmtContext context)\n    {\n        ClassDescriptor table = new ClassDescriptor();\n\n        table.Name = context.tableName.NAME().GetText();\n        table.Fields = new List&lt;FieldDescriptor&gt;();\n\n        foreach (var el in context.element())\n        {\n            if(el.definition() != null)\n            {\n                table.Fields.Add(VisitDefinition(el.definition()));\n            }                 \n        }        \n\n        return table;\n    }\n\t\n    [..]</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div><p>The first thing we notice is that we do not need to use the standard base visitor that can be created for us by ANTLR. Our visitor uses just our code. We do not need to use the base visitor, because of the structure of a SQL file and because we know exactly what we need to visit. We can completely ignore everything that is not a create statement because every statement in our SQL files is a top-level element. It is not like statements in your average programming language, that can be nested inside a code block, function definitions, etc. Also, the structure of create statements is simple, so we can visit everything ourselves.</p><p>In short, all we need to do is:</p><ul><li>to visit the <code>statements</code> node</li><li>then to visit each <code>statement</code> node (we ignore the <code>ignore</code> nodes) and to select the <code>createStmt</code> node</li><li>visiting the <code>createStmt</code> nodes, we pick only the <code>definition</code> nodes (we ignore the <code>ignorable</code> nodes) to get all the columns definition</li></ul><h2>Translating Types from SQL to Your Language</h2><p>Inside the <code>VisitDefinition</code> method we deal with the only real complication of this visitor: handling types.</p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"csharp\" data-enlighter-theme=\"\" data-enlighter-highlight=\"37,38\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">        public FieldDescriptor VisitDefinition(DefinitionContext context)\n\t{\n\t\tstring name = context.name().NAME().GetText();\n\t\tTypeDescriptor type;\n\t\t\n\t\tswitch(context.type().GetType().Name)\n\t\t{\n\t\t\tcase \"IntegerTypeContext\":\n\t\t\t\ttype = VisitIntegerType(context.type() as IntegerTypeContext);\n\t\t\t\tbreak;\n\t\t\tcase \"SmallIntegerTypeContext\":\n\t\t\t\ttype = VisitSmallIntegerType(context.type() as SmallIntegerTypeContext);\n\t\t\t\tbreak;\n\t\t\tcase \"VarcharTypeContext\":\n\t\t\t\ttype = VisitVarcharType(context.type() as VarcharTypeContext);\n\t\t\t\tbreak;\n\t\t\tcase \"TimestampTypeContext\":\n\t\t\t\ttype = VisitTimestampType(context.type() as TimestampTypeContext);\n\t\t\t\tbreak;\n\t\t\tcase \"TextTypeContext\":\n\t\t\t\ttype = VisitTextType(context.type() as TextTypeContext);\n\t\t\t\tbreak;               \n\t\t\tcase \"DecimalTypeContext\":\n\t\t\t\ttype = VisitDecimalType(context.type() as DecimalTypeContext);\n\t\t\t\tbreak;  \n\t\t\tcase \"CharTypeContext\":\n\t\t\t\ttype = VisitCharType(context.type() as CharTypeContext);\n\t\t\t\tbreak; \n\t\t\tcase \"BlobTypeContext\":\n\t\t\t\ttype = VisitBlobType(context.type() as BlobTypeContext);\n\t\t\t\tbreak; \n\t\t\tdefault:\n\t\t\t\ttype = null;\n\t\t\t\tbreak;\n\t\t}\n\t\t\n\t\tif(context.nullability() != null &amp;&amp; context.nullability().NOT() != null)\n\t\t\ttype.Nullability = false;\n\t\n\t\treturn new FieldDescriptor(name, type);\n\t}</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"\">        </span><span class=\"kw1\">public</span><span class=\"\"> FieldDescriptor </span><span class=\"me0\">VisitDefinition</span><span class=\"br0\">(</span><span class=\"\">DefinitionContext context</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">  </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">    </span><span class=\"kw2\">string</span><span class=\"\"> name = context.</span><span class=\"me0\">name</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">.</span><span class=\"me0\">NAME</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">.</span><span class=\"me0\">GetText</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">    TypeDescriptor type;</span></li><li class=\" odd\"><span class=\"\">    </span></li><li class=\" even\"><span class=\"\">    </span><span class=\"kw1\">switch</span><span class=\"br0\">(</span><span class=\"\">context.</span><span class=\"me0\">type</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">.</span><span class=\"me0\">GetType</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">.Name</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">    </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">      </span><span class=\"kw1\">case</span><span class=\"\"> </span><span class=\"st1\">\"IntegerTypeContext\"</span><span class=\"\">:</span></li><li class=\" odd\"><span class=\"\">        type = </span><span class=\"me0\">VisitIntegerType</span><span class=\"br0\">(</span><span class=\"\">context.</span><span class=\"me0\">type</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\"> </span><span class=\"kw1\">as</span><span class=\"\"> IntegerTypeContext</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">        </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">      </span><span class=\"kw1\">case</span><span class=\"\"> </span><span class=\"st1\">\"SmallIntegerTypeContext\"</span><span class=\"\">:</span></li><li class=\" even\"><span class=\"\">        type = </span><span class=\"me0\">VisitSmallIntegerType</span><span class=\"br0\">(</span><span class=\"\">context.</span><span class=\"me0\">type</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\"> </span><span class=\"kw1\">as</span><span class=\"\"> SmallIntegerTypeContext</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">        </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">      </span><span class=\"kw1\">case</span><span class=\"\"> </span><span class=\"st1\">\"VarcharTypeContext\"</span><span class=\"\">:</span></li><li class=\" odd\"><span class=\"\">        type = </span><span class=\"me0\">VisitVarcharType</span><span class=\"br0\">(</span><span class=\"\">context.</span><span class=\"me0\">type</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\"> </span><span class=\"kw1\">as</span><span class=\"\"> VarcharTypeContext</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">        </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">      </span><span class=\"kw1\">case</span><span class=\"\"> </span><span class=\"st1\">\"TimestampTypeContext\"</span><span class=\"\">:</span></li><li class=\" even\"><span class=\"\">        type = </span><span class=\"me0\">VisitTimestampType</span><span class=\"br0\">(</span><span class=\"\">context.</span><span class=\"me0\">type</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\"> </span><span class=\"kw1\">as</span><span class=\"\"> TimestampTypeContext</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">        </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">      </span><span class=\"kw1\">case</span><span class=\"\"> </span><span class=\"st1\">\"TextTypeContext\"</span><span class=\"\">:</span></li><li class=\" odd\"><span class=\"\">        type = </span><span class=\"me0\">VisitTextType</span><span class=\"br0\">(</span><span class=\"\">context.</span><span class=\"me0\">type</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\"> </span><span class=\"kw1\">as</span><span class=\"\"> TextTypeContext</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">        </span><span class=\"kw1\">break</span><span class=\"\">;               </span></li><li class=\" odd\"><span class=\"\">      </span><span class=\"kw1\">case</span><span class=\"\"> </span><span class=\"st1\">\"DecimalTypeContext\"</span><span class=\"\">:</span></li><li class=\" even\"><span class=\"\">        type = </span><span class=\"me0\">VisitDecimalType</span><span class=\"br0\">(</span><span class=\"\">context.</span><span class=\"me0\">type</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\"> </span><span class=\"kw1\">as</span><span class=\"\"> DecimalTypeContext</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">        </span><span class=\"kw1\">break</span><span class=\"\">;  </span></li><li class=\" even\"><span class=\"\">      </span><span class=\"kw1\">case</span><span class=\"\"> </span><span class=\"st1\">\"CharTypeContext\"</span><span class=\"\">:</span></li><li class=\" odd\"><span class=\"\">        type = </span><span class=\"me0\">VisitCharType</span><span class=\"br0\">(</span><span class=\"\">context.</span><span class=\"me0\">type</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\"> </span><span class=\"kw1\">as</span><span class=\"\"> CharTypeContext</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">        </span><span class=\"kw1\">break</span><span class=\"\">; </span></li><li class=\" odd\"><span class=\"\">      </span><span class=\"kw1\">case</span><span class=\"\"> </span><span class=\"st1\">\"BlobTypeContext\"</span><span class=\"\">:</span></li><li class=\" even\"><span class=\"\">        type = </span><span class=\"me0\">VisitBlobType</span><span class=\"br0\">(</span><span class=\"\">context.</span><span class=\"me0\">type</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\"> </span><span class=\"kw1\">as</span><span class=\"\"> BlobTypeContext</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">        </span><span class=\"kw1\">break</span><span class=\"\">; </span></li><li class=\" even\"><span class=\"\">      </span><span class=\"kw1\">default</span><span class=\"\">:</span></li><li class=\" odd\"><span class=\"\">        type = </span><span class=\"kw1\">null</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">        </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">    </span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">    </span></li><li class=\"specialline odd\"><span class=\"\">    </span><span class=\"kw1\">if</span><span class=\"br0\">(</span><span class=\"\">context.</span><span class=\"me0\">nullability</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\"> != </span><span class=\"kw1\">null</span><span class=\"\"> &amp;&amp; context.</span><span class=\"me0\">nullability</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">.</span><span class=\"me0\">NOT</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\"> != </span><span class=\"kw1\">null</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\"specialline even\"><span class=\"\">      type.Nullability = </span><span class=\"kw1\">false</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">  </span></li><li class=\" even\"><span class=\"\">    </span><span class=\"kw1\">return</span><span class=\"\"> </span><span class=\"kw1\">new</span><span class=\"\"> </span><span class=\"me0\">FieldDescriptor</span><span class=\"br0\">(</span><span class=\"\">name, type</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">  </span><span class=\"br0\">}</span></li></ol><pre style=\"display: none;\">        public FieldDescriptor VisitDefinition(DefinitionContext context)\n\t{\n\t\tstring name = context.name().NAME().GetText();\n\t\tTypeDescriptor type;\n\t\t\n\t\tswitch(context.type().GetType().Name)\n\t\t{\n\t\t\tcase \"IntegerTypeContext\":\n\t\t\t\ttype = VisitIntegerType(context.type() as IntegerTypeContext);\n\t\t\t\tbreak;\n\t\t\tcase \"SmallIntegerTypeContext\":\n\t\t\t\ttype = VisitSmallIntegerType(context.type() as SmallIntegerTypeContext);\n\t\t\t\tbreak;\n\t\t\tcase \"VarcharTypeContext\":\n\t\t\t\ttype = VisitVarcharType(context.type() as VarcharTypeContext);\n\t\t\t\tbreak;\n\t\t\tcase \"TimestampTypeContext\":\n\t\t\t\ttype = VisitTimestampType(context.type() as TimestampTypeContext);\n\t\t\t\tbreak;\n\t\t\tcase \"TextTypeContext\":\n\t\t\t\ttype = VisitTextType(context.type() as TextTypeContext);\n\t\t\t\tbreak;               \n\t\t\tcase \"DecimalTypeContext\":\n\t\t\t\ttype = VisitDecimalType(context.type() as DecimalTypeContext);\n\t\t\t\tbreak;  \n\t\t\tcase \"CharTypeContext\":\n\t\t\t\ttype = VisitCharType(context.type() as CharTypeContext);\n\t\t\t\tbreak; \n\t\t\tcase \"BlobTypeContext\":\n\t\t\t\ttype = VisitBlobType(context.type() as BlobTypeContext);\n\t\t\t\tbreak; \n\t\t\tdefault:\n\t\t\t\ttype = null;\n\t\t\t\tbreak;\n\t\t}\n\t\t\n\t\tif(context.nullability() != null &amp;&amp; context.nullability().NOT() != null)\n\t\t\ttype.Nullability = false;\n\t\n\t\treturn new FieldDescriptor(name, type);\n\t}</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div><p>The issue is that we need to identify each type and then translate it in a way that is compatible with a programming language. In fact, SQL data types and programming language data types can be different. For example, SQL has types for variable and fixed size char array, this is less relevant in programming languages.</p><p>We already have done the work to easily identify each type by creating a label for each option of the <code>type</code> grammar rule. Now, we just need to use a different method to visit each node correctly.</p><p>Before seeing the examples of <code>VisitIntegerType</code> and <code>VisitSmallIntegerType</code>, let’s notice a couple of things. First, we deal with nullability of types only once, on lines 37-38. Second, we are only dealing with some types, the ones used in our example SQL files.</p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"csharp\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">        private TypeDescriptor VisitSmallIntegerType(SmallIntegerTypeContext context)\n        {\n           if(context.UNSIGNED() != null)\n                return new IntegerTypeDescriptor(2, true);\n            else\n                return new IntegerTypeDescriptor(2);\n        }\n\n        private TypeDescriptor VisitIntegerType(IntegerTypeContext context)\n        {\n            if(context.UNSIGNED() != null)\n                return new IntegerTypeDescriptor(4, true);\n            else\n                return new IntegerTypeDescriptor(4);\n        }</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"\">        </span><span class=\"kw1\">private</span><span class=\"\"> TypeDescriptor </span><span class=\"me0\">VisitSmallIntegerType</span><span class=\"br0\">(</span><span class=\"\">SmallIntegerTypeContext context</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">        </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">           </span><span class=\"kw1\">if</span><span class=\"br0\">(</span><span class=\"\">context.</span><span class=\"me0\">UNSIGNED</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\"> != </span><span class=\"kw1\">null</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">                </span><span class=\"kw1\">return</span><span class=\"\"> </span><span class=\"kw1\">new</span><span class=\"\"> </span><span class=\"me0\">IntegerTypeDescriptor</span><span class=\"br0\">(</span><span class=\"nu0\">2</span><span class=\"\">, </span><span class=\"kw1\">true</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">            </span><span class=\"kw1\">else</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">                </span><span class=\"kw1\">return</span><span class=\"\"> </span><span class=\"kw1\">new</span><span class=\"\"> </span><span class=\"me0\">IntegerTypeDescriptor</span><span class=\"br0\">(</span><span class=\"nu0\">2</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">        </span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">        </span><span class=\"kw1\">private</span><span class=\"\"> TypeDescriptor </span><span class=\"me0\">VisitIntegerType</span><span class=\"br0\">(</span><span class=\"\">IntegerTypeContext context</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">        </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">            </span><span class=\"kw1\">if</span><span class=\"br0\">(</span><span class=\"\">context.</span><span class=\"me0\">UNSIGNED</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\"> != </span><span class=\"kw1\">null</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">                </span><span class=\"kw1\">return</span><span class=\"\"> </span><span class=\"kw1\">new</span><span class=\"\"> </span><span class=\"me0\">IntegerTypeDescriptor</span><span class=\"br0\">(</span><span class=\"nu0\">4</span><span class=\"\">, </span><span class=\"kw1\">true</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">            </span><span class=\"kw1\">else</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">                </span><span class=\"kw1\">return</span><span class=\"\"> </span><span class=\"kw1\">new</span><span class=\"\"> </span><span class=\"me0\">IntegerTypeDescriptor</span><span class=\"br0\">(</span><span class=\"nu0\">4</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">        </span><span class=\"br0\">}</span></li></ol><pre style=\"display: none;\">        private TypeDescriptor VisitSmallIntegerType(SmallIntegerTypeContext context)\n        {\n           if(context.UNSIGNED() != null)\n                return new IntegerTypeDescriptor(2, true);\n            else\n                return new IntegerTypeDescriptor(2);\n        }\n\n        private TypeDescriptor VisitIntegerType(IntegerTypeContext context)\n        {\n            if(context.UNSIGNED() != null)\n                return new IntegerTypeDescriptor(4, true);\n            else\n                return new IntegerTypeDescriptor(4);\n        }</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div><p>These two methods are representative of the little effort we have to do. Each method returns a <code>TypeDescriptor</code> specific for each type.</p><p>The methods are simple, but different because each type is different. In the case of integer types we need to check whether the type is unsigned or not. We use only one <code>IntegerTypeDescriptor</code> for all integer types. This is simply because they can be described in the same way: from our point of view, the only difference between integer types is the number of bytes they need.</p><p>The <code>TypeDescriptor</code> classes themselves are also fairly trivial. They just are a series of classes that contain specific information for each type.</p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"csharp\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">public enum BaseType\n{\n    Integer,\n    Floating,    \n    Decimal,           \n    Text,\n    Binary,\n    ArrayCharacters,        \n    Year,\n    DateTime\n}\n\npublic class TypeDescriptor\n{\n    public BaseType Type { get; protected set; }\n    public bool Nullability { get; set; } = true;\n}\n\npublic class IntegerTypeDescriptor : TypeDescriptor\n{\n    public int Bytes { get; private set; }\n    public bool Unsigned { get; private set;  }\n\n    public IntegerTypeDescriptor(int bytes, bool unsigned = false)\n    {\n        Type = BaseType.Integer;\n        Bytes = bytes;\n        Unsigned = unsigned;\n    }\n}</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"kw1\">public</span><span class=\"\"> </span><span class=\"kw2\">enum</span><span class=\"\"> BaseType</span></li><li class=\" even\"><span class=\"\"></span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">    Integer,</span></li><li class=\" even\"><span class=\"\">    Floating,    </span></li><li class=\" odd\"><span class=\"\">    Decimal,           </span></li><li class=\" even\"><span class=\"\">    Text,</span></li><li class=\" odd\"><span class=\"\">    Binary,</span></li><li class=\" even\"><span class=\"\">    ArrayCharacters,        </span></li><li class=\" odd\"><span class=\"\">    Year,</span></li><li class=\" even\"><span class=\"\">    DateTime</span></li><li class=\" odd\"><span class=\"\"></span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\"></span><span class=\"kw1\">public</span><span class=\"\"> </span><span class=\"kw3\">class</span><span class=\"\"> TypeDescriptor</span></li><li class=\" even\"><span class=\"\"></span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">    </span><span class=\"kw1\">public</span><span class=\"\"> BaseType Type </span><span class=\"br0\">{</span><span class=\"\"> get; </span><span class=\"kw1\">protected</span><span class=\"\"> set; </span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">    </span><span class=\"kw1\">public</span><span class=\"\"> </span><span class=\"kw2\">bool</span><span class=\"\"> Nullability </span><span class=\"br0\">{</span><span class=\"\"> get; set; </span><span class=\"br0\">}</span><span class=\"\"> = </span><span class=\"kw1\">true</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\"></span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\"></span><span class=\"kw1\">public</span><span class=\"\"> </span><span class=\"kw3\">class</span><span class=\"\"> IntegerTypeDescriptor : TypeDescriptor</span></li><li class=\" even\"><span class=\"\"></span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">    </span><span class=\"kw1\">public</span><span class=\"\"> </span><span class=\"kw2\">int</span><span class=\"\"> Bytes </span><span class=\"br0\">{</span><span class=\"\"> get; </span><span class=\"kw1\">private</span><span class=\"\"> set; </span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">    </span><span class=\"kw1\">public</span><span class=\"\"> </span><span class=\"kw2\">bool</span><span class=\"\"> Unsigned </span><span class=\"br0\">{</span><span class=\"\"> get; </span><span class=\"kw1\">private</span><span class=\"\"> set;  </span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\"></span></li><li class=\" even\"><span class=\"\">    </span><span class=\"kw1\">public</span><span class=\"\"> </span><span class=\"me0\">IntegerTypeDescriptor</span><span class=\"br0\">(</span><span class=\"kw2\">int</span><span class=\"\"> bytes, </span><span class=\"kw2\">bool</span><span class=\"\"> unsigned = </span><span class=\"kw1\">false</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">    </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">        Type = BaseType.Integer;</span></li><li class=\" odd\"><span class=\"\">        Bytes = bytes;</span></li><li class=\" even\"><span class=\"\">        Unsigned = unsigned;</span></li><li class=\" odd\"><span class=\"\">    </span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\"></span><span class=\"br0\">}</span></li></ol><pre style=\"display: none;\">public enum BaseType\n{\n    Integer,\n    Floating,    \n    Decimal,           \n    Text,\n    Binary,\n    ArrayCharacters,        \n    Year,\n    DateTime\n}\n\npublic class TypeDescriptor\n{\n    public BaseType Type { get; protected set; }\n    public bool Nullability { get; set; } = true;\n}\n\npublic class IntegerTypeDescriptor : TypeDescriptor\n{\n    public int Bytes { get; private set; }\n    public bool Unsigned { get; private set;  }\n\n    public IntegerTypeDescriptor(int bytes, bool unsigned = false)\n    {\n        Type = BaseType.Integer;\n        Bytes = bytes;\n        Unsigned = unsigned;\n    }\n}</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div><p>You can see the rest on the companion repository.</p><h2>Generating Code</h2><p>We have a custom representation of our original SQL code: a description of all the tables suited for our needs. Now we can generate the corresponding source code. We are going to generate the code in multiple languages: C# and Kotlin. We do this to show how easy it is to do anything once we get the information out of SQL and because there are different limitations in the two languages.</p><h3>Generating Code in C#</h3><p>Let’s start with seeing C#. We have only one public method: <code>ToSourceCode</code>, which accepts a namespace and a series of classes/tables definition.</p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"csharp\" data-enlighter-theme=\"\" data-enlighter-highlight=\"23-24, 32-33\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">public class CSharpCodeGenerator : ICodeGenerator\n{\n    public string ToSourceCode(string idNamespace, List&lt;ClassDescriptor&gt; classes)\n    {\n        StringBuilder sourceCode = new StringBuilder();\n\n        // opening namespace\n        sourceCode.AppendLine($\"namespace {idNamespace}\");\n        sourceCode.AppendLine(\"{\");\n        \n        foreach(var c in classes)\n        {\n            sourceCode.AppendLine($\"\\tpublic class {c.Name}\");\n            sourceCode.AppendLine(\"\\t{\");\n            \n            foreach(var f in c.Fields)\n            {\n                switch(f.Type.Type)\n                {\n                    case BaseType.Integer:\n                        sourceCode.AppendLine($\"\\t\\tpublic {GenerateInt(f.Type as IntegerTypeDescriptor)} {f.Name} {{ get; set; }}\");\n                        break;\n                    case BaseType.Text:\n                        sourceCode.AppendLine($\"\\t\\tpublic string {f.Name} {{ get; set; }}\");\n                        break;\n                    case BaseType.ArrayCharacters:\n                        sourceCode.AppendLine($\"\\t\\tpublic {GenerateCharArray(f.Name, f.Type as CharArrayTypeDescriptor)}\");\n                        break;\n                    case BaseType.DateTime:\n                        sourceCode.AppendLine($\"\\t\\tpublic DateTime {f.Name} {{ get; set; }}\");\n                        break;                            \n                    case BaseType.Decimal:                        \n                        sourceCode.AppendLine($\"\\t\\tpublic decimal {f.Name} {{ get; set; }}\");\n                        break;\n                    case BaseType.Binary:\n                        sourceCode.AppendLine($\"\\t\\tpublic bytes[] {f.Name} {{ get; set; }}\");\n                        break;\n                }\n            }\n            \n            sourceCode.AppendLine(\"\\t}\");\n            sourceCode.AppendLine();\n        }\n\n        // closing namespace            \n        sourceCode.AppendLine(\"}\");\n\n        return sourceCode.ToString();\n    }\n\n    [..]</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"kw1\">public</span><span class=\"\"> </span><span class=\"kw3\">class</span><span class=\"\"> CSharpCodeGenerator : ICodeGenerator</span></li><li class=\" even\"><span class=\"\"></span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">    </span><span class=\"kw1\">public</span><span class=\"\"> </span><span class=\"kw2\">string</span><span class=\"\"> </span><span class=\"me0\">ToSourceCode</span><span class=\"br0\">(</span><span class=\"kw2\">string</span><span class=\"\"> idNamespace, List&lt;ClassDescriptor&gt; classes</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">    </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">        StringBuilder sourceCode = </span><span class=\"kw1\">new</span><span class=\"\"> </span><span class=\"me0\">StringBuilder</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">       </span><span class=\"co1\"> // opening namespace</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">        sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"\">$</span><span class=\"st1\">\"namespace {idNamespace}\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">        sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"st1\">\"{\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">        </span></li><li class=\" odd\"><span class=\"\">        </span><span class=\"kw1\">foreach</span><span class=\"br0\">(</span><span class=\"\">var c </span><span class=\"kw3\">in</span><span class=\"\"> classes</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">        </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">            sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"\">$</span><span class=\"st1\">\"\\tpublic class {c.Name}\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">            sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"st1\">\"\\t{\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">            </span></li><li class=\" even\"><span class=\"\">            </span><span class=\"kw1\">foreach</span><span class=\"br0\">(</span><span class=\"\">var f </span><span class=\"kw3\">in</span><span class=\"\"> c.Fields</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">            </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">                </span><span class=\"kw1\">switch</span><span class=\"br0\">(</span><span class=\"\">f.Type.Type</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">                </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">                    </span><span class=\"kw1\">case</span><span class=\"\"> BaseType.Integer:</span></li><li class=\" odd\"><span class=\"\">                        sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"\">$</span><span class=\"st1\">\"\\t\\tpublic {GenerateInt(f.Type as IntegerTypeDescriptor)} {f.Name} {{ get; set; }}\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">                        </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\"specialline odd\"><span class=\"\">                    </span><span class=\"kw1\">case</span><span class=\"\"> BaseType.Text:</span></li><li class=\"specialline even\"><span class=\"\">                        sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"\">$</span><span class=\"st1\">\"\\t\\tpublic string {f.Name} {{ get; set; }}\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">                        </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">                    </span><span class=\"kw1\">case</span><span class=\"\"> BaseType.ArrayCharacters:</span></li><li class=\" odd\"><span class=\"\">                        sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"\">$</span><span class=\"st1\">\"\\t\\tpublic {GenerateCharArray(f.Name, f.Type as CharArrayTypeDescriptor)}\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">                        </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">                    </span><span class=\"kw1\">case</span><span class=\"\"> BaseType.DateTime:</span></li><li class=\" even\"><span class=\"\">                        sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"\">$</span><span class=\"st1\">\"\\t\\tpublic DateTime {f.Name} {{ get; set; }}\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">                        </span><span class=\"kw1\">break</span><span class=\"\">;                            </span></li><li class=\"specialline even\"><span class=\"\">                    </span><span class=\"kw1\">case</span><span class=\"\"> BaseType.Decimal:                        </span></li><li class=\"specialline odd\"><span class=\"\">                        sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"\">$</span><span class=\"st1\">\"\\t\\tpublic decimal {f.Name} {{ get; set; }}\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">                        </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">                    </span><span class=\"kw1\">case</span><span class=\"\"> BaseType.Binary:</span></li><li class=\" even\"><span class=\"\">                        sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"\">$</span><span class=\"st1\">\"\\t\\tpublic bytes[] {f.Name} {{ get; set; }}\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">                        </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">                </span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">            </span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">            </span></li><li class=\" odd\"><span class=\"\">            sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"st1\">\"\\t}\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">            sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">        </span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">       </span><span class=\"co1\"> // closing namespace            </span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">        sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"st1\">\"}\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\"></span></li><li class=\" even\"><span class=\"\">        </span><span class=\"kw1\">return</span><span class=\"\"> sourceCode.</span><span class=\"me0\">ToString</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">    </span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">    </span><span class=\"br0\">[</span><span class=\"\">..</span><span class=\"br0\">]</span></li></ol><pre style=\"display: none;\">public class CSharpCodeGenerator : ICodeGenerator\n{\n    public string ToSourceCode(string idNamespace, List&lt;ClassDescriptor&gt; classes)\n    {\n        StringBuilder sourceCode = new StringBuilder();\n\n        // opening namespace\n        sourceCode.AppendLine($\"namespace {idNamespace}\");\n        sourceCode.AppendLine(\"{\");\n        \n        foreach(var c in classes)\n        {\n            sourceCode.AppendLine($\"\\tpublic class {c.Name}\");\n            sourceCode.AppendLine(\"\\t{\");\n            \n            foreach(var f in c.Fields)\n            {\n                switch(f.Type.Type)\n                {\n                    case BaseType.Integer:\n                        sourceCode.AppendLine($\"\\t\\tpublic {GenerateInt(f.Type as IntegerTypeDescriptor)} {f.Name} {{ get; set; }}\");\n                        break;\n                    case BaseType.Text:\n                        sourceCode.AppendLine($\"\\t\\tpublic string {f.Name} {{ get; set; }}\");\n                        break;\n                    case BaseType.ArrayCharacters:\n                        sourceCode.AppendLine($\"\\t\\tpublic {GenerateCharArray(f.Name, f.Type as CharArrayTypeDescriptor)}\");\n                        break;\n                    case BaseType.DateTime:\n                        sourceCode.AppendLine($\"\\t\\tpublic DateTime {f.Name} {{ get; set; }}\");\n                        break;                            \n                    case BaseType.Decimal:                        \n                        sourceCode.AppendLine($\"\\t\\tpublic decimal {f.Name} {{ get; set; }}\");\n                        break;\n                    case BaseType.Binary:\n                        sourceCode.AppendLine($\"\\t\\tpublic bytes[] {f.Name} {{ get; set; }}\");\n                        break;\n                }\n            }\n            \n            sourceCode.AppendLine(\"\\t}\");\n            sourceCode.AppendLine();\n        }\n\n        // closing namespace            \n        sourceCode.AppendLine(\"}\");\n\n        return sourceCode.ToString();\n    }\n\n    [..]</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div><p>This method takes care of generating the whole new source code file. It handles the enclosing namespace (necessary for C# files) and the whole class.</p><p>We transform columns into properties. These are the obvious choice because it is easy to anticipate that we would need to transform any data coming from SQL in a different format to handle it in our programming language. For example, dates would be different. We would also need to enforce fixed-size arrays in some way. That is because programming languages usually do not have a well-defined way to handle an input too large or too small. Instead databases can automatically do things like padding an input that is too short with spaces.</p><p>There are generally three cases:</p><ul><li>the type has a perfect correspondence (e.g. lines 23-24 <code>TEXT</code> becomes a <code>String</code>). So we just write the property directly.</li><li>the type has only a partial, but unambiguous, correspondence (e.g. lines 32-33 DECIMAL becomes <code>Decimal</code>, but the SQL and C# type behave differently). For example, a SQL decimal allows us to specify a precision, to set just how many digits it can hold. In C# you cannot do that. Normally we would need to take care of this difference, in our example, we just ignore the issue</li><li>the type has multiple correspondences (e.g., lines 20-21 <code>INT</code>, <code>SMALLINT</code> become <code>int</code>, <code>short</code>), so we handle them with a method</li></ul><p>For the third case, we are going to see the integer example.</p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"csharp\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">        private string GenerateInt(IntegerTypeDescriptor descriptor)\n        {\n            StringBuilder intType = new StringBuilder();\n\n            // we ignore nullability, because it is not well supported for all C# types\n            if(descriptor.Unsigned == true)\n                intType.Append(\"u\");\n\n            switch(descriptor.Bytes)\n            {\n                case 2:\n                    intType.Append(\"short\");\n                    break;\n                case 4:\n                    intType.Append(\"int\");\n                    break;\n                case 8:\n                    intType.Append(\"long\");\n                    break;\n            }\n           \n            return intType.ToString();\n        }</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"\">        </span><span class=\"kw1\">private</span><span class=\"\"> </span><span class=\"kw2\">string</span><span class=\"\"> </span><span class=\"me0\">GenerateInt</span><span class=\"br0\">(</span><span class=\"\">IntegerTypeDescriptor descriptor</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">        </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">            StringBuilder intType = </span><span class=\"kw1\">new</span><span class=\"\"> </span><span class=\"me0\">StringBuilder</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">           </span><span class=\"co1\"> // we ignore nullability, because it is not well supported for all C# types</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">            </span><span class=\"kw1\">if</span><span class=\"br0\">(</span><span class=\"\">descriptor.Unsigned == </span><span class=\"kw1\">true</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">                intType.</span><span class=\"me0\">Append</span><span class=\"br0\">(</span><span class=\"st1\">\"u\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">            </span><span class=\"kw1\">switch</span><span class=\"br0\">(</span><span class=\"\">descriptor.Bytes</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">            </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">                </span><span class=\"kw1\">case</span><span class=\"\"> </span><span class=\"nu0\">2</span><span class=\"\">:</span></li><li class=\" even\"><span class=\"\">                    intType.</span><span class=\"me0\">Append</span><span class=\"br0\">(</span><span class=\"st1\">\"short\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">                    </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">                </span><span class=\"kw1\">case</span><span class=\"\"> </span><span class=\"nu0\">4</span><span class=\"\">:</span></li><li class=\" odd\"><span class=\"\">                    intType.</span><span class=\"me0\">Append</span><span class=\"br0\">(</span><span class=\"st1\">\"int\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">                    </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">                </span><span class=\"kw1\">case</span><span class=\"\"> </span><span class=\"nu0\">8</span><span class=\"\">:</span></li><li class=\" even\"><span class=\"\">                    intType.</span><span class=\"me0\">Append</span><span class=\"br0\">(</span><span class=\"st1\">\"long\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">                    </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">            </span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">           </span></li><li class=\" even\"><span class=\"\">            </span><span class=\"kw1\">return</span><span class=\"\"> intType.</span><span class=\"me0\">ToString</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">        </span><span class=\"br0\">}</span></li></ol><pre style=\"display: none;\">        private string GenerateInt(IntegerTypeDescriptor descriptor)\n        {\n            StringBuilder intType = new StringBuilder();\n\n            // we ignore nullability, because it is not well supported for all C# types\n            if(descriptor.Unsigned == true)\n                intType.Append(\"u\");\n\n            switch(descriptor.Bytes)\n            {\n                case 2:\n                    intType.Append(\"short\");\n                    break;\n                case 4:\n                    intType.Append(\"int\");\n                    break;\n                case 8:\n                    intType.Append(\"long\");\n                    break;\n            }\n           \n            return intType.ToString();\n        }</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div><p>We can find a perfect correspondence between each integer type in SQL and C#. Since integer types are all represented internally the same way, it all depends on the number of bytes used for each of them. Depending on how many bytes are stored in our instance of <code>IntegerTypeDescriptor</code>, we generate the proper C# type.</p><p>The only issue is with C# itself: it does not have perfect support for nullability. Until <a href=\"https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-8#nullable-reference-types\">C# 8.0</a> reference types could be nullable by default, so it would be fairly inconsistent to work with nullable types both in our code and any third-party code.</p><p>On the other hand, we can easily deal with unsigned integers, we just need to prepend a <code>u</code>, to use unsigned types.</p><h3>Generating Code in Kotlin</h3><p>Generating the code for Kotlin is very similar.</p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"csharp\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">public class KotlinCodeGenerator : ICodeGenerator\n{\n        public string ToSourceCode(string idNamespace, List&lt;ClassDescriptor&gt; classes)\n        {\n            StringBuilder sourceCode = new StringBuilder();\n\n            // declaring package\n            if(!String.IsNullOrEmpty(idNamespace))\n                sourceCode.AppendLine($\"package {idNamespace}\");   \n\n            // adding imports\n            sourceCode.AppendLine();\n            sourceCode.AppendLine(\"import java.time.LocalDateTime\");\n            sourceCode.AppendLine(\"import java.math.BigDecimal\");            \n            sourceCode.AppendLine();\n            \n            foreach(var c in classes)\n            {\n                sourceCode.Append($\"data class {c.Name}(\");\n                \n                foreach(var f in c.Fields)\n                {\n                    switch(f.Type.Type)\n                    {\n                        case BaseType.Integer:\n                            sourceCode.Append($\"var {f.Name}: {GenerateInt(f.Type as IntegerTypeDescriptor)}\");\n                            break;\n                        case BaseType.Text:\n                            sourceCode.Append($\"var {f.Name}: String\");\n                            break;\n                        case BaseType.ArrayCharacters:\n                            sourceCode.Append($\"var {f.Name}: {GenerateCharArray(f.Type as CharArrayTypeDescriptor)}\");\n                            break;\n                        case BaseType.DateTime:\n                            sourceCode.Append($\"var {f.Name}: LocalDateTime\");\n                            break;                            \n                        case BaseType.Decimal:                        \n                            sourceCode.Append($\"var {f.Name}: BigDecimal\");\n                            break;\n                        case BaseType.Binary:\n                            sourceCode.Append($\"var {f.Name}: ByteArray\");\n                            break;\n                    }                    \n                    \n                    if(f != c.Fields.Last())\n                        sourceCode.Append(\", \");\n                }\n                \n                sourceCode.AppendLine(\")\");\n                sourceCode.AppendLine(\"\");\n            }\n\n            return sourceCode.ToString();\n        }</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"kw1\">public</span><span class=\"\"> </span><span class=\"kw3\">class</span><span class=\"\"> KotlinCodeGenerator : ICodeGenerator</span></li><li class=\" even\"><span class=\"\"></span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">        </span><span class=\"kw1\">public</span><span class=\"\"> </span><span class=\"kw2\">string</span><span class=\"\"> </span><span class=\"me0\">ToSourceCode</span><span class=\"br0\">(</span><span class=\"kw2\">string</span><span class=\"\"> idNamespace, List&lt;ClassDescriptor&gt; classes</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">        </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">            StringBuilder sourceCode = </span><span class=\"kw1\">new</span><span class=\"\"> </span><span class=\"me0\">StringBuilder</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">           </span><span class=\"co1\"> // declaring package</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">            </span><span class=\"kw1\">if</span><span class=\"br0\">(</span><span class=\"\">!String.</span><span class=\"me0\">IsNullOrEmpty</span><span class=\"br0\">(</span><span class=\"\">idNamespace</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">                sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"\">$</span><span class=\"st1\">\"package {idNamespace}\"</span><span class=\"br0\">)</span><span class=\"\">;   </span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">           </span><span class=\"co1\"> // adding imports</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">            sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">            sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"st1\">\"import java.time.LocalDateTime\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">            sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"st1\">\"import java.math.BigDecimal\"</span><span class=\"br0\">)</span><span class=\"\">;            </span></li><li class=\" odd\"><span class=\"\">            sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">            </span></li><li class=\" odd\"><span class=\"\">            </span><span class=\"kw1\">foreach</span><span class=\"br0\">(</span><span class=\"\">var c </span><span class=\"kw3\">in</span><span class=\"\"> classes</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">            </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">                sourceCode.</span><span class=\"me0\">Append</span><span class=\"br0\">(</span><span class=\"\">$</span><span class=\"st1\">\"data class {c.Name}(\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">                </span></li><li class=\" odd\"><span class=\"\">                </span><span class=\"kw1\">foreach</span><span class=\"br0\">(</span><span class=\"\">var f </span><span class=\"kw3\">in</span><span class=\"\"> c.Fields</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">                </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">                    </span><span class=\"kw1\">switch</span><span class=\"br0\">(</span><span class=\"\">f.Type.Type</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">                    </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">                        </span><span class=\"kw1\">case</span><span class=\"\"> BaseType.Integer:</span></li><li class=\" even\"><span class=\"\">                            sourceCode.</span><span class=\"me0\">Append</span><span class=\"br0\">(</span><span class=\"\">$</span><span class=\"st1\">\"var {f.Name}: {GenerateInt(f.Type as IntegerTypeDescriptor)}\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">                            </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">                        </span><span class=\"kw1\">case</span><span class=\"\"> BaseType.Text:</span></li><li class=\" odd\"><span class=\"\">                            sourceCode.</span><span class=\"me0\">Append</span><span class=\"br0\">(</span><span class=\"\">$</span><span class=\"st1\">\"var {f.Name}: String\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">                            </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">                        </span><span class=\"kw1\">case</span><span class=\"\"> BaseType.ArrayCharacters:</span></li><li class=\" even\"><span class=\"\">                            sourceCode.</span><span class=\"me0\">Append</span><span class=\"br0\">(</span><span class=\"\">$</span><span class=\"st1\">\"var {f.Name}: {GenerateCharArray(f.Type as CharArrayTypeDescriptor)}\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">                            </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">                        </span><span class=\"kw1\">case</span><span class=\"\"> BaseType.DateTime:</span></li><li class=\" odd\"><span class=\"\">                            sourceCode.</span><span class=\"me0\">Append</span><span class=\"br0\">(</span><span class=\"\">$</span><span class=\"st1\">\"var {f.Name}: LocalDateTime\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">                            </span><span class=\"kw1\">break</span><span class=\"\">;                            </span></li><li class=\" odd\"><span class=\"\">                        </span><span class=\"kw1\">case</span><span class=\"\"> BaseType.Decimal:                        </span></li><li class=\" even\"><span class=\"\">                            sourceCode.</span><span class=\"me0\">Append</span><span class=\"br0\">(</span><span class=\"\">$</span><span class=\"st1\">\"var {f.Name}: BigDecimal\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">                            </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">                        </span><span class=\"kw1\">case</span><span class=\"\"> BaseType.Binary:</span></li><li class=\" odd\"><span class=\"\">                            sourceCode.</span><span class=\"me0\">Append</span><span class=\"br0\">(</span><span class=\"\">$</span><span class=\"st1\">\"var {f.Name}: ByteArray\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">                            </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">                    </span><span class=\"br0\">}</span><span class=\"\">                    </span></li><li class=\" even\"><span class=\"\">                    </span></li><li class=\" odd\"><span class=\"\">                    </span><span class=\"kw1\">if</span><span class=\"br0\">(</span><span class=\"\">f != c.Fields.</span><span class=\"me0\">Last</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">                        sourceCode.</span><span class=\"me0\">Append</span><span class=\"br0\">(</span><span class=\"st1\">\", \"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">                </span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">                </span></li><li class=\" odd\"><span class=\"\">                sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"st1\">\")\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">                sourceCode.</span><span class=\"me0\">AppendLine</span><span class=\"br0\">(</span><span class=\"st1\">\"\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">            </span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">            </span><span class=\"kw1\">return</span><span class=\"\"> sourceCode.</span><span class=\"me0\">ToString</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">        </span><span class=\"br0\">}</span></li></ol><pre style=\"display: none;\">public class KotlinCodeGenerator : ICodeGenerator\n{\n        public string ToSourceCode(string idNamespace, List&lt;ClassDescriptor&gt; classes)\n        {\n            StringBuilder sourceCode = new StringBuilder();\n\n            // declaring package\n            if(!String.IsNullOrEmpty(idNamespace))\n                sourceCode.AppendLine($\"package {idNamespace}\");   \n\n            // adding imports\n            sourceCode.AppendLine();\n            sourceCode.AppendLine(\"import java.time.LocalDateTime\");\n            sourceCode.AppendLine(\"import java.math.BigDecimal\");            \n            sourceCode.AppendLine();\n            \n            foreach(var c in classes)\n            {\n                sourceCode.Append($\"data class {c.Name}(\");\n                \n                foreach(var f in c.Fields)\n                {\n                    switch(f.Type.Type)\n                    {\n                        case BaseType.Integer:\n                            sourceCode.Append($\"var {f.Name}: {GenerateInt(f.Type as IntegerTypeDescriptor)}\");\n                            break;\n                        case BaseType.Text:\n                            sourceCode.Append($\"var {f.Name}: String\");\n                            break;\n                        case BaseType.ArrayCharacters:\n                            sourceCode.Append($\"var {f.Name}: {GenerateCharArray(f.Type as CharArrayTypeDescriptor)}\");\n                            break;\n                        case BaseType.DateTime:\n                            sourceCode.Append($\"var {f.Name}: LocalDateTime\");\n                            break;                            \n                        case BaseType.Decimal:                        \n                            sourceCode.Append($\"var {f.Name}: BigDecimal\");\n                            break;\n                        case BaseType.Binary:\n                            sourceCode.Append($\"var {f.Name}: ByteArray\");\n                            break;\n                    }                    \n                    \n                    if(f != c.Fields.Last())\n                        sourceCode.Append(\", \");\n                }\n                \n                sourceCode.AppendLine(\")\");\n                sourceCode.AppendLine(\"\");\n            }\n\n            return sourceCode.ToString();\n        }</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div><p>There are no structural differences. The only variations depend on the differences between the languages themselves. For instance, the equivalent of a namespace, i.e., packages are not required in Kotlin. We can also use the special <a href=\"https://superkotlin.com/kotlin-mega-tutorial/#data-classes\">data classes</a> in Kotlin to quickly define a class with its properties directly in the default constructor.</p><p>On the other hand, we need to import some Java packages, because Kotlin does not directly have classes for DateTime types. Since Kotlin can run in different environments (i.e. JVM with Java support, JavaScript, native with C++ support), we should probably find a way to support all of these environments. In a normal situation, we would probably create a runtime in pure Kotlin with these custom types (i.e., KotlinDateTime) and then add support for each platform in separate files. This way we could just generate one Kotlin file for all environments. This would be overkill for this example, so we just consider Kotlin run in Java.</p><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"csharp\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\" style=\"display: none;\">\tprivate string GenerateInt(IntegerTypeDescriptor descriptor)\n        {\n            StringBuilder intType = new StringBuilder();            \n\n            switch(descriptor.Bytes)\n            {\n                case 2:\n                    intType.Append(\"Short\");\n                    break;\n                case 4:\n                    intType.Append(\"Int\");\n                    break;\n                case 8:\n                    intType.Append(\"Long\");\n                    break;\n            }\n\n            // we ignore unsigned, because it is not well supported in C#\n            if(descriptor.Nullability == true)\n                intType.Append(\"?\");\n           \n            return intType.ToString();\n        }</pre><div class=\"EnlighterJSWrapper enlighterEnlighterJSWrapper\"><ol class=\"hoverEnabled enlighterEnlighterJS EnlighterJS\"><li class=\" odd\"><span class=\"\">  </span><span class=\"kw1\">private</span><span class=\"\"> </span><span class=\"kw2\">string</span><span class=\"\"> </span><span class=\"me0\">GenerateInt</span><span class=\"br0\">(</span><span class=\"\">IntegerTypeDescriptor descriptor</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">        </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">            StringBuilder intType = </span><span class=\"kw1\">new</span><span class=\"\"> </span><span class=\"me0\">StringBuilder</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;            </span></li><li class=\" even\"><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">            </span><span class=\"kw1\">switch</span><span class=\"br0\">(</span><span class=\"\">descriptor.Bytes</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">            </span><span class=\"br0\">{</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">                </span><span class=\"kw1\">case</span><span class=\"\"> </span><span class=\"nu0\">2</span><span class=\"\">:</span></li><li class=\" even\"><span class=\"\">                    intType.</span><span class=\"me0\">Append</span><span class=\"br0\">(</span><span class=\"st1\">\"Short\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">                    </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">                </span><span class=\"kw1\">case</span><span class=\"\"> </span><span class=\"nu0\">4</span><span class=\"\">:</span></li><li class=\" odd\"><span class=\"\">                    intType.</span><span class=\"me0\">Append</span><span class=\"br0\">(</span><span class=\"st1\">\"Int\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">                    </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">                </span><span class=\"kw1\">case</span><span class=\"\"> </span><span class=\"nu0\">8</span><span class=\"\">:</span></li><li class=\" even\"><span class=\"\">                    intType.</span><span class=\"me0\">Append</span><span class=\"br0\">(</span><span class=\"st1\">\"Long\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">                    </span><span class=\"kw1\">break</span><span class=\"\">;</span></li><li class=\" even\"><span class=\"\">            </span><span class=\"br0\">}</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\"></span></li><li class=\" even\"><span class=\"\">           </span><span class=\"co1\"> // we ignore unsigned, because it is not well supported in C#</span><span class=\"\"></span></li><li class=\" odd\"><span class=\"\">            </span><span class=\"kw1\">if</span><span class=\"br0\">(</span><span class=\"\">descriptor.Nullability == </span><span class=\"kw1\">true</span><span class=\"br0\">)</span><span class=\"\"></span></li><li class=\" even\"><span class=\"\">                intType.</span><span class=\"me0\">Append</span><span class=\"br0\">(</span><span class=\"st1\">\"?\"</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">           </span></li><li class=\" even\"><span class=\"\">            </span><span class=\"kw1\">return</span><span class=\"\"> intType.</span><span class=\"me0\">ToString</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"\">;</span></li><li class=\" odd\"><span class=\"\">        </span><span class=\"br0\">}</span></li></ol><pre style=\"display: none;\">\tprivate string GenerateInt(IntegerTypeDescriptor descriptor)\n        {\n            StringBuilder intType = new StringBuilder();            \n\n            switch(descriptor.Bytes)\n            {\n                case 2:\n                    intType.Append(\"Short\");\n                    break;\n                case 4:\n                    intType.Append(\"Int\");\n                    break;\n                case 8:\n                    intType.Append(\"Long\");\n                    break;\n            }\n\n            // we ignore unsigned, because it is not well supported in C#\n            if(descriptor.Nullability == true)\n                intType.Append(\"?\");\n           \n            return intType.ToString();\n        }</pre><div class=\"EnlighterJSToolbar\"><a class=\"EnlighterJSInfoButton\" title=\"EnlighterJS Syntax Highlighter\"></a><a class=\"EnlighterJSRawButton\" title=\"Toggle RAW Code\"></a><a class=\"EnlighterJSWindowButton\" title=\"Open Code in new Window\"></a><span class=\"clear\"></span></div></div><p>We can also see that the methods to generate integral types are very similar in both C# and Kotlin. The difference is that with Kotlin nullability has always been supported, while support for unsigned integer is still experimental for the current version.</p><h2>Summary</h2><p>In this article, we have seen how to parse SQL. In general, our advice is to:</p><ol><li>Consider if you can use existing tools or libraries to process SQL code. Some of them even support multiple SQL-dialects or multiple programming languages. If you can use any of them for your needs they should be your first option</li><li>If you want to build a solution in-house you may consider starting from the few ANTLR grammars available for the major SQL databases. They can really help you get started in parsing SQL</li><li>If you are stuck with a less common SQL database you might be in trouble. Parsing SQL from scratch it is going to be hard work: the language has a fairly simple structure, but it is large, it has many variations and in some cases even procedural extensions. In this article, we have seen a few tricks to start parsing even with a partial grammar. This can be a good way if you need to parse only small parts of the language</li></ol><p>If none of these options work for you, and you need some commercial option supporting you in building a solution for your needs, we at <a href=\"https://strumenta.com/\">Strumenta</a> may be able to help.</p> <script src=\"https://cdn.convertkit.com/assets/CKJS4.js?v=21\" defer=\"\"></script> <div class=\"ck_form_container ck_inline\" data-ck-version=\"6\"><div class=\"ck_form ck_vertical_subscription_form\"><div class=\"ck_form_content\"><h3 class=\"ck_form_title\">Download the guide with 68 resources on Creating Programming Languages</h3><div class=\"ck_description\"> <span class=\"ck_image\"> <img src=\"data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%200%200'%3E%3C/svg%3E\" alt=\"68resources\" data-lazy-src=\"https://convertkit.s3.amazonaws.com/subscription_forms/images/005/010/568/standard/68resources.jpg?1492612538\"><noscript><img src=\"https://convertkit.s3.amazonaws.com/subscription_forms/images/005/010/568/standard/68resources.jpg?1492612538\" alt=\"68resources\" /></noscript> </span><p>Receive the guide to your inbox to read it on all your devices when you have time</p></div></div><div class=\"ck_form_fields\"><div id=\"ck_success_msg\" style=\"display:none;\"><p>Success! Now check your email to confirm your subscription.</p></div><form id=\"ck_subscribe_form\" class=\"ck_subscribe_form\" action=\"https://forms.convertkit.com/landing_pages/198735/subscribe\" data-remote=\"true\"> <input type=\"hidden\" value=\"{&quot;form_style&quot;:&quot;full&quot;,&quot;embed_style&quot;:&quot;inline&quot;,&quot;embed_trigger&quot;:&quot;scroll_percentage&quot;,&quot;scroll_percentage&quot;:&quot;70&quot;,&quot;delay_seconds&quot;:&quot;10&quot;,&quot;display_position&quot;:&quot;br&quot;,&quot;display_devices&quot;:&quot;all&quot;,&quot;days_no_show&quot;:&quot;15&quot;,&quot;converted_behavior&quot;:&quot;show&quot;}\" id=\"ck_form_options\"> <input type=\"hidden\" name=\"id\" value=\"198735\" id=\"landing_page_id\"> <input type=\"hidden\" name=\"ck_form_recaptcha\" value=\"\" id=\"ck_form_recaptcha\"><div class=\"ck_errorArea\"><div id=\"ck_error_msg\" style=\"display:none\"><p>There was an error submitting your subscription. Please try again.</p></div></div><div class=\"ck_control_group ck_first_name_field_group\"> <label class=\"ck_label\" for=\"ck_firstNameField\">First Name</label> <input type=\"text\" name=\"first_name\" class=\"ck_first_name\" id=\"ck_firstNameField\"></div><div class=\"ck_control_group ck_email_field_group\"> <label class=\"ck_label\" for=\"ck_emailField\">Email Address</label> <input type=\"email\" name=\"email\" class=\"ck_email_address\" id=\"ck_emailField\" required=\"\"></div><div class=\"ck_control_group ck_captcha2_h_field_group ck-captcha2-h\" style=\"position: absolute !important;left: -999em !important;\"> <label class=\"ck_label\" for=\"ck_captcha2_h\">We use this field to detect spam bots. If you fill this in, you will be marked as a spammer.</label> <input type=\"text\" name=\"captcha2_h\" class=\"ck-captcha2-h\" id=\"ck_captcha2_h\"></div> <label class=\"ck_checkbox\" style=\"\"> <input class=\"optIn ck_course_opted\" name=\"course_opted\" type=\"checkbox\" id=\"optIn\" checked=\"\"> <span class=\"ck_opt_in_prompt\"><p>I'd like to receive the free email course.</p></span> </label> <button class=\"subscribe_button ck_subscribe_button btn fields\" id=\"ck_subscribe_button\"> Send it to me! </button> <span class=\"ck_guarantee\"> <a class=\"ck_powered_by\" href=\"https://convertkit.com?utm_source=dynamic&amp;utm_medium=referral&amp;utm_campaign=poweredby&amp;utm_content=form\">Powered by ConvertKit</a> </span></form></div></div></div><style type=\"text/css\">.ck_form{background:#fff url(data:image/gif;base64,R0lGODlhAQADAIABAMzMzP///yH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS41LWMwMTQgNzkuMTUxNDgxLCAyMDEzLzAzLzEzLTEyOjA5OjE1ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUQ5NjM5RjgxQUVEMTFFNEJBQTdGNTQwMjc5MTZDOTciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUQ5NjM5RjkxQUVEMTFFNEJBQTdGNTQwMjc5MTZDOTciPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoxRDk2MzlGNjFBRUQxMUU0QkFBN0Y1NDAyNzkxNkM5NyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxRDk2MzlGNzFBRUQxMUU0QkFBN0Y1NDAyNzkxNkM5NyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgH//v38+/r5+Pf29fTz8vHw7+7t7Ovq6ejn5uXk4+Lh4N/e3dzb2tnY19bV1NPS0dDPzs3My8rJyMfGxcTDwsHAv769vLu6ubi3trW0s7KxsK+urayrqqmop6alpKOioaCfnp2cm5qZmJeWlZSTkpGQj46NjIuKiYiHhoWEg4KBgH9+fXx7enl4d3Z1dHNycXBvbm1sa2ppaGdmZWRjYmFgX15dXFtaWVhXVlVUU1JRUE9OTUxLSklIR0ZFRENCQUA/Pj08Ozo5ODc2NTQzMjEwLy4tLCsqKSgnJiUkIyIhIB8eHRwbGhkYFxYVFBMSERAPDg0MCwoJCAcGBQQDAgEAACH5BAEAAAEALAAAAAABAAMAAAICRFIAOw==) repeat-y center top;font-family:\"Helvetica Neue\",Helvetica,Arial,Verdana,sans-serif;line-height:1.5em;overflow:hidden;color:#666;font-size:16px;border-top:solid 20px #3071b0;border-top-color:#3071b0;border-bottom:solid 10px #3d3d3d;border-bottom-color:#1d446a;-webkit-box-shadow:0 0 5px rgba(0,0,0,.3);-moz-box-shadow:0 0 5px rgba(0,0,0,.3);box-shadow:0 0 5px rgba(0,0,0,.3);clear:both;margin:20px 0}.ck_form,.ck_form *{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}#ck_subscribe_form{clear:both}.ck_form_content,.ck_form_fields{width:50%;float:left;padding:5%}.ck_form_content{border-bottom:none}.ck_form.ck_vertical{background:#fff}.ck_vertical .ck_form_content,.ck_vertical .ck_form_fields{padding:10%;width:100%;float:none}.ck_vertical .ck_form_content{border-bottom:1px dotted #aaa;overflow:hidden}@media all and (max-width:499px){.ck_form{background:#fff}.ck_form_content,.ck_form_fields{padding:10%;width:100%;float:none}.ck_form_content{border-bottom:1px dotted #aaa}}.ck_form_content h3{margin:0 0 15px;font-size:24px;padding:0}.ck_form_content p{font-size:14px}.ck_image{float:left;margin-right:5px}.ck_errorArea{display:none}#ck_success_msg{padding:10px 10px 0;border:solid 1px #ddd;background:#eee}.ck_label{font-size:14px;font-weight:700}.ck_form input[type=\"text\"],.ck_form input[type=\"email\"]{font-size:14px;padding:10px 8px;width:100%;border:1px solid #d6d6d6;-moz-border-radius:4px;-webkit-border-radius:4px;border-radius:4px;background-color:#f8f7f7;margin-bottom:5px;height:auto}.ck_form input[type=\"text\"]:focus,.ck_form input[type=\"email\"]:focus{outline:none;border-color:#aaa}.ck_checkbox{padding:10px 0 10px 20px;display:block;clear:both}.ck_checkbox input.optIn{margin-left:-20px;margin-top:0}.ck_form .ck_opt_in_prompt{margin-left:4px}.ck_form .ck_opt_in_prompt p{display:inline}.ck_form .ck_subscribe_button{width:100%;color:#fff;margin:10px 0 0;padding:10px 0;font-size:18px;background:#0d6db8;-moz-border-radius:4px;-webkit-border-radius:4px;border-radius:4px;cursor:pointer;border:none;text-shadow:none}.ck_form .ck_guarantee{color:#626262;font-size:12px;text-align:center;padding:5px 0;display:block}.ck_form .ck_powered_by{display:block;color:#aaa}.ck_form .ck_powered_by:hover{display:block;color:#444}.ck_converted_content{display:none;padding:5%;background:#fff}.ck_form_v6 #ck_success_msg{padding:0 10px}@media all and (max-width:403px){.ck_form_v6.ck_modal .ck_close_link{top:30px}}@media all and (min-width:404px) and (max-width:499px){.ck_form_v6.ck_modal .ck_close_link{top:57px}}.ck_powered_by{display:none!important}.ck_form_container.ck_inline{margin-left:20px}.ck_image img{margin-right:10px}.ck_form.ck_vertical_subscription_form.ck_horizontal{margin-left:20px}</style><div class=\"ttr_end\"></div><span id=\"tve_leads_end_content\" style=\"display: block; visibility: hidden; border: 1px solid transparent;\"></span></div><footer class=\"entry-footer\"><span class=\"blog-tags minor-meta\"><strong>Tags:</strong><span> <a href=\"https://tomassetti.me/tag/c/\" rel=\"tag\">C#</a>, <a href=\"https://tomassetti.me/tag/kotlin/\" rel=\"tag\">Kotlin</a>, <a href=\"https://tomassetti.me/tag/sql/\" rel=\"tag\">SQL</a>, <a href=\"https://tomassetti.me/tag/tools/\" rel=\"tag\">tools</a></span></span></footer><div class=\"post_delimiter\"></div></div><div class=\"post_author_timeline\"></div><span class=\"hidden\"> <span class=\"av-structured-data\" itemprop=\"image\" itemscope=\"itemscope\" itemtype=\"https://schema.org/ImageObject\"> <span itemprop=\"url\">https://tomassetti.me/wp-content/uploads/2020/04/Parsing-SQL.jpg</span> <span itemprop=\"height\">512</span> <span itemprop=\"width\">1024</span> </span><span class=\"av-structured-data\" itemprop=\"publisher\" itemtype=\"https://schema.org/Organization\" itemscope=\"itemscope\"> <span itemprop=\"name\">Gabriele Tomassetti</span> <span itemprop=\"logo\" itemscope=\"\" itemtype=\"https://schema.org/ImageObject\"> <span itemprop=\"url\">https://tomassetti.me/wp-content/uploads/2017/07/federico-tomassetti-software-architect-300.png</span> </span> </span><span class=\"av-structured-data\" itemprop=\"author\" itemscope=\"itemscope\" itemtype=\"https://schema.org/Person\"><span itemprop=\"name\">Gabriele Tomassetti</span></span><span class=\"av-structured-data\" itemprop=\"datePublished\" datetime=\"2020-04-15T10:58:48+02:00\">2020-04-15 10:58:48</span><span class=\"av-structured-data\" itemprop=\"dateModified\" itemtype=\"https://schema.org/dateModified\">2020-04-15 10:58:48</span><span class=\"av-structured-data\" itemprop=\"mainEntityOfPage\" itemtype=\"https://schema.org/mainEntityOfPage\"><span itemprop=\"name\">Parsing SQL</span></span></span></article><div class=\"small\"></div><div class=\"related_posts\"><h5 class=\"related_title\">You might also like</h5><div class=\"related_entries_container \"><div class=\"av_one_eighth no_margin alpha relThumb relThumb1 relThumbOdd post-format-standard related_column\"> <a href=\"https://tomassetti.me/getting-started-antlr-cpp/\" class=\"relThumWrap noLightbox\"> <span class=\"related_image_wrap\" data-avia-related-tooltip=\"Getting Started with ANTLR in C++\"><img width=\"180\" height=\"180\" src=\"data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20180%20180'%3E%3C/svg%3E\" class=\"attachment-square size-square wp-post-image\" alt=\"Getting started with ANTLR in C++\" data-lazy-srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2018/04/Getting-started-with-ANTLR-in-C-180x180.jpg 180w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2018/04/Getting-started-with-ANTLR-in-C-80x80.jpg 80w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2018/04/Getting-started-with-ANTLR-in-C-36x36.jpg 36w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2018/04/Getting-started-with-ANTLR-in-C-120x120.jpg 120w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2018/04/Getting-started-with-ANTLR-in-C-450x450.jpg 450w\" data-lazy-sizes=\"(max-width: 180px) 100vw, 180px\" data-lazy-src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2018/04/Getting-started-with-ANTLR-in-C-180x180.jpg\"><noscript><img width=\"180\" height=\"180\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2018/04/Getting-started-with-ANTLR-in-C-180x180.jpg\" class=\"attachment-square size-square wp-post-image\" alt=\"Getting started with ANTLR in C++\" srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2018/04/Getting-started-with-ANTLR-in-C-180x180.jpg 180w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2018/04/Getting-started-with-ANTLR-in-C-80x80.jpg 80w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2018/04/Getting-started-with-ANTLR-in-C-36x36.jpg 36w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2018/04/Getting-started-with-ANTLR-in-C-120x120.jpg 120w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2018/04/Getting-started-with-ANTLR-in-C-450x450.jpg 450w\" sizes=\"(max-width: 180px) 100vw, 180px\" /></noscript> <span class=\"related-format-icon \"><span class=\"related-format-icon-inner\" aria-hidden=\"true\" data-av_icon=\"\" data-av_iconfont=\"entypo-fontello\"></span></span> </span> </a></div><div class=\"av_one_eighth no_margin relThumb relThumb2 relThumbEven post-format-standard related_column\"> <a href=\"https://tomassetti.me/guide-parsing-algorithms-terminology/\" class=\"relThumWrap noLightbox\"> <span class=\"related_image_wrap\" data-avia-related-tooltip=\"A Guide to Parsing: Algorithms and Terminology\"><img width=\"180\" height=\"180\" src=\"data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20180%20180'%3E%3C/svg%3E\" class=\"attachment-square size-square wp-post-image\" alt=\"A Guide To Parsing: Algorithms And Terminology\" data-lazy-srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/09/A-Guide-To-Parsing_-Algorithms-And-Terminology-180x180.jpg 180w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/09/A-Guide-To-Parsing_-Algorithms-And-Terminology-80x80.jpg 80w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/09/A-Guide-To-Parsing_-Algorithms-And-Terminology-36x36.jpg 36w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/09/A-Guide-To-Parsing_-Algorithms-And-Terminology-120x120.jpg 120w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/09/A-Guide-To-Parsing_-Algorithms-And-Terminology-450x450.jpg 450w\" data-lazy-sizes=\"(max-width: 180px) 100vw, 180px\" data-lazy-src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/09/A-Guide-To-Parsing_-Algorithms-And-Terminology-180x180.jpg\"><noscript><img width=\"180\" height=\"180\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/09/A-Guide-To-Parsing_-Algorithms-And-Terminology-180x180.jpg\" class=\"attachment-square size-square wp-post-image\" alt=\"A Guide To Parsing: Algorithms And Terminology\" srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/09/A-Guide-To-Parsing_-Algorithms-And-Terminology-180x180.jpg 180w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/09/A-Guide-To-Parsing_-Algorithms-And-Terminology-80x80.jpg 80w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/09/A-Guide-To-Parsing_-Algorithms-And-Terminology-36x36.jpg 36w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/09/A-Guide-To-Parsing_-Algorithms-And-Terminology-120x120.jpg 120w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/09/A-Guide-To-Parsing_-Algorithms-And-Terminology-450x450.jpg 450w\" sizes=\"(max-width: 180px) 100vw, 180px\" /></noscript> <span class=\"related-format-icon \"><span class=\"related-format-icon-inner\" aria-hidden=\"true\" data-av_icon=\"\" data-av_iconfont=\"entypo-fontello\"></span></span> </span> </a></div><div class=\"av_one_eighth no_margin relThumb relThumb3 relThumbOdd post-format-standard related_column\"> <a href=\"https://tomassetti.me/writing-a-browser-based-editor-using-monaco-and-antlr/\" class=\"relThumWrap noLightbox\"> <span class=\"related_image_wrap\" data-avia-related-tooltip=\"Writing a browser based editor using Monaco and ANTLR\"><img width=\"180\" height=\"180\" src=\"data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20180%20180'%3E%3C/svg%3E\" class=\"attachment-square size-square wp-post-image\" alt=\"\" data-lazy-srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2019/09/Writing-a-browser-based-editor-using-Monaco-and-ANTLR-180x180.jpg 180w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2019/09/Writing-a-browser-based-editor-using-Monaco-and-ANTLR-80x80.jpg 80w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2019/09/Writing-a-browser-based-editor-using-Monaco-and-ANTLR-36x36.jpg 36w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2019/09/Writing-a-browser-based-editor-using-Monaco-and-ANTLR-120x120.jpg 120w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2019/09/Writing-a-browser-based-editor-using-Monaco-and-ANTLR-450x450.jpg 450w\" data-lazy-sizes=\"(max-width: 180px) 100vw, 180px\" data-lazy-src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2019/09/Writing-a-browser-based-editor-using-Monaco-and-ANTLR-180x180.jpg\"><noscript><img width=\"180\" height=\"180\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2019/09/Writing-a-browser-based-editor-using-Monaco-and-ANTLR-180x180.jpg\" class=\"attachment-square size-square wp-post-image\" alt=\"\" srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2019/09/Writing-a-browser-based-editor-using-Monaco-and-ANTLR-180x180.jpg 180w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2019/09/Writing-a-browser-based-editor-using-Monaco-and-ANTLR-80x80.jpg 80w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2019/09/Writing-a-browser-based-editor-using-Monaco-and-ANTLR-36x36.jpg 36w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2019/09/Writing-a-browser-based-editor-using-Monaco-and-ANTLR-120x120.jpg 120w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2019/09/Writing-a-browser-based-editor-using-Monaco-and-ANTLR-450x450.jpg 450w\" sizes=\"(max-width: 180px) 100vw, 180px\" /></noscript> <span class=\"related-format-icon \"><span class=\"related-format-icon-inner\" aria-hidden=\"true\" data-av_icon=\"\" data-av_iconfont=\"entypo-fontello\"></span></span> </span> </a></div><div class=\"av_one_eighth no_margin relThumb relThumb4 relThumbEven post-format-standard related_column\"> <a href=\"https://tomassetti.me/antlr-mega-tutorial/\" class=\"relThumWrap noLightbox\"> <span class=\"related_image_wrap\" data-avia-related-tooltip=\"The ANTLR Mega Tutorial\"><img width=\"180\" height=\"180\" src=\"data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20180%20180'%3E%3C/svg%3E\" class=\"attachment-square size-square wp-post-image\" alt=\"ANTLR Mega Tutorial\" data-lazy-srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial-180x180.jpg 180w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial-80x80.jpg 80w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial-36x36.jpg 36w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial-120x120.jpg 120w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial-450x450.jpg 450w\" data-lazy-sizes=\"(max-width: 180px) 100vw, 180px\" data-lazy-src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial-180x180.jpg\"><noscript><img width=\"180\" height=\"180\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial-180x180.jpg\" class=\"attachment-square size-square wp-post-image\" alt=\"ANTLR Mega Tutorial\" srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial-180x180.jpg 180w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial-80x80.jpg 80w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial-36x36.jpg 36w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial-120x120.jpg 120w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/03/ANTLR-Mega-Tutorial-450x450.jpg 450w\" sizes=\"(max-width: 180px) 100vw, 180px\" /></noscript> <span class=\"related-format-icon \"><span class=\"related-format-icon-inner\" aria-hidden=\"true\" data-av_icon=\"\" data-av_iconfont=\"entypo-fontello\"></span></span> </span> </a></div><div class=\"av_one_eighth no_margin relThumb relThumb5 relThumbOdd post-format-standard related_column\"> <a href=\"https://tomassetti.me/parsing-any-language-in-java-in-5-minutes-using-antlr-for-example-python/\" class=\"relThumWrap noLightbox\"> <span class=\"related_image_wrap\" data-avia-related-tooltip=\"Parsing Any Language in Java in 5 Minutes Using ANTLR: for Example Python\"><img width=\"180\" height=\"180\" src=\"data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20180%20180'%3E%3C/svg%3E\" class=\"attachment-square size-square wp-post-image\" alt=\"\" data-lazy-srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/02/Parsing-any-language-in-Java-using-ANTLR-180x180.jpg 180w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/02/Parsing-any-language-in-Java-using-ANTLR-80x80.jpg 80w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/02/Parsing-any-language-in-Java-using-ANTLR-36x36.jpg 36w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/02/Parsing-any-language-in-Java-using-ANTLR-120x120.jpg 120w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/02/Parsing-any-language-in-Java-using-ANTLR-450x450.jpg 450w\" data-lazy-sizes=\"(max-width: 180px) 100vw, 180px\" data-lazy-src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/02/Parsing-any-language-in-Java-using-ANTLR-180x180.jpg\"><noscript><img width=\"180\" height=\"180\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/02/Parsing-any-language-in-Java-using-ANTLR-180x180.jpg\" class=\"attachment-square size-square wp-post-image\" alt=\"\" srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/02/Parsing-any-language-in-Java-using-ANTLR-180x180.jpg 180w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/02/Parsing-any-language-in-Java-using-ANTLR-80x80.jpg 80w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/02/Parsing-any-language-in-Java-using-ANTLR-36x36.jpg 36w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/02/Parsing-any-language-in-Java-using-ANTLR-120x120.jpg 120w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/02/Parsing-any-language-in-Java-using-ANTLR-450x450.jpg 450w\" sizes=\"(max-width: 180px) 100vw, 180px\" /></noscript> <span class=\"related-format-icon \"><span class=\"related-format-icon-inner\" aria-hidden=\"true\" data-av_icon=\"\" data-av_iconfont=\"entypo-fontello\"></span></span> </span> </a></div><div class=\"av_one_eighth no_margin relThumb relThumb6 relThumbEven post-format-standard related_column\"> <a href=\"https://tomassetti.me/generate-diagrams-csharp/\" class=\"relThumWrap noLightbox\"> <span class=\"related_image_wrap\" data-avia-related-tooltip=\"Generate diagrams from C# source code using Roslyn\"><img width=\"180\" height=\"180\" src=\"data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20180%20180'%3E%3C/svg%3E\" class=\"attachment-square size-square wp-post-image\" alt=\"\" data-lazy-srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/11/Generate-diagrams-from-C-source-code-using-Roslyn-180x180.jpg 180w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/11/Generate-diagrams-from-C-source-code-using-Roslyn-80x80.jpg 80w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/11/Generate-diagrams-from-C-source-code-using-Roslyn-36x36.jpg 36w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/11/Generate-diagrams-from-C-source-code-using-Roslyn-120x120.jpg 120w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/11/Generate-diagrams-from-C-source-code-using-Roslyn-450x450.jpg 450w\" data-lazy-sizes=\"(max-width: 180px) 100vw, 180px\" data-lazy-src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/11/Generate-diagrams-from-C-source-code-using-Roslyn-180x180.jpg\"><noscript><img width=\"180\" height=\"180\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/11/Generate-diagrams-from-C-source-code-using-Roslyn-180x180.jpg\" class=\"attachment-square size-square wp-post-image\" alt=\"\" srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/11/Generate-diagrams-from-C-source-code-using-Roslyn-180x180.jpg 180w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/11/Generate-diagrams-from-C-source-code-using-Roslyn-80x80.jpg 80w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/11/Generate-diagrams-from-C-source-code-using-Roslyn-36x36.jpg 36w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/11/Generate-diagrams-from-C-source-code-using-Roslyn-120x120.jpg 120w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/11/Generate-diagrams-from-C-source-code-using-Roslyn-450x450.jpg 450w\" sizes=\"(max-width: 180px) 100vw, 180px\" /></noscript> <span class=\"related-format-icon \"><span class=\"related-format-icon-inner\" aria-hidden=\"true\" data-av_icon=\"\" data-av_iconfont=\"entypo-fontello\"></span></span> </span> </a></div><div class=\"av_one_eighth no_margin relThumb relThumb7 relThumbOdd post-format-standard related_column\"> <a href=\"https://tomassetti.me/extracting-javadoc-documentation-source-files-using-javaparser/\" class=\"relThumWrap noLightbox\"> <span class=\"related_image_wrap\" data-avia-related-tooltip=\"Extracting JavaDoc documentation from source files using JavaParser\"><img width=\"180\" height=\"180\" src=\"data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20180%20180'%3E%3C/svg%3E\" class=\"attachment-square size-square wp-post-image\" alt=\"\" data-lazy-srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/01/Extracting-Javadoc-using-Javaparser-180x180.jpg 180w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/01/Extracting-Javadoc-using-Javaparser-80x80.jpg 80w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/01/Extracting-Javadoc-using-Javaparser-36x36.jpg 36w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/01/Extracting-Javadoc-using-Javaparser-120x120.jpg 120w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/01/Extracting-Javadoc-using-Javaparser-450x450.jpg 450w\" data-lazy-sizes=\"(max-width: 180px) 100vw, 180px\" data-lazy-src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/01/Extracting-Javadoc-using-Javaparser-180x180.jpg\"><noscript><img width=\"180\" height=\"180\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/01/Extracting-Javadoc-using-Javaparser-180x180.jpg\" class=\"attachment-square size-square wp-post-image\" alt=\"\" srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/01/Extracting-Javadoc-using-Javaparser-180x180.jpg 180w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/01/Extracting-Javadoc-using-Javaparser-80x80.jpg 80w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/01/Extracting-Javadoc-using-Javaparser-36x36.jpg 36w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/01/Extracting-Javadoc-using-Javaparser-120x120.jpg 120w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/01/Extracting-Javadoc-using-Javaparser-450x450.jpg 450w\" sizes=\"(max-width: 180px) 100vw, 180px\" /></noscript> <span class=\"related-format-icon \"><span class=\"related-format-icon-inner\" aria-hidden=\"true\" data-av_icon=\"\" data-av_iconfont=\"entypo-fontello\"></span></span> </span> </a></div><div class=\"av_one_eighth no_margin omega relThumb relThumb8 relThumbEven post-format-standard related_column\"> <a href=\"https://tomassetti.me/getting-started-with-antlr-building-a-simple-expression-language/\" class=\"relThumWrap noLightbox\"> <span class=\"related_image_wrap\" data-avia-related-tooltip=\"Getting started with ANTLR: building a simple expression language\"><img width=\"180\" height=\"180\" src=\"data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20180%20180'%3E%3C/svg%3E\" class=\"attachment-square size-square wp-post-image\" alt=\"\" data-lazy-srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/07/Getting-started-with-ANTLR_-building-simple-language-180x180.jpg 180w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/07/Getting-started-with-ANTLR_-building-simple-language-80x80.jpg 80w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/07/Getting-started-with-ANTLR_-building-simple-language-36x36.jpg 36w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/07/Getting-started-with-ANTLR_-building-simple-language-120x120.jpg 120w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/07/Getting-started-with-ANTLR_-building-simple-language-450x450.jpg 450w\" data-lazy-sizes=\"(max-width: 180px) 100vw, 180px\" data-lazy-src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/07/Getting-started-with-ANTLR_-building-simple-language-180x180.jpg\"><noscript><img width=\"180\" height=\"180\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/07/Getting-started-with-ANTLR_-building-simple-language-180x180.jpg\" class=\"attachment-square size-square wp-post-image\" alt=\"\" srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/07/Getting-started-with-ANTLR_-building-simple-language-180x180.jpg 180w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/07/Getting-started-with-ANTLR_-building-simple-language-80x80.jpg 80w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/07/Getting-started-with-ANTLR_-building-simple-language-36x36.jpg 36w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/07/Getting-started-with-ANTLR_-building-simple-language-120x120.jpg 120w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2016/07/Getting-started-with-ANTLR_-building-simple-language-450x450.jpg 450w\" sizes=\"(max-width: 180px) 100vw, 180px\" /></noscript> <span class=\"related-format-icon \"><span class=\"related-format-icon-inner\" aria-hidden=\"true\" data-av_icon=\"\" data-av_iconfont=\"entypo-fontello\"></span></span> </span> </a></div></div></div><div class=\"template-page content alpha units\" style=\"background-color: #F8F8F8;\"><div class=\"post-entry post-entry-type-page post-entry-2592\" style=\"margin-left: 2em; margin-right: 1em;\"><div class=\"entry-content-wrapper clearfix\"><div style=\"padding-bottom:10px; \" class=\"av-special-heading av-special-heading-h2 blockquote modern-quote modern-centered avia-builder-el-7 el_before_av_one_third avia-builder-el-first \"><h2 class=\"av-special-heading-tag \" itemprop=\"headline\" style=\"margin-bottom: 1em;\">Do You Need a Parser?</h2><div class=\"av-subheading av-subheading_below\" style=\"font-size:18px; text-align: justify; margin-bottom: 1em;\"><p>We can design parsers for new languages, or rewrite parsers for existing languages built in house.</p><p> On top of parsers we can then help building interpreters, compilers, code generators, documentation generators, or translators (code converters) to other languages.</p></div><div class=\"special-heading-border\"><div class=\"special-heading-inner-border\"></div></div></div><div class=\"flex_column av_one_third flex_column_div av-zero-column-padding first avia-builder-el-8 el_after_av_heading el_before_av_one_third \" style=\"border-radius:0px; \"></div><div class=\"flex_column av_one_third flex_column_div av-zero-column-padding avia-builder-el-9 el_after_av_one_third el_before_av_one_third \" style=\"border-radius:0px; \"><div class=\"avia-button-wrap avia-button-center avia-builder-el-10 avia-builder-el-no-sibling \"><a href=\"https://tomassetti.me/contact-me-about-a-project/\" class=\"avia-button avia-button-fullwidth avia-icon_select-no avia-color-theme-color \" style=\"color:#ffffff; \"><span class=\"avia_iconbox_title\">Let’s Talk!</span><span class=\"avia_button_background avia-button avia-button-fullwidth avia-color-black\"></span></a></div></div><div class=\"flex_column av_one_third flex_column_div av-zero-column-padding avia-builder-el-11 el_after_av_one_third avia-builder-el-last \" style=\"border-radius:0px; \"></div><p></p> <span id=\"tve_leads_end_content\" style=\"display: block; visibility: hidden; border: 1px solid transparent;\"></span></div></div></div><div class=\"comment-entry post-entry\"></div></main><aside class=\"sidebar sidebar_right alpha units\" role=\"complementary\" itemscope=\"itemscope\" itemtype=\"https://schema.org/WPSideBar\"><div class=\"inner_sidebar extralight-border\"><section id=\"custom_html-4\" class=\"widget_text widget clearfix widget_custom_html\"><h3 class=\"widgettitle\">Course: Using ANTLR Like A Professional</h3><div class=\"textwidget custom-html-widget\"><a href=\"https://tomassetti.me/antlr-course\" target=\"_blank\" rel=\"noopener noreferrer\" style=\"position: relative; overflow: hidden;\"><img src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2018/04/ANTLR-Course-Widget-Square.png\" alt=\"ANTLR Course Image\" width=\"256px\" data-lazy-src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2018/04/ANTLR-Course-Widget-Square.png\" class=\"lazyloaded\" data-was-processed=\"true\"><noscript><img src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2018/04/ANTLR-Course-Widget-Square.png\" alt=\"ANTLR Course Image\" width=\"256px\"></noscript><span class=\"image-overlay overlay-type-extern\"><span class=\"image-overlay-inside\"></span></span></a><p style=\"font-size: 10pt;\"><a href=\"https://tomassetti.me/antlr-course\" style=\" text-decoration: underline; color: #ea9030; \">A complete video course on parsing and ANTLR</a>, that will teach you how to build parser for everything from programming languages to data formats. <br> Taught from professionals that build parsers for a living.</p></div><span class=\"seperator extralight-border\"></span></section><section id=\"text-4\" class=\"widget clearfix widget_text\"><h3 class=\"widgettitle\">Book: How to create pragmatic, lightweight languages</h3><div class=\"textwidget\"><p><a href=\"https://tomassetti.me/create-languages\" target=\"_blank\" rel=\"noopener noreferrer\" style=\"position: relative; overflow: hidden;\"><img src=\"data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%200%200'%3E%3C/svg%3E\" data-lazy-src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2018/03/low-resolution.png\"><noscript><img src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2018/03/low-resolution.png\"/></noscript><span class=\"image-overlay overlay-type-extern\"><span class=\"image-overlay-inside\"></span></span></a></p><p style=\" font-size: 10pt; \">This <a href=\"https://tomassetti.me/create-languages\" style=\" text-decoration: underline; color: #ea9030; \">book on Building Languages</a> is about building in a simple manner productive languages with parsers, compilers, interpreters, editors and more.</p></div> <span class=\"seperator extralight-border\"></span></section><section id=\"text-6\" class=\"widget clearfix widget_text\"><h3 class=\"widgettitle\">Book: JavaParser Visited</h3><div class=\"textwidget\"><a href=\"https://leanpub.com/javaparservisited\" target=\"_blank\" rel=\"noopener noreferrer\" style=\"position: relative; overflow: hidden;\"><img src=\"data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%200%200'%3E%3C/svg%3E\" data-lazy-src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/01/javaparser-book.jpg\"><noscript><img src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2017/01/javaparser-book.jpg\"/></noscript><span class=\"image-overlay overlay-type-extern\"><span class=\"image-overlay-inside\"></span></span></a><p style=\" font-size: 10pt; \">This <a href=\"https://leanpub.com/javaparservisited\" style=\" text-decoration: underline; color: #ea9030; \">book on JavaParser</a> will teach you how to analyze, transform, and generate Java code</p></div> <span class=\"seperator extralight-border\"></span></section><section id=\"custom_html-2\" class=\"widget_text widget clearfix widget_custom_html\"><h3 class=\"widgettitle\">Strumenta – Consulting</h3><div class=\"textwidget custom-html-widget\">If you need help designing and developing DSLs, languages, parsers, compilers, interpreters, and editors you can check the <a href=\"https://strumenta.com/services\" style=\"text-decoration: underline;\">services page</a> of the Consulting studio we founded: <a href=\"https://strumenta.com\">Strumenta</a>. <a href=\"https://strumenta.com\" style=\"position: relative; overflow: hidden;\"><img style=\"display: block;margin: 10px 30px 0;width:70%\" src=\"data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%200%200'%3E%3C/svg%3E\" alt=\"Strumenta Logo\" data-lazy-src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2018/03/SRUMENTA-ESTESO-320x132.png\"><noscript><img style=\"display: block;margin: 10px 30px 0;width:70%\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2018/03/SRUMENTA-ESTESO-320x132.png\" alt=\"Strumenta Logo\"></noscript><span class=\"image-overlay overlay-type-extern\"><span class=\"image-overlay-inside\"></span></span></a></div><span class=\"seperator extralight-border\"></span></section><section id=\"categories-7\" class=\"widget clearfix widget_categories\"><h3 class=\"widgettitle\">Blog Categories</h3><ul><li class=\"cat-item cat-item-57\"><a href=\"https://tomassetti.me/category/language-engineering/antlr/\" title=\"Tutorials, news and informations on the parser generator ANTLR\">ANTLR</a> (17)</li><li class=\"cat-item cat-item-173\"><a href=\"https://tomassetti.me/category/application-modernization/\">Application modernization</a> (2)</li><li class=\"cat-item cat-item-30\"><a href=\"https://tomassetti.me/category/static-analysis/\" title=\"Articles about extracting data from code, analyze it and programmatically transform it. In other words we talk about static analysis, automated refactoring, and code generation.\">Code processing</a> (24)</li><li class=\"cat-item cat-item-68\"><a href=\"https://tomassetti.me/category/consulting/\" title=\"My experience about consulting and freelancing\">Consulting</a> (14)</li><li class=\"cat-item cat-item-166\"><a href=\"https://tomassetti.me/category/language-engineering/create-a-programming-language/\">Create a programming language</a> (1)</li><li class=\"cat-item cat-item-38\"><a href=\"https://tomassetti.me/category/language-engineering/domain-specific-languages/\" title=\"News, guides, tutorials and the bigger picture of creating domain specific languages\">Domain specific languages</a> (16)</li><li class=\"cat-item cat-item-172\"><a href=\"https://tomassetti.me/category/language-engineering/editors/\">Editors</a> (1)</li><li class=\"cat-item cat-item-54\"><a href=\"https://tomassetti.me/category/language-engineering/jetbrains-mps/\" title=\"Informations and tutorials on the language workbench Jetbrains MPS\">Jetbrains MPS</a> (11)</li><li class=\"cat-item cat-item-52\"><a href=\"https://tomassetti.me/category/language-engineering/language-design/\" title=\"Strategies, tips and tutorials on designing programming languages\">Language design</a> (13)</li><li class=\"cat-item cat-item-60\"><a href=\"https://tomassetti.me/category/language-engineering/\" title=\"The science, tools, strategies, patterns and tools behind the creation and processing of languages\">Language Engineering</a> (33)</li><li class=\"cat-item cat-item-1\"><a href=\"https://tomassetti.me/category/miscellany/\" title=\"Reviews, ideas, tip, opinions, etc. on all aspects of software development\">Miscellany</a> (5)</li><li class=\"cat-item cat-item-5\"><a href=\"https://tomassetti.me/category/language-engineering/mdd/\" title=\"Articles on creating software working on domains models\">Model driven development</a> (4)</li><li class=\"cat-item cat-item-171\"><a href=\"https://tomassetti.me/category/natural-language-processing/\">Natural Language Processing</a> (1)</li><li class=\"cat-item cat-item-70\"><a href=\"https://tomassetti.me/category/random-stuff/\" title=\"Everything that is not related to software development: ideas on natural languages, countries I have lived in, my life, stuff that make me curious. All sort of interesting things.\">Non software development</a> (4)</li><li class=\"cat-item cat-item-23\"><a href=\"https://tomassetti.me/category/open-source/\" title=\"Ideas and tips on how to make open source project successful and my open source projects\">Open-source</a> (8)</li><li class=\"cat-item cat-item-39\"><a href=\"https://tomassetti.me/category/language-engineering/parsing/\" title=\"Tutorials and issues on all aspects of creating software to analyse code\">Parsing</a> (22)</li><li class=\"cat-item cat-item-17\"><a href=\"https://tomassetti.me/category/research/\" title=\"Research Papers, conferences and challenges at the forefront of Language Engineering\">Research</a> (4)</li><li class=\"cat-item cat-item-4\"><a href=\"https://tomassetti.me/category/development/\" title=\"Everything related to software development that every developer could find useful\">Software Development</a> (16)</li><li class=\"cat-item cat-item-35\"><a href=\"https://tomassetti.me/category/software-engineering/\" title=\"Methods and processes of Software Engineering: how to create beautiful software\">Software Engineering</a> (13)</li><li class=\"cat-item cat-item-44\"><a href=\"https://tomassetti.me/category/turin-programming-language/\" title=\"The creation of the Turin Programmin Language: examples, problems, solutions and strategies.\">Turin Programming Language</a> (4)</li><li class=\"cat-item cat-item-63\"><a href=\"https://tomassetti.me/category/language-engineering/whole-platform/\" title=\"Informations and opinions about the Whole Platform\">Whole Platform</a> (2)</li><li class=\"cat-item cat-item-56\"><a href=\"https://tomassetti.me/category/language-engineering/xtext/\" title=\"News and tips on Xtext\">Xtext</a> (3)</li></ul> <span class=\"seperator extralight-border\"></span></section></div></aside></div></div><div class=\"container_wrap footer_color\" id=\"footer\"><div class=\"container\"><div class=\"flex_column av_one_fourth first el_before_av_one_fourth\"><section id=\"nav_menu-3\" class=\"widget clearfix widget_nav_menu\"><h3 class=\"widgettitle\">Menu</h3><div class=\"menu-tomassetti_footer-container\"><ul id=\"menu-tomassetti_footer\" class=\"menu\"><li id=\"menu-item-2582\" class=\"menu-item menu-item-type-post_type menu-item-object-page menu-item-2582\"><a href=\"https://tomassetti.me/about-me/\">About me</a></li><li id=\"menu-item-2579\" class=\"menu-item menu-item-type-post_type menu-item-object-page menu-item-2579\"><a href=\"https://tomassetti.me/how-i-work/\">How I work</a></li><li id=\"menu-item-5981\" class=\"menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-5981\"><a href=\"https://strumenta.com/services/\">Language Engineering Services</a><ul class=\"sub-menu\"><li id=\"menu-item-5092\" class=\"menu-item menu-item-type-custom menu-item-object-custom menu-item-5092\"><a href=\"https://strumenta.com/antlr-consulting/\">ANTLR Consulting</a></li><li id=\"menu-item-5984\" class=\"menu-item menu-item-type-custom menu-item-object-custom menu-item-5984\"><a href=\"https://strumenta.com/jetbrains-mps-consulting/\">Jetbrains MPS Consulting</a></li></ul></li><li id=\"menu-item-5961\" class=\"menu-item menu-item-type-custom menu-item-object-custom menu-item-5961\"><a href=\"https://strumenta.com/contact-us/\">Contact</a></li><li id=\"menu-item-2585\" class=\"menu-item menu-item-type-custom menu-item-object-custom menu-item-2585\"><a href=\"https://ie.linkedin.com/in/federicotomassetti\">LinkedIn</a></li></ul></div><span class=\"seperator extralight-border\"></span></section></div><div class=\"flex_column av_one_fourth el_after_av_one_fourth el_before_av_one_fourth \"><section id=\"categories-5\" class=\"widget clearfix widget_categories\"><h3 class=\"widgettitle\">Blog Categories</h3><ul><li class=\"cat-item cat-item-57\"><a href=\"https://tomassetti.me/category/language-engineering/antlr/\" title=\"Tutorials, news and informations on the parser generator ANTLR\">ANTLR</a> (17)</li><li class=\"cat-item cat-item-173\"><a href=\"https://tomassetti.me/category/application-modernization/\">Application modernization</a> (2)</li><li class=\"cat-item cat-item-30\"><a href=\"https://tomassetti.me/category/static-analysis/\" title=\"Articles about extracting data from code, analyze it and programmatically transform it. In other words we talk about static analysis, automated refactoring, and code generation.\">Code processing</a> (24)</li><li class=\"cat-item cat-item-68\"><a href=\"https://tomassetti.me/category/consulting/\" title=\"My experience about consulting and freelancing\">Consulting</a> (14)</li><li class=\"cat-item cat-item-166\"><a href=\"https://tomassetti.me/category/language-engineering/create-a-programming-language/\">Create a programming language</a> (1)</li><li class=\"cat-item cat-item-38\"><a href=\"https://tomassetti.me/category/language-engineering/domain-specific-languages/\" title=\"News, guides, tutorials and the bigger picture of creating domain specific languages\">Domain specific languages</a> (16)</li><li class=\"cat-item cat-item-172\"><a href=\"https://tomassetti.me/category/language-engineering/editors/\">Editors</a> (1)</li><li class=\"cat-item cat-item-54\"><a href=\"https://tomassetti.me/category/language-engineering/jetbrains-mps/\" title=\"Informations and tutorials on the language workbench Jetbrains MPS\">Jetbrains MPS</a> (11)</li><li class=\"cat-item cat-item-52\"><a href=\"https://tomassetti.me/category/language-engineering/language-design/\" title=\"Strategies, tips and tutorials on designing programming languages\">Language design</a> (13)</li><li class=\"cat-item cat-item-60\"><a href=\"https://tomassetti.me/category/language-engineering/\" title=\"The science, tools, strategies, patterns and tools behind the creation and processing of languages\">Language Engineering</a> (33)</li><li class=\"cat-item cat-item-1\"><a href=\"https://tomassetti.me/category/miscellany/\" title=\"Reviews, ideas, tip, opinions, etc. on all aspects of software development\">Miscellany</a> (5)</li><li class=\"cat-item cat-item-5\"><a href=\"https://tomassetti.me/category/language-engineering/mdd/\" title=\"Articles on creating software working on domains models\">Model driven development</a> (4)</li><li class=\"cat-item cat-item-171\"><a href=\"https://tomassetti.me/category/natural-language-processing/\">Natural Language Processing</a> (1)</li><li class=\"cat-item cat-item-70\"><a href=\"https://tomassetti.me/category/random-stuff/\" title=\"Everything that is not related to software development: ideas on natural languages, countries I have lived in, my life, stuff that make me curious. All sort of interesting things.\">Non software development</a> (4)</li><li class=\"cat-item cat-item-23\"><a href=\"https://tomassetti.me/category/open-source/\" title=\"Ideas and tips on how to make open source project successful and my open source projects\">Open-source</a> (8)</li><li class=\"cat-item cat-item-39\"><a href=\"https://tomassetti.me/category/language-engineering/parsing/\" title=\"Tutorials and issues on all aspects of creating software to analyse code\">Parsing</a> (22)</li><li class=\"cat-item cat-item-17\"><a href=\"https://tomassetti.me/category/research/\" title=\"Research Papers, conferences and challenges at the forefront of Language Engineering\">Research</a> (4)</li><li class=\"cat-item cat-item-4\"><a href=\"https://tomassetti.me/category/development/\" title=\"Everything related to software development that every developer could find useful\">Software Development</a> (16)</li><li class=\"cat-item cat-item-35\"><a href=\"https://tomassetti.me/category/software-engineering/\" title=\"Methods and processes of Software Engineering: how to create beautiful software\">Software Engineering</a> (13)</li><li class=\"cat-item cat-item-44\"><a href=\"https://tomassetti.me/category/turin-programming-language/\" title=\"The creation of the Turin Programmin Language: examples, problems, solutions and strategies.\">Turin Programming Language</a> (4)</li><li class=\"cat-item cat-item-63\"><a href=\"https://tomassetti.me/category/language-engineering/whole-platform/\" title=\"Informations and opinions about the Whole Platform\">Whole Platform</a> (2)</li><li class=\"cat-item cat-item-56\"><a href=\"https://tomassetti.me/category/language-engineering/xtext/\" title=\"News and tips on Xtext\">Xtext</a> (3)</li></ul> <span class=\"seperator extralight-border\"></span></section></div><div class=\"flex_column av_one_fourth el_after_av_one_fourth el_before_av_one_fourth \"><section id=\"tag_cloud-3\" class=\"widget clearfix widget_tag_cloud\"><h3 class=\"widgettitle\">Tags</h3><div class=\"tagcloud\"><a href=\"https://tomassetti.me/tag/automation/\" class=\"tag-cloud-link tag-link-73 tag-link-position-1\" style=\"font-size: 10.964705882353pt;\" aria-label=\"Automation (2 items)\">Automation</a> <a href=\"https://tomassetti.me/tag/c/\" class=\"tag-cloud-link tag-link-91 tag-link-position-2\" style=\"font-size: 20.847058823529pt;\" aria-label=\"C# (11 items)\">C#</a> <a href=\"https://tomassetti.me/tag/clojure/\" class=\"tag-cloud-link tag-link-80 tag-link-position-3\" style=\"font-size: 12.941176470588pt;\" aria-label=\"Clojure (3 items)\">Clojure</a> <a href=\"https://tomassetti.me/tag/code-generation/\" class=\"tag-cloud-link tag-link-156 tag-link-position-4\" style=\"font-size: 10.964705882353pt;\" aria-label=\"code generation (2 items)\">code generation</a> <a href=\"https://tomassetti.me/tag/dsl/\" class=\"tag-cloud-link tag-link-111 tag-link-position-5\" style=\"font-size: 14.588235294118pt;\" aria-label=\"dsl (4 items)\">dsl</a> <a href=\"https://tomassetti.me/tag/effectivejava/\" class=\"tag-cloud-link tag-link-135 tag-link-position-6\" style=\"font-size: 12.941176470588pt;\" aria-label=\"effectivejava (3 items)\">effectivejava</a> <a href=\"https://tomassetti.me/tag/formats/\" class=\"tag-cloud-link tag-link-146 tag-link-position-7\" style=\"font-size: 10.964705882353pt;\" aria-label=\"formats (2 items)\">formats</a> <a href=\"https://tomassetti.me/tag/frege/\" class=\"tag-cloud-link tag-link-74 tag-link-position-8\" style=\"font-size: 10.964705882353pt;\" aria-label=\"Frege (2 items)\">Frege</a> <a href=\"https://tomassetti.me/tag/functional-programming/\" class=\"tag-cloud-link tag-link-86 tag-link-position-9\" style=\"font-size: 10.964705882353pt;\" aria-label=\"Functional programming (2 items)\">Functional programming</a> <a href=\"https://tomassetti.me/tag/guide/\" class=\"tag-cloud-link tag-link-147 tag-link-position-10\" style=\"font-size: 12.941176470588pt;\" aria-label=\"guide (3 items)\">guide</a> <a href=\"https://tomassetti.me/tag/haskell/\" class=\"tag-cloud-link tag-link-75 tag-link-position-11\" style=\"font-size: 12.941176470588pt;\" aria-label=\"Haskell (3 items)\">Haskell</a> <a href=\"https://tomassetti.me/tag/icse/\" class=\"tag-cloud-link tag-link-18 tag-link-position-12\" style=\"font-size: 8pt;\" aria-label=\"icse (1 item)\">icse</a> <a href=\"https://tomassetti.me/tag/image-processing/\" class=\"tag-cloud-link tag-link-72 tag-link-position-13\" style=\"font-size: 8pt;\" aria-label=\"Image processing (1 item)\">Image processing</a> <a href=\"https://tomassetti.me/tag/interpreters/\" class=\"tag-cloud-link tag-link-149 tag-link-position-14\" style=\"font-size: 10.964705882353pt;\" aria-label=\"interpreters (2 items)\">interpreters</a> <a href=\"https://tomassetti.me/tag/interview/\" class=\"tag-cloud-link tag-link-71 tag-link-position-15\" style=\"font-size: 22pt;\" aria-label=\"Interview (13 items)\">Interview</a> <a href=\"https://tomassetti.me/tag/java/\" class=\"tag-cloud-link tag-link-24 tag-link-position-16\" style=\"font-size: 17.882352941176pt;\" aria-label=\"java (7 items)\">java</a> <a href=\"https://tomassetti.me/tag/javaparser/\" class=\"tag-cloud-link tag-link-83 tag-link-position-17\" style=\"font-size: 17.058823529412pt;\" aria-label=\"JavaParser (6 items)\">JavaParser</a> <a href=\"https://tomassetti.me/tag/javascript/\" class=\"tag-cloud-link tag-link-89 tag-link-position-18\" style=\"font-size: 14.588235294118pt;\" aria-label=\"JavaScript (4 items)\">JavaScript</a> <a href=\"https://tomassetti.me/tag/javasymbolsolver/\" class=\"tag-cloud-link tag-link-81 tag-link-position-19\" style=\"font-size: 8pt;\" aria-label=\"JavaSymbolSolver (1 item)\">JavaSymbolSolver</a> <a href=\"https://tomassetti.me/tag/jetbrains-mps/\" class=\"tag-cloud-link tag-link-13 tag-link-position-20\" style=\"font-size: 14.588235294118pt;\" aria-label=\"jetbrains mps (4 items)\">jetbrains mps</a> <a href=\"https://tomassetti.me/tag/kotlin/\" class=\"tag-cloud-link tag-link-90 tag-link-position-21\" style=\"font-size: 14.588235294118pt;\" aria-label=\"Kotlin (4 items)\">Kotlin</a> <a href=\"https://tomassetti.me/tag/language-integration/\" class=\"tag-cloud-link tag-link-16 tag-link-position-22\" style=\"font-size: 10.964705882353pt;\" aria-label=\"language integration (2 items)\">language integration</a> <a href=\"https://tomassetti.me/tag/language-server-protocol/\" class=\"tag-cloud-link tag-link-100 tag-link-position-23\" style=\"font-size: 12.941176470588pt;\" aria-label=\"language server protocol (3 items)\">language server protocol</a> <a href=\"https://tomassetti.me/tag/language-worbenches/\" class=\"tag-cloud-link tag-link-19 tag-link-position-24\" style=\"font-size: 8pt;\" aria-label=\"language worbenches (1 item)\">language worbenches</a> <a href=\"https://tomassetti.me/tag/libav/\" class=\"tag-cloud-link tag-link-84 tag-link-position-25\" style=\"font-size: 10.964705882353pt;\" aria-label=\"Libav (2 items)\">Libav</a> <a href=\"https://tomassetti.me/tag/machine-learning/\" class=\"tag-cloud-link tag-link-121 tag-link-position-26\" style=\"font-size: 10.964705882353pt;\" aria-label=\"machine learning (2 items)\">machine learning</a> <a href=\"https://tomassetti.me/tag/mbeddr/\" class=\"tag-cloud-link tag-link-48 tag-link-position-27\" style=\"font-size: 8pt;\" aria-label=\"mbeddr (1 item)\">mbeddr</a> <a href=\"https://tomassetti.me/tag/mise/\" class=\"tag-cloud-link tag-link-20 tag-link-position-28\" style=\"font-size: 8pt;\" aria-label=\"mise (1 item)\">mise</a> <a href=\"https://tomassetti.me/tag/natural-language/\" class=\"tag-cloud-link tag-link-113 tag-link-position-29\" style=\"font-size: 10.964705882353pt;\" aria-label=\"natural language (2 items)\">natural language</a> <a href=\"https://tomassetti.me/tag/nlp/\" class=\"tag-cloud-link tag-link-140 tag-link-position-30\" style=\"font-size: 10.964705882353pt;\" aria-label=\"nlp (2 items)\">nlp</a> <a href=\"https://tomassetti.me/tag/open-source/\" class=\"tag-cloud-link tag-link-82 tag-link-position-31\" style=\"font-size: 10.964705882353pt;\" aria-label=\"Open-source (2 items)\">Open-source</a> <a href=\"https://tomassetti.me/tag/opensource/\" class=\"tag-cloud-link tag-link-157 tag-link-position-32\" style=\"font-size: 10.964705882353pt;\" aria-label=\"opensource (2 items)\">opensource</a> <a href=\"https://tomassetti.me/tag/programming-languages/\" class=\"tag-cloud-link tag-link-123 tag-link-position-33\" style=\"font-size: 14.588235294118pt;\" aria-label=\"programming languages (4 items)\">programming languages</a> <a href=\"https://tomassetti.me/tag/python/\" class=\"tag-cloud-link tag-link-78 tag-link-position-34\" style=\"font-size: 17.882352941176pt;\" aria-label=\"Python (7 items)\">Python</a> <a href=\"https://tomassetti.me/tag/refactoring/\" class=\"tag-cloud-link tag-link-116 tag-link-position-35\" style=\"font-size: 12.941176470588pt;\" aria-label=\"refactoring (3 items)\">refactoring</a> <a href=\"https://tomassetti.me/tag/review/\" class=\"tag-cloud-link tag-link-102 tag-link-position-36\" style=\"font-size: 10.964705882353pt;\" aria-label=\"review (2 items)\">review</a> <a href=\"https://tomassetti.me/tag/roslyn/\" class=\"tag-cloud-link tag-link-99 tag-link-position-37\" style=\"font-size: 14.588235294118pt;\" aria-label=\"Roslyn (4 items)\">Roslyn</a> <a href=\"https://tomassetti.me/tag/sparkweb/\" class=\"tag-cloud-link tag-link-85 tag-link-position-38\" style=\"font-size: 14.588235294118pt;\" aria-label=\"SparkWeb (4 items)\">SparkWeb</a> <a href=\"https://tomassetti.me/tag/static-analysis/\" class=\"tag-cloud-link tag-link-104 tag-link-position-39\" style=\"font-size: 10.964705882353pt;\" aria-label=\"static-analysis (2 items)\">static-analysis</a> <a href=\"https://tomassetti.me/tag/testing/\" class=\"tag-cloud-link tag-link-25 tag-link-position-40\" style=\"font-size: 8pt;\" aria-label=\"testing (1 item)\">testing</a> <a href=\"https://tomassetti.me/tag/tools/\" class=\"tag-cloud-link tag-link-107 tag-link-position-41\" style=\"font-size: 12.941176470588pt;\" aria-label=\"tools (3 items)\">tools</a> <a href=\"https://tomassetti.me/tag/tripadvisor/\" class=\"tag-cloud-link tag-link-120 tag-link-position-42\" style=\"font-size: 12.941176470588pt;\" aria-label=\"TripAdvisor (3 items)\">TripAdvisor</a> <a href=\"https://tomassetti.me/tag/tutorial/\" class=\"tag-cloud-link tag-link-134 tag-link-position-43\" style=\"font-size: 17.882352941176pt;\" aria-label=\"tutorial (7 items)\">tutorial</a> <a href=\"https://tomassetti.me/tag/web/\" class=\"tag-cloud-link tag-link-98 tag-link-position-44\" style=\"font-size: 10.964705882353pt;\" aria-label=\"web (2 items)\">web</a> <a href=\"https://tomassetti.me/tag/webassembly/\" class=\"tag-cloud-link tag-link-105 tag-link-position-45\" style=\"font-size: 10.964705882353pt;\" aria-label=\"WebAssembly (2 items)\">WebAssembly</a></div> <span class=\"seperator extralight-border\"></span></section></div><div class=\"flex_column av_one_fourth el_after_av_one_fourth el_before_av_one_fourth \"><section id=\"custom_html-5\" class=\"widget_text widget clearfix widget_custom_html\"><h3 class=\"widgettitle\">Don’t miss the next updates!</h3><div class=\"textwidget custom-html-widget\"><div class=\"tve-leads-shortcode tve-tl-anim tl-anim-instant tve-leads-track-shortcode_4566 tve-leads-triggered\"><div class=\"tl-style\" id=\"tve_tcb2_blank\" data-state=\"98\" data-form-state=\"\"><style type=\"text/css\" class=\"tve_custom_style\">@media (min-width: 300px){[data-css=\"tve-u-15e429e013292c\"] { max-width: 100%; margin-top: 0px !important; margin-bottom: 0px !important; padding: 0px !important; }:not(#tve) [data-css=\"tve-u-25e429e013292d\"] button { text-transform: uppercase; background-image: none !important; background-color: rgb(234, 145, 48) !important; font-weight: bold !important; }[data-css=\"tve-u-05e429e0132927\"] { display: inline-block; padding: 10px !important; margin-bottom: 0px !important; margin-top: 0px !important; background-color: rgb(252, 252, 252) !important; }}</style><style type=\"text/css\" class=\"tve_user_custom_style\">.tve-leads-conversion-object .thrv_heading h1,.tve-leads-conversion-object .thrv_heading h2,.tve-leads-conversion-object .thrv_heading h3{margin:0;padding:0}.tve-leads-conversion-object .thrv_text_element p,.tve-leads-conversion-object .thrv_text_element h1,.tve-leads-conversion-object .thrv_text_element h2,.tve-leads-conversion-object .thrv_text_element h3{margin:0}</style><style type=\"text/css\" class=\"tve_global_style\"></style><div class=\"tve-leads-conversion-object\" data-tl-type=\"shortcode_4566\"><div class=\"tve_flt\"><div id=\"tve_editor\" class=\"tve_shortcode_editor\"><div class=\"thrv-leads-form-box tve_no_drag tve_no_icons thrv_wrapper tve_editor_main_content tve_empty_dropzone\" data-css=\"tve-u-05e429e0132927\"><div class=\"thrv_wrapper thrv_contentbox_shortcode thrv-content-box\" data-css=\"tve-u-15e429e013292c\"><div class=\"tve-content-box-background\"></div><div class=\"tve-cb tve_empty_dropzone\"><div class=\"thrv_wrapper thrv_text_element tve_empty_dropzone\"><p>Want to join over 10.000+ people that keep learning more about DSLs, parsers, interpreters, compilers and language design?</p></div><div class=\"thrv_wrapper thrv_lead_generation\" data-connection=\"api\"><input class=\"tve-lg-err-msg\" value=\"{&quot;email&quot;:&quot;Email address invalid&quot;,&quot;phone&quot;:&quot;Phone number invalid&quot;,&quot;password&quot;:&quot;Password invalid&quot;,&quot;passwordmismatch&quot;:&quot;Password mismatch error&quot;,&quot;required&quot;:&quot;Required field missing&quot;}\" type=\"hidden\"><div class=\"thrv_lead_generation_container tve_clearfix\"><form action=\"#\" method=\"post\" novalidate=\"\"><div class=\"tve_lead_generated_inputs_container tve_clearfix tve_empty_dropzone\"><div class=\"tve_lg_input_container tve_lg_input\"><input data-field=\"email\" data-required=\"1\" data-validation=\"email\" name=\"email\" placeholder=\"Email\" data-placeholder=\"Email\" class=\"\" type=\"email\"></div><div class=\"tve_lg_input_container tve_submit_container tve_lg_submit\" data-css=\"tve-u-25e429e013292d\" data-tcb_hover_state_parent=\"\"><button type=\"submit\" class=\"tve-froala\">Count Me In!</button></div></div><input id=\"_submit_option\" name=\"_submit_option\" value=\"redirect\" type=\"hidden\"><input id=\"_back_url\" name=\"_back_url\" value=\"https://tomassetti.me/thank-you\" type=\"hidden\"><input id=\"_autofill\" name=\"_autofill\" value=\"\" type=\"hidden\"><input name=\"__tcb_lg_fc\" id=\"__tcb_lg_fc\" value=\"YToxOntzOjEwOiJjb252ZXJ0a2l0IjtzOjc6IjUwMDA4OTAiO30=\" type=\"hidden\"></form></div></div></div></div></div></div></div></div></div></div></div><span class=\"seperator extralight-border\"></span></section></div></div></div><footer class=\"container_wrap socket_color\" id=\"socket\" role=\"contentinfo\" itemscope=\"itemscope\" itemtype=\"https://schema.org/WPFooter\"><div class=\"container\"> <span class=\"copyright\">© 2018 Strumenta | <a href=\"https://strumenta.com/privacy-policy/\">Privacy Policy of Strumenta Websites</a></span><ul class=\"noLightbox social_bookmarks icon_count_4\"><li class=\"social_bookmarks_twitter av-social-link-twitter social_icon_1\"><a target=\"_blank\" aria-label=\"Link to Twitter\" href=\"https://twitter.com/ftomasse\" aria-hidden=\"true\" data-av_icon=\"\" data-av_iconfont=\"entypo-fontello\" title=\"Twitter\"><span class=\"avia_hidden_link_text\">Twitter</span></a></li><li class=\"social_bookmarks_linkedin av-social-link-linkedin social_icon_2\"><a target=\"_blank\" aria-label=\"Link to Linkedin\" href=\"https://ie.linkedin.com/in/federicotomassetti\" aria-hidden=\"true\" data-av_icon=\"\" data-av_iconfont=\"entypo-fontello\" title=\"Linkedin\"><span class=\"avia_hidden_link_text\">Linkedin</span></a></li><li class=\"social_bookmarks_mail av-social-link-mail social_icon_3\"><a aria-label=\"Link to Mail\" href=\"mailto:federico@tomassetti.me\" aria-hidden=\"true\" data-av_icon=\"\" data-av_iconfont=\"entypo-fontello\" title=\"Mail\"><span class=\"avia_hidden_link_text\">Mail</span></a></li><li class=\"social_bookmarks_rss av-social-link-rss social_icon_4\"><a aria-label=\"Link to Rss this site\" href=\"https://tomassetti.me/feed/\" aria-hidden=\"true\" data-av_icon=\"\" data-av_iconfont=\"entypo-fontello\" title=\"Rss\"><span class=\"avia_hidden_link_text\">Rss</span></a></li></ul></div></footer></div> <a class=\"avia-post-nav avia-post-prev with-image\" href=\"https://tomassetti.me/quick-domain-specific-languages-in-python-with-textx/\"> <span class=\"label iconfont\" aria-hidden=\"true\" data-av_icon=\"\" data-av_iconfont=\"entypo-fontello\"></span> <span class=\"entry-info-wrap\"> <span class=\"entry-info\"> <span class=\"entry-title\">Quick Domain-Specific Languages in Python with textX</span> <span class=\"entry-image\"><img width=\"80\" height=\"80\" src=\"data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2080%2080'%3E%3C/svg%3E\" class=\"attachment-thumbnail size-thumbnail wp-post-image\" alt=\"\" data-lazy-srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Quick-Domain-Specific-Languages-in-Python-with-textX-2-80x80.jpg 80w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Quick-Domain-Specific-Languages-in-Python-with-textX-2-36x36.jpg 36w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Quick-Domain-Specific-Languages-in-Python-with-textX-2-180x180.jpg 180w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Quick-Domain-Specific-Languages-in-Python-with-textX-2-120x120.jpg 120w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Quick-Domain-Specific-Languages-in-Python-with-textX-2-450x450.jpg 450w\" data-lazy-sizes=\"(max-width: 80px) 100vw, 80px\" data-lazy-src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Quick-Domain-Specific-Languages-in-Python-with-textX-2-80x80.jpg\"><noscript><img width=\"80\" height=\"80\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Quick-Domain-Specific-Languages-in-Python-with-textX-2-80x80.jpg\" class=\"attachment-thumbnail size-thumbnail wp-post-image\" alt=\"\" srcset=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Quick-Domain-Specific-Languages-in-Python-with-textX-2-80x80.jpg 80w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Quick-Domain-Specific-Languages-in-Python-with-textX-2-36x36.jpg 36w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Quick-Domain-Specific-Languages-in-Python-with-textX-2-180x180.jpg 180w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Quick-Domain-Specific-Languages-in-Python-with-textX-2-120x120.jpg 120w, https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/04/Quick-Domain-Specific-Languages-in-Python-with-textX-2-450x450.jpg 450w\" sizes=\"(max-width: 80px) 100vw, 80px\" /></noscript></span> </span> </span></a></div> <a href=\"#top\" title=\"Scroll to top\" id=\"scroll-top-link\" aria-hidden=\"true\" data-av_icon=\"\" data-av_iconfont=\"entypo-fontello\"><span class=\"avia_hidden_link_text\">Scroll to top</span></a><div id=\"fb-root\"></div><div class=\"avia-cookie-consent avia-cookiemessage-bottom-left\"><div class=\"container\"><p class=\"avia_cookie_text\">This site uses cookies. By continuing to browse the site, you are agreeing to our use of cookies.</p> <a href=\"https://strumenta.com/privacy-policy\" class=\"avia-button avia-cookie-consent-button avia-cookie-consent-button-1 av-extra-cookie-btn\">Privacy Policy of Strumenta Websites</a><a href=\"#\" class=\"avia-button avia-cookie-consent-button avia-cookie-consent-button-2 avia-cookie-close-bar \" data-contents=\"a6fe7a635a3ae90b600d28d9abace894\">OK</a></div></div> <script>function aggiungiAttributiAnalytics() {\n        var fakeurl = document.URL;\n        if(document.location.search.length > 0)\n        {\n            let params = new URLSearchParams(document.location.search.substring(1));    \n            fakeurl = params.get(\"da\");\n        }\n\tga('send', {\n\t\thitType: 'event',\n\t\teventCategory: 'Link',\n\t\teventAction: 'click',\n\t\teventLabel: this.textContent,\n\t\tdimension1: fakeurl,\n\t\tdimension2: this.href,\n\t\ttransport: 'beacon'\n\t});\n}\n\n// aggiungi attributi ai link per tracciamento\nfor (var ls = document.getElementsByTagName(\"a\"), numLinks = ls.length, i=0; i<numLinks; i++){    \n        ls[i].addEventListener(\"click\", aggiungiAttributiAnalytics, false);\n\tls[i].addEventListener(\"auxclick\", aggiungiAttributiAnalytics, false);\n\tls[i].addEventListener(\"contextmenu\", aggiungiAttributiAnalytics, false);\n}\n\nfor (var lsb = document.getElementsByTagName(\"button\"), numLinks = lsb.length, i=0; i<numLinks; i++){    \n        lsb[i].addEventListener(\"click\", aggiungiAttributiAnalytics, false);\n\tlsb[i].addEventListener(\"auxclick\", aggiungiAttributiAnalytics, false);\n\tlsb[i].addEventListener(\"contextmenu\", aggiungiAttributiAnalytics, false);\n}\n\nfunction track_checkout(price, item) {\n    fbq('track', 'InitiateCheckout', {\n      content_name: item,\n      value: price,\n      currency: 'USD'\n    });\n}\n// aggiungi tracciamento delle riproduzioni audio\njQuery(\"#amazon-ai-player\").on(\"play\", function (e) {\n    ga('send', {\n        hitType: 'event',\n        eventCategory: 'Audio',\n        eventAction: 'play',\n        eventLabel: document.title.substr(0, document.title.search(\" - Federico Tomassetti\"))\n    });\n});\n\n// Find all YouTube and Vimeo videos\nvar allVideos = jQuery(\"iframe[src*='//player.vimeo.com'], iframe[src*='//www.youtube.com']\"),\n\n    // The element that is fluid width\n    fluidEl = jQuery(\"body\");\n\n// Figure out and save aspect ratio for each video\nallVideos.each(function() {\n  jQuery(this)\n    .data('aspectRatio', this.height / this.width)\n\n    // and remove the hard coded width/height\n    .removeAttr('height')\n    .removeAttr('width');\n\n});\n\n// When the window is resized\njQuery(window).resize(function() {\n\n  var newWidth = fluidEl.width();\n\n  // Resize all videos according to their own aspect ratio\n  allVideos.each(function() {\n\n    var el = jQuery(this);\n    el\n      .width(newWidth)\n      .height(newWidth * el.data('aspectRatio'));\n\n  });\n\n// Kick off one resize to fix all videos on page load\n}).resize();</script> <div id=\"sb_super_bar\" class=\"orange\" style=\"display: none;\"><div class=\"sbprogress-container\"><span class=\"sbprogress-bar\" style=\"width: 1.00134%;\"></span></div><div id=\"sb_main_bar\"><div class=\"sb_text-size\"> <a href=\"https://tomassetti.me/category/language-engineering/antlr/\">ANTLR</a></div><div class=\"sb_post-data\"><h2> Parsing SQL</h2> <span class=\"sb_author\">by Gabriele Tomassetti</span> <span class=\"sb_ttr\">time to read: 22 min</span></div><div class=\"sb_prev-next-posts\"> <a href=\"https://tomassetti.me/why-you-should-not-use-flex-yacc-and-bison/\"><i class=\"sbicn-left-open-1\"></i></a><div class=\"sb_next_post\"><div class=\"sb_next_post_image\"> <img src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/03/Why-you-should-not-use-flex-yacc-and-bison-205x155.jpg\" alt=\"\" data-lazy-src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/03/Why-you-should-not-use-flex-yacc-and-bison-205x155.jpg\" class=\"lazyloaded\" data-was-processed=\"true\"><noscript><img src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/uploads/2020/03/Why-you-should-not-use-flex-yacc-and-bison-205x155.jpg\" alt=\"\"></noscript></div><div class=\"sb_next_post_info\"> <span class=\"sb_title\"> <span class=\"sb_category\"> Application modernization </span> <span class=\"sb_tcategory\"> Why you should not use (f)lex, yacc and bison </span> </span></div></div></div><ul class=\"sb_share \"><li class=\"sbfacebook\"> <a href=\"#\" title=\"Share on Facebook\" class=\"sbsoc-fb\" target=\"_blank\"><i class=\"sbicn-facebook\"></i> </a></li><li class=\"sbtwitter\"> <a href=\"#\" data-via=\"\" data-title=\"Parsing SQL\" title=\"Share on Twitter\" class=\"sbsoc-tw\" target=\"_blank\"><i class=\"sbicn-twitter\"></i> </a></li><li class=\"sblinkedin\"> <a href=\"#\" title=\"Share on Linkedin\" class=\"sbsoc-linked\" target=\"_blank\"><i class=\"sbicn-linkedin\"></i> </a></li></ul></div></div> <script type=\"text/javascript\">/* <![CDATA[ */ var avia_framework_globals = avia_framework_globals || {};\n    avia_framework_globals.frameworkUrl = 'https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/themes/enfold/framework/';\n    avia_framework_globals.installedAt = 'https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/themes/enfold/';\n    avia_framework_globals.ajaxurl = 'https://tomassetti.me/wp-admin/admin-ajax.php'; /* ]]> */</script> <div class=\"tve-leads-slide-in tve-tl-anim tve-leads-track-slide_in-136 tl-anim-slide_right tl_bot_right tve-trigger-hide\"><div class=\"tl-style\" id=\"tve_tcb2_overlayed-patterns-1-step\" data-state=\"136\" data-form-state=\"\"><style type=\"text/css\" class=\"tve_custom_style\">@import url(\"//fonts.googleapis.com/css?family=Cabin:400,600,700,500&subset=latin\");@import url(\"//fonts.googleapis.com/css?family=Allerta+Stencil:400,&subset=latin\");@media (min-width: 300px){:not(#tve) [data-css=\"tve-u-185cadb3c8624cf\"] strong { font-weight: 600; }[data-css=\"tve-u-35cadb3c862135\"] h3 { margin: 0px !important; padding: 0px !important; }[data-css=\"tve-u-35cadb3c862135\"] h2 { margin: 0px !important; padding: 0px !important; }[data-css=\"tve-u-35cadb3c862135\"] h1 { margin: 0px !important; padding: 0px !important; }[data-css=\"tve-u-35cadb3c862135\"] p { margin: 0px !important; padding: 0px !important; }[data-css=\"tve-u-05cadb3c86207a\"] { padding: 15px 0px 15px 15px !important; max-width: 720px !important; background-color: rgba(222, 222, 222, 0.01) !important; }:not(#tve) [data-css=\"tve-u-175cadb3c862493\"]:hover input { border-bottom: 1px solid rgba(255, 255, 255, 0.8) !important; }:not(#tve) [data-css=\"tve-u-185cadb3c8624cf\"]:hover button { border-color: rgb(255, 255, 255) !important; background-image: repeating-radial-gradient(circle at center center, rgba(244, 67, 54, 0.4), rgba(244, 67, 54, 0.4) 1px, transparent 1px, transparent 100%) !important; background-size: 3px 3px !important; background-position: 50% 50% !important; background-attachment: scroll !important; background-repeat: repeat !important; }:not(#tve) [data-css=\"tve-u-185cadb3c8624cf\"] button { border-color: rgb(255, 255, 255); color: rgb(244, 67, 54); font-family: Cabin; font-weight: 700; font-size: 16px; line-height: 1.12em; letter-spacing: 2px; background-image: none !important; background-color: rgb(255, 255, 255) !important; margin: 0px !important; }:not(#tve) [data-css=\"tve-u-175cadb3c862493\"] input { border-color: currentcolor currentcolor rgb(255, 255, 255); border-style: none none solid; border-width: medium medium 1px; border-image: initial; font-family: Cabin; font-weight: 400; font-size: 18px; letter-spacing: 1px; line-height: 1.12em; background-image: none !important; margin-top: 0px !important; background-color: rgba(233, 236, 239, 0) !important; }:not(#tve) [data-css=\"tve-u-175cadb3c862493\"] input, :not(#tve) [data-css=\"tve-u-175cadb3c862493\"] input::placeholder { color: rgb(255, 255, 255) !important; }[data-css=\"tve-u-165cadb3c862456\"] { float: none; margin: 0px auto !important; padding: 0px !important; }[data-css=\"tve-u-85cadb3c862272\"] { margin-bottom: 0px !important; background-image: linear-gradient(rgb(19, 19, 19), rgb(19, 19, 19)) !important; background-size: auto !important; background-position: 50% 50% !important; background-attachment: scroll !important; background-repeat: no-repeat !important; padding-right: 0px !important; }[data-css=\"tve-u-95cadb3c8622af\"] img { filter: grayscale(0%) blur(0px); opacity: 1; }[data-css=\"tve-u-115cadb3c862327\"] { padding: 40px 40px 0px 0px !important; margin-top: 0px !important; }[data-css=\"tve-u-105cadb3c8622eb\"] { max-width: 61.9%; }[data-css=\"tve-u-75cadb3c862236\"] { max-width: 38.1%; }[data-css=\"tve-u-55cadb3c8621ad\"] { margin: 0px !important; }[data-css=\"tve-u-65cadb3c8621f4\"] { margin-left: -44px; padding: 0px !important; }[data-css=\"tve-u-65cadb3c8621f4\"] > .tcb-flex-col { padding-left: 44px; }[data-css=\"tve-u-95cadb3c8622af\"] { width: 240px; top: 70px; box-shadow: none; left: 0px; margin-top: 0px !important; margin-bottom: 0px !important; padding-top: 0px !important; display: block; }[data-css=\"tve-u-35cadb3c862135\"] { min-height: 265px !important; }[data-css=\"tve-u-25cadb3c8620f9\"] { background-color: rgb(19, 19, 19) !important; background-image: linear-gradient(rgb(19, 19, 19), rgb(19, 19, 19)) !important; background-size: auto !important; background-position: 50% 50% !important; background-attachment: scroll !important; background-repeat: no-repeat !important; }[data-css=\"tve-u-15cadb3c8620bc\"] { padding: 0px 0px 50px !important; margin-top: 0px !important; }[data-css=\"tve-u-155cadb3c86241a\"] { line-height: 1.4em !important; }[data-css=\"tve-u-145cadb3c8623db\"] { padding: 0px !important; margin-bottom: 20px !important; }:not(#tve) [data-css=\"tve-u-155cadb3c86241a\"] { color: rgb(156, 156, 156) !important; font-family: Cabin !important; font-weight: 400 !important; font-size: 16px !important; }[data-css=\"tve-u-135cadb3c86239f\"] { line-height: 1.2em !important; }:not(#tve) [data-css=\"tve-u-135cadb3c86239f\"] { font-family: \"Allerta Stencil\" !important; font-weight: 400 !important; color: rgb(255, 255, 255) !important; font-size: 26px !important; }[data-css=\"tve-u-125cadb3c862363\"] { max-width: 438px; float: none; padding: 0px !important; margin-bottom: 20px !important; margin-left: auto !important; margin-right: auto !important; }:not(#tve) [data-css=\"tve-u-45cadb3c862171\"]:hover > :first-child { color: rgb(244, 67, 54) !important; }:not(#tve) [data-css=\"tve-u-45cadb3c862171\"]:hover { background-image: linear-gradient(rgba(1, 1, 1, 0.5), rgba(1, 1, 1, 0.5)) !important; background-size: auto !important; background-position: 0px 0px !important; background-attachment: scroll !important; background-repeat: no-repeat !important; }[data-css=\"tve-u-45cadb3c862171\"] { font-size: 14px; width: 14px; height: 14px; color: rgb(255, 255, 255); border: medium none; border-radius: 0px; overflow: hidden; position: absolute; right: 0px; top: 0px; z-index: 10; background-image: linear-gradient(rgba(1, 1, 1, 0.2), rgba(1, 1, 1, 0.2)) !important; padding: 15px !important; background-size: auto !important; background-position: 0px 0px !important; background-attachment: scroll !important; background-repeat: no-repeat !important; margin: 0px !important; }[data-css=\"tve-u-85cadb3c862272\"]::after { clear: both; }}@media (max-width: 1023px){[data-css=\"tve-u-85cadb3c862272\"] { margin: 0px !important; }[data-css=\"tve-u-15cadb3c8620bc\"] { margin-top: 0px !important; }[data-css=\"tve-u-95cadb3c8622af\"] { top: 24px; left: 0px; width: 304px; }}@media (max-width: 767px){[data-css=\"tve-u-25cadb3c8620f9\"] { background-color: rgb(19, 19, 19) !important; }:not(#tve) [data-css=\"tve-u-155cadb3c86241a\"] { font-size: 14px !important; }[data-css=\"tve-u-65cadb3c8621f4\"] { margin-left: 0px; }[data-css=\"tve-u-65cadb3c8621f4\"] > .tcb-flex-col { padding-left: 0px; }:not(#tve) [data-css=\"tve-u-135cadb3c86239f\"] { font-size: 20px !important; }[data-css=\"tve-u-05cadb3c86207a\"] { max-width: 270px !important; padding: 0px !important; background-color: rgba(222, 222, 222, 0.01) !important; }[data-css=\"tve-u-65cadb3c8621f4\"] .tcb-flex-col { flex-basis: 265px !important; }[data-css=\"tve-u-15cadb3c8620bc\"] { margin-top: 0px !important; padding-bottom: 0px !important; }[data-css=\"tve-u-115cadb3c862327\"] { padding: 20px !important; }[data-css=\"tve-u-125cadb3c862363\"] { margin-top: 0px !important; }[data-css=\"tve-u-95cadb3c8622af\"] { width: 100%; left: 0px; top: 0px; }[data-css=\"tve-u-45cadb3c862171\"] { top: 0px; right: 0px; background-image: linear-gradient(rgba(1, 1, 1, 0.48), rgba(1, 1, 1, 0.48)) !important; background-size: auto !important; background-position: 0px 0px !important; background-attachment: scroll !important; background-repeat: no-repeat !important; }}</style><style type=\"text/css\" class=\"tve_global_style\"></style><div class=\"tve-leads-conversion-object\" data-tl-type=\"slide_in\"><div class=\"tve_flt\"><div id=\"tve_editor\" class=\"tve_shortcode_editor\"><div class=\"thrv-leads-slide-in tve_no_drag tve_no_icons thrv_wrapper tve_editor_main_content tve_empty_dropzone\" data-css=\"tve-u-05cadb3c86207a\">\n<div class=\"thrv_wrapper thrv-page-section\" data-css=\"tve-u-15cadb3c8620bc\">\n<div class=\"tve-page-section-out\" data-css=\"tve-u-25cadb3c8620f9\"></div>\n<div class=\"tve-page-section-in tve_empty_dropzone\" data-css=\"tve-u-35cadb3c862135\"><div class=\"thrv_wrapper thrv_icon tcb-icon-display tve_evt_manager_listen tve_et_click tve_ea_thrive_leads_form_close\" data-css=\"tve-u-45cadb3c862171\" data-tcb-events=\"__TCB_EVENT_[{&quot;a&quot;:&quot;thrive_leads_form_close&quot;,&quot;t&quot;:&quot;click&quot;}]_TNEVE_BCT__\" data-tcb_hover_state_parent=\"\" data-float=\"1\">\n<svg class=\"tcb-icon\" viewBox=\"0 0 30 32\" data-name=\"close\">\n<path d=\"M0.655 2.801l1.257-1.257 27.655 27.655-1.257 1.257-27.655-27.655z\"></path>\n<path d=\"M28.31 1.543l1.257 1.257-27.655 27.655-1.257-1.257 27.655-27.655z\"></path>\n</svg>\n</div><div class=\"thrv_wrapper thrv-columns\" data-css=\"tve-u-55cadb3c8621ad\"><div class=\"tcb-flex-row tcb-resized v-2 tcb--cols--2\" data-css=\"tve-u-65cadb3c8621f4\"><div class=\"tcb-flex-col\" data-css=\"tve-u-75cadb3c862236\" style=\"\"><div class=\"tcb-col tve_empty_dropzone\" data-css=\"tve-u-85cadb3c862272\"><div class=\"thrv_wrapper tve_image_caption\" data-css=\"tve-u-95cadb3c8622af\"><span class=\"tve_image_frame\" style=\"width: 100%;\"><img class=\"tve_image\" alt=\"Creating a Programming Language\" title=\"Creating a Programming Language\" data-id=\"4854\" src=\"https://tomassetti.me/wp-content/uploads/2018/09/creating-programming-language-640.jpg\" style=\"width: 100%;\" scale=\"0\" width=\"640\" height=\"800\"></span></div></div></div><div class=\"tcb-flex-col\" data-css=\"tve-u-105cadb3c8622eb\" style=\"\"><div class=\"tcb-col tve_empty_dropzone\" data-css=\"tve-u-115cadb3c862327\"><div class=\"thrv_wrapper thrv_heading\" data-tag=\"h2\" data-css=\"tve-u-125cadb3c862363\"><h2 data-css=\"tve-u-135cadb3c86239f\" style=\"text-align: center;\">​Learn to Create Programming Languages</h2></div><div class=\"thrv_wrapper thrv_text_element tve_empty_dropzone\" data-css=\"tve-u-145cadb3c8623db\"><p data-css=\"tve-u-155cadb3c86241a\" style=\"text-align: center;\">Subscribe to ​our ​newsletter to get the FREE email course that teaches you how to create a programming language<br></p></div><div class=\"thrv_wrapper thrv_lead_generation\" data-connection=\"api\" data-css=\"tve-u-165cadb3c862456\"><input type=\"hidden\" class=\"tve-lg-err-msg\" value=\"{&quot;email&quot;:&quot;Email address invalid&quot;,&quot;phone&quot;:&quot;Phone number invalid&quot;,&quot;password&quot;:&quot;Password invalid&quot;,&quot;passwordmismatch&quot;:&quot;Password mismatch error&quot;,&quot;required&quot;:&quot;Required field missing&quot;}\">\n<div class=\"thrv_lead_generation_container tve_clearfix\">\n<form action=\"#\" method=\"post\" novalidate=\"novalidate\">\n<div class=\"tve_lead_generated_inputs_container tve_clearfix tve_empty_dropzone\">\n<div class=\"tve_lg_input_container tve_lg_input\" data-css=\"tve-u-175cadb3c862493\" data-tcb_hover_state_parent=\"\">\n<input type=\"email\" data-field=\"email\" data-required=\"1\" data-validation=\"email\" name=\"email\" placeholder=\"Email\" data-placeholder=\"Email\" class=\"\">\n</div>\n<div class=\"tve_lg_input_container tve_submit_container tve_lg_submit\" data-css=\"tve-u-185cadb3c8624cf\" data-tcb_hover_state_parent=\"\">\n<button type=\"submit\" class=\"tve-froala\">I want to create programming languages</button>\n</div>\n</div>\n<input id=\"_submit_option\" type=\"hidden\" name=\"_submit_option\" value=\"redirect\"><input id=\"_back_url\" type=\"hidden\" name=\"_back_url\" value=\"https://tomassetti.me/thank-you\"><input id=\"_autofill\" type=\"hidden\" name=\"_autofill\" value=\"\"><input type=\"hidden\" name=\"__tcb_lg_fc\" id=\"__tcb_lg_fc\" value=\"YToxOntzOjEwOiJjb252ZXJ0a2l0IjtzOjY6IjQ0Mjg1NyI7fQ==\"></form>\n</div>\n</div></div></div></div></div></div>\n</div></div></div></div></div></div></div><script data-minify=\"1\" type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/js/avia-93d6ec4cf60db7cca150d7e0ad8aa2f7.js\" defer=\"\"></script> <script data-minify=\"1\" type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/js/shortcodes-a99528795d03cc2b63fdc255d187a939.js\" defer=\"\"></script> <script data-minify=\"1\" type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/contact/contact-f1cc2fdbf0ca4a2c3a4d22b591d5b71c.js\" defer=\"\"></script> <script data-minify=\"1\" type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/countdown/countdown-692361e31cf26adda95ef748d233cac2.js\" defer=\"\"></script> <script data-minify=\"1\" type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/gallery/gallery-c6f142774af7f32ecc5221618be6378f.js\" defer=\"\"></script> <script data-minify=\"1\" type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/iconlist/iconlist-49208438ba015017defa07c846d67e90.js\" defer=\"\"></script> <script data-minify=\"1\" type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/magazine/magazine-c8e42a67fb6deb1a8f1e6fa391ca14f2.js\" defer=\"\"></script> <script data-minify=\"1\" type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/slideshow/slideshow-4e2ef8a1b5c521040e13ed8bbbfa186e.js\" defer=\"\"></script> <script data-minify=\"1\" type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/slideshow/slideshow-video-ac90ef645ad034c5eefab66fa6a89b34.js\" defer=\"\"></script> <script data-minify=\"1\" type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/slideshow_layerslider/slideshow_layerslider-afc64a1e242444c675746481007edd51.js\" defer=\"\"></script> <script data-minify=\"1\" type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/tabs/tabs-7107ae0aa394534972c3ba2fba1386b6.js\" defer=\"\"></script> <script data-minify=\"1\" type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/testimonials/testimonials-a34346ab10d70074aaa423412acaeea4.js\" defer=\"\"></script> <script data-minify=\"1\" type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/video/video-8ea131869a7170637e7179f41919b89f.js\" defer=\"\"></script> <script type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/busting/1/wp-includes/js/imagesloaded.min-3.2.0.js\" defer=\"\"></script> <script type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/busting/1/wp-includes/js/masonry.min-3.3.2.js\" defer=\"\"></script> <script type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/busting/1/wp-includes/js/jquery/jquery.masonry.min-3.1.2b.js\" defer=\"\"></script> <script type=\"text/javascript\">/* <![CDATA[ */ var tve_frontend_options = {\"is_editor_page\":\"\",\"page_events\":[],\"is_single\":\"1\",\"ajaxurl\":\"https:\\/\\/tomassetti.me\\/wp-admin\\/admin-ajax.php\",\"social_fb_app_id\":\"\",\"dash_url\":\"https:\\/\\/tomassetti.me\\/wp-content\\/plugins\\/thrive-leads\\/thrive-dashboard\",\"translations\":{\"Copy\":\"Copy\"},\"post_id\":\"6033\",\"ip\":\"116.153.38.252\",\"current_user\":[],\"post_title\":\"Parsing SQL\",\"post_type\":\"post\",\"post_url\":\"https:\\/\\/tomassetti.me\\/parsing-sql\\/\",\"is_lp\":\"\",\"post_request_data\":[]}; /* ]]> */</script> <script type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/busting/1/wp-content/plugins/thrive-leads/tcb/editor/js/dist/frontend.min-2.5.2.2.js\" defer=\"\"></script> <script type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/busting/1/wp-content/plugins/thrive-leads/js/frontend.min-2.2.13.2.js\" defer=\"\"></script> <script type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/busting/1/wp-content/themes/enfold/js/aviapopup/jquery.magnific-popup.min-4.5.7.js\" defer=\"\"></script> <script data-minify=\"1\" type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/js/avia-snippet-lightbox-af571128e5a33c2149c945f8f248ec6e.js\" defer=\"\"></script> <script data-minify=\"1\" type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/js/avia-snippet-sticky-header-0003c940c03fb51010c9767adb23a28b.js\" defer=\"\"></script> <script data-minify=\"1\" type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/js/avia-snippet-cookieconsent-d28d2866b8e8786beac2ca70e78174f7.js\" defer=\"\"></script> <script data-minify=\"1\" type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/js/avia-snippet-widget-3775c407ef28ce425c794ad4be7c563f.js\" defer=\"\"></script> <script type=\"text/javascript\">/* <![CDATA[ */ var tve_dash_front = {\"ajaxurl\":\"https:\\/\\/tomassetti.me\\/wp-admin\\/admin-ajax.php\",\"force_ajax_send\":\"1\",\"is_crawler\":\"\"}; /* ]]> */</script> <script type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/busting/1/wp-content/plugins/thrive-leads/thrive-dashboard/js/dist/frontend.min-2.2.14.2.js\" defer=\"\"></script> <script type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/busting/1/wp-content/plugins/q2w3-fixed-widget/js/q2w3-fixed-widget.min-5.1.9.js\" defer=\"\"></script> <script type=\"text/javascript\" src=\"//cdnjs.cloudflare.com/ajax/libs/mootools/1.6.0/mootools-core.min.js\"></script> <script type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/busting/1/wp-content/plugins/enlighter/resources/EnlighterJS.min-3.11.0.js\" defer=\"\"></script> <script data-minify=\"1\" type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/plugins/enlighter/cache/EnlighterJS.init-08b8fc7f4497d8570568ea2382b711c3.js\" defer=\"\"></script> <script data-minify=\"1\" type=\"text/javascript\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/framework/js/conditional_load/avia_google_maps_front-16af321c42711ae8ac9dc4be6671c549.js\" defer=\"\"></script> <script type=\"text/javascript\">var tcb_post_lists=JSON.parse('[]');</script><script type=\"text/javascript\">/* <![CDATA[ */ /*<![CDATA[*/if ( !window.TL_Const ) {var TL_Const={\"security\":\"bd50a1f945\",\"ajax_url\":\"https:\\/\\/tomassetti.me\\/wp-admin\\/admin-ajax.php\",\"forms\":[],\"action_conversion\":\"tve_leads_ajax_conversion\",\"action_impression\":\"tve_leads_ajax_impression\",\"ajax_load\":1,\"main_group_id\":4352,\"display_options\":{\"allowed_post_types\":[],\"flag_url_match\":false},\"shortcode_ids\":[\"4566\"],\"custom_post_data\":[],\"current_screen\":{\"screen_type\":4,\"screen_id\":6033},\"ignored_fields\":[\"email\",\"_captcha_size\",\"_captcha_theme\",\"_captcha_type\",\"_submit_option\",\"_use_captcha\",\"g-recaptcha-response\",\"__tcb_lg_fc\",\"__tcb_lg_msg\",\"_state\",\"_form_type\",\"_error_message_option\",\"_back_url\",\"_submit_option\",\"url\",\"_asset_group\",\"_asset_option\",\"mailchimp_optin\"]};} else {ThriveGlobal.$j.extend(true, TL_Const, {\"security\":\"bd50a1f945\",\"ajax_url\":\"https:\\/\\/tomassetti.me\\/wp-admin\\/admin-ajax.php\",\"forms\":[],\"action_conversion\":\"tve_leads_ajax_conversion\",\"action_impression\":\"tve_leads_ajax_impression\",\"ajax_load\":1,\"main_group_id\":4352,\"display_options\":{\"allowed_post_types\":[],\"flag_url_match\":false},\"shortcode_ids\":[\"4566\"],\"custom_post_data\":[],\"current_screen\":{\"screen_type\":4,\"screen_id\":6033},\"ignored_fields\":[\"email\",\"_captcha_size\",\"_captcha_theme\",\"_captcha_type\",\"_submit_option\",\"_use_captcha\",\"g-recaptcha-response\",\"__tcb_lg_fc\",\"__tcb_lg_msg\",\"_state\",\"_form_type\",\"_error_message_option\",\"_back_url\",\"_submit_option\",\"url\",\"_asset_group\",\"_asset_option\",\"mailchimp_optin\"]})} /*]]> */ /* ]]> */</script><script>(function( $ ) {\n      \"use strict\";\n\t\t$(function() {\n\t\t\tvar $allVideos = $(\"iframe[src^='https://www.youtube.com']\"),\n\t\t\t    // The element that is fluid width\n\t\t\t    $fluidEl = $(\".post-entry-type-standard\");\n\n\t\t\t\t$allVideos.each(function() {\nconsole.log(\"video found\");\n\t\t\t\t\t$(this)\n\t\t\t\t\t\t.data('aspectRatio', this.height / this.width)\n\t\t\t\t\t\t.removeAttr('height')\n\t\t\t\t\t\t.removeAttr('width')\n\t\t\t\t\t    .removeAttr('style');\n\n\t\t\t\t});\n\n\t\t\t\t$(window).resize(function() {\n\n\t\t\t\t\tvar newWidth = $fluidEl.width();\n\t\t\t\t\tvar newHeight = 0;\n\t\t\t\t\tif(newWidth < 426)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewWidth = 426;\n\t\t\t\t\t\tnewHeight = 240;\n\t\t\t\t\t}\n\t\t\t\t\telse if(newWidth >= 426 && newWidth < 640)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewWidth = 426;\n\t\t\t\t\t\tnewHeight = 240;\n\t\t\t\t\t}\t\t\t\t\t\n\t\t\t\t\telse if(newWidth >= 640 && newWidth < 768)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewWidth = 640;\n\t\t\t\t\t\tnewHeight = 360;\n\t\t\t\t\t}\t\t\t\t\t\n\t\t\t\t\telse if(newWidth >= 768 && newWidth < 800)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewWidth = 768;\n\t\t\t\t\t\tnewHeight = 432;\n\t\t\t\t\t}\n\t\t\t\t\telse if(newWidth >= 800 && newWidth < 960)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewWidth = 800;\n\t\t\t\t\t\tnewHeight = 450;\n\t\t\t\t\t}\n\t\t\t\t\telse if(newWidth >= 960 && newWidth < 1024)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewWidth = 960;\n\t\t\t\t\t\tnewHeight = 540;\n\t\t\t\t\t}\n\t\t\t\t\telse if(newWidth >= 1024 && newWidth < 1280)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewWidth = 1024;\n\t\t\t\t\t\tnewHeight = 576;\n\t\t\t\t\t}\n\t\t\t\t\telse if(newWidth >= 1280 && newWidth < 1366)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewWidth = 1280;\n\t\t\t\t\t\tnewHeight = 720;\n\t\t\t\t\t}\n\t\t\t\t\telse if(newWidth >= 1366 && newWidth < 1600)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewWidth = 1366;\n\t\t\t\t\t\tnewHeight = 768;\n\t\t\t\t\t}\n\t\t\t\t\telse if(newWidth >= 1600 && newWidth < 1920)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewWidth = 1600;\n\t\t\t\t\t\tnewHeight = 900;\n\t\t\t\t\t}\n\t\t\t\t\telse if(newWidth >= 1920)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewWidth = 1920;\n\t\t\t\t\t\tnewHeight = 1080;\n\t\t\t\t\t}\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t$allVideos.each(function() {\n\n\t\t\t\t\t\tvar $el = $(this);\n\t\t\t\t\t\t$el\n\t\t\t\t\t\t\t.width(newWidth)\n\t\t\t\t\t\t\t.height(newWidth / 16 * 10);\n\t\t\t\t\t});\n\t\t\t\t}).resize();\n\t\t});\n  }(jQuery));</script> <script>if(document.cookie.match(/aviaPrivacyGoogleTrackingDisabled/)){ window['ga-disable-UA-11421555-5'] = true; }</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\nm=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\n\nga('create', 'UA-11421555-5', 'auto', {'allowLinker': true});\nga(function(tracker) {\n      window.cid = tracker.get('clientId');\n});\nga('require', 'linker');\nga('linker:autoLink', ['strumenta.com', 'gumroad.com'] ); \n\n// anonimizza ip per ottemperare leggi privacy\nga('set', 'anonymizeIp', true);\n\n// invia visita come solito\nfunction delayGALoad(){\n   if(window.cid !== undefined){\n       ga('send', 'pageview',{'dimension4':  window.cid});\n   }else{\n       setTimeout(delayGALoad,50)\n   }\n}\ndelayGALoad();</script><script type=\"text/javascript\" src=\"https://stats.wp.com/e-202017.js\" async=\"async\" defer=\"defer\"></script> <script type=\"text/javascript\">_stq = window._stq || [];\n\t_stq.push([ 'view', {v:'ext',j:'1:8.4.2',blog:'70090124',post:'6033',tz:'2',srv:'tomassetti.me'} ]);\n\t_stq.push([ 'clickTrackerInit', '70090124', '6033' ]);</script> <script>window.lazyLoadOptions={elements_selector:\"img[data-lazy-src],.rocket-lazyload\",data_src:\"lazy-src\",data_srcset:\"lazy-srcset\",data_sizes:\"lazy-sizes\",class_loading:\"lazyloading\",class_loaded:\"lazyloaded\",threshold:300,callback_loaded:function(element){if(element.tagName===\"IFRAME\"&&element.dataset.rocketLazyload==\"fitvidscompatible\"){if(element.classList.contains(\"lazyloaded\")){if(typeof window.jQuery!=\"undefined\"){if(jQuery.fn.fitVids){jQuery(element).parent().fitVids()}}}}}};window.addEventListener('LazyLoad::Initialized',function(e){var lazyLoadInstance=e.detail.instance;if(window.MutationObserver){var observer=new MutationObserver(function(mutations){var image_count=0;var iframe_count=0;var rocketlazy_count=0;mutations.forEach(function(mutation){for(i=0;i<mutation.addedNodes.length;i++){if(typeof mutation.addedNodes[i].getElementsByTagName!=='function'){return}\nif(typeof mutation.addedNodes[i].getElementsByClassName!=='function'){return}\nimages=mutation.addedNodes[i].getElementsByTagName('img');is_image=mutation.addedNodes[i].tagName==\"IMG\";iframes=mutation.addedNodes[i].getElementsByTagName('iframe');is_iframe=mutation.addedNodes[i].tagName==\"IFRAME\";rocket_lazy=mutation.addedNodes[i].getElementsByClassName('rocket-lazyload');image_count+=images.length;iframe_count+=iframes.length;rocketlazy_count+=rocket_lazy.length;if(is_image){image_count+=1}\nif(is_iframe){iframe_count+=1}}});if(image_count>0||iframe_count>0||rocketlazy_count>0){lazyLoadInstance.update()}});var b=document.getElementsByTagName(\"body\")[0];var config={childList:!0,subtree:!0};observer.observe(b,config)}},!1)</script><script data-no-minify=\"1\" async=\"\" src=\"https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/plugins/wp-rocket/assets/js/lazyload/12.0/lazyload.min.js\"></script><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-grid-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/css/grid-e7f86a4957050d86bbdde2be4b2e329c.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-base-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/css/base-9ee43dd72bee9b2e9372a5d41dfb2cfd.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-layout-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/css/layout-9d9e2151e6dfc7e5f9e836d3932cd249.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-blog-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/blog/blog-18576e4bf2a5d29be26c86a7d9e1c867.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-postslider-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/postslider/postslider-989c704f7f2a809af837b8e670cd0853.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-button-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/buttons/buttons-134ef1e4b4f1459379c2fc85ac863cbe.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-buttonrow-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/buttonrow/buttonrow-e2c888d48bc63472adaaa4f495043db6.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-button-fullwidth-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/buttons_fullwidth/buttons_fullwidth-254d86a461616beaf79576d06cd34c20.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-catalogue-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/catalogue/catalogue-adbb6d96c9a1738e54bee68a79d32810.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-comments-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/comments/comments-8df61ebd5ffecb3e3d2e0f8dfdba3021.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-contact-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/contact/contact-0f3a49a8560a6238f55c9d2127ffeb76.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-countdown-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/countdown/countdown-7afa04e6b150c054d2c4789014570bac.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-gallery-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/gallery/gallery-7700f83f6eb0be9afd295fd2e1293fea.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-gridrow-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/grid_row/grid_row-a75f88bea377b403e886c709b5ad57cf.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-heading-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/heading/heading-b7dddd1ef4275029a57b9a1517182880.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-hr-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/hr/hr-be01ac5c2ab2e5bdbcfbf150e32877e0.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-icon-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/icon/icon-da0406313b8462d480e535bb05f5f50c.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-iconlist-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/iconlist/iconlist-6088b3605f42a243a31c7547c92e7daa.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-image-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/image/image-2da44520fb6135c9345d7a3f78d7f638.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-magazine-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/magazine/magazine-fc5022a0047a03c485f988cd70381467.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-promobox-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/promobox/promobox-0d9df544506622d9978fcde68065845b.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-slideshow-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/slideshow/slideshow-dba83fd5b8d30bff2fd33416275f9c68.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-slideshow-fullsize-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/slideshow_fullsize/slideshow_fullsize-fe118d93c104a09fe9cb8f20f63dadb2.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-slideshow-ls-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/slideshow_layerslider/slideshow_layerslider-a349afb13837bc36afbd868e155babf0.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-social-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/social_share/social_share-e981254c3b50efafac2cc9a1c1b9c905.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-tabs-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/tabs/tabs-a7a217b2cdef7d7317f82ac3ff818c81.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-testimonials-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/testimonials/testimonials-6b29171c1f09c44f76fc7f3b18ff6b98.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-module-video-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/config-templatebuilder/avia-shortcodes/video/video-907cc2ae456a4fc8839931e64a286834.css' type='text/css' media='all' /></noscript><noscript><link rel='stylesheet' id='wp-block-library-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='fi_buttons-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/plugins/feedly-insight/css/fi-buttons-deprecated-25fa38b71a8609678b12c06dbaad2860.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='sb_bar-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/plugins/swifty-bar/public/assets/css/sb-bar-public-bf0134b2d24b0c6e4e6b5423991a6d0f.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='tve_style_family_tve_flt-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/plugins/thrive-leads/tcb/editor/css/thrive_flat-3a109a78ff4eac71f3856ec4009d4665.css' type='text/css' media='all' /></noscript><noscript><link rel='stylesheet' id='tve_leads_forms-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/busting/1/wp-content/plugins/thrive-leads/editor-layouts/css/frontend-2.2.13.2.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-scs-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/css/shortcodes-143bf9025df50d4ca3f24aae5b70c92b.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-popup-css-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/js/aviapopup/magnific-popup-3aba24496166b48da31e47e534851e67.css' type='text/css' media='screen' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-lightbox-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/css/avia-snippet-lightbox-64cad3d2c9d77d18b77c1cf70633f581.css' type='text/css' media='screen' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-cookie-css-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/css/avia-snippet-cookieconsent-bedea0a358c588d449bdd7c4f95a5996.css' type='text/css' media='screen' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-widget-css-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/css/avia-snippet-widget-3bb4c2bac224a946f94a272008eeb881.css' type='text/css' media='screen' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-dynamic-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/uploads/dynamic_avia/tomassetti-214e93ce18069c712a9bbe7dca72a848.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-custom-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/enfold/css/custom-ea2bb2e63ecf88c9937492e1706413c4.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='avia-style-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/themes/tomassetti/style-b224b5538d82adcffaed3add5922da9b.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='easy_table_style-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/plugins/easy-table/themes/default/style-61380df45b9199a4a87f6de0f5c2f6ad.css' type='text/css' media='all' /></noscript><noscript><link rel='stylesheet' id='enlighter-local-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/busting/1/wp-content/plugins/enlighter/resources/EnlighterJS.min-3.11.0.css' type='text/css' media='all' /></noscript><noscript><link data-minify=\"1\" rel='stylesheet' id='jetpack_css-css' href='https://mk0tuzolorusfnc7thxk.kinstacdn.com/wp-content/cache/min/1/wp-content/plugins/jetpack/css/jetpack-cb9b5a4a54629bc9e9f25bd878449a45.css' type='text/css' media='all' /></noscript>\n<img src=\"https://pixel.wp.com/g.gif?v=ext&amp;j=1%3A8.4.2&amp;blog=70090124&amp;post=6033&amp;tz=2&amp;srv=tomassetti.me&amp;host=tomassetti.me&amp;ref=&amp;fcp=5454&amp;rand=0.544133571756904\" alt=\":)\" width=\"6\" height=\"5\" id=\"wpstats\"><script type=\"text/javascript\">\n\t(function ($) {\n\tvar event_data = {\"form_id\":\"tve-leads-track-slide_in-136\",\"form_type\":\"slide_in\"},\n\t_percent = 0.2,\n\t$window = $(window);\n\tevent_data.source = 'scroll_percent';\n\t$(function () {\n\tvar _triggered = false,\n\t$element = $(\"#tve_leads_end_content\"),\n\t_check = function () {\n\tif (_triggered) {\n\treturn;\n\t}\n\n\tvar _h = $('body').height() - $window.height();\n\n\tif ($element.length) {\n\t_h = $element.offset().top - $window.height();\n\t}\n\n\tif ($window.scrollTop() / _h >= _percent) {\n\tThriveGlobal.$j(TL_Front).trigger('showform.thriveleads', event_data);\n\t_triggered = true;\n\t}\n\t};\n\t$window.scroll(_check);\n\t_check();\n\t\t/* Chrome has a stupid bug in which it triggers almost simultaneously \"mouseenter\" \"mouseleave\" \"mouseenter\" if the following applies:\n\t - at page load, the cursor is outside the html element\n\t - the user moves the cursor over the html element\n\t */\n\tvar chrome_fix_id = 0,\n\tme = function (e) { /* mouse enter */\n\tclearTimeout(chrome_fix_id);\n\t},\n\tml = function (e) {\n\n\tif (e.clientY <= config.s) {\n\tchrome_fix_id = setTimeout(function () {\n\tif (!_triggered) {\n\tThriveGlobal.$j(TL_Front).trigger('showform.thriveleads', event_data);\n\t_triggered = true;\n\t}\n\tc();\n\t}, 50);\n\t}\n\t},\n\tc = function () { // cancel\n\t$(document).off('mouseenter.exit_intent mouseleave.exit_intent');\n\t},\n\tconfig = { // we can adjust this and the code below to allow users to tweak settings\n\ts: 20 // sensitivity\n\t};\n\t$(document).on('mouseleave.exit_intent', ml)\n\t.on('mouseenter.exit_intent', me);\n\t\t});\n\t})\n(ThriveGlobal.$j);\n</script><script type=\"text/javascript\">\n\t(function ($) {\n\t$(function () {\n\t\tvar event_data = {\"form_id\":\"tve-leads-track-shortcode_4566\",\"form_type\":\"shortcode\"};\n\t\tevent_data.source = 'page_load';\n\t\tsetTimeout(function () {\n\t\t\tThriveGlobal.$j(TL_Front).trigger('showform.thriveleads', event_data);\n\t\t\t}, 200);\n\t\t});\n\t})\n(ThriveGlobal.$j);\n</script><script type=\"text/javascript\">var TVE_Event_Manager_Registered_Callbacks = TVE_Event_Manager_Registered_Callbacks || {};TVE_Event_Manager_Registered_Callbacks.thrive_leads_form_close = function(t, a, c){TL_Front.close_form(this, t, a, c); return false;};</script><link rel=\"stylesheet\" href=\"https://tomassetti.me/wp-admin/load-styles.php?c=1&amp;dir=ltr&amp;load%5Bchunk_0%5D=dashicons,wp-jquery-ui-dialog&amp;ver=5.4\" type=\"text/css\" media=\"all\">\n<link rel=\"stylesheet\" id=\"avia-media-style-css\" href=\"https://tomassetti.me/wp-content/themes/enfold/config-templatebuilder/avia-template-builder/assets/css/avia-media.css?ver=5.4\" media=\"all\">\n<link rel=\"stylesheet\" id=\"post-snippets-icons-css\" href=\"https://tomassetti.me/wp-content/plugins/post-snippets/assets/features.css?ver=3.0.18\" media=\"all\">\n<link rel=\"stylesheet\" id=\"post-snippets-features-css\" href=\"https://tomassetti.me/wp-content/plugins/post-snippets/assets/icons.css?ver=3.0.18\" media=\"all\">\n<link rel=\"stylesheet\" id=\"post-snippets-newsletter-css\" href=\"https://tomassetti.me/wp-content/plugins/post-snippets/assets/newsletter.css?ver=3.0.18\" media=\"all\">\n<link rel=\"stylesheet\" id=\"post-snippets-css\" href=\"https://tomassetti.me/wp-content/plugins/post-snippets/assets/post-snippets.css?ver=3.0.18\" media=\"all\">\n<script type=\"text/javascript\">var tcb_post_lists=JSON.parse('[]');</script>","text":"Blog\nParsing SQL\nApril 15, 2020/in ANTLR, Code processing, Parsing /by Gabriele Tomassetti\n\nYou can find the code presented in this article in the companion repository\n\nSQL is a language to handle data in a relational database. If you worked with data you have probably worked with SQL.\n\nIt is in the same league of HTML: maybe you never learned it formally but you kinda know how to use it. That is great because if you know SQL, you know how to handle data. However, it has limitations and when you hit them your only course of action might be to work with a traditional programming language. This does not necessarily mean migrating away from SQL. You might need to move from one SQL dialect to another one or to analyze the SQL code you use. And to do that, you need to parse SQL, and that is what this article is about.\n\nWhat are the limits of SQL? After a while you learn of a couple of issues:\n\nthere is not one SQL, but many variations of it. The SQLs implemented in SQLite, MySQL, PostgreSQL, etc. are all a bit different\nyou cannot do everything related to data in SQL. In some cases, you need a traditional programming language to work with the data\n\nThese issues became real problems when you need to make big changes. For instance, if you need to change the database used by a large application. It can also be a problem when you need to make transformations that SQL and your database cannot handle them. In that case, you have some transformations done in SQL (and run on the database) and some other in your source code. So you spend a lot of time working on glue code and around the limitations of SQL.\n\nSQL can also be a constraint, simply for what it lacks: unit testing integrated with your source code and all the other tools that you can use with Java, C#, etc. SQL is an old language and not designed for large scale programming, it is not a language that developers will love. Even worse, they will not be very productive with it. And what happens if your application requires you to verify that something gets executed in a certain way, or to offer some guarantees? It can be a business need or a regulatory requirement. Then you need to parse SQL or to find a way to move from SQL world to your programming language world.\n\nThat is what this article is about: parsing SQL. We are going to see ready-to-use libraries and tools to parse SQL, and an example project in which we will build our own SQL parser.\n\nWhat is SQL\n\nSQL (Structured Query Language) is a domain-specific language designed to handle data in relational database. It is a declarative language, so you describe what you want to achieve (e.g., get me a row of data with id=5) and not how to achieve it (e.g. loop through the rows until id=5). It has a formal mathematical foundation in relational algebra and calculus. The language is an ISO/IEC standard that is periodically updated, the latest version is SQL2016. This means that there is a very formal and clear description of the language if you need it.\n\nSQL is designed to handle many aspects of the life cycle of working with data: yes, you can query data, but you can also create the format of data (i.e., the schema of a table) and regulate access control to the data.\n\nSQL Procedural Extensions\n\nActual SQL implementation comes with procedural extensions that implement some form of procedural programming. These are even more varied from database engine to database engine. They were added to perform complex elaborations on the data directly on the database, so they can be as powerful as traditional programming languages. And this can also be an additional headache if you try to parse SQL. See, for instance, this is a PL/SQL (the procedural SQL from Oracle databases) example from Wikipedia.\n\nDECLARE\n    var NUMBER;\nBEGIN\n     /*N.B. for loop variables in pl/sql are new declarations, with scope only inside the loop */\n     FOR var IN 0 .. 10 LOOP\n          DBMS_OUTPUT.PUT_LINE(var);\n     END LOOP;\n     IF (var IS NULL) THEN\n          DBMS_OUTPUT.PUT_LINE('var is null');\n     ELSE\n          DBMS_OUTPUT.PUT_LINE('var is not null');\n     END IF;\nEND;\nResources\n\nAs we have seen handling SQL can be a daunting task, so let’s see a few resources to help you. They range from grammars to kick start your parsing efforts, to ready-to-use tools.\n\nKnowledge\nOfficial Sources\n\nThe latest official SQL standard is formally known as ISO/IEC 9075 SQL:2016. You can find every information you need about it in the official sources either the ISO or IEC websites. However, keep in mind that there are several documents describing the standard and you have to pay for each of them. This means, depending on the exchange rate, the total cost could be more than 2,000 USD.\n\nOfficial References from Database Documentation\n\nOther than the official SQL standard, you can look up the official documentation of the database producers, which contains a reference for their SQL implementation. Here is a list of the few major ones:\n\nOracle PL/SQL Documentation\nMySQL 8 SQL Reference\nMicrosoft Transact-SQL Reference\nPostgreSQL 12 SQL Language\nIBM DB2 SQL\nSQL as understood by SQLite\nGrammars\n\nThere are a few (usually partial) grammars available in different formats. They can be a good starting point for getting where you need.\n\nBNF Grammars for SQL-92, SQL-99 and SQL-2003\nPartial Teradata SQL grammar for ANTLR4\nThe ANTLR v4 Grammars repository contains grammars for MySQL, PL/SQL, T-SQL and SQLite. In our ANTLR Course we analyze the SQLite grammar to explain its structure and how you can parse a declarative language like SQL.\nLibraries\n\nThere are many libraries to parse SQL in different languages. Some support different databases and different programming languages. Here it is a list of the most used ones. Unless otherwise noted, the libraries are released under an opensource license.\n\nMulti-lingual and/or multi-databases\nGeneral SQL Parser is a commercial library that supports many databases (DB2, Greenplum, Hana, Hive, Impala, Informix, MySQL, Netezza, Oracle, PostgreSQL, Redshift SQL Server, Sybase, and Teradata) and languages (C#, VB.NET, Java, C/C++, Delphi, VB). It can validate SQL syntax, format SQL and work with the parse tree\nJSqlParser parses an SQL statement and translates it into a hierarchy of Java classes. It is opensource, with a double LGPL and Apache license, and supports many databases: Oracle, SqlServer, MySQL, PostgreSQL, etc.\nMySQL parsers\nPingcap parser is a MySQL parser in Go.\nxwb1989/sqlparser is a MySQL parser for Go. This parser has been extracted from Vitess, a database clustering system for horizontal scaling of MySQL.\nPHP SQL Parser is a (mainly) MySQL (non-validating) parser written in PHP. It can parse other SQL dialects with some modifications. It fully supports parsing the most used SQL statements, but it just returns some information on other statements.\nThe SQL Parser of phpmyadmin is a validating SQL lexer and parser with a focus on MySQL dialect. Given its use in PHPMyAdmin, it is certainly well tested.\njs-sql-parser is SQL (only select) parser for JavaScript that parses the MySQL 5.7 version of SQL into an AST.\nSQLite Parsers\nsqlite-parser is a parser for SQLite v3 written in JavaScript that generates ASTs.\nSQL Parsers\nsql-parser is a parser for SQL written in pure JavaScript. It is not maintained anymore and it only supports some SELECT queries, but it is probably better than starting from scratch if you need to use JavaScript.\nhyrise/sql-parser is a SQL parser for C++. It parses the given SQL query into C++ objects. It is developed together with Hyrise, an in-memory database, but it can be used on its own.\nandialbrecht/sqlparse is a non-validating SQL parser for Python. It provides support for parsing, splitting and formatting SQL statements.\nK2InformaticsGmbH/sqlparse is a production-ready SQL parser written in pure Erlang. It targets the Oracle PL/SQL dialect.\nsqlparser-rs is SQL parser written in Rust. It supports the SQL-92, plus some addition for MS-SQL, PostgreSQL, and SQL:2011. The developers say: if you are assessing whether this project will be suitable for your needs, you’ll likely need to experimentally verify whether it supports the subset of SQL that you need.\nmoz-sql-parser is a peculiar SQL parser in Python written by Mozilla. The primary objective of this library is to convert some subset of SQL-92 queries to JSON-izable parse trees.\nqueryparser is a parser written in Haskell for parsing and analysis of Vertica, Hive, and Presto SQL.\nTools\nFrom SQL to a Programming Language or another SQL\nIO64 offers a tool to convert PL/SQL to Java. We have also seen this tool in our previous article Convert PL/SQL code to Java\nIspirer is a company that provides a tool to perform database migration from different SQL dialects to another SQL dialect or a programming language: Ispirer MnMTK. We have seen it in our previous article Convert PL/SQL code to Java\nSQLines SQL Converter is an open-source tool to convert a SQL dialect to a different SQL dialect. It is written in C++ and implements its own SQL parser.\nHow Hard Could it be to Parse a Declarative Language?\n\nDeclarative languages tend to have simpler structures than your average programming language. For instance, you do not see many nested lambdas used inside declarative languages. A program in a declarative language is usually a long list of simple statements. The issue is that any single statement can be fairly complicated in some cases. And that is what happens in SQL.\n\nFurthermore, there are actually several versions of SQL. This is true both in the sense that each database can implement it differently, and that there are many versions of the SQL standard because the language is evolving.\n\nAs an example, you are certainly familiar with a SELECT statement. In its basic format, like SELECT name FROM customers WHERE id = 1 it is quite easy to parse. However, the complete statement can be fairly complex. This image represents the SELECT statement as implemented in SQLite.\n\nSo, to implement support for parsing the general case will certainly take some time.\n\nTry to Parse for Your Application\n\nThe reality is that to implement support for parsing the whole SQL requires a lot of effort, probably as much as parsing any average programming language. Even more, if you need to parse many different SQL dialects. Then, if you need to parse SQL and cannot rely on a ready-to-use library, you should start with an analysis of your needs. You should try to understand first exactly what you need to parse and then try to parse in light of your application. This means both to parse just what you need and to structure the grammar in a way that makes your life easier.\n\nFor instance, if you just need to translate a series of SQL files just once, it may be acceptable to just ignore 40 complex statements. Maybe translating them manually would take less time than creating a large grammar to do it automatically. This does not work if you either have a lot of code or you need to do the translation repeatedly, not just once.\n\nIn this tutorial we are going to use this pragmatic approach: we are going to create a SQL grammar from scratch to parse just what we need and to ignore the rest.\n\nWriting a (Very Partial) Grammar\n\nIn our example, we will parse a simple SQL file (an exported database) to generate classes that could represent that database. We are going to ignore everything else, even any exported data present in the file. That’s it. The advantage of dealing with SQL files is that we do not need to interact with a database. In fact, the database might not even exist anymore.\n\nDesigning a Partial Grammar\n\nTo do that we are going to start with a grammar. We are going to write a very simple one, but there are a couple of things to keep in mind:\n\nSQL is not case-sensitive, while ANTLR grammars by default are\nOur input (the SQL files) will contain some data that we do not care about. We still need to parse the file successfully while ignoring the extraneous input\n\nThese are notable issues that are specific to SQL and to our approach; they would not probably appear with other languages or if we wanted to create a complete grammar.\n\nBefore starting, just to give you an idea of what we have to deal with, this is a sample SQL file.\n\n--\n-- Table structure for table actor\n--\n--DROP TABLE actor;\nCREATE TABLE actor (\n  actor_id numeric NOT NULL ,\n  first_name VARCHAR(45) NOT NULL,\n  last_name VARCHAR(45) NOT NULL,\n  last_update TIMESTAMP NOT NULL,\n  PRIMARY KEY  (actor_id)\n  )\n  ;\nCREATE  INDEX idx_actor_last_name ON actor(last_name)\n;\n \nCREATE TRIGGER actor_trigger_ai AFTER INSERT ON actor\n BEGIN\n  UPDATE actor SET last_update = DATETIME('NOW')  WHERE rowid = new.rowid;\n END\n;\n\nAs you can see at a first glance, we need to parse CREATE TABLE statements and ignore the other ones. We also need to ignore some parts of the CREATE TABLE statements, because they do not contain any information we care about for our task.\n\nHow to Ignore Stuff\n\nThe key to design a partial grammar is understanding how to ignore everything except for what we care about. This is not trivial because we have two conflicting needs: to ignore or drop most information and to keep all the necessary context to parse what we need. The more we ignore, the hardest is to parse what we need. This is tricky particularly for lexing since the lexer has less information available to make a decision.\n\nFor instance, we cannot just say ignore anything until we find a CREATE token. That is because the lexer would still find tokens for the elements in row definition, like the ones for naming the columns (e.g. last_name) in INSERT statements or CREATE INDEX. One possible way to deal with this would be lexical modes. These are a way to include multiple sets of lexer rules and switch between them. See our ANTLR Mega Tutorial, if you need to know more.\n\nEssentially we would treat SQL as if it were a markup language: bits of structured information in a sea of free text that we could ignore. This could work in our case because SQL has a regular structure and we are just interested in CREATE TABLE statements. For regular structure, we mean that a SQL file is just a list of statements, each of them ends with a semicolon. So, we could just make a CREATE TABLE token to start the special lexical mode and use the semicolon to end the special lexical mode. However, it is not flexible, so it would be risky in case we need to use our grammar for something else.\n\nThe Cognizant Way of Ignoring Stuff\n\nOur preferred approach is more flexible, and can also be used for regular programming languages.\n\nOn the lexer side, we just put as the last lexer rule this ANY rule.\n\nANY             : . -> skip;\n\nWe skip every character, that was not already recognized by some previous token.\n\nOn the parser side, these would be our main rules.\n\nstatements          : (statement | ignore)+ EOF\n                    ;\nstatement           : createStmt\n                    ;\nignore              : .*? SEMICOLON\n                    | COMMENT\n                    ;\n\nThe main rule is statements, which captures both the stuff we care about and the stuff to ignore. This approach allows us to start using our grammar while we build it. For this example, we only need to parse CREATE TABLE statements, but you could slowly add support for parsing more statements with this structure.\n\nWe need the ignore rule to maintain an understanding of the structure of the SQL file. Without this rule, we would not be able to recognize and parse the statements we are interested in. The negative side-effect is that it will clutter our parse tree with ignore nodes. For instance, this is a graphical representation of a sample parse tree made with grun, the ANTLR testing utility.\n\nParsing Create Statements\n\nWe use a similar approach to parsing the CREATE TABLE statements.\n\ncreateStmt          : CREATE TABLE (IF NOT EXISTS)? tableName=name\n                        LPAREN element (COMMA element)* RPAREN?\n                        SEMICOLON\n                    ;\nelement             : definition\n                    | ignorable\n                    ;\nignorable           : (PRIMARY? KEY | CONSTRAINT | SPECIAL_FEATURES | FULLTEXT) .*? (COMMA|RPAREN)                    \n                    ;\ndefinition          : name type defaultValue? nullability? attributes*;\n\nThe statement includes both definitions of columns, that we need, and settings for the table, that we could ignore. So, our element rule can accept both the definition for a row and the information about primary keys, constraints, etc. Later, in our code, we will simply ignore both the nodes ignore and ignorable.\n\nThe rules themselves are fairly easy to understand and should be obvious for everybody that has seen SQL. There is only a dirty trick that needs to be explained. You can see that the closing parenthesis (RPAREN) that should be at the end of the list of column definitions is optional. Technically this is not correct, it should always be there. However, we use this to fix an issue regarding the ignorable rule.\n\nGetting Around the Need to Actually Parse Settings\n\nThe issue is that the ignorable rule is only a partial implementation of the parsing of these settings that you will find in a SQL file. In fact, this is the bare minimum necessary to parse correctly a bunch of sample SQL files we encountered. It is not a good design, but this is a very realistic implementation. Look at this example and see if you can spot our problem.\n\nCREATE TABLE city (\n  city_id int NOT NULL,\n  city VARCHAR(50) NOT NULL,\n  country_id SMALLINT NOT NULL,\n  last_update TIMESTAMP NOT NULL,\n  PRIMARY KEY  (city_id),\n  CONSTRAINT fk_city_country FOREIGN KEY (country_id) REFERENCES country (country_id) ON DELETE NO ACTION ON UPDATE CASCADE\n);\n\nThis partial implementation has the issue that it does not parse well enough to understand when it found the end of a setting. So, it uses as a clue the comma (i.e., the start of a new setting) or the final closing parenthesis (i.e., the end of the list of elements) for the final setting.\n\nNow, how safe is it to use this dirty trick? In this case, it is safe because SQL files are not written by humans, they are exported with tools. This means that there will not be missing parenthesis that will mess up the recognition of subsequent statements. So, we actually can be sure that every CREATE TABLE will end with a closing parenthesis and a semicolon. This may vary with different languages, different sources of SQL statements or different databases.\n\nWhen you need to only partially implement a grammar these sorts of tricks can be quite helpful to speed up development and get your task done quicker. You have to be careful and aware of the risks, but they can be useful.\n\nThe Rest of the Grammar\n\nThe rest of the grammar is also fairly simple to understand. We just mention a couple of things.\n\nname                : QUOTE? NAME QUOTE? ;\n\nThe rule name is a parser rule instead of a lexer rule. That is because some tools wrap the name of the column with quotation marks (these are also used as apostrophes in some languages) like ` or '. With this definition, later in our code, we can easily extract the real name of the column without any check for quotation marks.\n\ntype                : (INTEGER | INT) UNSIGNED?                                                     #integerType\n                    | (TINYINT | SMALLINT) UNSIGNED?                                                #smallIntegerType\n                    | TEXT                                                                          #textType\n                    | BLOB (SUBTYPE type)?                                                          #blobType\n                    | (VARCHAR|CHARVAR) LPAREN NUMBER RPAREN                                        #varcharType\n                    | CHAR LPAREN NUMBER RPAREN                                                     #charType\n                    | YEAR                                                                          #yearType\n                    | DATETIME                                                                      #datetimeType\n                    | TIMESTAMP TIMEZONE?                                                           #timestampType\n                    | (NUMERIC | DECIMAL) (LPAREN precision=NUMBER (COMMA scale=NUMBER)? RPAREN)?   #decimalType\n                    ;\n\nThe rule to parse the type of the column includes rule labels. We designed this way to simplify our job, later in the code where we use the parser. This is also the reason because the VARCHAR rule is separated from the CHAR rule. Structurally the rules are obviously identical, but they mean something different. Remember: you should parse for your application, to make the parse effective for your needs.\n\nfragment A      : [aA];\nfragment B      : [bB];\nfragment C      : [cC];\nfragment D      : [dD];\nfragment E      : [eE];\n// etc.\n\nSince SQL is case-insensitive we use fragments for letters everywhere we need, to ensure that we parse everything correctly.\n\nYou can see the rest of the grammar on the companion repository.\n\nCREATING THE C# PROJECT\n\nWe can finally see some code. We are going to create a C# project from the command line since we are using VS Code as our editor. These are the instructions to create the project and to add the ANTLR library.\n\n// create a new directory somewhere\n// to create a new C# project\ndotnet new console -lang C#\n// to install the standard ANTLR 4 Runtime\ndotnet add package Antlr4.Runtime.Standard\n\nThese are the instructions to generate the parser and to run the program.\n\n// to generate the parser\nantlr4 SQL.g4 -Dlanguage=CSharp -o generated\\ -encoding UTF-8\n// to run the program\ndotnet run\n\nEven our main source code file is fairly standard.\n\nstatic void Main(string[] args)\n{\n    // standard ANTLR code\n    // we get the input\n    ICharStream chars = CharStreams.fromPath(args[0]);\n    // we set up the lexer\n    SQLLexer lexer = new SQLLexer(chars);            \n    // we use the lexer\n    CommonTokenStream stream = new CommonTokenStream(lexer);\n    // we set up the parser\n    SQLParser parser = new SQLParser(stream);\n    // we find the root node of our parse tree             \n    var tree = parser.statements();                                    \n    \n    // we create our visitor\n    CreateVisitor createVisitor = new CreateVisitor();   \n    List<ClassDescriptor> classes = createVisitor.VisitStatements(tree);\n    // we choose our code generator...\n    ICodeGenerator generator;\n    // ...depending on the command line argument\n    if(args.Count() > 1 && args[1] == \"kotlin\")\n        generator = new KotlinCodeGenerator();\n    else\n        generator = new CSharpCodeGenerator();\n    \n    Console.WriteLine(generator.ToSourceCode(\"SQLDataTypes\", classes));\n}\n\nThe comments are self-explanatory. After our standard code to setup ANTLR and parse the input, we employ our CreateVisitor. We use the visitor to visit the create table statements and to generate an internal representation of them. Then we use this representation to generate a source code file in our chosen language. In our example we choose to generate either in Kotlin or C#, to show how easy it can be to work with our SQL data once you parse it.\n\nThis is the simple overall structure; we can now move on the individual parts.\n\nVisiting the Statements\n\nLet’s start by looking at the general organization of our visitor.\n\npublic class CreateVisitor\n{\n    public  List<ClassDescriptor> VisitStatements(StatementsContext context)    \n    {\n        List<ClassDescriptor> tables = new List<ClassDescriptor>();\n        \n        foreach(var statement in context.statement())\n        {\n            tables.Add(VisitStmt(statement));\n        }\n        return tables;\n    }\n    public ClassDescriptor VisitStmt(StatementContext context)\n    {                      \n        return VisitCreateStmt(context.createStmt());\n    }\n    public ClassDescriptor VisitCreateStmt(CreateStmtContext context)\n    {\n        ClassDescriptor table = new ClassDescriptor();\n        table.Name = context.tableName.NAME().GetText();\n        table.Fields = new List<FieldDescriptor>();\n        foreach (var el in context.element())\n        {\n            if(el.definition() != null)\n            {\n                table.Fields.Add(VisitDefinition(el.definition()));\n            }                 \n        }        \n        return table;\n    }\n  \n    [..]\n\nThe first thing we notice is that we do not need to use the standard base visitor that can be created for us by ANTLR. Our visitor uses just our code. We do not need to use the base visitor, because of the structure of a SQL file and because we know exactly what we need to visit. We can completely ignore everything that is not a create statement because every statement in our SQL files is a top-level element. It is not like statements in your average programming language, that can be nested inside a code block, function definitions, etc. Also, the structure of create statements is simple, so we can visit everything ourselves.\n\nIn short, all we need to do is:\n\nto visit the statements node\nthen to visit each statement node (we ignore the ignore nodes) and to select the createStmt node\nvisiting the createStmt nodes, we pick only the definition nodes (we ignore the ignorable nodes) to get all the columns definition\nTranslating Types from SQL to Your Language\n\nInside the VisitDefinition method we deal with the only real complication of this visitor: handling types.\n\n        public FieldDescriptor VisitDefinition(DefinitionContext context)\n  {\n    string name = context.name().NAME().GetText();\n    TypeDescriptor type;\n    \n    switch(context.type().GetType().Name)\n    {\n      case \"IntegerTypeContext\":\n        type = VisitIntegerType(context.type() as IntegerTypeContext);\n        break;\n      case \"SmallIntegerTypeContext\":\n        type = VisitSmallIntegerType(context.type() as SmallIntegerTypeContext);\n        break;\n      case \"VarcharTypeContext\":\n        type = VisitVarcharType(context.type() as VarcharTypeContext);\n        break;\n      case \"TimestampTypeContext\":\n        type = VisitTimestampType(context.type() as TimestampTypeContext);\n        break;\n      case \"TextTypeContext\":\n        type = VisitTextType(context.type() as TextTypeContext);\n        break;               \n      case \"DecimalTypeContext\":\n        type = VisitDecimalType(context.type() as DecimalTypeContext);\n        break;  \n      case \"CharTypeContext\":\n        type = VisitCharType(context.type() as CharTypeContext);\n        break; \n      case \"BlobTypeContext\":\n        type = VisitBlobType(context.type() as BlobTypeContext);\n        break; \n      default:\n        type = null;\n        break;\n    }\n    \n    if(context.nullability() != null && context.nullability().NOT() != null)\n      type.Nullability = false;\n  \n    return new FieldDescriptor(name, type);\n  }\n\nThe issue is that we need to identify each type and then translate it in a way that is compatible with a programming language. In fact, SQL data types and programming language data types can be different. For example, SQL has types for variable and fixed size char array, this is less relevant in programming languages.\n\nWe already have done the work to easily identify each type by creating a label for each option of the type grammar rule. Now, we just need to use a different method to visit each node correctly.\n\nBefore seeing the examples of VisitIntegerType and VisitSmallIntegerType, let’s notice a couple of things. First, we deal with nullability of types only once, on lines 37-38. Second, we are only dealing with some types, the ones used in our example SQL files.\n\n        private TypeDescriptor VisitSmallIntegerType(SmallIntegerTypeContext context)\n        {\n           if(context.UNSIGNED() != null)\n                return new IntegerTypeDescriptor(2, true);\n            else\n                return new IntegerTypeDescriptor(2);\n        }\n        private TypeDescriptor VisitIntegerType(IntegerTypeContext context)\n        {\n            if(context.UNSIGNED() != null)\n                return new IntegerTypeDescriptor(4, true);\n            else\n                return new IntegerTypeDescriptor(4);\n        }\n\nThese two methods are representative of the little effort we have to do. Each method returns a TypeDescriptor specific for each type.\n\nThe methods are simple, but different because each type is different. In the case of integer types we need to check whether the type is unsigned or not. We use only one IntegerTypeDescriptor for all integer types. This is simply because they can be described in the same way: from our point of view, the only difference between integer types is the number of bytes they need.\n\nThe TypeDescriptor classes themselves are also fairly trivial. They just are a series of classes that contain specific information for each type.\n\npublic enum BaseType\n{\n    Integer,\n    Floating,    \n    Decimal,           \n    Text,\n    Binary,\n    ArrayCharacters,        \n    Year,\n    DateTime\n}\npublic class TypeDescriptor\n{\n    public BaseType Type { get; protected set; }\n    public bool Nullability { get; set; } = true;\n}\npublic class IntegerTypeDescriptor : TypeDescriptor\n{\n    public int Bytes { get; private set; }\n    public bool Unsigned { get; private set;  }\n    public IntegerTypeDescriptor(int bytes, bool unsigned = false)\n    {\n        Type = BaseType.Integer;\n        Bytes = bytes;\n        Unsigned = unsigned;\n    }\n}\n\nYou can see the rest on the companion repository.\n\nGenerating Code\n\nWe have a custom representation of our original SQL code: a description of all the tables suited for our needs. Now we can generate the corresponding source code. We are going to generate the code in multiple languages: C# and Kotlin. We do this to show how easy it is to do anything once we get the information out of SQL and because there are different limitations in the two languages.\n\nGenerating Code in C#\n\nLet’s start with seeing C#. We have only one public method: ToSourceCode, which accepts a namespace and a series of classes/tables definition.\n\npublic class CSharpCodeGenerator : ICodeGenerator\n{\n    public string ToSourceCode(string idNamespace, List<ClassDescriptor> classes)\n    {\n        StringBuilder sourceCode = new StringBuilder();\n        // opening namespace\n        sourceCode.AppendLine($\"namespace {idNamespace}\");\n        sourceCode.AppendLine(\"{\");\n        \n        foreach(var c in classes)\n        {\n            sourceCode.AppendLine($\"\\tpublic class {c.Name}\");\n            sourceCode.AppendLine(\"\\t{\");\n            \n            foreach(var f in c.Fields)\n            {\n                switch(f.Type.Type)\n                {\n                    case BaseType.Integer:\n                        sourceCode.AppendLine($\"\\t\\tpublic {GenerateInt(f.Type as IntegerTypeDescriptor)} {f.Name} {{ get; set; }}\");\n                        break;\n                    case BaseType.Text:\n                        sourceCode.AppendLine($\"\\t\\tpublic string {f.Name} {{ get; set; }}\");\n                        break;\n                    case BaseType.ArrayCharacters:\n                        sourceCode.AppendLine($\"\\t\\tpublic {GenerateCharArray(f.Name, f.Type as CharArrayTypeDescriptor)}\");\n                        break;\n                    case BaseType.DateTime:\n                        sourceCode.AppendLine($\"\\t\\tpublic DateTime {f.Name} {{ get; set; }}\");\n                        break;                            \n                    case BaseType.Decimal:                        \n                        sourceCode.AppendLine($\"\\t\\tpublic decimal {f.Name} {{ get; set; }}\");\n                        break;\n                    case BaseType.Binary:\n                        sourceCode.AppendLine($\"\\t\\tpublic bytes[] {f.Name} {{ get; set; }}\");\n                        break;\n                }\n            }\n            \n            sourceCode.AppendLine(\"\\t}\");\n            sourceCode.AppendLine();\n        }\n        // closing namespace            \n        sourceCode.AppendLine(\"}\");\n        return sourceCode.ToString();\n    }\n    [..]\n\nThis method takes care of generating the whole new source code file. It handles the enclosing namespace (necessary for C# files) and the whole class.\n\nWe transform columns into properties. These are the obvious choice because it is easy to anticipate that we would need to transform any data coming from SQL in a different format to handle it in our programming language. For example, dates would be different. We would also need to enforce fixed-size arrays in some way. That is because programming languages usually do not have a well-defined way to handle an input too large or too small. Instead databases can automatically do things like padding an input that is too short with spaces.\n\nThere are generally three cases:\n\nthe type has a perfect correspondence (e.g. lines 23-24 TEXT becomes a String). So we just write the property directly.\nthe type has only a partial, but unambiguous, correspondence (e.g. lines 32-33 DECIMAL becomes Decimal, but the SQL and C# type behave differently). For example, a SQL decimal allows us to specify a precision, to set just how many digits it can hold. In C# you cannot do that. Normally we would need to take care of this difference, in our example, we just ignore the issue\nthe type has multiple correspondences (e.g., lines 20-21 INT, SMALLINT become int, short), so we handle them with a method\n\nFor the third case, we are going to see the integer example.\n\n        private string GenerateInt(IntegerTypeDescriptor descriptor)\n        {\n            StringBuilder intType = new StringBuilder();\n            // we ignore nullability, because it is not well supported for all C# types\n            if(descriptor.Unsigned == true)\n                intType.Append(\"u\");\n            switch(descriptor.Bytes)\n            {\n                case 2:\n                    intType.Append(\"short\");\n                    break;\n                case 4:\n                    intType.Append(\"int\");\n                    break;\n                case 8:\n                    intType.Append(\"long\");\n                    break;\n            }\n           \n            return intType.ToString();\n        }\n\nWe can find a perfect correspondence between each integer type in SQL and C#. Since integer types are all represented internally the same way, it all depends on the number of bytes used for each of them. Depending on how many bytes are stored in our instance of IntegerTypeDescriptor, we generate the proper C# type.\n\nThe only issue is with C# itself: it does not have perfect support for nullability. Until C# 8.0 reference types could be nullable by default, so it would be fairly inconsistent to work with nullable types both in our code and any third-party code.\n\nOn the other hand, we can easily deal with unsigned integers, we just need to prepend a u, to use unsigned types.\n\nGenerating Code in Kotlin\n\nGenerating the code for Kotlin is very similar.\n\npublic class KotlinCodeGenerator : ICodeGenerator\n{\n        public string ToSourceCode(string idNamespace, List<ClassDescriptor> classes)\n        {\n            StringBuilder sourceCode = new StringBuilder();\n            // declaring package\n            if(!String.IsNullOrEmpty(idNamespace))\n                sourceCode.AppendLine($\"package {idNamespace}\");   \n            // adding imports\n            sourceCode.AppendLine();\n            sourceCode.AppendLine(\"import java.time.LocalDateTime\");\n            sourceCode.AppendLine(\"import java.math.BigDecimal\");            \n            sourceCode.AppendLine();\n            \n            foreach(var c in classes)\n            {\n                sourceCode.Append($\"data class {c.Name}(\");\n                \n                foreach(var f in c.Fields)\n                {\n                    switch(f.Type.Type)\n                    {\n                        case BaseType.Integer:\n                            sourceCode.Append($\"var {f.Name}: {GenerateInt(f.Type as IntegerTypeDescriptor)}\");\n                            break;\n                        case BaseType.Text:\n                            sourceCode.Append($\"var {f.Name}: String\");\n                            break;\n                        case BaseType.ArrayCharacters:\n                            sourceCode.Append($\"var {f.Name}: {GenerateCharArray(f.Type as CharArrayTypeDescriptor)}\");\n                            break;\n                        case BaseType.DateTime:\n                            sourceCode.Append($\"var {f.Name}: LocalDateTime\");\n                            break;                            \n                        case BaseType.Decimal:                        \n                            sourceCode.Append($\"var {f.Name}: BigDecimal\");\n                            break;\n                        case BaseType.Binary:\n                            sourceCode.Append($\"var {f.Name}: ByteArray\");\n                            break;\n                    }                    \n                    \n                    if(f != c.Fields.Last())\n                        sourceCode.Append(\", \");\n                }\n                \n                sourceCode.AppendLine(\")\");\n                sourceCode.AppendLine(\"\");\n            }\n            return sourceCode.ToString();\n        }\n\nThere are no structural differences. The only variations depend on the differences between the languages themselves. For instance, the equivalent of a namespace, i.e., packages are not required in Kotlin. We can also use the special data classes in Kotlin to quickly define a class with its properties directly in the default constructor.\n\nOn the other hand, we need to import some Java packages, because Kotlin does not directly have classes for DateTime types. Since Kotlin can run in different environments (i.e. JVM with Java support, JavaScript, native with C++ support), we should probably find a way to support all of these environments. In a normal situation, we would probably create a runtime in pure Kotlin with these custom types (i.e., KotlinDateTime) and then add support for each platform in separate files. This way we could just generate one Kotlin file for all environments. This would be overkill for this example, so we just consider Kotlin run in Java.\n\n  private string GenerateInt(IntegerTypeDescriptor descriptor)\n        {\n            StringBuilder intType = new StringBuilder();            \n            switch(descriptor.Bytes)\n            {\n                case 2:\n                    intType.Append(\"Short\");\n                    break;\n                case 4:\n                    intType.Append(\"Int\");\n                    break;\n                case 8:\n                    intType.Append(\"Long\");\n                    break;\n            }\n            // we ignore unsigned, because it is not well supported in C#\n            if(descriptor.Nullability == true)\n                intType.Append(\"?\");\n           \n            return intType.ToString();\n        }\n\nWe can also see that the methods to generate integral types are very similar in both C# and Kotlin. The difference is that with Kotlin nullability has always been supported, while support for unsigned integer is still experimental for the current version.\n\nSummary\n\nIn this article, we have seen how to parse SQL. In general, our advice is to:\n\nConsider if you can use existing tools or libraries to process SQL code. Some of them even support multiple SQL-dialects or multiple programming languages. If you can use any of them for your needs they should be your first option\nIf you want to build a solution in-house you may consider starting from the few ANTLR grammars available for the major SQL databases. They can really help you get started in parsing SQL\nIf you are stuck with a less common SQL database you might be in trouble. Parsing SQL from scratch it is going to be hard work: the language has a fairly simple structure, but it is large, it has many variations and in some cases even procedural extensions. In this article, we have seen a few tricks to start parsing even with a partial grammar. This can be a good way if you need to parse only small parts of the language\n\nIf none of these options work for you, and you need some commercial option supporting you in building a solution for your needs, we at Strumenta may be able to help.\n\nDownload the guide with 68 resources on Creating Programming Languages\n\nReceive the guide to your inbox to read it on all your devices when you have time\n\nFirst Name\nEmail Address\nWe use this field to detect spam bots. If you fill this in, you will be marked as a spammer.\n \n\nI'd like to receive the free email course.\n\nSend it to me!\nTags: C#, Kotlin, SQL, tools\nYou might also like\nDO YOU NEED A PARSER?\n\nWe can design parsers for new languages, or rewrite parsers for existing languages built in house.\n\nOn top of parsers we can then help building interpreters, compilers, code generators, documentation generators, or translators (code converters) to other languages.\n\nLet’s Talk!\nCOURSE: USING ANTLR LIKE A PROFESSIONAL\n\nA complete video course on parsing and ANTLR, that will teach you how to build parser for everything from programming languages to data formats.\nTaught from professionals that build parsers for a living.\n\nBOOK: HOW TO CREATE PRAGMATIC, LIGHTWEIGHT LANGUAGES\n\nThis book on Building Languages is about building in a simple manner productive languages with parsers, compilers, interpreters, editors and more.\n\nBOOK: JAVAPARSER VISITED\n\nThis book on JavaParser will teach you how to analyze, transform, and generate Java code\n\nSTRUMENTA – CONSULTING\nIf you need help designing and developing DSLs, languages, parsers, compilers, interpreters, and editors you can check the services page of the Consulting studio we founded: Strumenta.\nBLOG CATEGORIES\nANTLR (17)\nApplication modernization (2)\nCode processing (24)\nConsulting (14)\nCreate a programming language (1)\nDomain specific languages (16)\nEditors (1)\nJetbrains MPS (11)\nLanguage design (13)\nLanguage Engineering (33)\nMiscellany (5)\nModel driven development (4)\nNatural Language Processing (1)\nNon software development (4)\nOpen-source (8)\nParsing (22)\nResearch (4)\nSoftware Development (16)\nSoftware Engineering (13)\nTurin Programming Language (4)\nWhole Platform (2)\nXtext (3)\nMENU\nAbout me\nHow I work\nLanguage Engineering Services\nANTLR Consulting\nJetbrains MPS Consulting\nContact\nLinkedIn\nBLOG CATEGORIES\nANTLR (17)\nApplication modernization (2)\nCode processing (24)\nConsulting (14)\nCreate a programming language (1)\nDomain specific languages (16)\nEditors (1)\nJetbrains MPS (11)\nLanguage design (13)\nLanguage Engineering (33)\nMiscellany (5)\nModel driven development (4)\nNatural Language Processing (1)\nNon software development (4)\nOpen-source (8)\nParsing (22)\nResearch (4)\nSoftware Development (16)\nSoftware Engineering (13)\nTurin Programming Language (4)\nWhole Platform (2)\nXtext (3)\nTAGS\nAutomation\nC#\nClojure\ncode generation\ndsl\neffectivejava\nformats\nFrege\nFunctional programming\nguide\nHaskell\nicse\nImage processing\ninterpreters\nInterview\njava\nJavaParser\nJavaScript\nJavaSymbolSolver\njetbrains mps\nKotlin\nlanguage integration\nlanguage server protocol\nlanguage worbenches\nLibav\nmachine learning\nmbeddr\nmise\nnatural language\nnlp\nOpen-source\nopensource\nprogramming languages\nPython\nrefactoring\nreview\nRoslyn\nSparkWeb\nstatic-analysis\ntesting\ntools\nTripAdvisor\ntutorial\nweb\nWebAssembly\nDON’T MISS THE NEXT UPDATES!\n\nWant to join over 10.000+ people that keep learning more about DSLs, parsers, interpreters, compilers and language design?\n\nCOUNT ME IN!\n© 2018 Strumenta | Privacy Policy of Strumenta Websites\nQuick Domain-Specific Languages in Python with textX\t\n\nThis site uses cookies. By continuing to browse the site, you are agreeing to our use of cookies.\n\nPrivacy Policy of Strumenta WebsitesOK\n​Learn to Create Programming Languages\n\nSubscribe to ​our ​newsletter to get the FREE email course that teaches you how to create a programming language\n\n\nI want to create programming languages"}

{"l":"https://tools.ietf.org/html/rfc1180","n":"A TCP/IP Tutorial","html":"\n  <div class=\"content\">\n   <div style=\"height: 13px;\">\n      <div onmouseover=\"this.style.cursor='pointer';\" onclick=\"showElem('legend');\" onmouseout=\"hideElem('legend')\" style=\"height: 6px; position: absolute;\" class=\"pre noprint docinfo bgorange\" title=\"Click for colour legend.\">                                                                        </div>\n      <div id=\"legend\" class=\"docinfo noprint pre legend\" style=\"position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; \" onmouseover=\"showElem('legend');\" onmouseout=\"hideElem('legend');\">\n      </div>\n   </div>\n<span class=\"pre noprint docinfo top\">[<a href=\"../html/\" title=\"Document search and retrieval page\">Docs</a>] [<a href=\"/rfc/rfc1180.txt\" title=\"Plaintext version of this document\">txt</a>|<a href=\"/pdf/rfc1180\" title=\"PDF version of this document\">pdf</a>] [<a href=\"https://datatracker.ietf.org/doc/rfc1180\" title=\"IESG Datatracker information for this document\">Tracker</a>] [<a href=\"https://www.rfc-editor.org/errata_search.php?rfc=1180\">Errata</a>]                                     </span><br>\n<span class=\"pre noprint docinfo\">                                                                        </span><br>\n<span class=\"pre noprint docinfo\">                                                           INFORMATIONAL</span><br>\n<span class=\"pre noprint docinfo\">                                                            <span style=\"color: #C00;\">Errata Exist</span></span><br>\n<pre>Network Working Group                                      T. Socolofsky\nRequest for Comments:  1180                                      C. Kale\n                                                  Spider Systems Limited\n                                                            January 1991\n\n\n                           <span class=\"h1\"><h1>A TCP/IP Tutorial</h1></span>\n\nStatus of this Memo\n\n   This RFC is a tutorial on the TCP/IP protocol suite, focusing\n   particularly on the steps in forwarding an IP datagram from source\n   host to destination host through a router.  It does not specify an\n   Internet standard.  Distribution of this memo is unlimited.\n\nTable of Contents\n\n    <a href=\"#section-1\">1</a>.  Introduction................................................   <a href=\"#page-1\">1</a>\n    <a href=\"#section-2\">2</a>.  TCP/IP Overview.............................................   <a href=\"#page-2\">2</a>\n    <a href=\"#section-3\">3</a>.  Ethernet....................................................   <a href=\"#page-8\">8</a>\n    <a href=\"#section-4\">4</a>.  ARP.........................................................   <a href=\"#page-9\">9</a>\n    <a href=\"#section-5\">5</a>.  Internet Protocol...........................................  <a href=\"#page-12\">12</a>\n    <a href=\"#section-6\">6</a>.  User Datagram Protocol......................................  <a href=\"#page-22\">22</a>\n    <a href=\"#section-7\">7</a>.  Transmission Control Protocol...............................  <a href=\"#page-24\">24</a>\n    <a href=\"#section-8\">8</a>.  Network Applications........................................  <a href=\"#page-25\">25</a>\n    <a href=\"#section-9\">9</a>.  Other Information...........................................  <a href=\"#page-27\">27</a>\n   <a href=\"#section-10\">10</a>.  References..................................................  <a href=\"#page-27\">27</a>\n   <a href=\"#section-11\">11</a>.  Relation to other RFCs......................................  <a href=\"#page-27\">27</a>\n   <a href=\"#section-12\">12</a>.  Security Considerations.....................................  <a href=\"#page-27\">27</a>\n   <a href=\"#section-13\">13</a>.  Authors' Addresses..........................................  <a href=\"#page-28\">28</a>\n\n<span class=\"h2\"><h2><a class=\"selflink\" name=\"section-1\" href=\"#section-1\">1</a>.  Introduction</h2></span>\n\n   This tutorial contains only one view of the salient points of TCP/IP,\n   and therefore it is the \"bare bones\" of TCP/IP technology.  It omits\n   the history of development and funding, the business case for its\n   use, and its future as compared to ISO OSI.  Indeed, a great deal of\n   technical information is also omitted.  What remains is a minimum of\n   information that must be understood by the professional working in a\n   TCP/IP environment.  These professionals include the systems\n   administrator, the systems programmer, and the network manager.\n\n   This tutorial uses examples from the UNIX TCP/IP environment, however\n   the main points apply across all implementations of TCP/IP.\n\n   Note that the purpose of this memo is explanation, not definition.\n   If any question arises about the correct specification of a protocol,\n   please refer to the actual standards defining RFC.\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                               [Page 1]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-2\" id=\"page-2\" href=\"#page-2\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n   The next section is an overview of TCP/IP, followed by detailed\n   descriptions of individual components.\n\n<span class=\"h2\"><h2><a class=\"selflink\" name=\"section-2\" href=\"#section-2\">2</a>.  TCP/IP Overview</h2></span>\n\n   The generic term \"TCP/IP\" usually means anything and everything\n   related to the specific protocols of TCP and IP.  It can include\n   other protocols, applications, and even the network medium.  A sample\n   of these protocols are: UDP, ARP, and ICMP.  A sample of these\n   applications are: TELNET, FTP, and rcp.  A more accurate term is\n   \"internet technology\".  A network that uses internet technology is\n   called an \"internet\".\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-2.1\" href=\"#section-2.1\">2.1</a>  Basic Structure</h3></span>\n\n   To understand this technology you must first understand the following\n   logical structure:\n\n                     ----------------------------\n                     |    network applications  |\n                     |                          |\n                     |...  \\ | /  ..  \\ | /  ...|\n                     |     -----      -----     |\n                     |     |TCP|      |UDP|     |\n                     |     -----      -----     |\n                     |         \\      /         |\n                     |         --------         |\n                     |         |  IP  |         |\n                     |  -----  -*------         |\n                     |  |ARP|   |               |\n                     |  -----   |               |\n                     |      \\   |               |\n                     |      ------              |\n                     |      |ENET|              |\n                     |      ---@--              |\n                     ----------|-----------------\n                               |\n         ----------------------o---------\n             Ethernet Cable\n\n                  Figure 1.  Basic TCP/IP Network Node\n\n   This is the logical structure of the layered protocols inside a\n   computer on an internet.  Each computer that can communicate using\n   internet technology has such a logical structure.  It is this logical\n   structure that determines the behavior of the computer on the\n   internet.  The boxes represent processing of the data as it passes\n   through the computer, and the lines connecting boxes show the path of\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                               [Page 2]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-3\" id=\"page-3\" href=\"#page-3\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n   data.  The horizontal line at the bottom represents the Ethernet\n   cable; the \"o\" is the transceiver.  The \"*\" is the IP address and the\n   \"@\" is the Ethernet address.  Understanding this logical structure is\n   essential to understanding internet technology; it is referred to\n   throughout this tutorial.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-2.2\" href=\"#section-2.2\">2.2</a>  Terminology</h3></span>\n\n   The name of a unit of data that flows through an internet is\n   dependent upon where it exists in the protocol stack.  In summary: if\n   it is on an Ethernet it is called an Ethernet frame; if it is between\n   the Ethernet driver and the IP module it is called a IP packet; if it\n   is between the IP module and the UDP module it is called a UDP\n   datagram; if it is between the IP module and the TCP module it is\n   called a TCP segment (more generally, a transport message); and if it\n   is in a network application it is called a application message.\n\n   These definitions are imperfect.  Actual definitions vary from one\n   publication to the next.  More specific definitions can be found in\n   <a href=\"./rfc1122#section-1.3.3\">RFC 1122, section&nbsp;1.3.3</a>.\n\n   A driver is software that communicates directly with the network\n   interface hardware.  A module is software that communicates with a\n   driver, with network applications, or with another module.\n\n   The terms driver, module, Ethernet frame, IP packet, UDP datagram,\n   TCP message, and application message are used where appropriate\n   throughout this tutorial.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-2.3\" href=\"#section-2.3\">2.3</a>  Flow of Data</h3></span>\n\n   Let's follow the data as it flows down through the protocol stack\n   shown in Figure 1.  For an application that uses TCP (Transmission\n   Control Protocol), data passes between the application and the TCP\n   module.  For applications that use UDP (User Datagram Protocol), data\n   passes between the application and the UDP module.  FTP (File\n   Transfer Protocol) is a typical application that uses TCP.  Its\n   protocol stack in this example is FTP/TCP/IP/ENET.  SNMP (Simple\n   Network Management Protocol) is an application that uses UDP.  Its\n   protocol stack in this example is SNMP/UDP/IP/ENET.\n\n   The TCP module, UDP module, and the Ethernet driver are n-to-1\n   multiplexers.  As multiplexers they switch many inputs to one output.\n   They are also 1-to-n de-multiplexers.  As de-multiplexers they switch\n   one input to many outputs according to the type field in the protocol\n   header.\n\n\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                               [Page 3]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-4\" id=\"page-4\" href=\"#page-4\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n         1   2 3 ...   n                   1   2 3 ...   n\n          \\  |      /      |               \\  | |      /       ^\n           \\ | |   /       |                \\ | |     /        |\n         -------------   flow              ----------------   flow\n         |multiplexer|    of               |de-multiplexer|    of\n         -------------   data              ----------------   data\n              |            |                     |              |\n              |            v                     |              |\n              1                                  1\n\n        Figure 2.  n-to-1 multiplexer and 1-to-n de-multiplexer\n\n   If an Ethernet frame comes up into the Ethernet driver off the\n   network, the packet can be passed upwards to either the ARP (Address\n   Resolution Protocol) module or to the IP (Internet Protocol) module.\n   The value of the type field in the Ethernet frame determines whether\n   the Ethernet frame is passed to the ARP or the IP module.\n\n   If an IP packet comes up into IP, the unit of data is passed upwards\n   to either TCP or UDP, as determined by the value of the protocol\n   field in the IP header.\n\n   If the UDP datagram comes up into UDP, the application message is\n   passed upwards to the network application based on the value of the\n   port field in the UDP header.  If the TCP message comes up into TCP,\n   the application message is passed upwards to the network application\n   based on the value of the port field in the TCP header.\n\n   The downwards multiplexing is simple to perform because from each\n   starting point there is only the one downward path; each protocol\n   module adds its header information so the packet can be de-\n   multiplexed at the destination computer.\n\n   Data passing out from the applications through either TCP or UDP\n   converges on the IP module and is sent downwards through the lower\n   network interface driver.\n\n   Although internet technology supports many different network media,\n   Ethernet is used for all examples in this tutorial because it is the\n   most common physical network used under IP.  The computer in Figure 1\n   has a single Ethernet connection.  The 6-byte Ethernet address is\n   unique for each interface on an Ethernet and is located at the lower\n   interface of the Ethernet driver.\n\n   The computer also has a 4-byte IP address.  This address is located\n   at the lower interface to the IP module.  The IP address must be\n   unique for an internet.\n\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                               [Page 4]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-5\" id=\"page-5\" href=\"#page-5\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n   A running computer always knows its own IP address and Ethernet\n   address.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-2.4\" href=\"#section-2.4\">2.4</a>  Two Network Interfaces</h3></span>\n\n   If a computer is connected to 2 separate Ethernets it is as in Figure\n   3.\n\n                ----------------------------\n                |    network applications  |\n                |                          |\n                |...  \\ | /  ..  \\ | /  ...|\n                |     -----      -----     |\n                |     |TCP|      |UDP|     |\n                |     -----      -----     |\n                |         \\      /         |\n                |         --------         |\n                |         |  IP  |         |\n                |  -----  -*----*-  -----  |\n                |  |ARP|   |    |   |ARP|  |\n                |  -----   |    |   -----  |\n                |      \\   |    |   /      |\n                |      ------  ------      |\n                |      |ENET|  |ENET|      |\n                |      ---@--  ---@--      |\n                ----------|-------|---------\n                          |       |\n                          |    ---o---------------------------\n                          |             Ethernet Cable 2\n           ---------------o----------\n             Ethernet Cable 1\n\n             Figure 3.  TCP/IP Network Node on 2 Ethernets\n\n   Please note that this computer has 2 Ethernet addresses and 2 IP\n   addresses.\n\n   It is seen from this structure that for computers with more than one\n   physical network interface, the IP module is both a n-to-m\n   multiplexer and an m-to-n de-multiplexer.\n\n\n\n\n\n\n\n\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                               [Page 5]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-6\" id=\"page-6\" href=\"#page-6\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n         1   2 3 ...   n                   1   2 3 ...   n\n          \\  | |      /    |                \\  | |      /       ^\n           \\ | |     /     |                 \\ | |     /        |\n         -------------   flow              ----------------   flow\n         |multiplexer|    of               |de-multiplexer|    of\n         -------------   data              ----------------   data\n           / | |     \\     |                 / | |     \\        |\n          /  | |      \\    v                /  | |      \\       |\n         1   2 3 ...   m                   1   2 3 ...   m\n\n        Figure 4.  n-to-m multiplexer and m-to-n de-multiplexer\n\n   It performs this multiplexing in either direction to accommodate\n   incoming and outgoing data.  An IP module with more than 1 network\n   interface is more complex than our original example in that it can\n   forward data onto the next network.  Data can arrive on any network\n   interface and be sent out on any other.\n\n                           TCP      UDP\n                             \\      /\n                              \\    /\n                          --------------\n                          |     IP     |\n                          |            |\n                          |    ---     |\n                          |   /   \\    |\n                          |  /     v   |\n                          --------------\n                           /         \\\n                          /           \\\n                       data           data\n                      comes in         goes out\n                     here               here\n\n            Figure 5.  Example of IP Forwarding a IP Packet\n\n   The process of sending an IP packet out onto another network is\n   called \"forwarding\" an IP packet.  A computer that has been dedicated\n   to the task of forwarding IP packets is called an \"IP-router\".\n\n   As you can see from the figure, the forwarded IP packet never touches\n   the TCP and UDP modules on the IP-router.  Some IP-router\n   implementations do not have a TCP or UDP module.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-2.5\" href=\"#section-2.5\">2.5</a>  IP Creates a Single Logical Network</h3></span>\n\n   The IP module is central to the success of internet technology.  Each\n   module or driver adds its header to the message as the message passes\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                               [Page 6]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-7\" id=\"page-7\" href=\"#page-7\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n   down through the protocol stack.  Each module or driver strips the\n   corresponding header from the message as the message climbs the\n   protocol stack up towards the application.  The IP header contains\n   the IP address, which builds a single logical network from multiple\n   physical networks.  This interconnection of physical networks is the\n   source of the name: internet.  A set of interconnected physical\n   networks that limit the range of an IP packet is called an\n   \"internet\".\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-2.6\" href=\"#section-2.6\">2.6</a>  Physical Network Independence</h3></span>\n\n   IP hides the underlying network hardware from the network\n   applications.  If you invent a new physical network, you can put it\n   into service by implementing a new driver that connects to the\n   internet underneath IP.  Thus, the network applications remain intact\n   and are not vulnerable to changes in hardware technology.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-2.7\" href=\"#section-2.7\">2.7</a>  Interoperability</h3></span>\n\n   If two computers on an internet can communicate, they are said to\n   \"interoperate\"; if an implementation of internet technology is good,\n   it is said to have \"interoperability\".  Users of general-purpose\n   computers benefit from the installation of an internet because of the\n   interoperability in computers on the market.  Generally, when you buy\n   a computer, it will interoperate.  If the computer does not have\n   interoperability, and interoperability can not be added, it occupies\n   a rare and special niche in the market.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-2.8\" href=\"#section-2.8\">2.8</a>  After the Overview</h3></span>\n\n   With the background set, we will answer the following questions:\n\n   When sending out an IP packet, how is the destination Ethernet\n   address determined?\n\n   How does IP know which of multiple lower network interfaces to use\n   when sending out an IP packet?\n\n   How does a client on one computer reach the server on another?\n\n   Why do both TCP and UDP exist, instead of just one or the other?\n\n   What network applications are available?\n\n   These will be explained, in turn, after an Ethernet refresher.\n\n\n\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                               [Page 7]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-8\" id=\"page-8\" href=\"#page-8\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n<span class=\"h2\"><h2><a class=\"selflink\" name=\"section-3\" href=\"#section-3\">3</a>.  Ethernet</h2></span>\n\n   This section is a short review of Ethernet technology.\n\n   An Ethernet frame contains the destination address, source address,\n   type field, and data.\n\n   An Ethernet address is 6 bytes.  Every device has its own Ethernet\n   address and listens for Ethernet frames with that destination\n   address.  All devices also listen for Ethernet frames with a wild-\n   card destination address of \"FF-FF-FF-FF-FF-FF\" (in hexadecimal),\n   called a \"broadcast\" address.\n\n   Ethernet uses CSMA/CD (Carrier Sense and Multiple Access with\n   Collision Detection).  CSMA/CD means that all devices communicate on\n   a single medium, that only one can transmit at a time, and that they\n   can all receive simultaneously.  If 2 devices try to transmit at the\n   same instant, the transmit collision is detected, and both devices\n   wait a random (but short) period before trying to transmit again.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-3.1\" href=\"#section-3.1\">3.1</a>  A Human Analogy</h3></span>\n\n   A good analogy of Ethernet technology is a group of people talking in\n   a small, completely dark room.  In this analogy, the physical network\n   medium is sound waves on air in the room instead of electrical\n   signals on a coaxial cable.\n\n   Each person can hear the words when another is talking (Carrier\n   Sense).  Everyone in the room has equal capability to talk (Multiple\n   Access), but none of them give lengthy speeches because they are\n   polite.  If a person is impolite, he is asked to leave the room\n   (i.e., thrown off the net).\n\n   No one talks while another is speaking.  But if two people start\n   speaking at the same instant, each of them know this because each\n   hears something they haven't said (Collision Detection).  When these\n   two people notice this condition, they wait for a moment, then one\n   begins talking.  The other hears the talking and waits for the first\n   to finish before beginning his own speech.\n\n   Each person has an unique name (unique Ethernet address) to avoid\n   confusion.  Every time one of them talks, he prefaces the message\n   with the name of the person he is talking to and with his own name\n   (Ethernet destination and source address, respectively), i.e., \"Hello\n   Jane, this is Jack, ..blah blah blah...\".  If the sender wants to\n   talk to everyone he might say \"everyone\" (broadcast address), i.e.,\n   \"Hello Everyone, this is Jack, ..blah blah blah...\".\n\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                               [Page 8]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-9\" id=\"page-9\" href=\"#page-9\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n<span class=\"h2\"><h2><a class=\"selflink\" name=\"section-4\" href=\"#section-4\">4</a>.  ARP</h2></span>\n\n   When sending out an IP packet, how is the destination Ethernet\n   address determined?\n\n   ARP (Address Resolution Protocol) is used to translate IP addresses\n   to Ethernet addresses.  The translation is done only for outgoing IP\n   packets, because this is when the IP header and the Ethernet header\n   are created.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-4.1\" href=\"#section-4.1\">4.1</a>  ARP Table for Address Translation</h3></span>\n\n   The translation is performed with a table look-up.  The table, called\n   the ARP table, is stored in memory and contains a row for each\n   computer.  There is a column for IP address and a column for Ethernet\n   address.  When translating an IP address to an Ethernet address, the\n   table is searched for a matching IP address.  The following is a\n   simplified ARP table:\n\n                  ------------------------------------\n                  |IP address       Ethernet address |\n                  ------------------------------------\n                  |223.1.2.1        08-00-39-00-2F-C3|\n                  |223.1.2.3        08-00-5A-21-A7-22|\n                  |223.1.2.4        08-00-10-99-AC-54|\n                  ------------------------------------\n                      TABLE 1.  Example ARP Table\n\n   The human convention when writing out the 4-byte IP address is each\n   byte in decimal and separating bytes with a period.  When writing out\n   the 6-byte Ethernet address, the conventions are each byte in\n   hexadecimal and separating bytes with either a minus sign or a colon.\n\n   The ARP table is necessary because the IP address and Ethernet\n   address are selected independently; you can not use an algorithm to\n   translate IP address to Ethernet address.  The IP address is selected\n   by the network manager based on the location of the computer on the\n   internet.  When the computer is moved to a different part of an\n   internet, its IP address must be changed.  The Ethernet address is\n   selected by the manufacturer based on the Ethernet address space\n   licensed by the manufacturer.  When the Ethernet hardware interface\n   board changes, the Ethernet address changes.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-4.2\" href=\"#section-4.2\">4.2</a>  Typical Translation Scenario</h3></span>\n\n   During normal operation a network application, such as TELNET, sends\n   an application message to TCP, then TCP sends the corresponding TCP\n   message to the IP module.  The destination IP address is known by the\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                               [Page 9]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-10\" id=\"page-10\" href=\"#page-10\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n   application, the TCP module, and the IP module.  At this point the IP\n   packet has been constructed and is ready to be given to the Ethernet\n   driver, but first the destination Ethernet address must be\n   determined.\n\n   The ARP table is used to look-up the destination Ethernet address.\n\n   4.3  ARP Request/Response Pair\n\n   But how does the ARP table get filled in the first place?  The answer\n   is that it is filled automatically by ARP on an \"as-needed\" basis.\n\n   Two things happen when the ARP table can not be used to translate an\n   address:\n\n     1. An ARP request packet with a broadcast Ethernet address is sent\n        out on the network to every computer.\n\n     2. The outgoing IP packet is queued.\n\n   Every computer's Ethernet interface receives the broadcast Ethernet\n   frame.  Each Ethernet driver examines the Type field in the Ethernet\n   frame and passes the ARP packet to the ARP module.  The ARP request\n   packet says \"If your IP address matches this target IP address, then\n   please tell me your Ethernet address\".  An ARP request packet looks\n   something like this:\n\n                ---------------------------------------\n                |Sender IP Address   223.1.2.1        |\n                |Sender Enet Address 08-00-39-00-2F-C3|\n                ---------------------------------------\n                |Target IP Address   223.1.2.2        |\n                |Target Enet Address &lt;blank&gt;          |\n                ---------------------------------------\n                     TABLE 2.  Example ARP Request\n\n   Each ARP module examines the IP address and if the Target IP address\n   matches its own IP address, it sends a response directly to the\n   source Ethernet address.  The ARP response packet says \"Yes, that\n   target IP address is mine, let me give you my Ethernet address\".  An\n   ARP response packet has the sender/target field contents swapped as\n   compared to the request.  It looks something like this:\n\n\n\n\n\n\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                              [Page 10]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-11\" id=\"page-11\" href=\"#page-11\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n                ---------------------------------------\n                |Sender IP Address   223.1.2.2        |\n                |Sender Enet Address 08-00-28-00-38-A9|\n                ---------------------------------------\n                |Target IP Address   223.1.2.1        |\n                |Target Enet Address 08-00-39-00-2F-C3|\n                ---------------------------------------\n                     TABLE 3.  Example ARP Response\n\n   The response is received by the original sender computer.  The\n   Ethernet driver looks at the Type field in the Ethernet frame then\n   passes the ARP packet to the ARP module.  The ARP module examines the\n   ARP packet and adds the sender's IP and Ethernet addresses to its ARP\n   table.\n\n   The updated table now looks like this:\n\n                   ----------------------------------\n                   |IP address     Ethernet address |\n                   ----------------------------------\n                   |223.1.2.1      08-00-39-00-2F-C3|\n                   |223.1.2.2      08-00-28-00-38-A9|\n                   |223.1.2.3      08-00-5A-21-A7-22|\n                   |223.1.2.4      08-00-10-99-AC-54|\n                   ----------------------------------\n                   TABLE 4.  ARP Table after Response\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-4.4\" href=\"#section-4.4\">4.4</a>  Scenario Continued</h3></span>\n\n   The new translation has now been installed automatically in the\n   table, just milli-seconds after it was needed.  As you remember from\n   step 2 above, the outgoing IP packet was queued.  Next, the IP\n   address to Ethernet address translation is performed by look-up in\n   the ARP table then the Ethernet frame is transmitted on the Ethernet.\n   Therefore, with the new steps 3, 4, and 5, the scenario for the\n   sender computer is:\n\n     1. An ARP request packet with a broadcast Ethernet address is sent\n        out on the network to every computer.\n\n     2. The outgoing IP packet is queued.\n\n     3. The ARP response arrives with the IP-to-Ethernet address\n        translation for the ARP table.\n\n\n\n\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                              [Page 11]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-12\" id=\"page-12\" href=\"#page-12\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n     4. For the queued IP packet, the ARP table is used to translate the\n        IP address to the Ethernet address.\n\n     5. The Ethernet frame is transmitted on the Ethernet.\n\n   In summary, when the translation is missing from the ARP table, one\n   IP packet is queued.  The translation data is quickly filled in with\n   ARP request/response and the queued IP packet is transmitted.\n\n   Each computer has a separate ARP table for each of its Ethernet\n   interfaces.  If the target computer does not exist, there will be no\n   ARP response and no entry in the ARP table.  IP will discard outgoing\n   IP packets sent to that address.  The upper layer protocols can't\n   tell the difference between a broken Ethernet and the absence of a\n   computer with the target IP address.\n\n   Some implementations of IP and ARP don't queue the IP packet while\n   waiting for the ARP response.  Instead the IP packet is discarded and\n   the recovery from the IP packet loss is left to the TCP module or the\n   UDP network application.  This recovery is performed by time-out and\n   retransmission.  The retransmitted message is successfully sent out\n   onto the network because the first copy of the message has already\n   caused the ARP table to be filled.\n\n<span class=\"h2\"><h2><a class=\"selflink\" name=\"section-5\" href=\"#section-5\">5</a>.  Internet Protocol</h2></span>\n\n   The IP module is central to internet technology and the essence of IP\n   is its route table.  IP uses this in-memory table to make all\n   decisions about routing an IP packet.  The content of the route table\n   is defined by the network administrator.  Mistakes block\n   communication.\n\n   To understand how a route table is used is to understand\n   internetworking.  This understanding is necessary for the successful\n   administration and maintenance of an IP network.\n\n   The route table is best understood by first having an overview of\n   routing, then learning about IP network addresses, and then looking\n   at the details.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-5.1\" href=\"#section-5.1\">5.1</a>  Direct Routing</h3></span>\n\n   The figure below is of a tiny internet with 3 computers: A, B, and C.\n   Each computer has the same TCP/IP protocol stack as in Figure 1.\n   Each computer's Ethernet interface has its own Ethernet address.\n   Each computer has an IP address assigned to the IP interface by the\n   network manager, who also has assigned an IP network number to the\n   Ethernet.\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                              [Page 12]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-13\" id=\"page-13\" href=\"#page-13\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n                          A      B      C\n                          |      |      |\n                        --o------o------o--\n                        Ethernet 1\n                        IP network \"development\"\n\n                       Figure 6.  One IP Network\n\n   When A sends an IP packet to B, the IP header contains A's IP address\n   as the source IP address, and the Ethernet header contains A's\n   Ethernet address as the source Ethernet address.  Also, the IP header\n   contains B's IP address as the destination IP address and the\n   Ethernet header contains B's Ethernet address as the destination\n   Ethernet address.\n\n                ----------------------------------------\n                |address            source  destination|\n                ----------------------------------------\n                |IP header          A       B          |\n                |Ethernet header    A       B          |\n                ----------------------------------------\n       TABLE 5.  Addresses in an Ethernet frame for an IP packet\n                              from A to B\n\n   For this simple case, IP is overhead because the IP adds little to\n   the service offered by Ethernet.  However, IP does add cost: the\n   extra CPU processing and network bandwidth to generate, transmit, and\n   parse the IP header.\n\n   When B's IP module receives the IP packet from A, it checks the\n   destination IP address against its own, looking for a match, then it\n   passes the datagram to the upper-level protocol.\n\n   This communication between A and B uses direct routing.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-5.2\" href=\"#section-5.2\">5.2</a>  Indirect Routing</h3></span>\n\n   The figure below is a more realistic view of an internet.  It is\n   composed of 3 Ethernets and 3 IP networks connected by an IP-router\n   called computer D.  Each IP network has 4 computers; each computer\n   has its own IP address and Ethernet address.\n\n\n\n\n\n\n\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                              [Page 13]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-14\" id=\"page-14\" href=\"#page-14\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n          A      B      C      ----D----      E      F      G\n          |      |      |      |   |   |      |      |      |\n        --o------o------o------o-  |  -o------o------o------o--\n        Ethernet 1                 |  Ethernet 2\n        IP network \"development\"   |  IP network \"accounting\"\n                                   |\n                                   |\n                                   |     H      I      J\n                                   |     |      |      |\n                                 --o-----o------o------o--\n                                  Ethernet 3\n                                  IP network \"factory\"\n\n               Figure 7.  Three IP Networks; One internet\n\n   Except for computer D, each computer has a TCP/IP protocol stack like\n   that in Figure 1.  Computer D is the IP-router; it is connected to\n   all 3 networks and therefore has 3 IP addresses and 3 Ethernet\n   addresses.  Computer D has a TCP/IP protocol stack similar to that in\n   Figure 3, except that it has 3 ARP modules and 3 Ethernet drivers\n   instead of 2.  Please note that computer D has only one IP module.\n\n   The network manager has assigned a unique number, called an IP\n   network number, to each of the Ethernets.  The IP network numbers are\n   not shown in this diagram, just the network names.\n\n   When computer A sends an IP packet to computer B, the process is\n   identical to the single network example above.  Any communication\n   between computers located on a single IP network matches the direct\n   routing example discussed previously.\n\n   When computer D and A communicate, it is direct communication.  When\n   computer D and E communicate, it is direct communication.  When\n   computer D and H communicate, it is direct communication.  This is\n   because each of these pairs of computers is on the same IP network.\n\n   However, when computer A communicates with a computer on the far side\n   of the IP-router, communication is no longer direct.  A must use D to\n   forward the IP packet to the next IP network.  This communication is\n   called \"indirect\".\n\n   This routing of IP packets is done by IP modules and happens\n   transparently to TCP, UDP, and the network applications.\n\n   If A sends an IP packet to E, the source IP address and the source\n   Ethernet address are A's.  The destination IP address is E's, but\n   because A's IP module sends the IP packet to D for forwarding, the\n   destination Ethernet address is D's.\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                              [Page 14]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-15\" id=\"page-15\" href=\"#page-15\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n                ----------------------------------------\n                |address            source  destination|\n                ----------------------------------------\n                |IP header          A       E          |\n                |Ethernet header    A       D          |\n                ----------------------------------------\n       TABLE 6.  Addresses in an Ethernet frame for an IP packet\n                         from A to E (before D)\n\n   D's IP module receives the IP packet and upon examining the\n   destination IP address, says \"This is not my IP address,\" and sends\n   the IP packet directly to E.\n\n                ----------------------------------------\n                |address            source  destination|\n                ----------------------------------------\n                |IP header          A       E          |\n                |Ethernet header    D       E          |\n                ----------------------------------------\n       TABLE 7.  Addresses in an Ethernet frame for an IP packet\n                         from A to E (after D)\n\n   In summary, for direct communication, both the source IP address and\n   the source Ethernet address is the sender's, and the destination IP\n   address and the destination Ethernet address is the recipient's.  For\n   indirect communication, the IP address and Ethernet addresses do not\n   pair up in this way.\n\n   This example internet is a very simple one.  Real networks are often\n   complicated by many factors, resulting in multiple IP-routers and\n   several types of physical networks.  This example internet might have\n   come about because the network manager wanted to split a large\n   Ethernet in order to localize Ethernet broadcast traffic.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-5.3\" href=\"#section-5.3\">5.3</a>  IP Module Routing Rules</h3></span>\n\n   This overview of routing has shown what happens, but not how it\n   happens.  Now let's examine the rules, or algorithm, used by the IP\n   module.\n\n     For an outgoing IP packet, entering IP from an upper layer, IP must\n     decide whether to send the IP packet directly or indirectly, and IP\n     must choose a lower network interface.  These choices are made by\n     consulting the route table.\n\n     For an incoming IP packet, entering IP from a lower interface, IP\n     must decide whether to forward the IP packet or pass it to an upper\n     layer.  If the IP packet is being forwarded, it is treated as an\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                              [Page 15]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-16\" id=\"page-16\" href=\"#page-16\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n     outgoing IP packet.\n\n     When an incoming IP packet arrives it is never forwarded back out\n     through the same network interface.\n\n   These decisions are made before the IP packet is handed to the lower\n   interface and before the ARP table is consulted.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-5.4\" href=\"#section-5.4\">5.4</a>  IP Address</h3></span>\n\n   The network manager assigns IP addresses to computers according to\n   the IP network to which the computer is attached.  One part of a 4-\n   byte IP address is the IP network number, the other part is the IP\n   computer number (or host number).  For the computer in table 1, with\n   an IP address of 223.1.2.1, the network number is 223.1.2 and the\n   host number is number 1.\n\n   The portion of the address that is used for network number and for\n   host number is defined by the upper bits in the 4-byte address.  All\n   example IP addresses in this tutorial are of type class C, meaning\n   that the upper 3 bits indicate that 21 bits are the network number\n   and 8 bits are the host number.  This allows 2,097,152 class C\n   networks up to 254 hosts on each network.\n\n   The IP address space is administered by the NIC (Network Information\n   Center).  All internets that are connected to the single world-wide\n   Internet must use network numbers assigned by the NIC.  If you are\n   setting up your own internet and you are not intending to connect it\n   to the Internet, you should still obtain your network numbers from\n   the NIC.  If you pick your own number, you run the risk of confusion\n   and chaos in the eventuality that your internet is connected to\n   another internet.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-5.5\" href=\"#section-5.5\">5.5</a>  Names</h3></span>\n\n   People refer to computers by names, not numbers.  A computer called\n   alpha might have the IP address of 223.1.2.1.  For small networks,\n   this name-to-address translation data is often kept on each computer\n   in the \"hosts\" file.  For larger networks, this translation data file\n   is stored on a server and accessed across the network when needed.  A\n   few lines from that file might look like this:\n\n   223.1.2.1     alpha\n   223.1.2.2     beta\n   223.1.2.3     gamma\n   223.1.2.4     delta\n   223.1.3.2     epsilon\n   223.1.4.2     iota\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                              [Page 16]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-17\" id=\"page-17\" href=\"#page-17\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n   The IP address is the first column and the computer name is the\n   second column.\n\n   In most cases, you can install identical \"hosts\" files on all\n   computers.  You may notice that \"delta\" has only one entry in this\n   file even though it has 3 IP addresses.  Delta can be reached with\n   any of its IP addresses; it does not matter which one is used.  When\n   delta receives an IP packet and looks at the destination address, it\n   will recognize any of its own IP addresses.\n\n   IP networks are also given names.  If you have 3 IP networks, your\n   \"networks\" file for documenting these names might look something like\n   this:\n\n   223.1.2     development\n   223.1.3     accounting\n   223.1.4     factory\n\n   The IP network number is in the first column and its name is in the\n   second column.\n\n   From this example you can see that alpha is computer number 1 on the\n   development network, beta is computer number 2 on the development\n   network and so on.  You might also say that alpha is development.1,\n   Beta is development.2, and so on.\n\n   The above hosts file is adequate for the users, but the network\n   manager will probably replace the line for delta with:\n\n   223.1.2.4     devnetrouter    delta\n   223.1.3.1     facnetrouter\n   223.1.4.1     accnetrouter\n\n   These three new lines for the hosts file give each of delta's IP\n   addresses a meaningful name.  In fact, the first IP address listed\n   has 2 names; \"delta\" and \"devnetrouter\" are synonyms.  In practice\n   \"delta\" is the general-purpose name of the computer and the other 3\n   names are only used when administering the IP route table.\n\n   These files are used by network administration commands and network\n   applications to provide meaningful names.  They are not required for\n   operation of an internet, but they do make it easier for us.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-5.6\" href=\"#section-5.6\">5.6</a>  IP Route Table</h3></span>\n\n   How does IP know which lower network interface to use when sending\n   out a IP packet?  IP looks it up in the route table using a search\n   key of the IP network number extracted from the IP destination\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                              [Page 17]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-18\" id=\"page-18\" href=\"#page-18\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n   address.\n\n   The route table contains one row for each route.  The primary columns\n   in the route table are:  IP network number, direct/indirect flag,\n   router IP address, and interface number.  This table is referred to\n   by IP for each outgoing IP packet.\n\n   On most computers the route table can be modified with the \"route\"\n   command.  The content of the route table is defined by the network\n   manager, because the network manager assigns the IP addresses to the\n   computers.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-5.7\" href=\"#section-5.7\">5.7</a>  Direct Routing Details</h3></span>\n\n   To explain how it is used, let us visit in detail the routing\n   situations we have reviewed previously.\n\n                        ---------         ---------\n                        | alpha |         | beta  |\n                        |    1  |         |  1    |\n                        ---------         ---------\n                             |               |\n                     --------o---------------o-\n                      Ethernet 1\n                      IP network \"development\"\n\n               Figure 8.  Close-up View of One IP Network\n\n   The route table inside alpha looks like this:\n\n     --------------------------------------------------------------\n     |network      direct/indirect flag  router   interface number|\n     --------------------------------------------------------------\n     |development  direct                &lt;blank&gt;  1               |\n     --------------------------------------------------------------\n                  TABLE 8.  Example Simple Route Table\n\n   This view can be seen on some UNIX systems with the \"netstat -r\"\n   command.  With this simple network, all computers have identical\n   routing tables.\n\n   For discussion, the table is printed again without the network number\n   translated to its network name.\n\n\n\n\n\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                              [Page 18]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-19\" id=\"page-19\" href=\"#page-19\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n     --------------------------------------------------------------\n     |network      direct/indirect flag  router   interface number|\n     --------------------------------------------------------------\n     |223.1.2      direct                &lt;blank&gt;  1               |\n     --------------------------------------------------------------\n           TABLE 9.  Example Simple Route Table with Numbers\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-5.8\" href=\"#section-5.8\">5.8</a>  Direct Scenario</h3></span>\n\n   Alpha is sending an IP packet to beta.  The IP packet is in alpha's\n   IP module and the destination IP address is beta or 223.1.2.2.  IP\n   extracts the network portion of this IP address and scans the first\n   column of the table looking for a match.  With this network a match\n   is found on the first entry.\n\n   The other information in this entry indicates that computers on this\n   network can be reached directly through interface number 1.  An ARP\n   table translation is done on beta's IP address then the Ethernet\n   frame is sent directly to beta via interface number 1.\n\n   If an application tries to send data to an IP address that is not on\n   the development network, IP will be unable to find a match in the\n   route table.  IP then discards the IP packet.  Some computers provide\n   a \"Network not reachable\" error message.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-5.9\" href=\"#section-5.9\">5.9</a>  Indirect Routing Details</h3></span>\n\n   Now, let's take a closer look at the more complicated routing\n   scenario that we examined previously.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                              [Page 19]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-20\" id=\"page-20\" href=\"#page-20\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n          ---------           ---------           ---------\n          | alpha |           | delta |           |epsilon|\n          |    1  |           |1  2  3|           |   1   |\n          ---------           ---------           ---------\n               |               |  |  |                |\n       --------o---------------o- | -o----------------o--------\n        Ethernet 1                |     Ethernet 2\n        IP network \"Development\"  |     IP network \"accounting\"\n                                  |\n                                  |     --------\n                                  |     | iota |\n                                  |     |  1   |\n                                  |     --------\n                                  |        |\n                                --o--------o--------\n                                    Ethernet 3\n                                    IP network \"factory\"\n\n             Figure 9.  Close-up View of Three IP Networks\n\n   The route table inside alpha looks like this:\n\n ---------------------------------------------------------------------\n |network      direct/indirect flag  router          interface number|\n ---------------------------------------------------------------------\n |development  direct                &lt;blank&gt;         1               |\n |accounting   indirect              devnetrouter    1               |\n |factory      indirect              devnetrouter    1               |\n ---------------------------------------------------------------------\n                      TABLE 10.  Alpha Route Table\n\n   For discussion the table is printed again using numbers instead of\n   names.\n\n  --------------------------------------------------------------------\n  |network      direct/indirect flag  router         interface number|\n  --------------------------------------------------------------------\n  |223.1.2      direct                &lt;blank&gt;        1               |\n  |223.1.3      indirect              223.1.2.4      1               |\n  |223.1.4      indirect              223.1.2.4      1               |\n  --------------------------------------------------------------------\n               TABLE 11.  Alpha Route Table with Numbers\n\n   The router in Alpha's route table is the IP address of delta's\n   connection to the development network.\n\n\n\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                              [Page 20]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-21\" id=\"page-21\" href=\"#page-21\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-5.10\" href=\"#section-5.10\">5.10</a>  Indirect Scenario</h3></span>\n\n   Alpha is sending an IP packet to epsilon.  The IP packet is in\n   alpha's IP module and the destination IP address is epsilon\n   (223.1.3.2).  IP extracts the network portion of this IP address\n   (223.1.3) and scans the first column of the table looking for a\n   match.  A match is found on the second entry.\n\n   This entry indicates that computers on the 223.1.3 network can be\n   reached through the IP-router devnetrouter.  Alpha's IP module then\n   does an ARP table translation for devnetrouter's IP address and sends\n   the IP packet directly to devnetrouter through Alpha's interface\n   number 1.  The IP packet still contains the destination address of\n   epsilon.\n\n   The IP packet arrives at delta's development network interface and is\n   passed up to delta's IP module.  The destination IP address is\n   examined and because it does not match any of delta's own IP\n   addresses, delta decides to forward the IP packet.\n\n   Delta's IP module extracts the network portion of the destination IP\n   address (223.1.3) and scans its route table for a matching network\n   field.  Delta's route table looks like this:\n\n ----------------------------------------------------------------------\n |network      direct/indirect flag  router           interface number|\n ----------------------------------------------------------------------\n |development  direct                &lt;blank&gt;          1               |\n |factory      direct                &lt;blank&gt;          3               |\n |accounting   direct                &lt;blank&gt;          2               |\n ----------------------------------------------------------------------\n                     TABLE 12.  Delta's Route Table\n\n   Below is delta's table printed again, without the translation to\n   names.\n\n ----------------------------------------------------------------------\n |network      direct/indirect flag  router           interface number|\n ----------------------------------------------------------------------\n |223.1.2      direct                &lt;blank&gt;          1               |\n |223.1.3      direct                &lt;blank&gt;          3               |\n |223.1.4      direct                &lt;blank&gt;          2               |\n ----------------------------------------------------------------------\n              TABLE 13.  Delta's Route Table with Numbers\n\n   The match is found on the second entry.  IP then sends the IP packet\n   directly to epsilon through interface number 3.  The IP packet\n   contains the IP destination address of epsilon and the Ethernet\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                              [Page 21]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-22\" id=\"page-22\" href=\"#page-22\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n   destination address of epsilon.\n\n   The IP packet arrives at epsilon and is passed up to epsilon's IP\n   module.  The destination IP address is examined and found to match\n   with epsilon's IP address, so the IP packet is passed to the upper\n   protocol layer.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-5.11\" href=\"#section-5.11\">5.11</a>  Routing Summary</h3></span>\n\n   When a IP packet travels through a large internet it may go through\n   many IP-routers before it reaches its destination.  The path it takes\n   is not determined by a central source but is a result of consulting\n   each of the routing tables used in the journey.  Each computer\n   defines only the next hop in the journey and relies on that computer\n   to send the IP packet on its way.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-5.12\" href=\"#section-5.12\">5.12</a>  Managing the Routes</h3></span>\n\n   Maintaining correct routing tables on all computers in a large\n   internet is a difficult task; network configuration is being modified\n   constantly by the network managers to meet changing needs.  Mistakes\n   in routing tables can block communication in ways that are\n   excruciatingly tedious to diagnose.\n\n   Keeping a simple network configuration goes a long way towards making\n   a reliable internet.  For instance, the most straightforward method\n   of assigning IP networks to Ethernet is to assign a single IP network\n   number to each Ethernet.\n\n   Help is also available from certain protocols and network\n   applications.  ICMP (Internet Control Message Protocol) can report\n   some routing problems.  For small networks the route table is filled\n   manually on each computer by the network administrator.  For larger\n   networks the network administrator automates this manual operation\n   with a routing protocol to distribute routes throughout a network.\n\n   When a computer is moved from one IP network to another, its IP\n   address must change.  When a computer is removed from an IP network\n   its old address becomes invalid.  These changes require frequent\n   updates to the \"hosts\" file.  This flat file can become difficult to\n   maintain for even medium-size networks.  The Domain Name System helps\n   solve these problems.\n\n<span class=\"h2\"><h2><a class=\"selflink\" name=\"section-6\" href=\"#section-6\">6</a>.  User Datagram Protocol</h2></span>\n\n   UDP is one of the two main protocols to reside on top of IP.  It\n   offers service to the user's network applications.  Example network\n   applications that use UDP are:  Network File System (NFS) and Simple\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                              [Page 22]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-23\" id=\"page-23\" href=\"#page-23\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n   Network Management Protocol (SNMP).  The service is little more than\n   an interface to IP.\n\n   UDP is a connectionless datagram delivery service that does not\n   guarantee delivery.  UDP does not maintain an end-to-end connection\n   with the remote UDP module; it merely pushes the datagram out on the\n   net and accepts incoming datagrams off the net.\n\n   UDP adds two values to what is provided by IP.  One is the\n   multiplexing of information between applications based on port\n   number.  The other is a checksum to check the integrity of the data.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-6.1\" href=\"#section-6.1\">6.1</a>  Ports</h3></span>\n\n   How does a client on one computer reach the server on another?\n\n   The path of communication between an application and UDP is through\n   UDP ports.  These ports are numbered, beginning with zero.  An\n   application that is offering service (the server) waits for messages\n   to come in on a specific port dedicated to that service.  The server\n   waits patiently for any client to request service.\n\n   For instance, the SNMP server, called an SNMP agent, always waits on\n   port 161.  There can be only one SNMP agent per computer because\n   there is only one UDP port number 161.  This port number is well\n   known; it is a fixed number, an internet assigned number.  If an SNMP\n   client wants service, it sends its request to port number 161 of UDP\n   on the destination computer.\n\n   When an application sends data out through UDP it arrives at the far\n   end as a single unit.  For example, if an application does 5 writes\n   to the UDP port, the application at the far end will do 5 reads from\n   the UDP port.  Also, the size of each write matches the size of each\n   read.\n\n   UDP preserves the message boundary defined by the application.  It\n   never joins two application messages together, or divides a single\n   application message into parts.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-6.2\" href=\"#section-6.2\">6.2</a>  Checksum</h3></span>\n\n   An incoming IP packet with an IP header type field indicating \"UDP\"\n   is passed up to the UDP module by IP.  When the UDP module receives\n   the UDP datagram from IP it examines the UDP checksum.  If the\n   checksum is zero, it means that checksum was not calculated by the\n   sender and can be ignored.  Thus the sending computer's UDP module\n   may or may not generate checksums.  If Ethernet is the only network\n   between the 2 UDP modules communicating, then you may not need\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                              [Page 23]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-24\" id=\"page-24\" href=\"#page-24\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n   checksumming.  However, it is recommended that checksum generation\n   always be enabled because at some point in the future a route table\n   change may send the data across less reliable media.\n\n   If the checksum is valid (or zero), the destination port number is\n   examined and if an application is bound to that port, an application\n   message is queued for the application to read.  Otherwise the UDP\n   datagram is discarded.  If the incoming UDP datagrams arrive faster\n   than the application can read them and if the queue fills to a\n   maximum value, UDP datagrams are discarded by UDP.  UDP will continue\n   to discard UDP datagrams until there is space in the queue.\n\n<span class=\"h2\"><h2><a class=\"selflink\" name=\"section-7\" href=\"#section-7\">7</a>.  Transmission Control Protocol</h2></span>\n\n   TCP provides a different service than UDP.  TCP offers a connection-\n   oriented byte stream, instead of a connectionless datagram delivery\n   service.  TCP guarantees delivery, whereas UDP does not.\n\n   TCP is used by network applications that require guaranteed delivery\n   and cannot be bothered with doing time-outs and retransmissions.  The\n   two most typical network applications that use TCP are File Transfer\n   Protocol (FTP) and the TELNET.  Other popular TCP network\n   applications include X-Window System, rcp (remote copy), and the r-\n   series commands.  TCP's greater capability is not without cost: it\n   requires more CPU and network bandwidth.  The internals of the TCP\n   module are much more complicated than those in a UDP module.\n\n   Similar to UDP, network applications connect to TCP ports.  Well-\n   defined port numbers are dedicated to specific applications.  For\n   instance, the TELNET server uses port number 23.  The TELNET client\n   can find the server simply by connecting to port 23 of TCP on the\n   specified computer.\n\n   When the application first starts using TCP, the TCP module on the\n   client's computer and the TCP module on the server's computer start\n   communicating with each other.  These two end-point TCP modules\n   contain state information that defines a virtual circuit.  This\n   virtual circuit consumes resources in both TCP end-points.  The\n   virtual circuit is full duplex; data can go in both directions\n   simultaneously.  The application writes data to the TCP port, the\n   data traverses the network and is read by the application at the far\n   end.\n\n   TCP packetizes the byte stream at will; it does not retain the\n   boundaries between writes.  For example, if an application does 5\n   writes to the TCP port, the application at the far end might do 10\n   reads to get all the data.  Or it might get all the data with a\n   single read.  There is no correlation between the number and size of\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                              [Page 24]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-25\" id=\"page-25\" href=\"#page-25\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n   writes at one end to the number and size of reads at the other end.\n\n   TCP is a sliding window protocol with time-out and retransmits.\n   Outgoing data must be acknowledged by the far-end TCP.\n   Acknowledgements can be piggybacked on data.  Both receiving ends can\n   flow control the far end, thus preventing a buffer overrun.\n\n   As with all sliding window protocols, the protocol has a window size.\n   The window size determines the amount of data that can be transmitted\n   before an acknowledgement is required.  For TCP, this amount is not a\n   number of TCP segments but a number of bytes.\n\n<span class=\"h2\"><h2><a class=\"selflink\" name=\"section-8\" href=\"#section-8\">8</a>.  Network Applications</h2></span>\n\n   Why do both TCP and UDP exist, instead of just one or the other?\n\n   They supply different services.  Most applications are implemented to\n   use only one or the other.  You, the programmer, choose the protocol\n   that best meets your needs.  If you need a reliable stream delivery\n   service, TCP might be best.  If you need a datagram service, UDP\n   might be best.  If you need efficiency over long-haul circuits, TCP\n   might be best.  If you need efficiency over fast networks with short\n   latency, UDP might be best.  If your needs do not fall nicely into\n   these categories, then the \"best\" choice is unclear.  However,\n   applications can make up for deficiencies in the choice.  For\n   instance if you choose UDP and you need reliability, then the\n   application must provide reliability.  If you choose TCP and you need\n   a record oriented service, then the application must insert markers\n   in the byte stream to delimit records.\n\n   What network applications are available?\n\n   There are far too many to list.  The number is growing continually.\n   Some of the applications have existed since the beginning of internet\n   technology: TELNET and FTP.  Others are relatively new: X-Windows and\n   SNMP.  The following is a brief description of the applications\n   mentioned in this tutorial.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-8.1\" href=\"#section-8.1\">8.1</a>  TELNET</h3></span>\n\n   TELNET provides a remote login capability on TCP.  The operation and\n   appearance is similar to keyboard dialing through a telephone switch.\n   On the command line the user types \"telnet delta\" and receives a\n   login prompt from the computer called \"delta\".\n\n   TELNET works well; it is an old application and has widespread\n   interoperability.  Implementations of TELNET usually work between\n   different operating systems.  For instance, a TELNET client may be on\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                              [Page 25]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-26\" id=\"page-26\" href=\"#page-26\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n   VAX/VMS and the server on UNIX System V.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-8.2\" href=\"#section-8.2\">8.2</a>  FTP</h3></span>\n\n   File Transfer Protocol (FTP), as old as TELNET, also uses TCP and has\n   widespread interoperability.  The operation and appearance is as if\n   you TELNETed to the remote computer.  But instead of typing your\n   usual commands, you have to make do with a short list of commands for\n   directory listings and the like.  FTP commands allow you to copy\n   files between computers.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-8.3\" href=\"#section-8.3\">8.3</a>  rsh</h3></span>\n\n   Remote shell (rsh or remsh) is one of an entire family of remote UNIX\n   style commands.  The UNIX copy command, cp, becomes rcp.  The UNIX\n   \"who is logged in\" command, who, becomes rwho.  The list continues\n   and is referred to collectively to as the \"r\" series commands or the\n   \"r*\" (r star) commands.\n\n   The r* commands mainly work between UNIX systems and are designed for\n   interaction between trusted hosts.  Little consideration is given to\n   security, but they provide a convenient user environment.\n\n   To execute the \"cc file.c\" command on a remote computer called delta,\n   type \"rsh delta cc file.c\".  To copy the \"file.c\" file to delta, type\n   \"rcp file.c delta:\".  To login to delta, type \"rlogin delta\", and if\n   you administered the computers in a certain way, you will not be\n   challenged with a password prompt.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-8.4\" href=\"#section-8.4\">8.4</a>  NFS</h3></span>\n\n   Network File System, first developed by Sun Microsystems Inc, uses\n   UDP and is excellent for mounting UNIX file systems on multiple\n   computers.  A diskless workstation can access its server's hard disk\n   as if the disk were local to the workstation.  A single disk copy of\n   a database on mainframe \"alpha\" can also be used by mainframe \"beta\"\n   if the database's file system is NFS mounted on \"beta\".\n\n   NFS adds significant load to a network and has poor utility across\n   slow links, but the benefits are strong.  The NFS client is\n   implemented in the kernel, allowing all applications and commands to\n   use the NFS mounted disk as if it were local disk.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-8.5\" href=\"#section-8.5\">8.5</a>  SNMP</h3></span>\n\n   Simple Network Management Protocol (SNMP) uses UDP and is designed\n   for use by central network management stations.  It is a well known\n   fact that if given enough data, a network manager can detect and\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                              [Page 26]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-27\" id=\"page-27\" href=\"#page-27\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n   diagnose network problems.  The central station uses SNMP to collect\n   this data from other computers on the network.  SNMP defines the\n   format for the data; it is left to the central station or network\n   manager to interpret the data.\n\n<span class=\"h3\"><h3><a class=\"selflink\" name=\"section-8.6\" href=\"#section-8.6\">8.6</a>  X-Window</h3></span>\n\n   The X Window System uses the X Window protocol on TCP to draw windows\n   on a workstation's bitmap display.  X Window is much more than a\n   utility for drawing windows; it is entire philosophy for designing a\n   user interface.\n\n<span class=\"h2\"><h2><a class=\"selflink\" name=\"section-9\" href=\"#section-9\">9</a>.  Other Information</h2></span>\n\n   Much information about internet technology was not included in this\n   tutorial.  This section lists information that is considered the next\n   level of detail for the reader who wishes to learn more.\n\n     o administration commands: arp, route, and netstat\n     o ARP: permanent entry, publish entry, time-out entry, spoofing\n     o IP route table: host entry, default gateway, subnets\n     o IP: time-to-live counter, fragmentation, ICMP\n     o RIP, routing loops\n     o Domain Name System\n\n<span class=\"h2\"><h2><a class=\"selflink\" name=\"section-10\" href=\"#section-10\">10</a>.  References</h2></span>\n\n   [<a name=\"ref-1\" id=\"ref-1\">1</a>] Comer, D., \"Internetworking with TCP/IP Principles, Protocols,\n       and Architecture\", Prentice Hall, Englewood Cliffs, New Jersey,\n       U.S.A., 1988.\n\n   [<a name=\"ref-2\" id=\"ref-2\">2</a>] Feinler, E., et al, DDN Protocol Handbook, Volume 2 and 3, DDN\n       Network Information Center, SRI International, 333 Ravenswood\n       Avenue, Room EJ291, Menlow Park, California, U.S.A., 1985.\n\n   [<a name=\"ref-3\" id=\"ref-3\">3</a>] Spider Systems, Ltd., \"Packets and Protocols\", Spider Systems\n       Ltd., Stanwell Street, Edinburgh, U.K. EH6 5NG, 1990.\n\n<span class=\"h2\"><h2><a class=\"selflink\" name=\"section-11\" href=\"#section-11\">11</a>.  Relation to other RFCs</h2></span>\n\n   This RFC is a tutorial and it does not UPDATE or OBSOLETE any other\n   RFC.\n\n<span class=\"h2\"><h2><a class=\"selflink\" name=\"section-12\" href=\"#section-12\">12</a>.  Security Considerations</h2></span>\n\n   There are security considerations within the TCP/IP protocol suite.\n   To some people these considerations are serious problems, to others\n   they are not; it depends on the user requirements.\n\n\n\n<span class=\"grey\">Socolofsky &amp; Kale                                              [Page 27]</span></pre>\n<hr class=\"noprint\" style=\"width: 96ex;\" align=\"left\"><!--NewPage--><pre class=\"newpage\"><a name=\"page-28\" id=\"page-28\" href=\"#page-28\" class=\"invisible\"> </a>\n<span class=\"grey\"><a href=\"./rfc1180\">RFC 1180</a>                   A TCP/IP Tutorial                January 1991</span>\n\n\n   This tutorial does not discuss these issues, but if you want to learn\n   more you should start with the topic of ARP-spoofing, then use the\n   \"Security Considerations\" section of <a href=\"./rfc1122\">RFC 1122</a> to lead you to more\n   information.\n\n<span class=\"h2\"><h2><a class=\"selflink\" name=\"section-13\" href=\"#section-13\">13</a>.  Authors' Addresses</h2></span>\n\n   Theodore John Socolofsky\n   Spider Systems Limited\n   Spider Park\n   Stanwell Street\n   Edinburgh EH6 5NG\n   United Kingdom\n\n   Phone:\n     from UK        031-554-9424\n     from USA 011-44-31-554-9424\n   Fax:\n     from UK        031-554-0649\n     from USA 011-44-31-554-0649\n\n   EMail: TEDS@SPIDER.CO.UK\n\n\n   Claudia Jeanne Kale\n   12 Gosford Place\n   Edinburgh EH6 4BJ\n   United Kingdom\n\n   Phone:\n     from UK        031-554-7432\n     from USA 011-44-31-554-7432\n\n   EMail: CLAUDIAK@SPIDER.CO.UK\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nSocolofsky &amp; Kale                                              [Page 28]\n\n</pre><br>\n    <span class=\"noprint\"><small><small>Html markup produced by rfcmarkup 1.129d, available from\n      <a href=\"https://tools.ietf.org/tools/rfcmarkup/\">https://tools.ietf.org/tools/rfcmarkup/</a>\n    </small></small></span>\n  </div>\n\n\n","text":"                                                                        \n[Docs] [txt|pdf] [Tracker] [Errata]                                     \n                                                                        \n                                                           INFORMATIONAL\n                                                            Errata Exist\n\nNetwork Working Group                                      T. Socolofsky\nRequest for Comments:  1180                                      C. Kale\n                                                  Spider Systems Limited\n                                                            January 1991\n\n\n                           A TCP/IP Tutorial\n\nStatus of this Memo\n\n   This RFC is a tutorial on the TCP/IP protocol suite, focusing\n   particularly on the steps in forwarding an IP datagram from source\n   host to destination host through a router.  It does not specify an\n   Internet standard.  Distribution of this memo is unlimited.\n\nTable of Contents\n\n    1.  Introduction................................................   1\n    2.  TCP/IP Overview.............................................   2\n    3.  Ethernet....................................................   8\n    4.  ARP.........................................................   9\n    5.  Internet Protocol...........................................  12\n    6.  User Datagram Protocol......................................  22\n    7.  Transmission Control Protocol...............................  24\n    8.  Network Applications........................................  25\n    9.  Other Information...........................................  27\n   10.  References..................................................  27\n   11.  Relation to other RFCs......................................  27\n   12.  Security Considerations.....................................  27\n   13.  Authors' Addresses..........................................  28\n\n1.  Introduction\n\n   This tutorial contains only one view of the salient points of TCP/IP,\n   and therefore it is the \"bare bones\" of TCP/IP technology.  It omits\n   the history of development and funding, the business case for its\n   use, and its future as compared to ISO OSI.  Indeed, a great deal of\n   technical information is also omitted.  What remains is a minimum of\n   information that must be understood by the professional working in a\n   TCP/IP environment.  These professionals include the systems\n   administrator, the systems programmer, and the network manager.\n\n   This tutorial uses examples from the UNIX TCP/IP environment, however\n   the main points apply across all implementations of TCP/IP.\n\n   Note that the purpose of this memo is explanation, not definition.\n   If any question arises about the correct specification of a protocol,\n   please refer to the actual standards defining RFC.\n\n\n\nSocolofsky & Kale                                               [Page 1]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n   The next section is an overview of TCP/IP, followed by detailed\n   descriptions of individual components.\n\n2.  TCP/IP Overview\n\n   The generic term \"TCP/IP\" usually means anything and everything\n   related to the specific protocols of TCP and IP.  It can include\n   other protocols, applications, and even the network medium.  A sample\n   of these protocols are: UDP, ARP, and ICMP.  A sample of these\n   applications are: TELNET, FTP, and rcp.  A more accurate term is\n   \"internet technology\".  A network that uses internet technology is\n   called an \"internet\".\n\n2.1  Basic Structure\n\n   To understand this technology you must first understand the following\n   logical structure:\n\n                     ----------------------------\n                     |    network applications  |\n                     |                          |\n                     |...  \\ | /  ..  \\ | /  ...|\n                     |     -----      -----     |\n                     |     |TCP|      |UDP|     |\n                     |     -----      -----     |\n                     |         \\      /         |\n                     |         --------         |\n                     |         |  IP  |         |\n                     |  -----  -*------         |\n                     |  |ARP|   |               |\n                     |  -----   |               |\n                     |      \\   |               |\n                     |      ------              |\n                     |      |ENET|              |\n                     |      ---@--              |\n                     ----------|-----------------\n                               |\n         ----------------------o---------\n             Ethernet Cable\n\n                  Figure 1.  Basic TCP/IP Network Node\n\n   This is the logical structure of the layered protocols inside a\n   computer on an internet.  Each computer that can communicate using\n   internet technology has such a logical structure.  It is this logical\n   structure that determines the behavior of the computer on the\n   internet.  The boxes represent processing of the data as it passes\n   through the computer, and the lines connecting boxes show the path of\n\n\n\nSocolofsky & Kale                                               [Page 2]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n   data.  The horizontal line at the bottom represents the Ethernet\n   cable; the \"o\" is the transceiver.  The \"*\" is the IP address and the\n   \"@\" is the Ethernet address.  Understanding this logical structure is\n   essential to understanding internet technology; it is referred to\n   throughout this tutorial.\n\n2.2  Terminology\n\n   The name of a unit of data that flows through an internet is\n   dependent upon where it exists in the protocol stack.  In summary: if\n   it is on an Ethernet it is called an Ethernet frame; if it is between\n   the Ethernet driver and the IP module it is called a IP packet; if it\n   is between the IP module and the UDP module it is called a UDP\n   datagram; if it is between the IP module and the TCP module it is\n   called a TCP segment (more generally, a transport message); and if it\n   is in a network application it is called a application message.\n\n   These definitions are imperfect.  Actual definitions vary from one\n   publication to the next.  More specific definitions can be found in\n   RFC 1122, section 1.3.3.\n\n   A driver is software that communicates directly with the network\n   interface hardware.  A module is software that communicates with a\n   driver, with network applications, or with another module.\n\n   The terms driver, module, Ethernet frame, IP packet, UDP datagram,\n   TCP message, and application message are used where appropriate\n   throughout this tutorial.\n\n2.3  Flow of Data\n\n   Let's follow the data as it flows down through the protocol stack\n   shown in Figure 1.  For an application that uses TCP (Transmission\n   Control Protocol), data passes between the application and the TCP\n   module.  For applications that use UDP (User Datagram Protocol), data\n   passes between the application and the UDP module.  FTP (File\n   Transfer Protocol) is a typical application that uses TCP.  Its\n   protocol stack in this example is FTP/TCP/IP/ENET.  SNMP (Simple\n   Network Management Protocol) is an application that uses UDP.  Its\n   protocol stack in this example is SNMP/UDP/IP/ENET.\n\n   The TCP module, UDP module, and the Ethernet driver are n-to-1\n   multiplexers.  As multiplexers they switch many inputs to one output.\n   They are also 1-to-n de-multiplexers.  As de-multiplexers they switch\n   one input to many outputs according to the type field in the protocol\n   header.\n\n\n\n\n\nSocolofsky & Kale                                               [Page 3]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n         1   2 3 ...   n                   1   2 3 ...   n\n          \\  |      /      |               \\  | |      /       ^\n           \\ | |   /       |                \\ | |     /        |\n         -------------   flow              ----------------   flow\n         |multiplexer|    of               |de-multiplexer|    of\n         -------------   data              ----------------   data\n              |            |                     |              |\n              |            v                     |              |\n              1                                  1\n\n        Figure 2.  n-to-1 multiplexer and 1-to-n de-multiplexer\n\n   If an Ethernet frame comes up into the Ethernet driver off the\n   network, the packet can be passed upwards to either the ARP (Address\n   Resolution Protocol) module or to the IP (Internet Protocol) module.\n   The value of the type field in the Ethernet frame determines whether\n   the Ethernet frame is passed to the ARP or the IP module.\n\n   If an IP packet comes up into IP, the unit of data is passed upwards\n   to either TCP or UDP, as determined by the value of the protocol\n   field in the IP header.\n\n   If the UDP datagram comes up into UDP, the application message is\n   passed upwards to the network application based on the value of the\n   port field in the UDP header.  If the TCP message comes up into TCP,\n   the application message is passed upwards to the network application\n   based on the value of the port field in the TCP header.\n\n   The downwards multiplexing is simple to perform because from each\n   starting point there is only the one downward path; each protocol\n   module adds its header information so the packet can be de-\n   multiplexed at the destination computer.\n\n   Data passing out from the applications through either TCP or UDP\n   converges on the IP module and is sent downwards through the lower\n   network interface driver.\n\n   Although internet technology supports many different network media,\n   Ethernet is used for all examples in this tutorial because it is the\n   most common physical network used under IP.  The computer in Figure 1\n   has a single Ethernet connection.  The 6-byte Ethernet address is\n   unique for each interface on an Ethernet and is located at the lower\n   interface of the Ethernet driver.\n\n   The computer also has a 4-byte IP address.  This address is located\n   at the lower interface to the IP module.  The IP address must be\n   unique for an internet.\n\n\n\n\nSocolofsky & Kale                                               [Page 4]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n   A running computer always knows its own IP address and Ethernet\n   address.\n\n2.4  Two Network Interfaces\n\n   If a computer is connected to 2 separate Ethernets it is as in Figure\n   3.\n\n                ----------------------------\n                |    network applications  |\n                |                          |\n                |...  \\ | /  ..  \\ | /  ...|\n                |     -----      -----     |\n                |     |TCP|      |UDP|     |\n                |     -----      -----     |\n                |         \\      /         |\n                |         --------         |\n                |         |  IP  |         |\n                |  -----  -*----*-  -----  |\n                |  |ARP|   |    |   |ARP|  |\n                |  -----   |    |   -----  |\n                |      \\   |    |   /      |\n                |      ------  ------      |\n                |      |ENET|  |ENET|      |\n                |      ---@--  ---@--      |\n                ----------|-------|---------\n                          |       |\n                          |    ---o---------------------------\n                          |             Ethernet Cable 2\n           ---------------o----------\n             Ethernet Cable 1\n\n             Figure 3.  TCP/IP Network Node on 2 Ethernets\n\n   Please note that this computer has 2 Ethernet addresses and 2 IP\n   addresses.\n\n   It is seen from this structure that for computers with more than one\n   physical network interface, the IP module is both a n-to-m\n   multiplexer and an m-to-n de-multiplexer.\n\n\n\n\n\n\n\n\n\n\n\nSocolofsky & Kale                                               [Page 5]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n         1   2 3 ...   n                   1   2 3 ...   n\n          \\  | |      /    |                \\  | |      /       ^\n           \\ | |     /     |                 \\ | |     /        |\n         -------------   flow              ----------------   flow\n         |multiplexer|    of               |de-multiplexer|    of\n         -------------   data              ----------------   data\n           / | |     \\     |                 / | |     \\        |\n          /  | |      \\    v                /  | |      \\       |\n         1   2 3 ...   m                   1   2 3 ...   m\n\n        Figure 4.  n-to-m multiplexer and m-to-n de-multiplexer\n\n   It performs this multiplexing in either direction to accommodate\n   incoming and outgoing data.  An IP module with more than 1 network\n   interface is more complex than our original example in that it can\n   forward data onto the next network.  Data can arrive on any network\n   interface and be sent out on any other.\n\n                           TCP      UDP\n                             \\      /\n                              \\    /\n                          --------------\n                          |     IP     |\n                          |            |\n                          |    ---     |\n                          |   /   \\    |\n                          |  /     v   |\n                          --------------\n                           /         \\\n                          /           \\\n                       data           data\n                      comes in         goes out\n                     here               here\n\n            Figure 5.  Example of IP Forwarding a IP Packet\n\n   The process of sending an IP packet out onto another network is\n   called \"forwarding\" an IP packet.  A computer that has been dedicated\n   to the task of forwarding IP packets is called an \"IP-router\".\n\n   As you can see from the figure, the forwarded IP packet never touches\n   the TCP and UDP modules on the IP-router.  Some IP-router\n   implementations do not have a TCP or UDP module.\n\n2.5  IP Creates a Single Logical Network\n\n   The IP module is central to the success of internet technology.  Each\n   module or driver adds its header to the message as the message passes\n\n\n\nSocolofsky & Kale                                               [Page 6]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n   down through the protocol stack.  Each module or driver strips the\n   corresponding header from the message as the message climbs the\n   protocol stack up towards the application.  The IP header contains\n   the IP address, which builds a single logical network from multiple\n   physical networks.  This interconnection of physical networks is the\n   source of the name: internet.  A set of interconnected physical\n   networks that limit the range of an IP packet is called an\n   \"internet\".\n\n2.6  Physical Network Independence\n\n   IP hides the underlying network hardware from the network\n   applications.  If you invent a new physical network, you can put it\n   into service by implementing a new driver that connects to the\n   internet underneath IP.  Thus, the network applications remain intact\n   and are not vulnerable to changes in hardware technology.\n\n2.7  Interoperability\n\n   If two computers on an internet can communicate, they are said to\n   \"interoperate\"; if an implementation of internet technology is good,\n   it is said to have \"interoperability\".  Users of general-purpose\n   computers benefit from the installation of an internet because of the\n   interoperability in computers on the market.  Generally, when you buy\n   a computer, it will interoperate.  If the computer does not have\n   interoperability, and interoperability can not be added, it occupies\n   a rare and special niche in the market.\n\n2.8  After the Overview\n\n   With the background set, we will answer the following questions:\n\n   When sending out an IP packet, how is the destination Ethernet\n   address determined?\n\n   How does IP know which of multiple lower network interfaces to use\n   when sending out an IP packet?\n\n   How does a client on one computer reach the server on another?\n\n   Why do both TCP and UDP exist, instead of just one or the other?\n\n   What network applications are available?\n\n   These will be explained, in turn, after an Ethernet refresher.\n\n\n\n\n\n\nSocolofsky & Kale                                               [Page 7]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n3.  Ethernet\n\n   This section is a short review of Ethernet technology.\n\n   An Ethernet frame contains the destination address, source address,\n   type field, and data.\n\n   An Ethernet address is 6 bytes.  Every device has its own Ethernet\n   address and listens for Ethernet frames with that destination\n   address.  All devices also listen for Ethernet frames with a wild-\n   card destination address of \"FF-FF-FF-FF-FF-FF\" (in hexadecimal),\n   called a \"broadcast\" address.\n\n   Ethernet uses CSMA/CD (Carrier Sense and Multiple Access with\n   Collision Detection).  CSMA/CD means that all devices communicate on\n   a single medium, that only one can transmit at a time, and that they\n   can all receive simultaneously.  If 2 devices try to transmit at the\n   same instant, the transmit collision is detected, and both devices\n   wait a random (but short) period before trying to transmit again.\n\n3.1  A Human Analogy\n\n   A good analogy of Ethernet technology is a group of people talking in\n   a small, completely dark room.  In this analogy, the physical network\n   medium is sound waves on air in the room instead of electrical\n   signals on a coaxial cable.\n\n   Each person can hear the words when another is talking (Carrier\n   Sense).  Everyone in the room has equal capability to talk (Multiple\n   Access), but none of them give lengthy speeches because they are\n   polite.  If a person is impolite, he is asked to leave the room\n   (i.e., thrown off the net).\n\n   No one talks while another is speaking.  But if two people start\n   speaking at the same instant, each of them know this because each\n   hears something they haven't said (Collision Detection).  When these\n   two people notice this condition, they wait for a moment, then one\n   begins talking.  The other hears the talking and waits for the first\n   to finish before beginning his own speech.\n\n   Each person has an unique name (unique Ethernet address) to avoid\n   confusion.  Every time one of them talks, he prefaces the message\n   with the name of the person he is talking to and with his own name\n   (Ethernet destination and source address, respectively), i.e., \"Hello\n   Jane, this is Jack, ..blah blah blah...\".  If the sender wants to\n   talk to everyone he might say \"everyone\" (broadcast address), i.e.,\n   \"Hello Everyone, this is Jack, ..blah blah blah...\".\n\n\n\n\nSocolofsky & Kale                                               [Page 8]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n4.  ARP\n\n   When sending out an IP packet, how is the destination Ethernet\n   address determined?\n\n   ARP (Address Resolution Protocol) is used to translate IP addresses\n   to Ethernet addresses.  The translation is done only for outgoing IP\n   packets, because this is when the IP header and the Ethernet header\n   are created.\n\n4.1  ARP Table for Address Translation\n\n   The translation is performed with a table look-up.  The table, called\n   the ARP table, is stored in memory and contains a row for each\n   computer.  There is a column for IP address and a column for Ethernet\n   address.  When translating an IP address to an Ethernet address, the\n   table is searched for a matching IP address.  The following is a\n   simplified ARP table:\n\n                  ------------------------------------\n                  |IP address       Ethernet address |\n                  ------------------------------------\n                  |223.1.2.1        08-00-39-00-2F-C3|\n                  |223.1.2.3        08-00-5A-21-A7-22|\n                  |223.1.2.4        08-00-10-99-AC-54|\n                  ------------------------------------\n                      TABLE 1.  Example ARP Table\n\n   The human convention when writing out the 4-byte IP address is each\n   byte in decimal and separating bytes with a period.  When writing out\n   the 6-byte Ethernet address, the conventions are each byte in\n   hexadecimal and separating bytes with either a minus sign or a colon.\n\n   The ARP table is necessary because the IP address and Ethernet\n   address are selected independently; you can not use an algorithm to\n   translate IP address to Ethernet address.  The IP address is selected\n   by the network manager based on the location of the computer on the\n   internet.  When the computer is moved to a different part of an\n   internet, its IP address must be changed.  The Ethernet address is\n   selected by the manufacturer based on the Ethernet address space\n   licensed by the manufacturer.  When the Ethernet hardware interface\n   board changes, the Ethernet address changes.\n\n4.2  Typical Translation Scenario\n\n   During normal operation a network application, such as TELNET, sends\n   an application message to TCP, then TCP sends the corresponding TCP\n   message to the IP module.  The destination IP address is known by the\n\n\n\nSocolofsky & Kale                                               [Page 9]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n   application, the TCP module, and the IP module.  At this point the IP\n   packet has been constructed and is ready to be given to the Ethernet\n   driver, but first the destination Ethernet address must be\n   determined.\n\n   The ARP table is used to look-up the destination Ethernet address.\n\n   4.3  ARP Request/Response Pair\n\n   But how does the ARP table get filled in the first place?  The answer\n   is that it is filled automatically by ARP on an \"as-needed\" basis.\n\n   Two things happen when the ARP table can not be used to translate an\n   address:\n\n     1. An ARP request packet with a broadcast Ethernet address is sent\n        out on the network to every computer.\n\n     2. The outgoing IP packet is queued.\n\n   Every computer's Ethernet interface receives the broadcast Ethernet\n   frame.  Each Ethernet driver examines the Type field in the Ethernet\n   frame and passes the ARP packet to the ARP module.  The ARP request\n   packet says \"If your IP address matches this target IP address, then\n   please tell me your Ethernet address\".  An ARP request packet looks\n   something like this:\n\n                ---------------------------------------\n                |Sender IP Address   223.1.2.1        |\n                |Sender Enet Address 08-00-39-00-2F-C3|\n                ---------------------------------------\n                |Target IP Address   223.1.2.2        |\n                |Target Enet Address <blank>          |\n                ---------------------------------------\n                     TABLE 2.  Example ARP Request\n\n   Each ARP module examines the IP address and if the Target IP address\n   matches its own IP address, it sends a response directly to the\n   source Ethernet address.  The ARP response packet says \"Yes, that\n   target IP address is mine, let me give you my Ethernet address\".  An\n   ARP response packet has the sender/target field contents swapped as\n   compared to the request.  It looks something like this:\n\n\n\n\n\n\n\n\n\nSocolofsky & Kale                                              [Page 10]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n                ---------------------------------------\n                |Sender IP Address   223.1.2.2        |\n                |Sender Enet Address 08-00-28-00-38-A9|\n                ---------------------------------------\n                |Target IP Address   223.1.2.1        |\n                |Target Enet Address 08-00-39-00-2F-C3|\n                ---------------------------------------\n                     TABLE 3.  Example ARP Response\n\n   The response is received by the original sender computer.  The\n   Ethernet driver looks at the Type field in the Ethernet frame then\n   passes the ARP packet to the ARP module.  The ARP module examines the\n   ARP packet and adds the sender's IP and Ethernet addresses to its ARP\n   table.\n\n   The updated table now looks like this:\n\n                   ----------------------------------\n                   |IP address     Ethernet address |\n                   ----------------------------------\n                   |223.1.2.1      08-00-39-00-2F-C3|\n                   |223.1.2.2      08-00-28-00-38-A9|\n                   |223.1.2.3      08-00-5A-21-A7-22|\n                   |223.1.2.4      08-00-10-99-AC-54|\n                   ----------------------------------\n                   TABLE 4.  ARP Table after Response\n\n4.4  Scenario Continued\n\n   The new translation has now been installed automatically in the\n   table, just milli-seconds after it was needed.  As you remember from\n   step 2 above, the outgoing IP packet was queued.  Next, the IP\n   address to Ethernet address translation is performed by look-up in\n   the ARP table then the Ethernet frame is transmitted on the Ethernet.\n   Therefore, with the new steps 3, 4, and 5, the scenario for the\n   sender computer is:\n\n     1. An ARP request packet with a broadcast Ethernet address is sent\n        out on the network to every computer.\n\n     2. The outgoing IP packet is queued.\n\n     3. The ARP response arrives with the IP-to-Ethernet address\n        translation for the ARP table.\n\n\n\n\n\n\n\nSocolofsky & Kale                                              [Page 11]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n     4. For the queued IP packet, the ARP table is used to translate the\n        IP address to the Ethernet address.\n\n     5. The Ethernet frame is transmitted on the Ethernet.\n\n   In summary, when the translation is missing from the ARP table, one\n   IP packet is queued.  The translation data is quickly filled in with\n   ARP request/response and the queued IP packet is transmitted.\n\n   Each computer has a separate ARP table for each of its Ethernet\n   interfaces.  If the target computer does not exist, there will be no\n   ARP response and no entry in the ARP table.  IP will discard outgoing\n   IP packets sent to that address.  The upper layer protocols can't\n   tell the difference between a broken Ethernet and the absence of a\n   computer with the target IP address.\n\n   Some implementations of IP and ARP don't queue the IP packet while\n   waiting for the ARP response.  Instead the IP packet is discarded and\n   the recovery from the IP packet loss is left to the TCP module or the\n   UDP network application.  This recovery is performed by time-out and\n   retransmission.  The retransmitted message is successfully sent out\n   onto the network because the first copy of the message has already\n   caused the ARP table to be filled.\n\n5.  Internet Protocol\n\n   The IP module is central to internet technology and the essence of IP\n   is its route table.  IP uses this in-memory table to make all\n   decisions about routing an IP packet.  The content of the route table\n   is defined by the network administrator.  Mistakes block\n   communication.\n\n   To understand how a route table is used is to understand\n   internetworking.  This understanding is necessary for the successful\n   administration and maintenance of an IP network.\n\n   The route table is best understood by first having an overview of\n   routing, then learning about IP network addresses, and then looking\n   at the details.\n\n5.1  Direct Routing\n\n   The figure below is of a tiny internet with 3 computers: A, B, and C.\n   Each computer has the same TCP/IP protocol stack as in Figure 1.\n   Each computer's Ethernet interface has its own Ethernet address.\n   Each computer has an IP address assigned to the IP interface by the\n   network manager, who also has assigned an IP network number to the\n   Ethernet.\n\n\n\nSocolofsky & Kale                                              [Page 12]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n                          A      B      C\n                          |      |      |\n                        --o------o------o--\n                        Ethernet 1\n                        IP network \"development\"\n\n                       Figure 6.  One IP Network\n\n   When A sends an IP packet to B, the IP header contains A's IP address\n   as the source IP address, and the Ethernet header contains A's\n   Ethernet address as the source Ethernet address.  Also, the IP header\n   contains B's IP address as the destination IP address and the\n   Ethernet header contains B's Ethernet address as the destination\n   Ethernet address.\n\n                ----------------------------------------\n                |address            source  destination|\n                ----------------------------------------\n                |IP header          A       B          |\n                |Ethernet header    A       B          |\n                ----------------------------------------\n       TABLE 5.  Addresses in an Ethernet frame for an IP packet\n                              from A to B\n\n   For this simple case, IP is overhead because the IP adds little to\n   the service offered by Ethernet.  However, IP does add cost: the\n   extra CPU processing and network bandwidth to generate, transmit, and\n   parse the IP header.\n\n   When B's IP module receives the IP packet from A, it checks the\n   destination IP address against its own, looking for a match, then it\n   passes the datagram to the upper-level protocol.\n\n   This communication between A and B uses direct routing.\n\n5.2  Indirect Routing\n\n   The figure below is a more realistic view of an internet.  It is\n   composed of 3 Ethernets and 3 IP networks connected by an IP-router\n   called computer D.  Each IP network has 4 computers; each computer\n   has its own IP address and Ethernet address.\n\n\n\n\n\n\n\n\n\n\nSocolofsky & Kale                                              [Page 13]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n          A      B      C      ----D----      E      F      G\n          |      |      |      |   |   |      |      |      |\n        --o------o------o------o-  |  -o------o------o------o--\n        Ethernet 1                 |  Ethernet 2\n        IP network \"development\"   |  IP network \"accounting\"\n                                   |\n                                   |\n                                   |     H      I      J\n                                   |     |      |      |\n                                 --o-----o------o------o--\n                                  Ethernet 3\n                                  IP network \"factory\"\n\n               Figure 7.  Three IP Networks; One internet\n\n   Except for computer D, each computer has a TCP/IP protocol stack like\n   that in Figure 1.  Computer D is the IP-router; it is connected to\n   all 3 networks and therefore has 3 IP addresses and 3 Ethernet\n   addresses.  Computer D has a TCP/IP protocol stack similar to that in\n   Figure 3, except that it has 3 ARP modules and 3 Ethernet drivers\n   instead of 2.  Please note that computer D has only one IP module.\n\n   The network manager has assigned a unique number, called an IP\n   network number, to each of the Ethernets.  The IP network numbers are\n   not shown in this diagram, just the network names.\n\n   When computer A sends an IP packet to computer B, the process is\n   identical to the single network example above.  Any communication\n   between computers located on a single IP network matches the direct\n   routing example discussed previously.\n\n   When computer D and A communicate, it is direct communication.  When\n   computer D and E communicate, it is direct communication.  When\n   computer D and H communicate, it is direct communication.  This is\n   because each of these pairs of computers is on the same IP network.\n\n   However, when computer A communicates with a computer on the far side\n   of the IP-router, communication is no longer direct.  A must use D to\n   forward the IP packet to the next IP network.  This communication is\n   called \"indirect\".\n\n   This routing of IP packets is done by IP modules and happens\n   transparently to TCP, UDP, and the network applications.\n\n   If A sends an IP packet to E, the source IP address and the source\n   Ethernet address are A's.  The destination IP address is E's, but\n   because A's IP module sends the IP packet to D for forwarding, the\n   destination Ethernet address is D's.\n\n\n\nSocolofsky & Kale                                              [Page 14]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n                ----------------------------------------\n                |address            source  destination|\n                ----------------------------------------\n                |IP header          A       E          |\n                |Ethernet header    A       D          |\n                ----------------------------------------\n       TABLE 6.  Addresses in an Ethernet frame for an IP packet\n                         from A to E (before D)\n\n   D's IP module receives the IP packet and upon examining the\n   destination IP address, says \"This is not my IP address,\" and sends\n   the IP packet directly to E.\n\n                ----------------------------------------\n                |address            source  destination|\n                ----------------------------------------\n                |IP header          A       E          |\n                |Ethernet header    D       E          |\n                ----------------------------------------\n       TABLE 7.  Addresses in an Ethernet frame for an IP packet\n                         from A to E (after D)\n\n   In summary, for direct communication, both the source IP address and\n   the source Ethernet address is the sender's, and the destination IP\n   address and the destination Ethernet address is the recipient's.  For\n   indirect communication, the IP address and Ethernet addresses do not\n   pair up in this way.\n\n   This example internet is a very simple one.  Real networks are often\n   complicated by many factors, resulting in multiple IP-routers and\n   several types of physical networks.  This example internet might have\n   come about because the network manager wanted to split a large\n   Ethernet in order to localize Ethernet broadcast traffic.\n\n5.3  IP Module Routing Rules\n\n   This overview of routing has shown what happens, but not how it\n   happens.  Now let's examine the rules, or algorithm, used by the IP\n   module.\n\n     For an outgoing IP packet, entering IP from an upper layer, IP must\n     decide whether to send the IP packet directly or indirectly, and IP\n     must choose a lower network interface.  These choices are made by\n     consulting the route table.\n\n     For an incoming IP packet, entering IP from a lower interface, IP\n     must decide whether to forward the IP packet or pass it to an upper\n     layer.  If the IP packet is being forwarded, it is treated as an\n\n\n\nSocolofsky & Kale                                              [Page 15]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n     outgoing IP packet.\n\n     When an incoming IP packet arrives it is never forwarded back out\n     through the same network interface.\n\n   These decisions are made before the IP packet is handed to the lower\n   interface and before the ARP table is consulted.\n\n5.4  IP Address\n\n   The network manager assigns IP addresses to computers according to\n   the IP network to which the computer is attached.  One part of a 4-\n   byte IP address is the IP network number, the other part is the IP\n   computer number (or host number).  For the computer in table 1, with\n   an IP address of 223.1.2.1, the network number is 223.1.2 and the\n   host number is number 1.\n\n   The portion of the address that is used for network number and for\n   host number is defined by the upper bits in the 4-byte address.  All\n   example IP addresses in this tutorial are of type class C, meaning\n   that the upper 3 bits indicate that 21 bits are the network number\n   and 8 bits are the host number.  This allows 2,097,152 class C\n   networks up to 254 hosts on each network.\n\n   The IP address space is administered by the NIC (Network Information\n   Center).  All internets that are connected to the single world-wide\n   Internet must use network numbers assigned by the NIC.  If you are\n   setting up your own internet and you are not intending to connect it\n   to the Internet, you should still obtain your network numbers from\n   the NIC.  If you pick your own number, you run the risk of confusion\n   and chaos in the eventuality that your internet is connected to\n   another internet.\n\n5.5  Names\n\n   People refer to computers by names, not numbers.  A computer called\n   alpha might have the IP address of 223.1.2.1.  For small networks,\n   this name-to-address translation data is often kept on each computer\n   in the \"hosts\" file.  For larger networks, this translation data file\n   is stored on a server and accessed across the network when needed.  A\n   few lines from that file might look like this:\n\n   223.1.2.1     alpha\n   223.1.2.2     beta\n   223.1.2.3     gamma\n   223.1.2.4     delta\n   223.1.3.2     epsilon\n   223.1.4.2     iota\n\n\n\nSocolofsky & Kale                                              [Page 16]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n   The IP address is the first column and the computer name is the\n   second column.\n\n   In most cases, you can install identical \"hosts\" files on all\n   computers.  You may notice that \"delta\" has only one entry in this\n   file even though it has 3 IP addresses.  Delta can be reached with\n   any of its IP addresses; it does not matter which one is used.  When\n   delta receives an IP packet and looks at the destination address, it\n   will recognize any of its own IP addresses.\n\n   IP networks are also given names.  If you have 3 IP networks, your\n   \"networks\" file for documenting these names might look something like\n   this:\n\n   223.1.2     development\n   223.1.3     accounting\n   223.1.4     factory\n\n   The IP network number is in the first column and its name is in the\n   second column.\n\n   From this example you can see that alpha is computer number 1 on the\n   development network, beta is computer number 2 on the development\n   network and so on.  You might also say that alpha is development.1,\n   Beta is development.2, and so on.\n\n   The above hosts file is adequate for the users, but the network\n   manager will probably replace the line for delta with:\n\n   223.1.2.4     devnetrouter    delta\n   223.1.3.1     facnetrouter\n   223.1.4.1     accnetrouter\n\n   These three new lines for the hosts file give each of delta's IP\n   addresses a meaningful name.  In fact, the first IP address listed\n   has 2 names; \"delta\" and \"devnetrouter\" are synonyms.  In practice\n   \"delta\" is the general-purpose name of the computer and the other 3\n   names are only used when administering the IP route table.\n\n   These files are used by network administration commands and network\n   applications to provide meaningful names.  They are not required for\n   operation of an internet, but they do make it easier for us.\n\n5.6  IP Route Table\n\n   How does IP know which lower network interface to use when sending\n   out a IP packet?  IP looks it up in the route table using a search\n   key of the IP network number extracted from the IP destination\n\n\n\nSocolofsky & Kale                                              [Page 17]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n   address.\n\n   The route table contains one row for each route.  The primary columns\n   in the route table are:  IP network number, direct/indirect flag,\n   router IP address, and interface number.  This table is referred to\n   by IP for each outgoing IP packet.\n\n   On most computers the route table can be modified with the \"route\"\n   command.  The content of the route table is defined by the network\n   manager, because the network manager assigns the IP addresses to the\n   computers.\n\n5.7  Direct Routing Details\n\n   To explain how it is used, let us visit in detail the routing\n   situations we have reviewed previously.\n\n                        ---------         ---------\n                        | alpha |         | beta  |\n                        |    1  |         |  1    |\n                        ---------         ---------\n                             |               |\n                     --------o---------------o-\n                      Ethernet 1\n                      IP network \"development\"\n\n               Figure 8.  Close-up View of One IP Network\n\n   The route table inside alpha looks like this:\n\n     --------------------------------------------------------------\n     |network      direct/indirect flag  router   interface number|\n     --------------------------------------------------------------\n     |development  direct                <blank>  1               |\n     --------------------------------------------------------------\n                  TABLE 8.  Example Simple Route Table\n\n   This view can be seen on some UNIX systems with the \"netstat -r\"\n   command.  With this simple network, all computers have identical\n   routing tables.\n\n   For discussion, the table is printed again without the network number\n   translated to its network name.\n\n\n\n\n\n\n\n\nSocolofsky & Kale                                              [Page 18]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n     --------------------------------------------------------------\n     |network      direct/indirect flag  router   interface number|\n     --------------------------------------------------------------\n     |223.1.2      direct                <blank>  1               |\n     --------------------------------------------------------------\n           TABLE 9.  Example Simple Route Table with Numbers\n\n5.8  Direct Scenario\n\n   Alpha is sending an IP packet to beta.  The IP packet is in alpha's\n   IP module and the destination IP address is beta or 223.1.2.2.  IP\n   extracts the network portion of this IP address and scans the first\n   column of the table looking for a match.  With this network a match\n   is found on the first entry.\n\n   The other information in this entry indicates that computers on this\n   network can be reached directly through interface number 1.  An ARP\n   table translation is done on beta's IP address then the Ethernet\n   frame is sent directly to beta via interface number 1.\n\n   If an application tries to send data to an IP address that is not on\n   the development network, IP will be unable to find a match in the\n   route table.  IP then discards the IP packet.  Some computers provide\n   a \"Network not reachable\" error message.\n\n5.9  Indirect Routing Details\n\n   Now, let's take a closer look at the more complicated routing\n   scenario that we examined previously.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nSocolofsky & Kale                                              [Page 19]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n          ---------           ---------           ---------\n          | alpha |           | delta |           |epsilon|\n          |    1  |           |1  2  3|           |   1   |\n          ---------           ---------           ---------\n               |               |  |  |                |\n       --------o---------------o- | -o----------------o--------\n        Ethernet 1                |     Ethernet 2\n        IP network \"Development\"  |     IP network \"accounting\"\n                                  |\n                                  |     --------\n                                  |     | iota |\n                                  |     |  1   |\n                                  |     --------\n                                  |        |\n                                --o--------o--------\n                                    Ethernet 3\n                                    IP network \"factory\"\n\n             Figure 9.  Close-up View of Three IP Networks\n\n   The route table inside alpha looks like this:\n\n ---------------------------------------------------------------------\n |network      direct/indirect flag  router          interface number|\n ---------------------------------------------------------------------\n |development  direct                <blank>         1               |\n |accounting   indirect              devnetrouter    1               |\n |factory      indirect              devnetrouter    1               |\n ---------------------------------------------------------------------\n                      TABLE 10.  Alpha Route Table\n\n   For discussion the table is printed again using numbers instead of\n   names.\n\n  --------------------------------------------------------------------\n  |network      direct/indirect flag  router         interface number|\n  --------------------------------------------------------------------\n  |223.1.2      direct                <blank>        1               |\n  |223.1.3      indirect              223.1.2.4      1               |\n  |223.1.4      indirect              223.1.2.4      1               |\n  --------------------------------------------------------------------\n               TABLE 11.  Alpha Route Table with Numbers\n\n   The router in Alpha's route table is the IP address of delta's\n   connection to the development network.\n\n\n\n\n\n\nSocolofsky & Kale                                              [Page 20]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n5.10  Indirect Scenario\n\n   Alpha is sending an IP packet to epsilon.  The IP packet is in\n   alpha's IP module and the destination IP address is epsilon\n   (223.1.3.2).  IP extracts the network portion of this IP address\n   (223.1.3) and scans the first column of the table looking for a\n   match.  A match is found on the second entry.\n\n   This entry indicates that computers on the 223.1.3 network can be\n   reached through the IP-router devnetrouter.  Alpha's IP module then\n   does an ARP table translation for devnetrouter's IP address and sends\n   the IP packet directly to devnetrouter through Alpha's interface\n   number 1.  The IP packet still contains the destination address of\n   epsilon.\n\n   The IP packet arrives at delta's development network interface and is\n   passed up to delta's IP module.  The destination IP address is\n   examined and because it does not match any of delta's own IP\n   addresses, delta decides to forward the IP packet.\n\n   Delta's IP module extracts the network portion of the destination IP\n   address (223.1.3) and scans its route table for a matching network\n   field.  Delta's route table looks like this:\n\n ----------------------------------------------------------------------\n |network      direct/indirect flag  router           interface number|\n ----------------------------------------------------------------------\n |development  direct                <blank>          1               |\n |factory      direct                <blank>          3               |\n |accounting   direct                <blank>          2               |\n ----------------------------------------------------------------------\n                     TABLE 12.  Delta's Route Table\n\n   Below is delta's table printed again, without the translation to\n   names.\n\n ----------------------------------------------------------------------\n |network      direct/indirect flag  router           interface number|\n ----------------------------------------------------------------------\n |223.1.2      direct                <blank>          1               |\n |223.1.3      direct                <blank>          3               |\n |223.1.4      direct                <blank>          2               |\n ----------------------------------------------------------------------\n              TABLE 13.  Delta's Route Table with Numbers\n\n   The match is found on the second entry.  IP then sends the IP packet\n   directly to epsilon through interface number 3.  The IP packet\n   contains the IP destination address of epsilon and the Ethernet\n\n\n\nSocolofsky & Kale                                              [Page 21]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n   destination address of epsilon.\n\n   The IP packet arrives at epsilon and is passed up to epsilon's IP\n   module.  The destination IP address is examined and found to match\n   with epsilon's IP address, so the IP packet is passed to the upper\n   protocol layer.\n\n5.11  Routing Summary\n\n   When a IP packet travels through a large internet it may go through\n   many IP-routers before it reaches its destination.  The path it takes\n   is not determined by a central source but is a result of consulting\n   each of the routing tables used in the journey.  Each computer\n   defines only the next hop in the journey and relies on that computer\n   to send the IP packet on its way.\n\n5.12  Managing the Routes\n\n   Maintaining correct routing tables on all computers in a large\n   internet is a difficult task; network configuration is being modified\n   constantly by the network managers to meet changing needs.  Mistakes\n   in routing tables can block communication in ways that are\n   excruciatingly tedious to diagnose.\n\n   Keeping a simple network configuration goes a long way towards making\n   a reliable internet.  For instance, the most straightforward method\n   of assigning IP networks to Ethernet is to assign a single IP network\n   number to each Ethernet.\n\n   Help is also available from certain protocols and network\n   applications.  ICMP (Internet Control Message Protocol) can report\n   some routing problems.  For small networks the route table is filled\n   manually on each computer by the network administrator.  For larger\n   networks the network administrator automates this manual operation\n   with a routing protocol to distribute routes throughout a network.\n\n   When a computer is moved from one IP network to another, its IP\n   address must change.  When a computer is removed from an IP network\n   its old address becomes invalid.  These changes require frequent\n   updates to the \"hosts\" file.  This flat file can become difficult to\n   maintain for even medium-size networks.  The Domain Name System helps\n   solve these problems.\n\n6.  User Datagram Protocol\n\n   UDP is one of the two main protocols to reside on top of IP.  It\n   offers service to the user's network applications.  Example network\n   applications that use UDP are:  Network File System (NFS) and Simple\n\n\n\nSocolofsky & Kale                                              [Page 22]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n   Network Management Protocol (SNMP).  The service is little more than\n   an interface to IP.\n\n   UDP is a connectionless datagram delivery service that does not\n   guarantee delivery.  UDP does not maintain an end-to-end connection\n   with the remote UDP module; it merely pushes the datagram out on the\n   net and accepts incoming datagrams off the net.\n\n   UDP adds two values to what is provided by IP.  One is the\n   multiplexing of information between applications based on port\n   number.  The other is a checksum to check the integrity of the data.\n\n6.1  Ports\n\n   How does a client on one computer reach the server on another?\n\n   The path of communication between an application and UDP is through\n   UDP ports.  These ports are numbered, beginning with zero.  An\n   application that is offering service (the server) waits for messages\n   to come in on a specific port dedicated to that service.  The server\n   waits patiently for any client to request service.\n\n   For instance, the SNMP server, called an SNMP agent, always waits on\n   port 161.  There can be only one SNMP agent per computer because\n   there is only one UDP port number 161.  This port number is well\n   known; it is a fixed number, an internet assigned number.  If an SNMP\n   client wants service, it sends its request to port number 161 of UDP\n   on the destination computer.\n\n   When an application sends data out through UDP it arrives at the far\n   end as a single unit.  For example, if an application does 5 writes\n   to the UDP port, the application at the far end will do 5 reads from\n   the UDP port.  Also, the size of each write matches the size of each\n   read.\n\n   UDP preserves the message boundary defined by the application.  It\n   never joins two application messages together, or divides a single\n   application message into parts.\n\n6.2  Checksum\n\n   An incoming IP packet with an IP header type field indicating \"UDP\"\n   is passed up to the UDP module by IP.  When the UDP module receives\n   the UDP datagram from IP it examines the UDP checksum.  If the\n   checksum is zero, it means that checksum was not calculated by the\n   sender and can be ignored.  Thus the sending computer's UDP module\n   may or may not generate checksums.  If Ethernet is the only network\n   between the 2 UDP modules communicating, then you may not need\n\n\n\nSocolofsky & Kale                                              [Page 23]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n   checksumming.  However, it is recommended that checksum generation\n   always be enabled because at some point in the future a route table\n   change may send the data across less reliable media.\n\n   If the checksum is valid (or zero), the destination port number is\n   examined and if an application is bound to that port, an application\n   message is queued for the application to read.  Otherwise the UDP\n   datagram is discarded.  If the incoming UDP datagrams arrive faster\n   than the application can read them and if the queue fills to a\n   maximum value, UDP datagrams are discarded by UDP.  UDP will continue\n   to discard UDP datagrams until there is space in the queue.\n\n7.  Transmission Control Protocol\n\n   TCP provides a different service than UDP.  TCP offers a connection-\n   oriented byte stream, instead of a connectionless datagram delivery\n   service.  TCP guarantees delivery, whereas UDP does not.\n\n   TCP is used by network applications that require guaranteed delivery\n   and cannot be bothered with doing time-outs and retransmissions.  The\n   two most typical network applications that use TCP are File Transfer\n   Protocol (FTP) and the TELNET.  Other popular TCP network\n   applications include X-Window System, rcp (remote copy), and the r-\n   series commands.  TCP's greater capability is not without cost: it\n   requires more CPU and network bandwidth.  The internals of the TCP\n   module are much more complicated than those in a UDP module.\n\n   Similar to UDP, network applications connect to TCP ports.  Well-\n   defined port numbers are dedicated to specific applications.  For\n   instance, the TELNET server uses port number 23.  The TELNET client\n   can find the server simply by connecting to port 23 of TCP on the\n   specified computer.\n\n   When the application first starts using TCP, the TCP module on the\n   client's computer and the TCP module on the server's computer start\n   communicating with each other.  These two end-point TCP modules\n   contain state information that defines a virtual circuit.  This\n   virtual circuit consumes resources in both TCP end-points.  The\n   virtual circuit is full duplex; data can go in both directions\n   simultaneously.  The application writes data to the TCP port, the\n   data traverses the network and is read by the application at the far\n   end.\n\n   TCP packetizes the byte stream at will; it does not retain the\n   boundaries between writes.  For example, if an application does 5\n   writes to the TCP port, the application at the far end might do 10\n   reads to get all the data.  Or it might get all the data with a\n   single read.  There is no correlation between the number and size of\n\n\n\nSocolofsky & Kale                                              [Page 24]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n   writes at one end to the number and size of reads at the other end.\n\n   TCP is a sliding window protocol with time-out and retransmits.\n   Outgoing data must be acknowledged by the far-end TCP.\n   Acknowledgements can be piggybacked on data.  Both receiving ends can\n   flow control the far end, thus preventing a buffer overrun.\n\n   As with all sliding window protocols, the protocol has a window size.\n   The window size determines the amount of data that can be transmitted\n   before an acknowledgement is required.  For TCP, this amount is not a\n   number of TCP segments but a number of bytes.\n\n8.  Network Applications\n\n   Why do both TCP and UDP exist, instead of just one or the other?\n\n   They supply different services.  Most applications are implemented to\n   use only one or the other.  You, the programmer, choose the protocol\n   that best meets your needs.  If you need a reliable stream delivery\n   service, TCP might be best.  If you need a datagram service, UDP\n   might be best.  If you need efficiency over long-haul circuits, TCP\n   might be best.  If you need efficiency over fast networks with short\n   latency, UDP might be best.  If your needs do not fall nicely into\n   these categories, then the \"best\" choice is unclear.  However,\n   applications can make up for deficiencies in the choice.  For\n   instance if you choose UDP and you need reliability, then the\n   application must provide reliability.  If you choose TCP and you need\n   a record oriented service, then the application must insert markers\n   in the byte stream to delimit records.\n\n   What network applications are available?\n\n   There are far too many to list.  The number is growing continually.\n   Some of the applications have existed since the beginning of internet\n   technology: TELNET and FTP.  Others are relatively new: X-Windows and\n   SNMP.  The following is a brief description of the applications\n   mentioned in this tutorial.\n\n8.1  TELNET\n\n   TELNET provides a remote login capability on TCP.  The operation and\n   appearance is similar to keyboard dialing through a telephone switch.\n   On the command line the user types \"telnet delta\" and receives a\n   login prompt from the computer called \"delta\".\n\n   TELNET works well; it is an old application and has widespread\n   interoperability.  Implementations of TELNET usually work between\n   different operating systems.  For instance, a TELNET client may be on\n\n\n\nSocolofsky & Kale                                              [Page 25]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n   VAX/VMS and the server on UNIX System V.\n\n8.2  FTP\n\n   File Transfer Protocol (FTP), as old as TELNET, also uses TCP and has\n   widespread interoperability.  The operation and appearance is as if\n   you TELNETed to the remote computer.  But instead of typing your\n   usual commands, you have to make do with a short list of commands for\n   directory listings and the like.  FTP commands allow you to copy\n   files between computers.\n\n8.3  rsh\n\n   Remote shell (rsh or remsh) is one of an entire family of remote UNIX\n   style commands.  The UNIX copy command, cp, becomes rcp.  The UNIX\n   \"who is logged in\" command, who, becomes rwho.  The list continues\n   and is referred to collectively to as the \"r\" series commands or the\n   \"r*\" (r star) commands.\n\n   The r* commands mainly work between UNIX systems and are designed for\n   interaction between trusted hosts.  Little consideration is given to\n   security, but they provide a convenient user environment.\n\n   To execute the \"cc file.c\" command on a remote computer called delta,\n   type \"rsh delta cc file.c\".  To copy the \"file.c\" file to delta, type\n   \"rcp file.c delta:\".  To login to delta, type \"rlogin delta\", and if\n   you administered the computers in a certain way, you will not be\n   challenged with a password prompt.\n\n8.4  NFS\n\n   Network File System, first developed by Sun Microsystems Inc, uses\n   UDP and is excellent for mounting UNIX file systems on multiple\n   computers.  A diskless workstation can access its server's hard disk\n   as if the disk were local to the workstation.  A single disk copy of\n   a database on mainframe \"alpha\" can also be used by mainframe \"beta\"\n   if the database's file system is NFS mounted on \"beta\".\n\n   NFS adds significant load to a network and has poor utility across\n   slow links, but the benefits are strong.  The NFS client is\n   implemented in the kernel, allowing all applications and commands to\n   use the NFS mounted disk as if it were local disk.\n\n8.5  SNMP\n\n   Simple Network Management Protocol (SNMP) uses UDP and is designed\n   for use by central network management stations.  It is a well known\n   fact that if given enough data, a network manager can detect and\n\n\n\nSocolofsky & Kale                                              [Page 26]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n   diagnose network problems.  The central station uses SNMP to collect\n   this data from other computers on the network.  SNMP defines the\n   format for the data; it is left to the central station or network\n   manager to interpret the data.\n\n8.6  X-Window\n\n   The X Window System uses the X Window protocol on TCP to draw windows\n   on a workstation's bitmap display.  X Window is much more than a\n   utility for drawing windows; it is entire philosophy for designing a\n   user interface.\n\n9.  Other Information\n\n   Much information about internet technology was not included in this\n   tutorial.  This section lists information that is considered the next\n   level of detail for the reader who wishes to learn more.\n\n     o administration commands: arp, route, and netstat\n     o ARP: permanent entry, publish entry, time-out entry, spoofing\n     o IP route table: host entry, default gateway, subnets\n     o IP: time-to-live counter, fragmentation, ICMP\n     o RIP, routing loops\n     o Domain Name System\n\n10.  References\n\n   [1] Comer, D., \"Internetworking with TCP/IP Principles, Protocols,\n       and Architecture\", Prentice Hall, Englewood Cliffs, New Jersey,\n       U.S.A., 1988.\n\n   [2] Feinler, E., et al, DDN Protocol Handbook, Volume 2 and 3, DDN\n       Network Information Center, SRI International, 333 Ravenswood\n       Avenue, Room EJ291, Menlow Park, California, U.S.A., 1985.\n\n   [3] Spider Systems, Ltd., \"Packets and Protocols\", Spider Systems\n       Ltd., Stanwell Street, Edinburgh, U.K. EH6 5NG, 1990.\n\n11.  Relation to other RFCs\n\n   This RFC is a tutorial and it does not UPDATE or OBSOLETE any other\n   RFC.\n\n12.  Security Considerations\n\n   There are security considerations within the TCP/IP protocol suite.\n   To some people these considerations are serious problems, to others\n   they are not; it depends on the user requirements.\n\n\n\nSocolofsky & Kale                                              [Page 27]\n \nRFC 1180                   A TCP/IP Tutorial                January 1991\n\n\n   This tutorial does not discuss these issues, but if you want to learn\n   more you should start with the topic of ARP-spoofing, then use the\n   \"Security Considerations\" section of RFC 1122 to lead you to more\n   information.\n\n13.  Authors' Addresses\n\n   Theodore John Socolofsky\n   Spider Systems Limited\n   Spider Park\n   Stanwell Street\n   Edinburgh EH6 5NG\n   United Kingdom\n\n   Phone:\n     from UK        031-554-9424\n     from USA 011-44-31-554-9424\n   Fax:\n     from UK        031-554-0649\n     from USA 011-44-31-554-0649\n\n   EMail: TEDS@SPIDER.CO.UK\n\n\n   Claudia Jeanne Kale\n   12 Gosford Place\n   Edinburgh EH6 4BJ\n   United Kingdom\n\n   Phone:\n     from UK        031-554-7432\n     from USA 011-44-31-554-7432\n\n   EMail: CLAUDIAK@SPIDER.CO.UK\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nSocolofsky & Kale                                              [Page 28]\n\n\n\nHtml markup produced by rfcmarkup 1.129d, available from https://tools.ietf.org/tools/rfcmarkup/"}

{"l":"https://www.taniarascia.com/writing-an-emulator-in-javascript-chip8/","n":"Writing an Emulator in JavaScript (and Interfacing with Multiple UIs)","html":"<div id=\"___gatsby\"><div style=\"outline:none\" tabindex=\"-1\" id=\"gatsby-focus-wrapper\"><nav class=\"nav\"><div class=\"nav-container\"><div class=\"brand\"><a href=\"/\"><img src=\"/static/floppy-7d563114074bfca5f3beef4a260cdd7d.png\" class=\"favicon\" alt=\"Floppy Diskette\"><span class=\"text\">Tania Rascia</span></a></div><div class=\"links\"><a href=\"/me/\">About</a><a href=\"/blog/\">Articles</a><a href=\"/newsletter/\">Newsletter</a></div><div class=\"cta\"><button class=\"dark-switcher\" aria-label=\"Toggle Dark Mode.\" title=\"Toggle Dark Mode\"><img src=\"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMTI4IDEyODsiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogIDxwYXRoIGQ9Ik0xMDUuODcsMTQuOTljLTMuNzQtMy4zOS03LjkxLTYuMzgtMTIuNDItOC44OWMtMC44Ny0wLjQ5LTItMC4zNS0yLjcxLDAuMzMgYy0wLjcxLDAuNjgtMC44MywxLjczLTAuMjksMi41M2MxNS42MywyMi45MywxMi4yOSw1Mi41Mi04LjExLDcxLjk3Yy0xMS45LDExLjM1LTI3Ljg1LDE3LjYtNDQuOTEsMTcuNiBjLTExLjM5LDAtMjIuNTQtMi44Ni0zMi4yNC04LjI3Yy0wLjg3LTAuNDktMi0wLjM2LTIuNzEsMC4zM2MtMC43MSwwLjY4LTAuODMsMS43Mi0wLjI4LDIuNTNjMi44MSw0LjEyLDYuMTIsNy45Myw5Ljg2LDExLjMyIGMxMi42MSwxMS40NSwyOS4yNywxNy43Niw0Ni45LDE3Ljc2YzE4LjI3LDAsMzUuMzQtNi43LDQ4LjA5LTE4Ljg2YzEyLjUzLTExLjk0LDE5LjMxLTI3LjcxLDE5LjA5LTQ0LjQgQzEyNS45Miw0Mi4yNSwxMTguNzIsMjYuNjQsMTA1Ljg3LDE0Ljk5eiIgc3R5bGU9ImZpbGw6I0ZDQzIxQjsiLz4KPC9zdmc+\" class=\"theme-icon\" alt=\"Dark Mode\"></button></div></div></nav><main id=\"main-content\"><article class=\"single container\"><header class=\"single-header \"><div class=\" gatsby-image-wrapper\" style=\"position:relative;overflow:hidden;display:inline-block;width:150px;height:150px\"><img aria-hidden=\"true\" src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAD/UlEQVQ4y4VUbYiUVRR+d6dNDEsoytmd7/f7nY/9GHPZNWH9EaxLWRSUFgkJYRgRBGEhJf1TyDAIifVHu2Im0Y8ll1JBQlEkMVTcMrbR1XZnnHFn3tmdj20+3pl7OufOO7stbXXhcj/OeZ773HvPOYLwt+awx2MuJx9TqiRAWHNAWLe75shqErd9625fhlmx5XWZjxlNarGCShts3vgPHxj5XKihLY0+tC4byspkU0qAj9OKuHjoVy7no/dUcTSpikdS2BM4/97reqJpj6sN32kby1sbdlTD57fkAC2FawFvKK5JnySC6nGIGFAPqsCwQ0gFJD2RMNSD19d3R7gQTzvH4KHLFd6zT7vm9yhxXT4NhgJltxMynvaqaSiWqcuWqUnVclgDkHww89jaM1dWt2mEuftga+syhSVD4e9xQ/TqRGaJXpjb0FMq7H3fyu16A9J+NzMVkWXxkIxrXS2/49US7PsQ4kODpy8JQojfblUb5xBeeHiNgFd5gL+FJh0mZdkne8oLhz4FbAxKRVbZtZNlwzpDlTD/7BCzYjGyVeDUSUg/t2WYsNU3dzpGOpz2z9mEMyHtQN3bDoUP9lSJrFz8k8USBTZ1cxoyG/vA9LvB+u0mI1sqOW8l5wFuJPIHOfbqJOcQ8Psp1lpeW/vIqnhQHbWQML/nPYtAk7dmWedL38CW7aMQi/RATvJAeWKCE+777EIt/PIYbN02fAwEYbWQgxYeQtAZbLXD5UglrIPpdlq5t99CUI1NxXMwuHscdmz/Am6Hu2Fe9kLp/Hn+FIeOXmX9r49Zxwd3Q8H/+FF+04jhEKCrQUgxRmHBf1MVofjuO0Aykz//ArejvZBWJaBPMbtCUL10EfJou/PxfqsoSZAylBMrEX5J8cYJZR/LRgyWe/4ZKA49DTktAKYmkg3MgAfmBjaxwotbWaEvagHaEpr09UqEIxS8GGsUc4xUZnwuSPvcDFORmc2uo0oMq4y3g6Ulv1UPaRTs/0lYwV4nNfyKhkJENbvTvKHUUMinQph/JcQUBKwmsGDIDaVIMIfrChJTp7lNai3Qgbi2cJ/ScYnQ/mVM9GGI6ICJfhlz+iS9JwLqs6pkTki+/b9KvgP3VTFNSkkV+oz/oQR+wrIGiF32yzyHU5o4hiflf/S5B8Y9HSpWnwsYnzCrSWYzTe9rUpII0HbxO/Q553dvRswcVqIfOGEnEWJQ02JS9u+9LvpeaYJPeV36HSVwJib7h0c61j10zude87vsP3xXCZxFm9r0Q8w2xH7UyDitUSRgU+9SAcU3haDaIvxPIyF4xcUqA09taGBgoL8x9kVbobd7kQiiEQH61ztofwYLKHSFGj60F40sESOG9pvC/gIyF15mMPvABAAAAABJRU5ErkJggg==\" alt=\"\" style=\"position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; object-fit: cover; object-position: center center; opacity: 0; transition-delay: 500ms;\"><picture><source srcset=\"/static/e66203dbfeb634797218764c1b0a0b1c/4148e/blinky.png 1x,\n/static/e66203dbfeb634797218764c1b0a0b1c/de03e/blinky.png 1.5x,\n/static/e66203dbfeb634797218764c1b0a0b1c/1e9e2/blinky.png 2x\"><img srcset=\"/static/e66203dbfeb634797218764c1b0a0b1c/4148e/blinky.png 1x,\n/static/e66203dbfeb634797218764c1b0a0b1c/de03e/blinky.png 1.5x,\n/static/e66203dbfeb634797218764c1b0a0b1c/1e9e2/blinky.png 2x\" src=\"/static/e66203dbfeb634797218764c1b0a0b1c/4148e/blinky.png\" alt=\"\" width=\"150\" height=\"150\" loading=\"lazy\" style=\"position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; object-fit: cover; object-position: center center; opacity: 1; transition: opacity 500ms ease 0s;\"></picture><noscript><picture><source srcset=\"/static/e66203dbfeb634797218764c1b0a0b1c/4148e/blinky.png 1x,\n/static/e66203dbfeb634797218764c1b0a0b1c/de03e/blinky.png 1.5x,\n/static/e66203dbfeb634797218764c1b0a0b1c/1e9e2/blinky.png 2x\" /><img loading=\"lazy\" width=\"150\" height=\"150\" srcset=\"/static/e66203dbfeb634797218764c1b0a0b1c/4148e/blinky.png 1x,\n/static/e66203dbfeb634797218764c1b0a0b1c/de03e/blinky.png 1.5x,\n/static/e66203dbfeb634797218764c1b0a0b1c/1e9e2/blinky.png 2x\" src=\"/static/e66203dbfeb634797218764c1b0a0b1c/4148e/blinky.png\" alt=\"\" style=\"position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center\"/></picture></noscript></div><div class=\"flex\"><h1>Writing an Emulator in JavaScript (and Interfacing with Multiple UIs)</h1><div class=\"post-meta\"><a href=\"/me\"><img src=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/4QCMRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAAMCgAwAEAAAAAQAAAMAAAAAA/8AAEQgAwADAAwERAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/bAEMACAYGCgoKCAkKCAcICAgHCAcHBwcHDQcHBwgdGh8eHRocHCAkLicgIjUjHBwgNyAsMDEtLS0fJzA9MCg8LigoKP/bAEMBCQkJDQoNDw0NDyYVEBUmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJv/dAAQAGP/aAAwDAQACEQMRAD8A87aEkjAqrkjwjAc0gK7oT2oEOiiOeeKAJphxQMhhiOTxQItrCW420h2LtvoqsVLvsz8wAXORSuVym1Z6CiySxiON18lXDyHJjQ/xD1qXIpQI7t7K1ZRAqySBcPJNHlM1STYOyM1tWDEEbQBwPLhCg1VhJmpZaoNwzJwOCJIs81nOJrGSOltLxMAyEGID5ZI2HlgfXtWE/I3gl1NRtGilQPEQzNnG/Eb/AKVl7S2jLlTT2Ob1DSnTcArBh2YEGtItMwlCxiFXV/mbjuDxW6ijF6HQac8YChiASO/ShxBTHahZRuCyEK394dKlaCkznp5DH8pBJHcDrWnMiRIJckcP15zRzILnX6VfwhAHC9OpFYSepqpLuZWvSRk7owCwPBXvTi0t2TJmGNRuFxhDx75qvcfUjnOg0nVZJl2ugVhxj1rN8qehop3P/9DkPKVexIqXdjtYquwJIVSfwqkIEtHb+EilcLFuHSnbrt9/ajmSHYkNkI+Dhj9KnmHYRbQE8D9KfMLlLcFsOOB681DkNIluLhVVtxQsjRopVc9atRbBl2yvFNpdtKFYW8XnxyLIySKfam42aBM4m4Mszs27OScj7pArVKxDZFJZzqQVk+UZyUOAMdad0wsyzbxXYZoluZEmHyrFOgwx64+nvSdhq5vaXrl1Zui3cO1eB5qqI8r6+lYTgpbbm8JuOjPSNHMcsSy20ioGIJUHfCW+nQH6Yrz56OzO+LTVzfijjmRop4AW2t8pxnHse4qoJoyqNHO6z4ctmGQVhC/vFkfls+h/xq1UcWc86atc5GSBUyoJO04Bq/rByPQkhmcZG7KnsxzWU6zJ5hJ7dGyxwD71h7aVxcxWSFV7jHpVOpKwcxegCYxkCud1Z3BSCSOPOScjPrVynOxXMSGG325wtciqVb2uK5DBLDG/GOveunmm0NOx/9HASzDA85z1zWXMXYZ9jVTkdfTGaOYLEzqUAwufrximDLFjFNIeFGO/rSYJmifD8knPIPpSvYY6PQXUhWGQe+MVm5jKGvQrZqnOHkz8o5bbW1Ncwnoc5HOCspZf4kmMe9vnxkfh1roSsZ3LV3cj7JBHGscTSNeG5eFfJRQhG0H1ODRbW4FO4gC4cLhZowTjqPWncRY0ucSusLkCUsvDAKrp0yPp1x3XNRLQuOpsXOnxxGC4O+SD7a8DyqMtpcoXOSeuO2fes1LQ05DXt7QwLF9ohjvLOSIlmbDo6d2H90+/T1xWEp320ZvCCN6w8PtaYn05/OspFLvbyvlT+PY/z7461lfndmtSm0tmdBDdwzLtb906sUUu7K9tOOiv6ezVfLykOTbM/U7h42ZJlRwzMgMpwpbuP8azaNNGrM5PU7ZVxJGrLE5I8tm3+U3pn096xcWmcVak4u/QxzKy9v8A61W4XOZ6FSe6kweTTjCJNyst5IOtU6aC45b+TPG78uKXsoiuSeZcSYxkUnyoqzLkNpcOBknB64PSueU4LZDSZej0srgtn355FYSq32DlZ//SybVcnbhuOmKz07j5i4bbaclf60uZCcircb8ghBgcHNTzxXUnmLumXTI3zJgHv6VMqkX1KUjobbXERhuxkcHI4pc6Yc6JtR1qAxswK5UZwMCjRlcx5fqmpNcSPM5+YkhBnIVa7IRsJu5kPehGyeVPEhxk+Wa0sQ2awvP9Ghsni814SN0yNzKrHPHtjGP61Leo0iOKQvbyBgQVmaSGQLmSLHBH6ikyrFWWFiBLGQk0Uof5TjLjkH88E0c3RhytanfeGdQW8tJYWIEiSxZjwCZYgeBj15I9xx2rCrFq1jopvudBbvHaQxYPm2TTIiF2HnRo33Rns3OB6g81i48zui4u2hu2UC2CM0Umy1kAaPrLAjHg5HVV4Pyj7vOO1Gm3UT1MHxAoYtfWWLe82rbyruBywGfKc9GXBJU+h4zjmovox2aMCx1t7mOSOZgTwqlz99B2P8we3Q1Mo2GpXLFvdHJBLGMMEG8BkZfcdjUSiU7NWZh6gZFmkBVQd5I2fdK1NjzasXF2I4osjLEikzIryxqCf8KauFhiOinnFNpsasXLe9TP3RxWcqbLujUj1SNFyQAfSsfq7b3GpIpy65uJCqcdMniqWGS3C5//00t444wfU+1eLKvKT0IuEk0Z7/pS55dxXIhh+i0c0urGKyFf4R+FVFskbtHUkdPxrXUaRm6rOqx7QxJc847LXRh4tyu9i0jkbiQlieuOOOhNejFAyiVaRwo7nFKTsCVzt9C0scK6gtDbr5JPO2M5yPoDXNOodkKSKax4W7gwQQRcocd8jI/StL7Mz5dyrHD87r0ysUwGeMdxTbsCRZhVoZRJGzISApZOHTnINRzaWYcrR2Gn+MYbyE2d1AnmyqIb5AQkd7GOuD/C/Qg9jzSlFp6DUrlzTfFBtpPsUtwZAVb7Fqk6K5uoT0EqjGDxgjvjscVEo9eo1buQXVx5btiPbBkxSWiS+dHbxnkKjfxIfvK3Y/Lx0GTfY2OR1iD7JOtxE7PC5UlmBRRn/wCvWsZ86s9zKa5XoTpe5ZnwsUuB9ogbICr61LiUpGlLcI8W5ldpUxtYDGYqxcb7GdeHMuZGLdX55VeB9KuMGtzz2yl57dSTzV8tibjQxY0IBxLIf/r09GO5IspI5Oadkh3I2m25o5Q5j//Uym1Af3q8lUjDmIvtyk9e9V7ILkw1RFHHP0o9lcfMRnVCapUrA2QTXxYdfyNaxgCZl30xIJOcBeueK66cbGy2MSUkL6Fm3HPpW1xFrQbbzJlYjIznms6j0NqUbs9KsIAk8BOds0DwYxxuHP8AjXHe53JWMW+tfKnhcfd8yS3lY8bFyf8A61axldGMo2Zn3EPlvG2MKJntpucbQeQau90Q1Zlx4A3OAcgHHvWXMzTlMW/01gGliJBQ5dN2G2nvWsai2ZjOHVGZLqLlVR2fzF5jkU87+gP9CPTHpWtkY8xraX4gBHlTMPKZCIcxmRYmP3gP9nvjrnmsp076o1hU6Gp5yuJLecq6N8ock5OfX19PfrWPwu5t8RlO7QO0bqzrGV2liWl8sjAwf0/KtN0Z7GvZXG9Ngwc4U5H7qTv/ACrKSszRe8rFG7gXccADJ6ZyBVpnm1VZsqFBRcxJ4ox1qJSGOmh74NTGQECRMeAp/DmteZICb7AxGSPzFR7VFWP/1eOYkelc3Ico6OTI6c+nenyopIcD7H8qOVBYmVlIp2HYbLgdMChFRRlXj5Urk4LBc1tE2KN2MgAduPrVJhY2/C0OXDY79fSsarOiitT0PyGMS7ADJGyyxc9H7/4VzI7ChrEKzwyFMt58byKOjFxwy+x6H86uLszOcTnGc3ERRsCV4GgnT+7eJzn8cLWuzuYvVFqwlDwxEg/cCZI5B9DWctGaR1QXNufmI7jIB6EVKY2jmNR089V4I+ZWWuiE7bnNOnYyQcswlkljk2nbLGqgPIOma2MNixa6tKEETNlQd0Qc857qT/L3qJQT2NI1LbmvDci5j2fu2ljGMSnYXT+7+P6Gs2raGilzF+yVk+Zw6opCB9uGf8emen4VnPU0iy9LAZvmwuVABKjANZOdkc2IhrfuVPsQzz+lLnucnKX7ayTjI/HvSk7lKJqx6NHIPT071hKTjsVyEq6THD95VHoa55VpvQdkjPvWjTIXFaQ5mSz/1sS409R8owT7c4rjVRmLRastLGOV5+maxlXSKSLD6OMH5cZ6cVCrsLGVPpxRs549q6oVOZBYqyQgAknoK1TKijDvWxg9s5rVGrKszZGO/p3zTE9Wdt4YsdioCBu4BPbNc1R3Z1U1ZHZLdwx/K00WenDDOajkNeddyncmMlnhmiO9t00CyKF3jo6+jfz70+UHM4jVmktLlpghEcrJLIhTcsb9iPXjrWkfeVjGWjLOnzqJmVCGinQXMW35gPUf1qZLqVB6my0fGc4Tbhg5rM1bsY140K5BkTPIAyCQK0jFmEpo5fUkidtyMAe/GK3hdbmE7PYySeufxx1BrUyJYLjY6uo2jK5Gc5H+FTKNxxlY6eC4WVUZGZgCRgMcD/PTNc8lbQ6U76m1pspdtmR84IKgcZFctRWVwqq6OgtNCDjczdeT7V59XFcmiOXlGzaeicAnP1xRTxDkTsSW+6LkMcd161fte4XGX91uXgjNdKgp6oDBc7upyfQ1pGFiGf/XpRREMCwz6+1efLVaBymos+FG1CSBjpXFya6iIWuJn4ETD604xjHdgZtza3TEnYcV0xrQXUlozLm3lRGLjGBzmuiFRT2LgjmL+Tt711IpkcUbSyyKv3lQMv1FD2GtzvNMje4itxiSKNkxNEh8p2b+7nsK5ZO1zritB+p2Gnx5SVhC2N3lw3VxM6/kRRCU5fChTUV1OXe3st+IryXO4/8APSF8/U/41teS3RkuV9TsNDtEliaJ7h5yP+eyguFrmnPXsdMIprUZL4djgl8xBsAYvsBwFbvj/CqUnJCcOV3M7WHWZBEsrRhDkso+Y+1OF0yJ6rc5wRWkZ/fM8hB+67KT+QwK3XM9jD3Y7kwgsJ/lj8tHYZCm3ETt9DS9+I/ckZV3pDLuZHVirEeSUO8j1B/p1960jU7kShYzPUdhWhkammXBjfEW+QMMNDjlyP5/hWc43NKcuh1cbNGY3VpNpAkWNk8uWKuWcbpo6N1Y6eHUpHQBPQZxXmyw8W9TkmmnYRvNzlj+dLkjHYhkE00g4AJ9MU1FMlmddSSdCCOa66eisCJLSyZ+WHX9KVSryisf/9DXs9G3DL/jXjTrpIbLiWkMP3tuPXtXBKrK4hj3tqhwNn1wKwk6ktguKL6Bh8qp09BWajVb3A5XxVdxCB1VfnkIVeMYr2cDCXMm3oUjze5bOD/tPXsoGanhi0eWeWUKWVURnK8+UAe/pms6ztE1ormZ6BIDbxl1U+YUwqqvG+uK93qzrcbHILol3N5slwnnu/zQbbhl8qTOckdG47V2RqRSsjllSlIqx6I8UsjSQxMHDAKS2xW7U3UVgjRZ1GiRPCschA3JKuQn8cXT/wCvXNJps6o6I1tSviVb/RbkgDhyFEf86qKCTOO1CFpflVwoIDu3XJP+cVpHToYSKb6O0pAjW2Rco7RRQiNDIOp+tae1sZui31K7aBKhQh1RlAGIxnLe/v70e0TVgVJrU1HtWMZLL8w559ayvqW0c1qdjHBtkN1GZpJjGLFYmeZVxncST07Y9a6ISujCpG2pUQFXQ992Mg7eat6kLc6ixlkaONnklcBvLAkkaQ498muWe51xOt0kjyAQpUqcHnrXDVdmY1VrctmYscYNck5HOy0sAbHHcHms3J9GAy8tY9o4H5cit6c2CRWyiKMc9uKcryA//9HSvNaIBCD29BXzsIX3YpSMx7i4mBCk1VorcnUdaaNM7Zdj+eazq1YxWiKSubMWmrGOefxrjVbmeg7HG+NCFaNR0CsSO5PSvbwOty4nCXJwv4Zr1I7iZt+A8NezQkjFxauADwGIPH86yxK0RvhnZs9Ujt/MiR8csACuPutXCdhUltSuccDOeKdmNehWOmCQgtz/AHi3WqVx/IfdWW2OKOIqu6dFZGGTJVIhmheRKkewAY2hTjmt4oUlocTHa7ZJkZsgPwvUhc03oc73L0ViAcjlfc4rORqiytqv90Z6/NUWaG0VbuAbWAGMjFXEykec642bpvbJx3ArrprQ5qjuwKbgxHVCHz7VRBr2Mn+rGBtxg5z96uaojpps6rTZTGXU/LkA7G4K1xVY3KqxurmitwOuMfzrinBnC0XItTRVyeuKz9k7gtDK1DVHc4QEc447V1Uocu4rhbsSBvPQ81NeVtgP/9LWjtIWPIB+vSvkVOVyUi5EkKYChSfpmr5m0UkPdtv3B+Xas3TctC7ELyPznj371UKCTJOA8YShpQuOQA2c9q9vBwaiWji5hlgvYLk+wr0okyNPw6/2e9s5MYAm8qTn+E/5FZ1VzRZrR0aPa1iKZZVaSKQAvGn342PUj1Ht3rgS7neQsIm+66H0+YK6/UVaQXKck6IcFwT/AHFIZ6Yx0Tb5FZh9wcAciP2+vvTihWHXg3KeMda6IilsctfKySB1XIH3uMbhTkrnOWLWZMBi4GegYfMR9axZqkW2uEI5aMkDjGHY0rA9jOuhkHOVUg53DDOP6CrRjI8w1R911Kf9oflXXT2OSb1LluM7emHVVbPpikwRc04lJNhxgZ4PqOtY1NjenudPaEgqWJYhgMEfeXpXDM6JK6sakkTcgLWDaR5842ZCtlI3ZgPTBqXoRa5P9gIUkjHfNSmwUQit8nFOoroLH//T6GK1Hc18klJAS/Z1U5zitIWKHM6jHT39a10C5Vk+bp1+tCaFc8/8YRhbjAzkxqx9q9XCv3S1scgw+aQ9cBOnpXetiXuWbRsMp4JUrJnpiomaU9z3bTJd8ED+sanNee9zuTC9jVgdyxt1J3KGJouzSNmYMyqHEaIF3H+AbAPypORdki6sywCKMwyHefmcAGMVUZ2ElcLuZcZ4HHJq1VYnE5Se+LylQhIGckdBW12zmtqPtIyhC+vTuBWU3Y0jqaQjUAnAycHpikpBJGZqMmAfoa2TOeR5denN1J/10Arrhsccty7bZOzJ/hXpUsqJd3kGF8cB8OMZJboT+nSspapo2g7HUWvIwSWUgE8cvXDM6t0dhaRRNDE+QSU5Ldc151Xm5mcNX4mWNsYHAGQOaI1NNTIrSruHA4+laJ6gU1GwjI/OrnsB/9TdlvADwQK+acGxsilmdxlTyOg9ar2YiENJ3B+gNCiIlDleoOOvWtEkUkcR4vbdMrAf8ssZ9a9HCqyLWxyA+YTH1kCj6Cu4nuU0uWVsg4AJU+4oauKMrM9z8F3nn6ZZPu3EQ+W/f514NefVVpNHo03dJmpeNgE9uee1Ytm8TNs4GLea2cscqO4FOKuNsuuo78+mauxKbRj6gpciNcjI5IHNJFboy/sioSCOe5PU1vGWhhJWFEeD1HHI55pzSaJjKxZRiysT/AcGsI72NZaox9TcBWJ44PWuiJyzPMS++4lbt5jGu3aKOJ7s0rYfc9+P1qJGkS4wDRzDvDcq3p8p/wD11kzSJv6RLkBTjITbgdzXHVWp2Q1R1VjuMYCNvVsSLzyoPauGq1F6nHXVpGjDCzDGfoK5ZTSZzF6O22j5h9Titou47GVfoPMGBxn1reK5kB//1bEI3k5P/wBevn7huWUm2Nt6jt61DlYNjRiO4A7CM98VCmIJrYkH5cVanqUec+MsxSBT18st7gV6+E1Ra2OUj/1S/wC1KST612kGY/Vh0/iBPemiT034U6sNl3p7sA0bi8gyeTG3Uf8AfXNcmJhbU7MPO+h6DdDKuPUHFcLO6JlySXJKeQIunzCbJD1UXqOyIprq5xyqj1WL5Wrbl8y4xT2Mm41GUEgRzhjlQWjQnNNRL5SjLNcHJyyHu0kmCfyrWMUYTiJBFcM6s8uEU4WMR43VM9jDqapISF+cs5Fc61Zb2OV8SXght5TnnZhR6muukrtI5KrsmcBaqcsxPPQn3rslsca3NiEcR/70g/WsmzaJfjwZbiP583FmsqtkffAFZS2TNI7s09JkOxCNoAkXcpOGD+1c1Xc6aZ2eixsrTJ8pjU7s9Gz/AIV5+IWzMcQupv26kEE8D3GK4JUpNnGS3NymMA/Wt6aaAwrl/nBA5J+XuK6IysCP/9bTtrRk7H8RXzjYbE8VoGkDMM8554GKwk2I6CNI1UdOMUmxle7uo1U9OBTpptjR4741ufOud2chhtA9hX0GFVoFPYwOkcY9GB/SusRn3MZzuAJGTkgZK1SIe5Y0bU5LC6t7yIEvA5Dx5wJYD95f8PwqJw5k0yoScJJnvNhqMN7bw3MDh4po1eNhwwU9vrXlzg4tpnqQlzJNE0KAdu/BNTEtsju4lcdMEHqPlJqlJoqMuUw5rRgSdzce4JzVqozTnK5sgvzE7m6/NzirVS5jUlzbBtx/Sq3OcqyS4BznAOanlsDkedeLNS82YQqcpES8nPBk9K7aMbK5xV53djOtE+Un+9yO1aSM4mnDwsZ75bjv1rJ9TWJPuKXNo3X5Y1xnqvI/qKiXws0W5raaGUyoMh47hmXb8wQ44P8A9auWep0Q0O00K8DzJJIxVng2SBjwWGK5KivoZV9jeubrA+U8gY46VHszkZmsGY5z+NRawrDmjAUMeSDz7Uhn/9fqpZkA4HOK+U1C5TFwcnA/KrjHmJJFmkJxzj0quVAV79GWNuc7gcZqorlaKR5d4iiK3Sqef3IcZ7Zr2sO7xuamRIMBRXUiChcEjn16DPFUiWQDBwR3Hb1oYHaeA9ea2d7dixt5WL7CcmFz1I/rXJXhf1OvDz6Hq8EwYAjBDLlSOQa4zrQ+RM5OMjrTSuUUpoBknn2Par5R3Kjx+vf0qlGxDZmXcgXnsB+dWjGTscvrWqfZ4mwcyPkRrVxjdmMpWR54zGSQkkksxJY967krI4nqzUhXCqKzZokWISNqHBxuI96hmiJ7pgrWpYhdrRjOdpJ61n0Za3Ru2MQeafaQGYQMOcdQR/MVyz2Ruja0p8TOhHIKyLjnapH+INYSatcit8Js75CcYP41PMmjiZegVgOeP5VhKaBBJGXVsHnOcdOKakhn/9DpI4g6g8n+dfMVJJEksVmMmuNVG3oNIcU2t0Fa8zHYpag5I9hnt1FdFFO+o4nmXicA3oPODbLj6Zr2sN8JoYUw4HstdaFYoXPAHQ5PFWjNlXGO2OeO1NiLVhP5UyuDgg7seorOaujSm7M9Y0DV8KgLExHB5OSjV581ZnfF3OrE4wTwQenvUrQ0TKk1wvXgU+Yozbm4HY4AzxVJkswtRu1RWdmCqMsfStEc02ed6reNK7yHjdkRqTnbHXXTics2ZduuWPsP1rZ7GK3NNvlyemxBn64zWRsiaH/VxZ7A5x64qHuUi28jxGNkOA8flyKyho5IW+8v/wBftULqWb+j8xNJ80kcSWzlUfEsQ3YGfz/nXNM2vojo9CgzczJJkpBbWyqpUEq2M9fxrlqfCkZ1XaJumSNTwAa5E2co7zMjj9B1rNvURNFCxznjI9KTnYZ//9HuUhRF7D6d6+Sk9NR2IghJ4/TmsuW2oIc9t3ahMqxl6ljYQME4xxya66E0wSPNPFKETW7AfwsjfSvZwzumWc/L1I7bce1dhLM66UE55GDkH2q0Qyqehxzg4pkj4zyrZ5Hymkyludbod6V2gn2x1BrjqxOynI7ezvmKABuOynmsDe4s923OUb/gJzUjuZN5eP8A3cVaRnKRyuq3LPkFsKOi9jXRBGE2cxdv+vArqgjmmJZrkn3IFVJkxRbujhZvcMP0AqEaMsr9xB/shePXFZvctbF11ykD9dkaOVxwRWa3Zdtje8MTxRu5dvLBijCEPwHU8E/4ep9qxktWadD0ey0uGKzWWNmc3X+kbz94JgBR+QrCa7nPVnd2MuS2YsTyP61zScV0MrGnp9ttAL9vWuV6saRoGVBxx6Umrgf/0uvAdjznFfJSsXYso4jG48HvVqKFsZeo64qgqDg0vY82wmznptSJ3Mc7R1wMmuqjhWho43XbozOcgqAp2BhgivXoUvZq3UuxiyjIz6qDXQBSmAIIyOnTpTRL1KLZG4YPHOT3qiBUGGyOhwc0MaNexmIK4OPpzWE0dEGddp17uGQfqO4rmkjeLNfztw6is7WNLmZev16flVxIkcnqLcn6n8q6YHNNnPznLZycDPOOK6YnPLUs26bVTHVwX+m7gUpFRQt0eCOu5senf/61TEbLePl47Ff5Gpe5a2NWJCYY+DlocL654rG+pqti7p9qAIVyU8yNzJK2GVWBx0+mDUSLjszu7S4kh2rOGjjnOIJC2YZFHp6H2rkrQclozCcVPZamrGq55xj0rhaexjsWfNGdoOPekojIZ4vQ479aEFj/0+zuLhF7/lXzUaFzVoyLzUyQVT5j0GOtbww7RD1MG6iYK88gZUVS7HBPFdlKl5DUTmrvXiATESrDBRBjald8aSiHN2OfedpXZmJZs4JptWHe40nKgdxGcGkMz5T8xHr+lWiCBgckjHTAB65piAdQOhHOBxQMu2v3gTwRx7VlI0izcsrjY6Hgb8r6jNYyRtFnQxXII+YZPr61k0aplS9ulAOBz69KqKIkzkNRuCWPOSfbHFdMEc82Y8gJ6nk9s1sjE0P41A/hZAAPQCpZaIpuSv1ZqSEy8MhWI/uo3rUM0RsWjkfu0USM0SrEpXJ38dKxe5tE6u3sI4/KtXixdTQQ3yE/OMB9wH5Ak/hSSvqaKSW5rXFsQAB89peERzKrbjHJn7w9D7/Ss3HqDhzO6NhISiwmRl3PGuD/AHzXDWjZtGEqb1dtC+lqGXjB4rmb5TKwGwPfJ4pjsf/U6OKAyAFzgH1ODXCqcYm1rk/2C2hUzO8YA5LOwArTl8jWNCT6HG+JPEokjltraNBHIpR5MbpXFbRglqbewt1PP5lcA7kdQTgMVKg1pGaezOKpDlZBEMP1GSQADxzRJEokzySSQCHVcD0qSijMNw3jOQeR0FUiWNZOSe5x1HQ0wIsc/TqaAJ4nIAbuPvCoaKTNWzlLOpHIRt2RzWbRombkUuB/gc5rJo1TKGoT7UZz04qorUiTOcmbO5j3yW/2RXRFWMJMqou509PMU49qvoR1LG7MwA7MR9anoV1CcYPsEz78mkgZoAfIf9yHFQ9zRG/oVi9zPtXbuVV4ZjjaTgHPasZaG8NTqlk8nVYY5WRpLaxSKNH/ANb8yOGB9htDZ6c9KUU0l5hPsZi+I2NteRO7yf6XYyWsjsPNK8bgP5/jT5SlOx1Fhqsc0kEU8kwt4LZWZILbzGmlPqfpx+FZVKNaWtONzWniqcE1Jr5s6GNonH+jXcRbGRFcK1tIfzrhlhpx+Ok4kP2FX4JW9NSreX08UgieKRGbld3KMPrR7HzMpUpR8z//1dPVtahhQ+bKsOekK5kuJB9BzXNTjOo7Qjc9OTpYZXqPU4nUPFLtlYbZQFyBJqE2SPoo4rvjldaWtSVl2PMrZvDVQRkNrGoyZIli2nqLbTs/1rT+y6cd3+Jzf2hKW0CrLbX8wOUvnVTk5iMSD9BVfVacNUxfWqs9HEU6XcR4kkgeILyS7KG/SueaitmdMG2tSFoWjBLBGVgdo7gVmWjN35J7jGNvSmAvPzEY42nmkNEbL85HqD+FAh6+p4B27vqaGNF6zlMTLnOxm2MR1X3rOSuWjXmuxDsLZ2F9mVGTmp5blc1jFv7t5XAZhiPkoPuo/wDjVqNiJSuU2+bI5AHHuatEtBGAhLEdFLY7imIjiz5q89AWJ/CkxLcfcN8xHoY1oRT3NS2UkAAMyv5YZRyZMc1mzSKOl0e3lCRXkDlvIijuZUhfbLFg8jHQkdR2NYt7nRBWOju1+3SPe2rxyXRt/JkRCNzA5OB6d+fwrCNRwdnsbOkpK6OL07TZPtNvbvHKGaSMkyjYkcYOTkdxgV1KS6HNJNbnqGnWeiRfLLqkUb5O8PeRQIW9vauunjJ01aMUebWwUazvK7N21tdFlJSLWY2Y5KoL2KR8fQ8Vr/aFTrFNehi8rgtYya+Zpf2HOi5gkhvrcHKxOPn/AA7Z+mKxl9Wr7x9nPutjWnLFYb7XtIdnv95//9bLntdHsS76lqS3Nx/FbxOzyu3+6OT+dep9YjTVqUVFfezzVhpTd6jb+Znv4502DK2ejOVB+WRhFBn8+axdeUup0KhGPQpP8RZudmmWyKc/K96zYH4LWbqPozRU49EU5vHl6+7FtYRlyMsxklaobbKSSK//AAkt9PgSy26x9AiWoDY9sk1lJGkSGedzI6l2IXcgBPGBUlmY+4sByAT6d6ZJKo+YL22tn3pXKIpTiQH0xmgRJKMbT2PJxQBbRgynuCuM+9SWXgq3ECLKCcopyGKneP8AOanZlbmLsC5UElVJG9urNVXuSODDp2B545JoACvDnoznAHoKpMlor23Lk+in602StwuOWAHLOQFA4y1JFM34eGnjVv8AVvHGWUcsw4P054rKRtA7Pw3e2ts0AkQ/Z7i3Y7ywaEMw9eoBBP0Irnmt2dENrGm2jJbR3DGSSMQIJLOW2CgTRE8A+/Tn0+tYtqW6sa83KUf7ThfcLwxoRHmY3kaxDB7lwMH601Sn0YnUg9yjLHocGXjYxmRSpeCM3VvG35cfhXRTVV7mE3BbGNqV2sE0YjkjdSgGxmxJs9cEfryeK3jqc8pWNjQ/Ft3aMv2e6kiAYHYjkwP/AMBPA/Km4oE11P/Z\" class=\"avatar-small\" alt=\"Tania\"></a><time class=\"date\">April 13th, 2020</time>/<a class=\"twitter-link\" href=\"http://twitter.com/share?text=Writing%20an%20Emulator%20in%20JavaScript%20(and%20Interfacing%20with%20Multiple%20UIs)&amp;url=https://www.taniarascia.com/writing-an-emulator-in-javascript-chip8/&amp;via=taniarascia\" target=\"_blank\" rel=\"noopener noreferrer\">Share</a>/<a class=\"github-link\" href=\"https://github.com/taniarascia/taniarascia.com/blob/master/content/posts/2020-04-13-writing-an-emulator-in-javascript-chip8.md\" target=\"_blank\" rel=\"noopener noreferrer\">Edit ✏️</a></div><div class=\"tag-container\"><a style=\"text-decoration:none\" href=\"/tags/javascript/\"><span>javascript</span></a><a style=\"text-decoration:none\" href=\"/tags/node/\"><span>node</span></a><a style=\"text-decoration:none\" href=\"/tags/emulator/\"><span>emulator</span></a></div></div></header><div class=\"post\"><p>I spent a good portion of my childhood playing emulated NES and SNES games on my computer, but I never imagined I'd write an emulator myself one day. However, my boyfriend Vanya challenged me to write a <a href=\"https://en.wikipedia.org/wiki/CHIP-8\">Chip-8</a> interpreter to learn some of the basic concepts of lower-level programming languages and how a CPU works, and the end result is a Chip-8 emulator in JavaScript that I wrote with his guidance.</p>\n<p>Although there are endless implementations of the Chip-8 interpreter in every programming language imaginable, this one is a bit unique. My Chip8.js code interfaces with not just one but three environments, existing as a web app, a CLI app, and a native app.</p>\n<p>You can take a look at the web app demo and the source here:</p>\n<ul>\n<li><a href=\"https://taniarascia.github.io/chip8/\">Demo</a></li>\n<li><a href=\"https://github.com/taniarascia/chip8\">Source code</a></li>\n</ul>\n<p>There are plenty of guides on how to make a Chip-8 emulator, such as <a href=\"http://mattmik.com/files/chip8/mastering/chip8.html\">Mastering Chip8</a>, <a href=\"http://www.multigesture.net/articles/how-to-write-an-emulator-Chip-8-interpreter/\">How to Write an Emulator</a>, and most importantly, <a href=\"http://devernay.free.fr/hacks/chip8/C8TECH10.HTM\">Cowgod's Chip-8 Technical Reference</a>, the primary resource used for my own emulator, and a website so old it ends in <code class=\"language-text\">.HTM</code>. As such, this isn't intended to be a how-to guide, but an overview of how I built the emulator, what major concepts I learned, and some JavaScript specifics for making a browser, CLI, or native app.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 850px;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/730748a3484c7822029e436f532694fb/e11df/blinky.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 95.2%; position: relative; bottom: 0px; left: 0px; background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAAEAElEQVQ4y51Uy27bVhB1LNWxZUl8XpIiRVKkRFmkJLtyHPlRG4niJg0cx4kfeRh22jh247pu0Qf6AOq2yKJAF10W6CJAv4D+gG677Ef0J7LQIgTu6eV1/GiXJXBw78ydOTPDwczAAPsMURAJESqSLDmjo6OuKIquaZZcwzBcQ9fdfD7v5nI5V5Ik/nYKiaEoCE6+UKgUCgVx4PTzJeGlaQ7D9pxX8/Pz/anu1X6z3eq3GN6+0uk7Fbc/NHy5P5jJ9DMp3mLIZvqDg1x+lc1mMTQ09PKMcKLdPu52p9Dtduns7Bw6zUlMd6Yxe3UOc5NMjjoInACu46HiVeHoLlyzAsf1EDVCem2mi7EwPD4jVFU11nUdhJDX7E7N61VavhHQ0oRL7ZWIWuyeQnNLVJVUai83qDlfpUQlVNO01yXDQMpxRijLckx0AkWUE61pwXsxA//ndxD+sYzxvzdR+/Uaoj9XYG+1UOpV0fprDcHvN6AazEdVElUjSDnOCUUpVvMy5JyYKJKC8sMI9mYT9nYLla+nQHwDzt44yg9C2E/bcJ6Nwz3sQBFOfNSC/G9CzSvFzkqE8lIjKS83YN2so/zeGKxeDazUE1xn91t1/ma9y7AYILUt32kk9lIIVSfnhNa1INb2m1APwkTa8CFtViGuVUAOI8hbNehfjUP7nJX74grs3+YhrnvcRt4OoO6HiXbAfH3jnNCc82N1p4HiPSfJ90wY33c4CrcsKLtjHPLTOpTnDU5m/DgJ46iD0QUD4kMvUXeYjaudE5Z7QUwYofjIT5S9MUiPfPCTZSGsViBueBDuOjxr8YGXZgX5ScADpT7kQ1Zy9UKG+pgVFxdKENYriXDP5Yb5Xgny+wEv0/plGsJ9l8vyBwEKNy1G2kBqy4IlhVkDkq5cIIzKsbBYhvjYT4pLNs+IR2fZpJmmpGmZ0uPqCelOnQfg2bMMiz0LsqFcbEotJrshhLVKkpaifhxB+6IN8kkThUWTN4aXzzLSv5kA+azFAjV4UGHVTbT9CKqnXyBcqMbkI9bRvXoiPalB3q1D3PShHobQvp1A4Y6NwrIN8mULRfYvuc2zOj+Vg0ZCnodQLhKWOm5sbEdQ7vqJer9K1dUaJRsBdX6aoeanE5SsB5Ss1Whpv831JH1fr9HUVlnxE2OLNcW+0GVZYqPHxocYbJY1QomjU+IalI0VZeNFtWqJEkujKlEp8QyqMXA5tWU+bAf8Z/QU+ThVKooCRVZAXLYoPIOPnBaa0CLzROfo0Bom16llDemYpj5vCM+2zSBbnrfZYv2Bnd/lRnNHucsjRyNDI0c5hpHs8NFIZpjruP5UHmZyast83vjeTrkG2PpJSS8xZBiy/xOp76WU6x+Dgq9S9FmI3AAAAABJRU5ErkJggg==&quot;); background-size: cover; display: block; transition: opacity 0.5s ease 0.5s; opacity: 0;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"blinky\" title=\"blinky\" src=\"/static/730748a3484c7822029e436f532694fb/4d3f1/blinky.png\" srcset=\"/static/730748a3484c7822029e436f532694fb/0cb30/blinky.png 213w,\n/static/730748a3484c7822029e436f532694fb/a67b6/blinky.png 425w,\n/static/730748a3484c7822029e436f532694fb/4d3f1/blinky.png 850w,\n/static/730748a3484c7822029e436f532694fb/e11df/blinky.png 1000w\" sizes=\"(max-width: 850px) 100vw, 850px\" style=\"opacity: 1; transition: opacity 0.5s ease 0s; color: inherit; box-shadow: white 0px 0px 0px 400px inset;\">\n  </a>\n    </span></p>\n<h4 id=\"contents\" style=\"position:relative;\"><a href=\"#contents\" aria-label=\"contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Contents</h4>\n<ul>\n<li><a href=\"#what-is-chip-8\">What is Chip-8</a></li>\n<li><a href=\"#what-goes-into-a-chip-8-interpreter\">What Goes Into a Chip-8 Interpreter?</a></li>\n<li><a href=\"#decoding-chip-8-instructions\">Decoding Chip-8 Instructions</a></li>\n<li><a href=\"#reading-the-rom-data-buffer\">Reading the ROM</a></li>\n<li><a href=\"#the-instruction-cycle---fetch-decode-execute\">The Instruction Cycle - Fetch, Decode, Execute</a></li>\n<li>\n<p><a href=\"#creating-a-cpu-interface-for-i-o\">Creating a CPU Interface for I/O</a></p>\n<ul>\n<li><a href=\"#cli-app---interfacing-with-the-terminal\">CLI App - Interfacing with the Terminal</a></li>\n<li><a href=\"#web-app---interfacing-with-the-browser\">Web App - Interfacing with the Browser</a></li>\n<li><a href=\"#native-app---interfacing-with-the-native-platform\">Native App - Interfacing with the Native Platform</a></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"what-is-chip-8\" style=\"position:relative;\"><a href=\"#what-is-chip-8\" aria-label=\"what is chip 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What is Chip-8?</h2>\n<p>I had never heard of Chip-8 before embarking on this project, so I assume most people haven't either unless they're already into emulators. Chip-8 is a very simple interpreted programming language that was developed in the 1970s for hobbyist computers. People wrote basic Chip-8 programs that mimicked popular games of the time, such as Pong, Tetris, Space Invaders, and probably other unique games lost to the annuls of time.</p>\n<p>A virtual machine that plays these games is actually a Chip-8 <a href=\"https://en.wikipedia.org/wiki/Interpreter_(computing)\"><em>interpreter</em></a>, not technically an <a href=\"https://en.wikipedia.org/wiki/Emulator\"><em>emulator</em></a>, as an emulator is software that emulates the hardware of a specific machine, and Chip-8 programs aren't tied to any hardware in specific. Often, Chip-8 interpreters were used on graphing calculators.</p>\n<p>Nonetheless, it's close enough to being an emulator that it's usually the starting project for anyone who wants to learn how to build an emulator, since it's significantly more simple than creating an NES emulator or anything beyond that. It's also a good starting point for a lot of CPU concepts in general, like memory, stacks, and I/O, things I deal with on a daily basis in the infinitely more complex world of a JavaScript runtime.</p>\n<h2 id=\"what-goes-into-a-chip-8-interpreter\" style=\"position:relative;\"><a href=\"#what-goes-into-a-chip-8-interpreter\" aria-label=\"what goes into a chip 8 interpreter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What Goes Into a Chip-8 Interpreter?</h2>\n<p>There was a lot of pre-learning I had to do to even get started understanding what I was working with, since I had never learned about computer science basics before. So I wrote <a href=\"https://www.taniarascia.com/bits-bytes-bases-and-a-hex-dump-javascript/\">Understanding Bits, Bytes, Bases, and Writing a Hex Dump in JavaScript</a> which goes over much of that.</p>\n<p>To summarize, there are two major takeaways of that article:</p>\n<ul>\n<li><strong>Bits and Bytes</strong> - A bit is a binary digit - <code class=\"language-text\">0</code> or <code class=\"language-text\">1</code>, <code class=\"language-text\">true</code> or <code class=\"language-text\">false</code>, on or off. Eight bits is a byte, which is the basic unit of information that computers work with.</li>\n<li><strong>Number Bases</strong> - Decimal is the base number system we're most used to dealing with, but computers usually work with binary (base 2) or hexadecimal (base 16). <code class=\"language-text\">1111</code> in binary, <code class=\"language-text\">15</code> in decimal, and <code class=\"language-text\">f</code> in hexadecimal are all the same number.</li>\n<li><strong>Nibbles</strong> - Also, 4 bits is a nibble, which is cute, and I had to deal with them a bit in this project.</li>\n<li><strong>Prefixes</strong> - In JavaScript, <code class=\"language-text\">0x</code> is a prefix for a hex number, and <code class=\"language-text\">0b</code> is a prefix for a binary number.</li>\n</ul>\n<p>I also wrote <a href=\"https://www.taniarascia.com/snake-game-in-javascript/\">a CLI snake game</a> in preparation of figuring out how to work with pixels in the terminal for this project.</p>\n<p>A <strong>CPU</strong> is the main processor of a computer that executes the instructions of a program. In this case, it consists of various bits of state, described below, and an instruction cycle with <strong>fetch, decode, and execute</strong> steps.</p>\n<ul>\n<li><a href=\"#memory\">Memory</a></li>\n<li><a href=\"#program-counter\">Program counter</a></li>\n<li><a href=\"#registers\">Registers</a></li>\n<li><a href=\"#index-register\">Index register</a></li>\n<li><a href=\"#stack\">Stack</a></li>\n<li><a href=\"#stack-pointer\">Stack pointer</a></li>\n<li><a href=\"#key-input\">Key input</a></li>\n<li><a href=\"#graphical-output\">Graphical output</a></li>\n<li><a href=\"#timers\">Timers</a></li>\n</ul>\n<h3 id=\"memory\" style=\"position:relative;\"><a href=\"#memory\" aria-label=\"memory permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Memory</h3>\n<p>Chip-8 can access up to <strong>4 kilobytes of memory</strong> (RAM). (That's <code class=\"language-text\">0.002%</code> of the storage space on a floppy disk.) The vast majority of data in the CPU is stored in memory.</p>\n<p>4kb is <code class=\"language-text\">4096</code> bytes, and JavaScript has some helpful <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Typed_arrays\">typed arrays</a>, like <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array\">Uint8Array</a> which is a fixed-size array of a certain element - in this case 8-bits.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> memory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">4096</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>You can access and use this array like a regular array, from <code class=\"language-text\">memory[0]</code> to <code class=\"language-text\">memory[4095]</code> and set each element to a value up to <code class=\"language-text\">255</code>. Anything above that will fall back to that (for example, <code class=\"language-text\">memory[0] = 300</code> would result in <code class=\"language-text\">memory[0] === 255</code>).</p>\n<h3 id=\"program-counter\" style=\"position:relative;\"><a href=\"#program-counter\" aria-label=\"program counter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Program counter</h3>\n<p>The program counter stores the address of the current instruction as an <strong>16-bit integer</strong>. Every single instruction in Chip-8 will update the program counter (PC) when it is done to go on to the next instruction, by accessing memory with PC as the index.</p>\n<p>In the Chip-8 memory layout, <code class=\"language-text\">0x000</code> to <code class=\"language-text\">0x1FF</code> in memory is reserved, so it starts at <code class=\"language-text\">0x200</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> <span class=\"token constant\">PC</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x200</span> <span class=\"token comment\">// memory[PC] will access the address of  the current instruvtion</span></code></pre></div>\n<p><small><em>*You'll notice the memory array is 8-bit and the PC is a 16-bit integer, so two program codes will be combined to make a big endian opcode.</em></small></p>\n<h3 id=\"registers\" style=\"position:relative;\"><a href=\"#registers\" aria-label=\"registers permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Registers</h3>\n<p>Memory is generally used for long-term storage and program data, so registers exist as a kind of \"short-term memory\" for immediate data and computations. Chip-8 has <strong>16 8-bit registers</strong>. They're referred as <code class=\"language-text\">V0</code> through <code class=\"language-text\">VF</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> registers <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"index-register\" style=\"position:relative;\"><a href=\"#index-register\" aria-label=\"index register permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Index register</h3>\n<p>There is a special <strong>16-bit register</strong> that accesses a specific point in memory, referred to as <code class=\"language-text\">I</code>. The <code class=\"language-text\">I</code> register exists mostly for reading and writing to memory in general, since the addressable memory is 16-bit as well.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> <span class=\"token constant\">I</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span></code></pre></div>\n<h3 id=\"stack\" style=\"position:relative;\"><a href=\"#stack\" aria-label=\"stack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Stack</h3>\n<p>Chip-8 has the ability to go into <a href=\"https://en.wikipedia.org/wiki/Subroutine\">subroutines</a>, and a stack for keeping track of where to return to. The stack is <strong>16 16-bit values</strong>, meaning the program can go into 16 nested subroutines before experiencing a \"stack overflow\".</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> stack <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint16Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"stack-pointer\" style=\"position:relative;\"><a href=\"#stack-pointer\" aria-label=\"stack pointer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Stack pointer</h3>\n<p>The stack pointer (SP) is an <code class=\"language-text\">8-bit</code> integer that points to a location in the stack. It only needs to be 8-bit even though the stack is 16-bit because it's only referencing the index of the stack, so only needs to be <code class=\"language-text\">0</code> thorough <code class=\"language-text\">15</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> <span class=\"token constant\">SP</span> <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n\n<span class=\"token comment\">// stack[SP] will access the current return address in the stack</span></code></pre></div>\n<h3 id=\"timers\" style=\"position:relative;\"><a href=\"#timers\" aria-label=\"timers permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Timers</h3>\n<p>Chip-8 is capable of a glorious single beep as far as sound goes. To be honest, I didn't bother implementing an actual output for the \"music\", though the CPU itself is all set up to interface properly with it. There are two timers, both <strong>8-bit registers</strong> - a sound timer (ST) for deciding when to beep and a delay timer (DT) for timing some events throughout the game. They count down at <strong>60 Hz</strong>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> <span class=\"token constant\">DT</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">let</span> <span class=\"token constant\">ST</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span></code></pre></div>\n<h3 id=\"key-input\" style=\"position:relative;\"><a href=\"#key-input\" aria-label=\"key input permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Key input</h3>\n<p>Chip-8 was set up to interface with the amazing hex keyboard. It looked like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"terminal\"><pre class=\"language-terminal\"><code class=\"language-terminal\">┌───┬───┬───┬───┐\n│ 1 │ 2 │ 3 │ C │\n│ 4 │ 5 │ 6 │ D │\n│ 7 │ 8 │ 9 │ E │\n│ A │ 0 │ B │ F │\n└───┴───┴───┴───┘</code></pre></div>\n<p>In practice, only a few of the keys seem to be used, and you can map them to whatever 4x4 grid you want, but they're pretty inconsistent between games.</p>\n<h3 id=\"graphical-output\" style=\"position:relative;\"><a href=\"#graphical-output\" aria-label=\"graphical output permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Graphical output</h3>\n<p>Chip-8 uses a monochromatic <code class=\"language-text\">64x32</code> resolution display. Each pixel is either on or off.</p>\n<p>Sprites that can be saved in memory are <code class=\"language-text\">8x15</code> - eight pixels wide by fifteen pixels high. Chip-8 also comes with a font set, but it only contains the characters in the hex keyboard, so not overall the most useful font set.</p>\n<h3 id=\"cpu\" style=\"position:relative;\"><a href=\"#cpu\" aria-label=\"cpu permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CPU</h3>\n<p>Put it all together, and you get the CPU state.</p>\n<div class=\"filename\">CPU</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">CPU</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>memory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">4096</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>registers <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>stack <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint16Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ST</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DT</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token constant\">I</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SP</span> <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PC</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x200</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"decoding-chip-8-instructions\" style=\"position:relative;\"><a href=\"#decoding-chip-8-instructions\" aria-label=\"decoding chip 8 instructions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Decoding Chip-8 Instructions</h2>\n<p>Chip-8 has 36 instructions. All the instructions <a href=\"http://devernay.free.fr/hacks/chip8/C8TECH10.HTM#3.1\">are listed here</a>. All instructions are 2 bytes (16-bits) long. Each instruction is encoded by an opcode (operation code) and operand, the data being operated on.</p>\n<p>An example of an instruction could be like this operation on two variables:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">x = 1\ny = 2\n\nADD x, y</code></pre></div>\n<p>In which <code class=\"language-text\">ADD</code> is the <code class=\"language-text\">opcode</code> and <code class=\"language-text\">x</code>, <code class=\"language-text\">y</code> are the operands. This type of language is known as an assembly language. This instruction would map to:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">x <span class=\"token operator\">=</span> x <span class=\"token operator\">+</span> y</code></pre></div>\n<p>With this instruction set I'll have to store this data in 16-bits, so every instrution ends up being a number from <code class=\"language-text\">0x0000</code> to <code class=\"language-text\">0xffff</code>. Each digit position in these sets is a nibble (4-bit).</p>\n<p>So how can I get from <code class=\"language-text\">nnnn</code> to something like <code class=\"language-text\">ADD x, y</code>, that is a little more understandable? Well, I'll start by looking at one of the instructions from Chip-8, which is basically the same as the above example:</p>\n<table>\n<thead>\n<tr>\n<th>Instruction</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code class=\"language-text\">8xy4</code></td>\n<td><code class=\"language-text\">ADD Vx, Vy</code></td>\n</tr>\n</tbody>\n</table>\n<p>So what are we dealing with here? There's one keyword, <code class=\"language-text\">ADD</code>, and two arguments, <code class=\"language-text\">Vx</code> and <code class=\"language-text\">Vy</code>, which we've established above are registers.</p>\n<p>There are several opcode mnemonics (which are like keywords), such as:</p>\n<ul>\n<li><code class=\"language-text\">ADD</code> (add)</li>\n<li><code class=\"language-text\">SUB</code> (subtract)</li>\n<li><code class=\"language-text\">JP</code> (jump)</li>\n<li><code class=\"language-text\">SKP</code> (skip)</li>\n<li><code class=\"language-text\">RET</code> (return)</li>\n<li><code class=\"language-text\">LD</code> (load)</li>\n</ul>\n<p>And there are several type of operand values, such as:</p>\n<ul>\n<li>Address (<code class=\"language-text\">I</code>)</li>\n<li>Register (<code class=\"language-text\">Vx</code>, <code class=\"language-text\">Vy</code>)</li>\n<li>Constant (<code class=\"language-text\">N</code> or <code class=\"language-text\">NN</code> for nibble or byte)</li>\n</ul>\n<p>The next step is to find a way to interpret the 16-bit opcode as these more understandable instructions.</p>\n<h3 id=\"bit-masking\" style=\"position:relative;\"><a href=\"#bit-masking\" aria-label=\"bit masking permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bit Masking</h3>\n<p>Each instruction contains a pattern that will always be the same, and variables that can change. For <code class=\"language-text\">8xy4</code>, the pattern is <code class=\"language-text\">8__4</code>. The two nibbles in the middle are the variables. By creating a <a href=\"https://en.wikipedia.org/wiki/Mask_(computing)\">bitmask</a> for that pattern, I can determine the instruction.</p>\n<p>To mask, you use the bitwise AND (<code class=\"language-text\">&amp;</code>) with a mask and match it to a pattern. So if the instruction <code class=\"language-text\">8124</code> came up, you would want to make sure the nibble in position 1 and 4 are on (passed through) and the nibble in position 2 and 3 are off (masked out). The mask then becomes <code class=\"language-text\">f00f</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> opcode <span class=\"token operator\">=</span> <span class=\"token number\">0x8124</span>\n<span class=\"token keyword\">const</span> mask <span class=\"token operator\">=</span> <span class=\"token number\">0xf00f</span>\n<span class=\"token keyword\">const</span> pattern <span class=\"token operator\">=</span> <span class=\"token number\">0x8004</span>\n\n<span class=\"token keyword\">const</span> isMatch <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>opcode <span class=\"token operator\">&amp;</span> mask<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> pattern <span class=\"token comment\">// true</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  8124\n&amp; f00f\n  ====\n  8004</code></pre></div>\n<p>Similarly, <code class=\"language-text\">0f00</code> and <code class=\"language-text\">00f0</code> will mask the variables, and right-shifting (<code class=\"language-text\">&gt;&gt;</code>) them will access the correct nibble.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> x <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0x8124</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x0f00</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&gt;&gt;</span> <span class=\"token number\">8</span> <span class=\"token comment\">// 1</span>\n\n<span class=\"token comment\">// (0x8124 &amp; 0x0f00) is 100000000 in binary</span>\n<span class=\"token comment\">// right shifting by 8 (&gt;&gt; 8) will remove 8 zeroes from the right</span>\n<span class=\"token comment\">// This leaves us with 1</span>\n\n<span class=\"token keyword\">const</span> y <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0x8124</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x00f0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&gt;&gt;</span> <span class=\"token number\">4</span> <span class=\"token comment\">// 2</span>\n<span class=\"token comment\">// (0x8124 &amp; 0x00f0) is 100000 in binary</span>\n<span class=\"token comment\">// right shifting by 4 (&gt;&gt; 4) will remove 4 zeroes from the right</span>\n<span class=\"token comment\">// This leaves us with 10, the binary equivalent of 2</span></code></pre></div>\n<p>So for each of the 36 instructions, I made an object with a unique identifier, mask, pattern, and arguments.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> instruction <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  id<span class=\"token operator\">:</span> <span class=\"token string\">'ADD_VX_VY'</span><span class=\"token punctuation\">,</span>\n  name<span class=\"token operator\">:</span> <span class=\"token string\">'ADD'</span><span class=\"token punctuation\">,</span>\n  mask<span class=\"token operator\">:</span> <span class=\"token number\">0xf00f</span><span class=\"token punctuation\">,</span>\n  pattern<span class=\"token operator\">:</span> <span class=\"token number\">0x8004</span><span class=\"token punctuation\">,</span>\n  arguments<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span> mask<span class=\"token operator\">:</span> <span class=\"token number\">0x0f00</span><span class=\"token punctuation\">,</span> shift<span class=\"token operator\">:</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> type<span class=\"token operator\">:</span> <span class=\"token string\">'R'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> mask<span class=\"token operator\">:</span> <span class=\"token number\">0x00f0</span><span class=\"token punctuation\">,</span> shift<span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> type<span class=\"token operator\">:</span> <span class=\"token string\">'R'</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now that I have these objects, each opcode can be disassembled into a unique identifier, and the values of the arguments can be determined. I made an <code class=\"language-text\">INSTRUCTION_SET</code> array containing all these instructions and a disassembler. I also wrote <a href=\"https://github.com/taniarascia/chip8/blob/master/tests/cpu.test.js\">tests for every one</a> to ensure they all worked correctly.</p>\n<div class=\"filename\">Disassembler</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">disassemble</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">opcode</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Find the instruction from the opcode</span>\n  <span class=\"token keyword\">const</span> instruction <span class=\"token operator\">=</span> <span class=\"token constant\">INSTRUCTION_SET</span><span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>\n    <span class=\"token parameter\">instruction</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">(</span>opcode <span class=\"token operator\">&amp;</span> instruction<span class=\"token punctuation\">.</span>mask<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> instruction<span class=\"token punctuation\">.</span>pattern\n  <span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// Find the argument(s)</span>\n  <span class=\"token keyword\">const</span> args <span class=\"token operator\">=</span> instruction<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">arg</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">(</span>opcode <span class=\"token operator\">&amp;</span> arg<span class=\"token punctuation\">.</span>mask<span class=\"token punctuation\">)</span> <span class=\"token operator\">&gt;&gt;</span> arg<span class=\"token punctuation\">.</span>shift<span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// Return an object containing the instruction data and arguments</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> instruction<span class=\"token punctuation\">,</span> args <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"reading-the-rom\" style=\"position:relative;\"><a href=\"#reading-the-rom\" aria-label=\"reading the rom permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reading the ROM</h2>\n<p>Since we're considering this project an emulator, each Chip-8 program file can be considered a ROM. The ROM is just binary data, and we're writing the program to interpret it. We can imagine the Chip8 CPU to be a virtual console, and a Chip-8 ROM to be a virtual game cartridge.</p>\n<p>The ROM buffer will take the raw binary file and translate it into 16-bit big endian words (a word is a unit of data consisting of a set amount of bits). This is where that <a href=\"/bits-bytes-bases-and-a-hex-dump-javascript/\">hex dump article</a> comes in handy. I'm collecting the binary data and converting it into blocks that I can use, in this case the 16-bit opcodes. Big endian means that the most significant byte will be first in the buffer, so when it encounters the two bytes <code class=\"language-text\">12 34</code>, it will create a <code class=\"language-text\">1234</code> 16-bit code. A little endian code would look like <code class=\"language-text\">3412</code>.</p>\n<div class=\"filename\">RomBuffer.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">RomBuffer</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/**\n   * @param {binary} fileContents ROM binary\n   */</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fileContents</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>data <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token comment\">// Read the raw data buffer from the file</span>\n    <span class=\"token keyword\">const</span> buffer <span class=\"token operator\">=</span> fileContents\n\n    <span class=\"token comment\">// Create 16-bit big endian opcodes from the buffer</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> buffer<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i <span class=\"token operator\">+=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The data returned from this buffer is the \"game\".</p>\n<p>The CPU will have a <code class=\"language-text\">load()</code> method - like loading a cartridge into a console - that will take the data from this buffer and place it into memory. Both the buffer and memory act as arrays in JavaScript, so loading the memory is just a matter of looping through the buffer and placing the bytes into the memory array.</p>\n<h2 id=\"the-instruction-cycle---fetch-decode-execute\" style=\"position:relative;\"><a href=\"#the-instruction-cycle---fetch-decode-execute\" aria-label=\"the instruction cycle   fetch decode execute permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Instruction Cycle - Fetch, Decode, Execute</h2>\n<p>Now I have the instruction set and game data all ready to be interpreted. The CPU just needs to do something with it. The <a href=\"https://en.wikipedia.org/wiki/Central_processing_unit#Operation\">instruction cycle</a> consists of three steps - fetch, decode, and execute.</p>\n<ul>\n<li><strong>Fetch</strong> - Get the data stored in memory using the program counter</li>\n<li><strong>Decode</strong> - Disassemble the 16-bit opcode to get the decoded instruction and argument values</li>\n<li><strong>Execute</strong> - Perform the operation based on the decoded instruction and update the program counter</li>\n</ul>\n<p>Here's a condensed and simplified version of how load, fetch, decode, and execute work in the code. These CPU cycle methods are private and not exposed.</p>\n<p>The first step, <code class=\"language-text\">fetch</code>, will access the current opcode from memory.</p>\n<div class=\"filename\">Fetch</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Get address value from memory</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> memory<span class=\"token punctuation\">[</span><span class=\"token constant\">PC</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The next step, <code class=\"language-text\">decode</code>, will disassemble the opcode into the more understandable instruction set I created earlier.</p>\n<div class=\"filename\">Decode</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Decode instruction</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">decode</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">opcode</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">disassemble</span><span class=\"token punctuation\">(</span>opcode<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The last step, <code class=\"language-text\">execute</code>, will consist of a switch with all 36 instructions as cases, and perform the relevant operation for the one it finds, then update the program counter so the next fetch cycle finds the next opcode. Any error handling will go here as well, which will halt the CPU.</p>\n<div class=\"filename\">Execute</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Execute instruction</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">instruction</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">,</span> args <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> instruction\n\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'ADD_VX_VY'</span><span class=\"token operator\">:</span>\n      <span class=\"token comment\">// Perform the instruction operation</span>\n      registers<span class=\"token punctuation\">[</span>args<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+=</span> registers<span class=\"token punctuation\">[</span>args<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n\n      <span class=\"token comment\">// Update program counter to next instruction</span>\n      <span class=\"token constant\">PC</span> <span class=\"token operator\">=</span> <span class=\"token constant\">PC</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'SUB_VX_VY'</span><span class=\"token operator\">:</span>\n    <span class=\"token comment\">// etc...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>What I end up with is the CPU, with all the state and the instruction cycle. There are two methods exposed on the CPU - <code class=\"language-text\">load</code>, which is the equivalent of loading a cartridge into a console with the <code class=\"language-text\">romBuffer</code> as the game, and <code class=\"language-text\">step</code>, which is the three functions of the instruction cycle (fetch, decode, execute). <code class=\"language-text\">step</code> will run in an infinite loop.</p>\n<div class=\"filename\">CPU.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">CPU</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>memory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">4096</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>registers <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>stack <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint16Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ST</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DT</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token constant\">I</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SP</span> <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PC</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x200</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Load buffer into memory</span>\n  <span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">romBuffer</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">reset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    romBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">opcode<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>memory<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> opcode\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Step through each instruction</span>\n  <span class=\"token function\">step</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> opcode <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> instruction <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_decode</span><span class=\"token punctuation\">(</span>opcode<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_execute</span><span class=\"token punctuation\">(</span>instruction<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">_fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>memory<span class=\"token punctuation\">[</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PC</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">_decode</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">opcode</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">disassemble</span><span class=\"token punctuation\">(</span>opcode<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">_execute</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">instruction</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">,</span> args <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> instruction\n\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">case</span> <span class=\"token string\">'ADD_VX_VY'</span><span class=\"token operator\">:</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>registers<span class=\"token punctuation\">[</span>args<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>registers<span class=\"token punctuation\">[</span>args<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PC</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PC</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span>\n        <span class=\"token keyword\">break</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Only one aspect of the project is missing now, and a pretty important one - the ability to actually play and see the game.</p>\n<h2 id=\"creating-a-cpu-interface-for-io\" style=\"position:relative;\"><a href=\"#creating-a-cpu-interface-for-io\" aria-label=\"creating a cpu interface for io permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating a CPU Interface for I/O</h2>\n<p>So now I have this CPU that's interpreting and executing instructions and updating all its own state, but I can't do anything with it yet. In order to play a game, you have to see it and be able to interact with it.</p>\n<p>This is where <a href=\"https://en.wikipedia.org/wiki/Input/output\">input/output</a>, or I/O, comes in. I/O is the communication between the CPU and the outside world.</p>\n<ul>\n<li><strong>Input</strong> is data received by the CPU</li>\n<li><strong>Output</strong> is data sent from the CPU</li>\n</ul>\n<p>So for me, the input will be through the keyboard, and the output will be graphics onto the screen.</p>\n<p>I could just mix the I/O code in with the CPU directly, but then I would be tied to one environment. By creating a generic CPU interface to connect the I/O and the CPU, I can interface with any system.</p>\n<p>The first thing to do was look through the instructions and find any that have to do with I/O. A few examples of those instructions:</p>\n<ul>\n<li><code class=\"language-text\">CLS</code> - Clear the screen</li>\n<li><code class=\"language-text\">LD Vx, K</code> - Wait for a key press, store the value of the key in Vx.</li>\n<li><code class=\"language-text\">DRW Vx, Vy, nibble</code> - Display n-byte sprite starting at memory location I</li>\n</ul>\n<p>Based on that, we'll want the interface to have methods like:</p>\n<ul>\n<li><code class=\"language-text\">clearDisplay()</code></li>\n<li><code class=\"language-text\">waitKey()</code></li>\n<li><code class=\"language-text\">drawPixel()</code> (<code class=\"language-text\">drawSprite</code> would have been 1:1, but it ended up to be easier doing it pixel-by-pixel from the interface)</li>\n</ul>\n<p>JavaScript doesn't really have a concept of an abstract class as far as I could find, but I created one by making a class that could not itself be instantiated, with methods that can only be used from classes that extend it. Here are all the interface methods on the class:</p>\n<div class=\"filename\">CpuInterface.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Abstract CPU interface class</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">CpuInterface</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">.</span>target <span class=\"token operator\">===</span> CpuInterface<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TypeError</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Cannot instantiate abstract class'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">clearDisplay</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TypeError</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Must be implemented on the inherited class.'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">waitKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TypeError</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Must be implemented on the inherited class.'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">getKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TypeError</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Must be implemented on the inherited class.'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">drawPixel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TypeError</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Must be implemented on the inherited class.'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">enableSound</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TypeError</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Must be implemented on the inherited class.'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">disableSound</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TypeError</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Must be implemented on the inherited class.'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here's how it will work: the interface will be loaded into the CPU on initialization, and the CPU will be able to access methods on the interface.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">CPU</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Initialize the interface</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cpuInterface</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>interface <span class=\"token operator\">=</span> cpuInterface\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">_execute</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">instruction</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">,</span> args <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> instruction\n\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">case</span> <span class=\"token string\">'CLS'</span><span class=\"token operator\">:</span>\n        <span class=\"token comment\">// Use the interface while executing an instruction</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>interface<span class=\"token punctuation\">.</span><span class=\"token function\">clearDisplay</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Before setting up the interface with any real environment (web, terminal, or native) I created a mock interface for tests. It doesn't actually hook up to any I/O but it helped me to set up the state of the interface and prepare it for real data. I'll ignore the sound ones, because that was never implemented with actual speaker output, so that leaves the keyboard and screen.</p>\n<h3 id=\"screen\" style=\"position:relative;\"><a href=\"#screen\" aria-label=\"screen permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Screen</h3>\n<p>The screen has a resolution of 64 pixels wide by 32 pixels tall. So as far as the CPU and interface is concerned, its a 64x32 grid of bits that are either on or off. To set up an empty screen, I can just make a 3D array of zeroes to represent all pixels being off. A <a href=\"https://en.wikipedia.org/wiki/Framebuffer\">frame buffer</a> is a portion of memory containing a bitmapped image that will be rendered to a display.</p>\n<div class=\"filename\">MockCpuInterface.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Interface for testing</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MockCpuInterface</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">CpuInterface</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// Store the screen data in the frame buffer</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>frameBuffer <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">createFrameBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Create 3D array of zeroes</span>\n  <span class=\"token function\">createFrameBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> frameBuffer <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">32</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      frameBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> <span class=\"token number\">64</span><span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        frameBuffer<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> frameBuffer\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Update a single pixel with a value (0 or 1)</span>\n  <span class=\"token function\">drawPixel</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>frameBuffer<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">]</span> <span class=\"token operator\">^=</span> value\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>So I end up with something like this to represent the screen (when printing it as a newline-separated string):</p>\n<div class=\"gatsby-highlight\" data-language=\"terminal\"><pre class=\"language-terminal\"><code class=\"language-terminal\">0000000000000000000000000000000000000000000000000000000000000000\n0000000000000000000000000000000000000000000000000000000000000000\n0000000000000000000000000000000000000000000000000000000000000000\n...etc...</code></pre></div>\n<p>In the <code class=\"language-text\">DRW</code> function, the CPU will loop through the sprite it pulled from memory and update each pixel in the sprite (some details left out for brevity).</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">case</span> <span class=\"token string\">'DRW_VX_VY_N'</span><span class=\"token operator\">:</span>\n  <span class=\"token comment\">// The interpreter reads n bytes from memory, starting at the address stored in I</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> args<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> line <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>memory<span class=\"token punctuation\">[</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token constant\">I</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">]</span>\n      <span class=\"token comment\">// Each byte is a line of eight pixels</span>\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> position <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> position <span class=\"token operator\">&lt;</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span> position<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ...Get value, x, and y...</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>interface<span class=\"token punctuation\">.</span><span class=\"token function\">drawPixel</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">clearDisplay()</code> function is the only other method that will be used for interacting with the screen. This is all the CPU interface needs for interacting with the screen.</p>\n<h3 id=\"keys\" style=\"position:relative;\"><a href=\"#keys\" aria-label=\"keys permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Keys</h3>\n<p>For keys, I mapped the original hex keyboard to the following 4x4 grid of keys:</p>\n<div class=\"gatsby-highlight\" data-language=\"terminal\"><pre class=\"language-terminal\"><code class=\"language-terminal\">┌───┬───┬───┬───┐\n│ 1 │ 2 │ 3 │ 4 │\n│ Q │ W │ E │ R │\n│ A │ S │ D │ F │\n│ Z │ X │ C │ V │\n└───┴───┴───┴───┘</code></pre></div>\n<p>I put the keys in an array.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// prettier-ignore</span>\n<span class=\"token keyword\">const</span> keyMap <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'3'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'4'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'q'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'w'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'e'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'r'</span><span class=\"token punctuation\">,</span> \n  <span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'s'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'d'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'f'</span><span class=\"token punctuation\">,</span> \n  <span class=\"token string\">'z'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'x'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'c'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'v'</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>And create some state to store the currently pressed keys.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>keys <span class=\"token operator\">=</span> <span class=\"token number\">0</span></code></pre></div>\n<p>In the interface, <code class=\"language-text\">keys</code> is a binary number consisting of 16 digits where each index represents a key. Chip-8 just wants to know at any given time which keys are pressed out of the 16 and makes a decision based on that. A few examples below:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token number\">0b1000000000000000</span> <span class=\"token comment\">// V is pressed (keyMap[15], or index 15)</span>\n<span class=\"token number\">0b0000000000000011</span> <span class=\"token comment\">// 1 and 2 are pressed (index 0, 1)</span>\n<span class=\"token number\">0b0000000000110000</span> <span class=\"token comment\">// Q and W are pressed (index 4, 5)</span></code></pre></div>\n<p>Now if, for example, <code class=\"language-text\">V</code> is pressed (<code class=\"language-text\">keyMap[15]</code>) and the operand is <code class=\"language-text\">0xf</code> (decimal <code class=\"language-text\">15</code>), the key is pressed. Left shifting (<code class=\"language-text\">&lt;&lt;</code>) with <code class=\"language-text\">1</code> will create a binary number with a <code class=\"language-text\">1</code> followed by as many zeroes as are in the left shift.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">case</span> <span class=\"token string\">'SKP_VX'</span><span class=\"token operator\">:</span>\n  <span class=\"token comment\">// Skip next instruction if key with the value of Vx is pressed</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>interface<span class=\"token punctuation\">.</span><span class=\"token function\">getKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>registers<span class=\"token punctuation\">[</span>args<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token comment\">// Skip instruction</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Go to next instruction</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>There is one other key method, <code class=\"language-text\">waitKey</code>, where the instruction is to wait for a keypress and return the key once pressed. </p>\n<h2 id=\"cli-app---interfacing-with-the-terminal\" style=\"position:relative;\"><a href=\"#cli-app---interfacing-with-the-terminal\" aria-label=\"cli app   interfacing with the terminal permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CLI App - Interfacing with the Terminal</h2>\n<p>The first interface I made was for the terminal. This was less familiar to me than working with the DOM as I have never made any sort of graphical app in terminal, but it wasn't too difficult.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 850px;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f57d15af66cf51027de833838ebcd23d/e11df/terminalpong.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75.1%; position: relative; bottom: 0px; left: 0px; background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACHUlEQVQ4y6WSwW7TQBCGXRGa8wohSBzvrm1omiBSx3YaSJoGJWmTJrRFAiF6QhwAFU499MqNAxJS0hMS4hl4rEp+gVYU7GFmYydpG0ERK/0az8j/t7szq2m4vj/ZTX/92GE771us3+6xnad9tq7X2H2tyPr9Tbb/9jXbf/eGddfbzNYE6zY67PF2jw22ukq72wNUP60la8NZOey13dNKo3zse17gOW5Q23oYtF49CnzXDRpr9WCtXg8qD/xg86ATrNYqql7xvcD3vWOMp85K6XACzOj6kZAWCC5AmhKMjAHFjSI0PzfBtE3gBgee42AVLGh/a4N9z1a5kAKEEGBZFujImAAxGdpYlFKcSUuGxk0jdF+6Yf1DPRQ5EUopQ2GIEIFh60srRKDKqY46i4HDWeCIirjbTzxhxLMclpvL4LxwAI24kVSnN++aUD2ogpWPbyNlRJ4YOJoLREUE4DoH45YxhgkxibkbuQRG+d+B8a6ql3j9czCKVJvJ/wC0p8CLp7oEnWoMtC8AzbI5Kg1KwDNc9TAxzJ5qDgxUv9FDXmJMgPaqPSo/c8C4bZwHYq9oAEvVJcBpzwWSh7zEmAUOnRlg3OwoHlAUX+2SEqAzBk6fDb/Dj/Jenp7ILzUMeUXhv+QhLzEmwGwm+4neG+56gvrxjzohLzES3kLqeqqwmF58nkql9vB7T8WrKP5XeZFBLK1QKCgo6tp/aoFYvwF+Mj8m/sWjiwAAAABJRU5ErkJggg==&quot;); background-size: cover; display: block; opacity: 0;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"terminalpong\" title=\"terminalpong\" src=\"/static/f57d15af66cf51027de833838ebcd23d/4d3f1/terminalpong.png\" srcset=\"/static/f57d15af66cf51027de833838ebcd23d/0cb30/terminalpong.png 213w,\n/static/f57d15af66cf51027de833838ebcd23d/a67b6/terminalpong.png 425w,\n/static/f57d15af66cf51027de833838ebcd23d/4d3f1/terminalpong.png 850w,\n/static/f57d15af66cf51027de833838ebcd23d/e11df/terminalpong.png 1000w\" sizes=\"(max-width: 850px) 100vw, 850px\" style=\"opacity: 1; color: inherit; box-shadow: white 0px 0px 0px 400px inset;\">\n  </a>\n    </span></p>\n<p><a href=\"https://en.wikipedia.org/wiki/Curses_(programming_library)\">Curses</a> is a library used to create text user interfaces in the terminal. <a href=\"https://github.com/chjj/blessed\">Blessed</a> is a library wrapping curses for Node.js.</p>\n<h3 id=\"screen-1\" style=\"position:relative;\"><a href=\"#screen-1\" aria-label=\"screen 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Screen</h3>\n<p>The frame buffer that contains the bitmap of the screen data is the same for all implementations, but the way the screen interfaces with each environment will be different.</p>\n<p>With <code class=\"language-text\">blessed</code>, I just defined a screen object:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>screen <span class=\"token operator\">=</span> blessed<span class=\"token punctuation\">.</span><span class=\"token function\">screen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> smartCSR<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>And used <code class=\"language-text\">fillRegion</code> or <code class=\"language-text\">clearRegion</code> on the pixel with a full unicode block to fill it out, using the frameBuffer as the data source.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">drawPixel</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>frameBuffer<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">]</span> <span class=\"token operator\">^=</span> value\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>frameBuffer<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>screen<span class=\"token punctuation\">.</span><span class=\"token function\">fillRegion</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">,</span> <span class=\"token string\">'█'</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> x <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> y <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>screen<span class=\"token punctuation\">.</span><span class=\"token function\">clearRegion</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> x <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> y <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>screen<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"keys-1\" style=\"position:relative;\"><a href=\"#keys-1\" aria-label=\"keys 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Keys</h3>\n<p>The key handler was not too different from what I would expect with the DOM. If a key is pressed, the handler passes the key along, which I can then use to find the index and update the keys object with any new additional keys that have been pressed.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>screen<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'keypress'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">_<span class=\"token punctuation\">,</span> key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> keyIndex <span class=\"token operator\">=</span> keyMap<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span>full<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>keyIndex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_setKeys</span><span class=\"token punctuation\">(</span>keyIndex<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>The only particularly weird thing was that <code class=\"language-text\">blessed</code> didn't have a any keyup event that I could use, so I had to just simulate one by setting an interval that would periodically clear the keys.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Emulate a keyup event to clear all pressed keys</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_resetKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"entrypoint\" style=\"position:relative;\"><a href=\"#entrypoint\" aria-label=\"entrypoint permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Entrypoint</h3>\n<p>Everything is set up now - the rom buffer to convert the binary data to opcodes, the interface to connect I/O, the CPU containing state, the instruction cycle, and two exposed methods - one to load the game, and one to step through a cycle. So I create a <code class=\"language-text\">cycle</code> function which will run the CPU instructions in an infinite loop.</p>\n<div class=\"filename\">terminal.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">CPU</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../classes/CPU'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> RomBuffer <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../classes/RomBuffer'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> TerminalCpuInterface <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../classes/interfaces/TerminalCpuInterface'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Retrieve the ROM file</span>\n<span class=\"token keyword\">const</span> fileContents <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Initialize the terminal interface</span>\n<span class=\"token keyword\">const</span> cpuInterface <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TerminalCpuInterface</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Initialize the CPU with the interface</span>\n<span class=\"token keyword\">const</span> cpu <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CPU</span><span class=\"token punctuation\">(</span>cpuInterface<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Convert the binary code into opcodes</span>\n<span class=\"token keyword\">const</span> romBuffer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RomBuffer</span><span class=\"token punctuation\">(</span>fileContents<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Load the game</span>\ncpu<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>romBuffer<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">cycle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  cpu<span class=\"token punctuation\">.</span><span class=\"token function\">step</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>cycle<span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">cycle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><small><em>There is also a delay timer in the cycle function, but I removed it from the example for clarity.</em></small></p>\n<p>Now I can run a script of the terminal entrypoint file and pass a ROM as the argument to play the game.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> run play:terminal roms/PONG</code></pre></div>\n<h2 id=\"web-app---interfacing-with-the-browser\" style=\"position:relative;\"><a href=\"#web-app---interfacing-with-the-browser\" aria-label=\"web app   interfacing with the browser permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Web App - Interfacing with the Browser</h2>\n<p>The next interface I made was for the web, communicating with the browser and the DOM. I made this version of the emulator a bit more fancy, since the browser is more of my familiar environment and I can't resist the urge to make retro looking websites. This one also allows you to switch between games.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 850px;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/294421a421911249839e41881b9c3975/6ff5e/webpong.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 65.5833%; position: relative; bottom: 0px; left: 0px; background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACbUlEQVQ4y32TzW7TQBDH107bxIm/9tNrO3E+KIlJSgtEVVsORUI9cuLWQw9WL/ASiCfhxHv12IgXSCM5O4ydEIKEevh5/mvP/j3jHRNp+W3q2nfdfnJ/MjsphqNhMZlMCp3qghxaRaN1UNhOo7CbiG1t9IFdWJZVYyOEkHvkzmk22yRTaT7LRzA/fwfX1x/g6uo9XFxeweRFDrzNQDgceAtjh4OUUa0lVSBVtKPX7cHxcABMypxQzqY6TpZRpI1SqtRxXComy3g+KAe3p+WweFOOvs5rrbOkHH6Zl8nbQRlxVUaxLiOtyySJTZomS0rZlAR+MGWMPXGOlXBuhBSGu9QkN8dm+O3CjH98NKPvl7VOP+dm8vPGpJ/Ghjmh4ZTVMMqAUvoUBAEa4gWNVkIIoIwaz/fA63gQRtjmWQpeswOu5YA874G8zMBru+D5PjDFQU1TEJkyIpaArALP/2solQKn2TL4caHCajXgaOjBn3VzGsJh5u7WbuiCPsOXTGIjjzWIrloFjrdnyAW4OjCkQXabdlh72rbq2HE7EJ9moPLERHkKEg39I3drKLBlKiDIpSFN6/9G1r/rylC/wpZ7yvCQAWd8FdBwv2UJTssx+1U8R234ugeiHxmB3VVF7R/KUkoJbaddYhVr69Be46ZncV13HWV6LVJVis2ELGvDMAxnuFhXhtXo4AhBNQYcT5F38V6K9BVwLTY6U3VOVdUOnJDKIwzCGfF9/yUmPCC/kEd8sMC44JIveCwWPJELMVAbnaLuo97mbHnc7n2ovLB6cmTb9hg5QWb4f86sKhKMhNSQvVhrzKly96j2jiuv31GTBKvQRm7NAAAAAElFTkSuQmCC&quot;); background-size: cover; display: block; opacity: 0;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"webpong\" title=\"webpong\" src=\"/static/294421a421911249839e41881b9c3975/4d3f1/webpong.png\" srcset=\"/static/294421a421911249839e41881b9c3975/0cb30/webpong.png 213w,\n/static/294421a421911249839e41881b9c3975/a67b6/webpong.png 425w,\n/static/294421a421911249839e41881b9c3975/4d3f1/webpong.png 850w,\n/static/294421a421911249839e41881b9c3975/6ff5e/webpong.png 1200w\" sizes=\"(max-width: 850px) 100vw, 850px\" style=\"opacity: 1; color: inherit; box-shadow: white 0px 0px 0px 400px inset;\">\n  </a>\n    </span></p>\n<h3 id=\"screen-2\" style=\"position:relative;\"><a href=\"#screen-2\" aria-label=\"screen 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Screen</h3>\n<p>For the screen, I used the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API\">Canvas API</a>, which uses <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D\">CanvasRenderingContext2D</a> for the drawing surface. Using <code class=\"language-text\">fillRect</code> with canvas was basically the same as <code class=\"language-text\">fillRegion</code> in blessed.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>screen <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>context <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>screen<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'black'</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>screen<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>screen<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span></code></pre></div>\n<p>One slight difference I made here is I multiplied all the pixels by 10 so the screen would be more visible.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>multiplier <span class=\"token operator\">=</span> <span class=\"token number\">10</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>screen<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> <span class=\"token constant\">DISPLAY_WIDTH</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>multiplier\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>screen<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> <span class=\"token constant\">DISPLAY_HEIGHT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>multiplier</code></pre></div>\n<p>This made the <code class=\"language-text\">drawPixel</code> command more verbose, but otherwise the same concept.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">drawPixel</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>frameBuffer<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">]</span> <span class=\"token operator\">^=</span> value\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>frameBuffer<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token constant\">COLOR</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span>\n      x <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>multiplier<span class=\"token punctuation\">,</span>\n      y <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>multiplier<span class=\"token punctuation\">,</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>multiplier<span class=\"token punctuation\">,</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>multiplier\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'black'</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span>\n      x <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>multiplier<span class=\"token punctuation\">,</span>\n      y <span class=\"token operator\">*</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>multiplier<span class=\"token punctuation\">,</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>multiplier<span class=\"token punctuation\">,</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>multiplier\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"keys-2\" style=\"position:relative;\"><a href=\"#keys-2\" aria-label=\"keys 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Keys</h3>\n<p>I had access to a lot more key event handlers with the DOM, so I was able to easily handle the keyup and keydown events without any hacks.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Set keys on key down</span>\ndocument<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'keydown'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> keyIndex <span class=\"token operator\">=</span> keyMap<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>key<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>keyIndex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_setKeys</span><span class=\"token punctuation\">(</span>keyIndex<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Reset keys on keyup</span>\ndocument<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'keyup'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_resetKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"entrypoint-1\" style=\"position:relative;\"><a href=\"#entrypoint-1\" aria-label=\"entrypoint 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Entrypoint</h3>\n<p>I handled working with the modules by importing all of them and setting them to the global object, then using <a href=\"http://browserify.org/\">Browserify</a> to use them in the browser. Setting them to the global makes them available on the window so I could use the code output in a browser script. Nowadays I might use Webpack or something else for this, but it was quick and simple.</p>\n<div class=\"filename\">web.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">CPU</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../classes/CPU'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> RomBuffer <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../classes/RomBuffer'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> WebCpuInterface <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../classes/interfaces/WebCpuInterface'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> cpuInterface <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WebCpuInterface</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> cpu <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CPU</span><span class=\"token punctuation\">(</span>cpuInterface<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Set CPU and Rom Buffer to the global object, which will become window in the</span>\n<span class=\"token comment\">// browser after bundling.</span>\nglobal<span class=\"token punctuation\">.</span>cpu <span class=\"token operator\">=</span> cpu\nglobal<span class=\"token punctuation\">.</span>RomBuffer <span class=\"token operator\">=</span> RomBuffer</code></pre></div>\n<p>The web entrypoint uses the same <code class=\"language-text\">cycle</code> function as the terminal implementation, but has a function to fetch each ROM and reset the display every time a new one is selected. I'm used to working with json data and fetch, but in this case I fetched the raw <code class=\"language-text\">arrayBuffer</code> from the response.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Fetch the ROM and load the game</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">loadRom</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> rom <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./roms/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>rom<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> arrayBuffer <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">arrayBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> uint8View <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span>arrayBuffer<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> romBuffer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RomBuffer</span><span class=\"token punctuation\">(</span>uint8View<span class=\"token punctuation\">)</span>\n\n  cpu<span class=\"token punctuation\">.</span>interface<span class=\"token punctuation\">.</span><span class=\"token function\">clearDisplay</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  cpu<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>romBuffer<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Add the ability to select a game</span>\ndocument<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'select'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> loadRom<span class=\"token punctuation\">)</span></code></pre></div>\n<p>The HTML includes a <code class=\"language-text\">canvas</code> and a <code class=\"language-text\">select</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>canvas</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>canvas</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>option</span> <span class=\"token attr-name\">disabled</span> <span class=\"token attr-name\">selected</span><span class=\"token punctuation\">&gt;</span></span>Load ROM...<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>option</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>option</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>CONNECT4<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>Connect4<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>option</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>option</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>PONG<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>Pong<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>option</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">&gt;</span></span></code></pre></div>\n<p>Then I just deployed the code onto GitHub pages because it's static.</p>\n<h2 id=\"native-app---interfacing-with-the-native-platform\" style=\"position:relative;\"><a href=\"#native-app---interfacing-with-the-native-platform\" aria-label=\"native app   interfacing with the native platform permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Native App - Interfacing with the Native Platform</h2>\n<p>I also made an experimental native UI implementation. I used <a href=\"https://www.raylib.com/\">Raylib</a>, a programming library for programming simple games that had bindings for <a href=\"https://github.com/RobLoach/node-raylib\">Node.js</a>.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 850px;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/e64d5e1d044866b03b104fcfc6fde224/a34ba/connect4.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 60.3723%; position: relative; bottom: 0px; left: 0px; background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABi0lEQVQoz61SS0vDQBCeyZqa1ndvgqJotSC0COJFPHrwJKikHnqpF0FBUtGSjR6kINiLUgvqf1TI1cearJPN1qa+wOLAl5md3fnm2+wAkEkpLUKWMNYjoloL2larlM/Pjg+kW+MPvM59fn3q8xPXd7nre57nO46jwDmPQXv80vN5w4viR+5xUa1WLyBhrUgoIYQR8kUV/45JwnRX7v6DzUBsooESAV9wnAW4YAYIEKBpBIjYDYbx3hydyatzgnKS9m6TCpu6yysMYwh7aQmFvrgzflLWXueYhHkWUvymcz8QZuja9UEJ25aELH696p8JR0lhmcg2+iU0hjok2LNCjBSGUEmHsGqGsJaih8JQPZhBQIjjHJHlFaH4jvBGEwqwyDsZqVQekV9PSdgktYv6nxpa4SwpnGEyofAuSXilCZ/oGgK2LAFLpoDdtFDr/UycixoyiH2UXzGj+FkTtjp0CAX67lB3m4ptmGAlWndQNEuwbMYx07kpOnM4YFOtrWqRplfNoGHAfxnNIrwDov77mIDc46kAAAAASUVORK5CYII=&quot;); background-size: cover; display: block; opacity: 0;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"connect4\" title=\"connect4\" src=\"/static/e64d5e1d044866b03b104fcfc6fde224/4d3f1/connect4.png\" srcset=\"/static/e64d5e1d044866b03b104fcfc6fde224/0cb30/connect4.png 213w,\n/static/e64d5e1d044866b03b104fcfc6fde224/a67b6/connect4.png 425w,\n/static/e64d5e1d044866b03b104fcfc6fde224/4d3f1/connect4.png 850w,\n/static/e64d5e1d044866b03b104fcfc6fde224/bfdc0/connect4.png 1275w,\n/static/e64d5e1d044866b03b104fcfc6fde224/a34ba/connect4.png 1504w\" sizes=\"(max-width: 850px) 100vw, 850px\" style=\"opacity: 1; color: inherit; box-shadow: white 0px 0px 0px 400px inset;\">\n  </a>\n    </span></p>\n<p>I consider this version experimental just because it's really slow compared to the other ones, so it's less usable, but everything works correctly with the keys and screen. </p>\n<h3 id=\"entrypoint-2\" style=\"position:relative;\"><a href=\"#entrypoint-2\" aria-label=\"entrypoint 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Entrypoint</h3>\n<p>Raylib works a bit differently than the other implementations because Raylib itself runs in a loop, meaning I won't end up using the <code class=\"language-text\">cycle</code> function.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> r <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'raylib'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// As long as the window shouldn't close...</span>\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>r<span class=\"token punctuation\">.</span><span class=\"token function\">WindowShouldClose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Fetch, decode, execute</span>\n  cpu<span class=\"token punctuation\">.</span><span class=\"token function\">step</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  r<span class=\"token punctuation\">.</span><span class=\"token function\">BeginDrawing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// Paint screen with amy changes</span>\n  r<span class=\"token punctuation\">.</span><span class=\"token function\">EndDrawing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nr<span class=\"token punctuation\">.</span><span class=\"token function\">CloseWindow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"screen-3\" style=\"position:relative;\"><a href=\"#screen-3\" aria-label=\"screen 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Screen</h3>\n<p>Within the <code class=\"language-text\">beginDrawing()</code> and <code class=\"language-text\">endDrawing()</code> methods, the screen will update. For the Raylib implementation I accessed the interface directly from the script instead of keeping everything contained in the interface, but it works.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">r<span class=\"token punctuation\">.</span><span class=\"token function\">BeginDrawing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\ncpu<span class=\"token punctuation\">.</span>interface<span class=\"token punctuation\">.</span>frameBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">y<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  y<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span> j</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      r<span class=\"token punctuation\">.</span><span class=\"token function\">DrawRectangleRec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">,</span> height <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">.</span><span class=\"token constant\">GREEN</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      r<span class=\"token punctuation\">.</span><span class=\"token function\">DrawRectangleRec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">,</span> height <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">.</span><span class=\"token constant\">BLACK</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\nr<span class=\"token punctuation\">.</span><span class=\"token function\">EndDrawing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"keys-3\" style=\"position:relative;\"><a href=\"#keys-3\" aria-label=\"keys 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Keys</h3>\n<p>Getting the keys to work on Raylib was the last thing I worked on. It was more difficult to figure out because I had to do everything in the <code class=\"language-text\">IsKeyDown</code> method - there was a <code class=\"language-text\">GetKeyPressed</code> method, but it had side effects and caused problems. So instead of just waiting for a keypress like the other implementations, I had to loop through all keys and check if they were down, and append them to the key bitmask if so.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> keyDownIndices <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token comment\">// Run through all possible keys</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> nativeKeyMap<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> currentKey <span class=\"token operator\">=</span> nativeKeyMap<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>\n  <span class=\"token comment\">// If key is already down, add index to key down map</span>\n  <span class=\"token comment\">// This will also lift up any keys that aren't pressed</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">.</span><span class=\"token function\">IsKeyDown</span><span class=\"token punctuation\">(</span>currentKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    keyDownIndices <span class=\"token operator\">|=</span> <span class=\"token number\">1</span> <span class=\"token operator\">&lt;&lt;</span> i\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Set all pressed keys</span>\ncpu<span class=\"token punctuation\">.</span>interface<span class=\"token punctuation\">.</span><span class=\"token function\">setKeys</span><span class=\"token punctuation\">(</span>keyDownIndices<span class=\"token punctuation\">)</span></code></pre></div>\n<p>That's it for the native implementation. It was more of a challenge than the other ones, but I'm glad I did it to round out the interface and see how well it would work on drastically different platforms.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>So that's my Chip-8 project! Once again, you can <a href=\"https://github.com/taniarascia/chip8\">check out the source</a> on GitHub. I learned a lot about lower level programming concepts and how a CPU operates, and also about the capabilities of JavaScript outside of a browser app or REST API server. I still have a few things left to do in this project, like attempt to make a (very) simple game, but the emulator is complete, and I'm proud to have finished it.</p></div></article><aside class=\"note\"><div class=\"container note-container\"><div class=\"flex-author\"><div class=\"flex-avatar\"><img class=\"avatar\" src=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/4QCMRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAAMCgAwAEAAAAAQAAAMAAAAAA/8AAEQgAwADAAwERAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/bAEMACAYGCgoKCAkKCAcICAgHCAcHBwcHDQcHBwgdGh8eHRocHCAkLicgIjUjHBwgNyAsMDEtLS0fJzA9MCg8LigoKP/bAEMBCQkJDQoNDw0NDyYVEBUmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJv/dAAQAGP/aAAwDAQACEQMRAD8A87aEkjAqrkjwjAc0gK7oT2oEOiiOeeKAJphxQMhhiOTxQItrCW420h2LtvoqsVLvsz8wAXORSuVym1Z6CiySxiON18lXDyHJjQ/xD1qXIpQI7t7K1ZRAqySBcPJNHlM1STYOyM1tWDEEbQBwPLhCg1VhJmpZaoNwzJwOCJIs81nOJrGSOltLxMAyEGID5ZI2HlgfXtWE/I3gl1NRtGilQPEQzNnG/Eb/AKVl7S2jLlTT2Ob1DSnTcArBh2YEGtItMwlCxiFXV/mbjuDxW6ijF6HQac8YChiASO/ShxBTHahZRuCyEK394dKlaCkznp5DH8pBJHcDrWnMiRIJckcP15zRzILnX6VfwhAHC9OpFYSepqpLuZWvSRk7owCwPBXvTi0t2TJmGNRuFxhDx75qvcfUjnOg0nVZJl2ugVhxj1rN8qehop3P/9DkPKVexIqXdjtYquwJIVSfwqkIEtHb+EilcLFuHSnbrt9/ajmSHYkNkI+Dhj9KnmHYRbQE8D9KfMLlLcFsOOB681DkNIluLhVVtxQsjRopVc9atRbBl2yvFNpdtKFYW8XnxyLIySKfam42aBM4m4Mszs27OScj7pArVKxDZFJZzqQVk+UZyUOAMdad0wsyzbxXYZoluZEmHyrFOgwx64+nvSdhq5vaXrl1Zui3cO1eB5qqI8r6+lYTgpbbm8JuOjPSNHMcsSy20ioGIJUHfCW+nQH6Yrz56OzO+LTVzfijjmRop4AW2t8pxnHse4qoJoyqNHO6z4ctmGQVhC/vFkfls+h/xq1UcWc86atc5GSBUyoJO04Bq/rByPQkhmcZG7KnsxzWU6zJ5hJ7dGyxwD71h7aVxcxWSFV7jHpVOpKwcxegCYxkCud1Z3BSCSOPOScjPrVynOxXMSGG325wtciqVb2uK5DBLDG/GOveunmm0NOx/9HASzDA85z1zWXMXYZ9jVTkdfTGaOYLEzqUAwufrximDLFjFNIeFGO/rSYJmifD8knPIPpSvYY6PQXUhWGQe+MVm5jKGvQrZqnOHkz8o5bbW1Ncwnoc5HOCspZf4kmMe9vnxkfh1roSsZ3LV3cj7JBHGscTSNeG5eFfJRQhG0H1ODRbW4FO4gC4cLhZowTjqPWncRY0ucSusLkCUsvDAKrp0yPp1x3XNRLQuOpsXOnxxGC4O+SD7a8DyqMtpcoXOSeuO2fes1LQ05DXt7QwLF9ohjvLOSIlmbDo6d2H90+/T1xWEp320ZvCCN6w8PtaYn05/OspFLvbyvlT+PY/z7461lfndmtSm0tmdBDdwzLtb906sUUu7K9tOOiv6ezVfLykOTbM/U7h42ZJlRwzMgMpwpbuP8azaNNGrM5PU7ZVxJGrLE5I8tm3+U3pn096xcWmcVak4u/QxzKy9v8A61W4XOZ6FSe6kweTTjCJNyst5IOtU6aC45b+TPG78uKXsoiuSeZcSYxkUnyoqzLkNpcOBknB64PSueU4LZDSZej0srgtn355FYSq32DlZ//SybVcnbhuOmKz07j5i4bbaclf60uZCcircb8ghBgcHNTzxXUnmLumXTI3zJgHv6VMqkX1KUjobbXERhuxkcHI4pc6Yc6JtR1qAxswK5UZwMCjRlcx5fqmpNcSPM5+YkhBnIVa7IRsJu5kPehGyeVPEhxk+Wa0sQ2awvP9Ghsni814SN0yNzKrHPHtjGP61Leo0iOKQvbyBgQVmaSGQLmSLHBH6ikyrFWWFiBLGQk0Uof5TjLjkH88E0c3RhytanfeGdQW8tJYWIEiSxZjwCZYgeBj15I9xx2rCrFq1jopvudBbvHaQxYPm2TTIiF2HnRo33Rns3OB6g81i48zui4u2hu2UC2CM0Umy1kAaPrLAjHg5HVV4Pyj7vOO1Gm3UT1MHxAoYtfWWLe82rbyruBywGfKc9GXBJU+h4zjmovox2aMCx1t7mOSOZgTwqlz99B2P8we3Q1Mo2GpXLFvdHJBLGMMEG8BkZfcdjUSiU7NWZh6gZFmkBVQd5I2fdK1NjzasXF2I4osjLEikzIryxqCf8KauFhiOinnFNpsasXLe9TP3RxWcqbLujUj1SNFyQAfSsfq7b3GpIpy65uJCqcdMniqWGS3C5//00t444wfU+1eLKvKT0IuEk0Z7/pS55dxXIhh+i0c0urGKyFf4R+FVFskbtHUkdPxrXUaRm6rOqx7QxJc847LXRh4tyu9i0jkbiQlieuOOOhNejFAyiVaRwo7nFKTsCVzt9C0scK6gtDbr5JPO2M5yPoDXNOodkKSKax4W7gwQQRcocd8jI/StL7Mz5dyrHD87r0ysUwGeMdxTbsCRZhVoZRJGzISApZOHTnINRzaWYcrR2Gn+MYbyE2d1AnmyqIb5AQkd7GOuD/C/Qg9jzSlFp6DUrlzTfFBtpPsUtwZAVb7Fqk6K5uoT0EqjGDxgjvjscVEo9eo1buQXVx5btiPbBkxSWiS+dHbxnkKjfxIfvK3Y/Lx0GTfY2OR1iD7JOtxE7PC5UlmBRRn/wCvWsZ86s9zKa5XoTpe5ZnwsUuB9ogbICr61LiUpGlLcI8W5ldpUxtYDGYqxcb7GdeHMuZGLdX55VeB9KuMGtzz2yl57dSTzV8tibjQxY0IBxLIf/r09GO5IspI5Oadkh3I2m25o5Q5j//Uym1Af3q8lUjDmIvtyk9e9V7ILkw1RFHHP0o9lcfMRnVCapUrA2QTXxYdfyNaxgCZl30xIJOcBeueK66cbGy2MSUkL6Fm3HPpW1xFrQbbzJlYjIznms6j0NqUbs9KsIAk8BOds0DwYxxuHP8AjXHe53JWMW+tfKnhcfd8yS3lY8bFyf8A61axldGMo2Zn3EPlvG2MKJntpucbQeQau90Q1Zlx4A3OAcgHHvWXMzTlMW/01gGliJBQ5dN2G2nvWsai2ZjOHVGZLqLlVR2fzF5jkU87+gP9CPTHpWtkY8xraX4gBHlTMPKZCIcxmRYmP3gP9nvjrnmsp076o1hU6Gp5yuJLecq6N8ock5OfX19PfrWPwu5t8RlO7QO0bqzrGV2liWl8sjAwf0/KtN0Z7GvZXG9Ngwc4U5H7qTv/ACrKSszRe8rFG7gXccADJ6ZyBVpnm1VZsqFBRcxJ4ox1qJSGOmh74NTGQECRMeAp/DmteZICb7AxGSPzFR7VFWP/1eOYkelc3Ico6OTI6c+nenyopIcD7H8qOVBYmVlIp2HYbLgdMChFRRlXj5Urk4LBc1tE2KN2MgAduPrVJhY2/C0OXDY79fSsarOiitT0PyGMS7ADJGyyxc9H7/4VzI7ChrEKzwyFMt58byKOjFxwy+x6H86uLszOcTnGc3ERRsCV4GgnT+7eJzn8cLWuzuYvVFqwlDwxEg/cCZI5B9DWctGaR1QXNufmI7jIB6EVKY2jmNR089V4I+ZWWuiE7bnNOnYyQcswlkljk2nbLGqgPIOma2MNixa6tKEETNlQd0Qc857qT/L3qJQT2NI1LbmvDci5j2fu2ljGMSnYXT+7+P6Gs2raGilzF+yVk+Zw6opCB9uGf8emen4VnPU0iy9LAZvmwuVABKjANZOdkc2IhrfuVPsQzz+lLnucnKX7ayTjI/HvSk7lKJqx6NHIPT071hKTjsVyEq6THD95VHoa55VpvQdkjPvWjTIXFaQ5mSz/1sS409R8owT7c4rjVRmLRastLGOV5+maxlXSKSLD6OMH5cZ6cVCrsLGVPpxRs549q6oVOZBYqyQgAknoK1TKijDvWxg9s5rVGrKszZGO/p3zTE9Wdt4YsdioCBu4BPbNc1R3Z1U1ZHZLdwx/K00WenDDOajkNeddyncmMlnhmiO9t00CyKF3jo6+jfz70+UHM4jVmktLlpghEcrJLIhTcsb9iPXjrWkfeVjGWjLOnzqJmVCGinQXMW35gPUf1qZLqVB6my0fGc4Tbhg5rM1bsY140K5BkTPIAyCQK0jFmEpo5fUkidtyMAe/GK3hdbmE7PYySeufxx1BrUyJYLjY6uo2jK5Gc5H+FTKNxxlY6eC4WVUZGZgCRgMcD/PTNc8lbQ6U76m1pspdtmR84IKgcZFctRWVwqq6OgtNCDjczdeT7V59XFcmiOXlGzaeicAnP1xRTxDkTsSW+6LkMcd161fte4XGX91uXgjNdKgp6oDBc7upyfQ1pGFiGf/XpRREMCwz6+1efLVaBymos+FG1CSBjpXFya6iIWuJn4ETD604xjHdgZtza3TEnYcV0xrQXUlozLm3lRGLjGBzmuiFRT2LgjmL+Tt711IpkcUbSyyKv3lQMv1FD2GtzvNMje4itxiSKNkxNEh8p2b+7nsK5ZO1zritB+p2Gnx5SVhC2N3lw3VxM6/kRRCU5fChTUV1OXe3st+IryXO4/8APSF8/U/41teS3RkuV9TsNDtEliaJ7h5yP+eyguFrmnPXsdMIprUZL4djgl8xBsAYvsBwFbvj/CqUnJCcOV3M7WHWZBEsrRhDkso+Y+1OF0yJ6rc5wRWkZ/fM8hB+67KT+QwK3XM9jD3Y7kwgsJ/lj8tHYZCm3ETt9DS9+I/ckZV3pDLuZHVirEeSUO8j1B/p1960jU7kShYzPUdhWhkammXBjfEW+QMMNDjlyP5/hWc43NKcuh1cbNGY3VpNpAkWNk8uWKuWcbpo6N1Y6eHUpHQBPQZxXmyw8W9TkmmnYRvNzlj+dLkjHYhkE00g4AJ9MU1FMlmddSSdCCOa66eisCJLSyZ+WHX9KVSryisf/9DXs9G3DL/jXjTrpIbLiWkMP3tuPXtXBKrK4hj3tqhwNn1wKwk6ktguKL6Bh8qp09BWajVb3A5XxVdxCB1VfnkIVeMYr2cDCXMm3oUjze5bOD/tPXsoGanhi0eWeWUKWVURnK8+UAe/pms6ztE1ormZ6BIDbxl1U+YUwqqvG+uK93qzrcbHILol3N5slwnnu/zQbbhl8qTOckdG47V2RqRSsjllSlIqx6I8UsjSQxMHDAKS2xW7U3UVgjRZ1GiRPCschA3JKuQn8cXT/wCvXNJps6o6I1tSviVb/RbkgDhyFEf86qKCTOO1CFpflVwoIDu3XJP+cVpHToYSKb6O0pAjW2Rco7RRQiNDIOp+tae1sZui31K7aBKhQh1RlAGIxnLe/v70e0TVgVJrU1HtWMZLL8w559ayvqW0c1qdjHBtkN1GZpJjGLFYmeZVxncST07Y9a6ISujCpG2pUQFXQ992Mg7eat6kLc6ixlkaONnklcBvLAkkaQ498muWe51xOt0kjyAQpUqcHnrXDVdmY1VrctmYscYNck5HOy0sAbHHcHms3J9GAy8tY9o4H5cit6c2CRWyiKMc9uKcryA//9HSvNaIBCD29BXzsIX3YpSMx7i4mBCk1VorcnUdaaNM7Zdj+eazq1YxWiKSubMWmrGOefxrjVbmeg7HG+NCFaNR0CsSO5PSvbwOty4nCXJwv4Zr1I7iZt+A8NezQkjFxauADwGIPH86yxK0RvhnZs9Ujt/MiR8csACuPutXCdhUltSuccDOeKdmNehWOmCQgtz/AHi3WqVx/IfdWW2OKOIqu6dFZGGTJVIhmheRKkewAY2hTjmt4oUlocTHa7ZJkZsgPwvUhc03oc73L0ViAcjlfc4rORqiytqv90Z6/NUWaG0VbuAbWAGMjFXEykec642bpvbJx3ArrprQ5qjuwKbgxHVCHz7VRBr2Mn+rGBtxg5z96uaojpps6rTZTGXU/LkA7G4K1xVY3KqxurmitwOuMfzrinBnC0XItTRVyeuKz9k7gtDK1DVHc4QEc447V1Uocu4rhbsSBvPQ81NeVtgP/9LWjtIWPIB+vSvkVOVyUi5EkKYChSfpmr5m0UkPdtv3B+Xas3TctC7ELyPznj371UKCTJOA8YShpQuOQA2c9q9vBwaiWji5hlgvYLk+wr0okyNPw6/2e9s5MYAm8qTn+E/5FZ1VzRZrR0aPa1iKZZVaSKQAvGn342PUj1Ht3rgS7neQsIm+66H0+YK6/UVaQXKck6IcFwT/AHFIZ6Yx0Tb5FZh9wcAciP2+vvTihWHXg3KeMda6IilsctfKySB1XIH3uMbhTkrnOWLWZMBi4GegYfMR9axZqkW2uEI5aMkDjGHY0rA9jOuhkHOVUg53DDOP6CrRjI8w1R911Kf9oflXXT2OSb1LluM7emHVVbPpikwRc04lJNhxgZ4PqOtY1NjenudPaEgqWJYhgMEfeXpXDM6JK6sakkTcgLWDaR5842ZCtlI3ZgPTBqXoRa5P9gIUkjHfNSmwUQit8nFOoroLH//T6GK1Hc18klJAS/Z1U5zitIWKHM6jHT39a10C5Vk+bp1+tCaFc8/8YRhbjAzkxqx9q9XCv3S1scgw+aQ9cBOnpXetiXuWbRsMp4JUrJnpiomaU9z3bTJd8ED+sanNee9zuTC9jVgdyxt1J3KGJouzSNmYMyqHEaIF3H+AbAPypORdki6sywCKMwyHefmcAGMVUZ2ElcLuZcZ4HHJq1VYnE5Se+LylQhIGckdBW12zmtqPtIyhC+vTuBWU3Y0jqaQjUAnAycHpikpBJGZqMmAfoa2TOeR5denN1J/10Arrhsccty7bZOzJ/hXpUsqJd3kGF8cB8OMZJboT+nSspapo2g7HUWvIwSWUgE8cvXDM6t0dhaRRNDE+QSU5Ldc151Xm5mcNX4mWNsYHAGQOaI1NNTIrSruHA4+laJ6gU1GwjI/OrnsB/9TdlvADwQK+acGxsilmdxlTyOg9ar2YiENJ3B+gNCiIlDleoOOvWtEkUkcR4vbdMrAf8ssZ9a9HCqyLWxyA+YTH1kCj6Cu4nuU0uWVsg4AJU+4oauKMrM9z8F3nn6ZZPu3EQ+W/f514NefVVpNHo03dJmpeNgE9uee1Ytm8TNs4GLea2cscqO4FOKuNsuuo78+mauxKbRj6gpciNcjI5IHNJFboy/sioSCOe5PU1vGWhhJWFEeD1HHI55pzSaJjKxZRiysT/AcGsI72NZaox9TcBWJ44PWuiJyzPMS++4lbt5jGu3aKOJ7s0rYfc9+P1qJGkS4wDRzDvDcq3p8p/wD11kzSJv6RLkBTjITbgdzXHVWp2Q1R1VjuMYCNvVsSLzyoPauGq1F6nHXVpGjDCzDGfoK5ZTSZzF6O22j5h9Titou47GVfoPMGBxn1reK5kB//1bEI3k5P/wBevn7huWUm2Nt6jt61DlYNjRiO4A7CM98VCmIJrYkH5cVanqUec+MsxSBT18st7gV6+E1Ra2OUj/1S/wC1KST612kGY/Vh0/iBPemiT034U6sNl3p7sA0bi8gyeTG3Uf8AfXNcmJhbU7MPO+h6DdDKuPUHFcLO6JlySXJKeQIunzCbJD1UXqOyIprq5xyqj1WL5Wrbl8y4xT2Mm41GUEgRzhjlQWjQnNNRL5SjLNcHJyyHu0kmCfyrWMUYTiJBFcM6s8uEU4WMR43VM9jDqapISF+cs5Fc61Zb2OV8SXght5TnnZhR6muukrtI5KrsmcBaqcsxPPQn3rslsca3NiEcR/70g/WsmzaJfjwZbiP583FmsqtkffAFZS2TNI7s09JkOxCNoAkXcpOGD+1c1Xc6aZ2eixsrTJ8pjU7s9Gz/AIV5+IWzMcQupv26kEE8D3GK4JUpNnGS3NymMA/Wt6aaAwrl/nBA5J+XuK6IysCP/9bTtrRk7H8RXzjYbE8VoGkDMM8554GKwk2I6CNI1UdOMUmxle7uo1U9OBTpptjR4741ufOud2chhtA9hX0GFVoFPYwOkcY9GB/SusRn3MZzuAJGTkgZK1SIe5Y0bU5LC6t7yIEvA5Dx5wJYD95f8PwqJw5k0yoScJJnvNhqMN7bw3MDh4po1eNhwwU9vrXlzg4tpnqQlzJNE0KAdu/BNTEtsju4lcdMEHqPlJqlJoqMuUw5rRgSdzce4JzVqozTnK5sgvzE7m6/NzirVS5jUlzbBtx/Sq3OcqyS4BznAOanlsDkedeLNS82YQqcpES8nPBk9K7aMbK5xV53djOtE+Un+9yO1aSM4mnDwsZ75bjv1rJ9TWJPuKXNo3X5Y1xnqvI/qKiXws0W5raaGUyoMh47hmXb8wQ44P8A9auWep0Q0O00K8DzJJIxVng2SBjwWGK5KivoZV9jeubrA+U8gY46VHszkZmsGY5z+NRawrDmjAUMeSDz7Uhn/9fqpZkA4HOK+U1C5TFwcnA/KrjHmJJFmkJxzj0quVAV79GWNuc7gcZqorlaKR5d4iiK3Sqef3IcZ7Zr2sO7xuamRIMBRXUiChcEjn16DPFUiWQDBwR3Hb1oYHaeA9ea2d7dixt5WL7CcmFz1I/rXJXhf1OvDz6Hq8EwYAjBDLlSOQa4zrQ+RM5OMjrTSuUUpoBknn2Par5R3Kjx+vf0qlGxDZmXcgXnsB+dWjGTscvrWqfZ4mwcyPkRrVxjdmMpWR54zGSQkkksxJY967krI4nqzUhXCqKzZokWISNqHBxuI96hmiJ7pgrWpYhdrRjOdpJ61n0Za3Ru2MQeafaQGYQMOcdQR/MVyz2Ruja0p8TOhHIKyLjnapH+INYSatcit8Js75CcYP41PMmjiZegVgOeP5VhKaBBJGXVsHnOcdOKakhn/9DpI4g6g8n+dfMVJJEksVmMmuNVG3oNIcU2t0Fa8zHYpag5I9hnt1FdFFO+o4nmXicA3oPODbLj6Zr2sN8JoYUw4HstdaFYoXPAHQ5PFWjNlXGO2OeO1NiLVhP5UyuDgg7seorOaujSm7M9Y0DV8KgLExHB5OSjV581ZnfF3OrE4wTwQenvUrQ0TKk1wvXgU+Yozbm4HY4AzxVJkswtRu1RWdmCqMsfStEc02ed6reNK7yHjdkRqTnbHXXTics2ZduuWPsP1rZ7GK3NNvlyemxBn64zWRsiaH/VxZ7A5x64qHuUi28jxGNkOA8flyKyho5IW+8v/wBftULqWb+j8xNJ80kcSWzlUfEsQ3YGfz/nXNM2vojo9CgzczJJkpBbWyqpUEq2M9fxrlqfCkZ1XaJumSNTwAa5E2co7zMjj9B1rNvURNFCxznjI9KTnYZ//9HuUhRF7D6d6+Sk9NR2IghJ4/TmsuW2oIc9t3ahMqxl6ljYQME4xxya66E0wSPNPFKETW7AfwsjfSvZwzumWc/L1I7bce1dhLM66UE55GDkH2q0Qyqehxzg4pkj4zyrZ5Hymkyludbod6V2gn2x1BrjqxOynI7ezvmKABuOynmsDe4s923OUb/gJzUjuZN5eP8A3cVaRnKRyuq3LPkFsKOi9jXRBGE2cxdv+vArqgjmmJZrkn3IFVJkxRbujhZvcMP0AqEaMsr9xB/shePXFZvctbF11ykD9dkaOVxwRWa3Zdtje8MTxRu5dvLBijCEPwHU8E/4ep9qxktWadD0ey0uGKzWWNmc3X+kbz94JgBR+QrCa7nPVnd2MuS2YsTyP61zScV0MrGnp9ttAL9vWuV6saRoGVBxx6Umrgf/0uvAdjznFfJSsXYso4jG48HvVqKFsZeo64qgqDg0vY82wmznptSJ3Mc7R1wMmuqjhWho43XbozOcgqAp2BhgivXoUvZq3UuxiyjIz6qDXQBSmAIIyOnTpTRL1KLZG4YPHOT3qiBUGGyOhwc0MaNexmIK4OPpzWE0dEGddp17uGQfqO4rmkjeLNfztw6is7WNLmZev16flVxIkcnqLcn6n8q6YHNNnPznLZycDPOOK6YnPLUs26bVTHVwX+m7gUpFRQt0eCOu5senf/61TEbLePl47Ff5Gpe5a2NWJCYY+DlocL654rG+pqti7p9qAIVyU8yNzJK2GVWBx0+mDUSLjszu7S4kh2rOGjjnOIJC2YZFHp6H2rkrQclozCcVPZamrGq55xj0rhaexjsWfNGdoOPekojIZ4vQ479aEFj/0+zuLhF7/lXzUaFzVoyLzUyQVT5j0GOtbww7RD1MG6iYK88gZUVS7HBPFdlKl5DUTmrvXiATESrDBRBjald8aSiHN2OfedpXZmJZs4JptWHe40nKgdxGcGkMz5T8xHr+lWiCBgckjHTAB65piAdQOhHOBxQMu2v3gTwRx7VlI0izcsrjY6Hgb8r6jNYyRtFnQxXII+YZPr61k0aplS9ulAOBz69KqKIkzkNRuCWPOSfbHFdMEc82Y8gJ6nk9s1sjE0P41A/hZAAPQCpZaIpuSv1ZqSEy8MhWI/uo3rUM0RsWjkfu0USM0SrEpXJ38dKxe5tE6u3sI4/KtXixdTQQ3yE/OMB9wH5Ak/hSSvqaKSW5rXFsQAB89peERzKrbjHJn7w9D7/Ss3HqDhzO6NhISiwmRl3PGuD/AHzXDWjZtGEqb1dtC+lqGXjB4rmb5TKwGwPfJ4pjsf/U6OKAyAFzgH1ODXCqcYm1rk/2C2hUzO8YA5LOwArTl8jWNCT6HG+JPEokjltraNBHIpR5MbpXFbRglqbewt1PP5lcA7kdQTgMVKg1pGaezOKpDlZBEMP1GSQADxzRJEokzySSQCHVcD0qSijMNw3jOQeR0FUiWNZOSe5x1HQ0wIsc/TqaAJ4nIAbuPvCoaKTNWzlLOpHIRt2RzWbRombkUuB/gc5rJo1TKGoT7UZz04qorUiTOcmbO5j3yW/2RXRFWMJMqou509PMU49qvoR1LG7MwA7MR9anoV1CcYPsEz78mkgZoAfIf9yHFQ9zRG/oVi9zPtXbuVV4ZjjaTgHPasZaG8NTqlk8nVYY5WRpLaxSKNH/ANb8yOGB9htDZ6c9KUU0l5hPsZi+I2NteRO7yf6XYyWsjsPNK8bgP5/jT5SlOx1Fhqsc0kEU8kwt4LZWZILbzGmlPqfpx+FZVKNaWtONzWniqcE1Jr5s6GNonH+jXcRbGRFcK1tIfzrhlhpx+Ok4kP2FX4JW9NSreX08UgieKRGbld3KMPrR7HzMpUpR8z//1dPVtahhQ+bKsOekK5kuJB9BzXNTjOo7Qjc9OTpYZXqPU4nUPFLtlYbZQFyBJqE2SPoo4rvjldaWtSVl2PMrZvDVQRkNrGoyZIli2nqLbTs/1rT+y6cd3+Jzf2hKW0CrLbX8wOUvnVTk5iMSD9BVfVacNUxfWqs9HEU6XcR4kkgeILyS7KG/SueaitmdMG2tSFoWjBLBGVgdo7gVmWjN35J7jGNvSmAvPzEY42nmkNEbL85HqD+FAh6+p4B27vqaGNF6zlMTLnOxm2MR1X3rOSuWjXmuxDsLZ2F9mVGTmp5blc1jFv7t5XAZhiPkoPuo/wDjVqNiJSuU2+bI5AHHuatEtBGAhLEdFLY7imIjiz5q89AWJ/CkxLcfcN8xHoY1oRT3NS2UkAAMyv5YZRyZMc1mzSKOl0e3lCRXkDlvIijuZUhfbLFg8jHQkdR2NYt7nRBWOju1+3SPe2rxyXRt/JkRCNzA5OB6d+fwrCNRwdnsbOkpK6OL07TZPtNvbvHKGaSMkyjYkcYOTkdxgV1KS6HNJNbnqGnWeiRfLLqkUb5O8PeRQIW9vauunjJ01aMUebWwUazvK7N21tdFlJSLWY2Y5KoL2KR8fQ8Vr/aFTrFNehi8rgtYya+Zpf2HOi5gkhvrcHKxOPn/AA7Z+mKxl9Wr7x9nPutjWnLFYb7XtIdnv95//9bLntdHsS76lqS3Nx/FbxOzyu3+6OT+dep9YjTVqUVFfezzVhpTd6jb+Znv4502DK2ejOVB+WRhFBn8+axdeUup0KhGPQpP8RZudmmWyKc/K96zYH4LWbqPozRU49EU5vHl6+7FtYRlyMsxklaobbKSSK//AAkt9PgSy26x9AiWoDY9sk1lJGkSGedzI6l2IXcgBPGBUlmY+4sByAT6d6ZJKo+YL22tn3pXKIpTiQH0xmgRJKMbT2PJxQBbRgynuCuM+9SWXgq3ECLKCcopyGKneP8AOanZlbmLsC5UElVJG9urNVXuSODDp2B545JoACvDnoznAHoKpMlor23Lk+in602StwuOWAHLOQFA4y1JFM34eGnjVv8AVvHGWUcsw4P054rKRtA7Pw3e2ts0AkQ/Z7i3Y7ywaEMw9eoBBP0Irnmt2dENrGm2jJbR3DGSSMQIJLOW2CgTRE8A+/Tn0+tYtqW6sa83KUf7ThfcLwxoRHmY3kaxDB7lwMH601Sn0YnUg9yjLHocGXjYxmRSpeCM3VvG35cfhXRTVV7mE3BbGNqV2sE0YjkjdSgGxmxJs9cEfryeK3jqc8pWNjQ/Ft3aMv2e6kiAYHYjkwP/AMBPA/Km4oE11P/Z\" alt=\"Tania Rascia\"></div><div><h3>Author</h3><p>Hey, I’m Tania, a full stack software engineer. I write about what I know to help viewers like you. My site has <strong>no ads, sponsors, or bullshit.</strong> If you enjoy my content, please consider supporting what I do!</p><div class=\"flex\"><a href=\"https://ko-fi.com/taniarascia\" class=\"donate-button\" target=\"_blank\" rel=\"noopener noreferrer\"><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAWEAAADkCAYAAABJ9ZUIAAABG2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+Gkqr6gAAAYBpQ0NQc1JHQiBJRUM2MTk2Ni0yLjEAACiRdZHPK0RRFMc/Hhr5XSgLi0lYoUGJjcWIobAYT/m1efPmvRk1M17vjSRbZTtFiY1fC/4CtspaKSIlGxtrYoOe88zUTDL3du/53O8953TuuaCoCT3plAUgmUrb4VDQPzs37/c9o1ArswmfpjvW5PSoStHxcUeJZ2+6vFzF/f4dVVHD0aGkQnhIt+y08JjwxGra8nhbuFGPa1HhU+FOWwoUvvX0SJZfPI5l+ctjWw0Pg1Iv7I8VcKSA9bidFJaX05ZMrOi5eryXVBupmWmxrbJacAgTIoifcUYYpp8eBmXvp4teuuVEkfjAb/wUyxKry26xhs0SMeKk6RR1RbIbYk3RDZkJ1rz+/+2rY/b1ZrNXB6H8yXXf2sG3Bd8Z1/08dN3vIyh9hItUPn75AAbeRc/ktbZ9qNuAs8u8FtmB801ofrA0W/uVSmUppgmvJ1AzBw3XULmQ7VnunuN7UNflq65gdw86xL9u8QcNCme9tGiQ+AAAAAlwSFlzAAAOxAAADsQBlSsOGwAAHfBJREFUeJzt3X1sVFd6BvAn2Wi19liCCmOjthhjb1OWhdhlg0SCU3s1FBZGXVySarakAieFtCAlmHw1kRLisEgQsoSPbGET0K6xFKujBWJHGqgtRjtu7MQShNp8eKlg7DG0ko2NFktzzVb80z/u3DAYz9xzZ+7HuXOfn2Rhe87MvJnYj8+899xzH0EW/IFgNYBqAOXZ3N9kfQDuOF2EC8Qj4VDc6SKI6EGPiA70B4J1ABoA1AOYYVE9RE6bgPqHnfRFdW6/A6AvEg7pjfM03RBOhm8TgFqriyGivNUP9Y9bFECU78ruyxjC/kCwCcB79pRCRB4yDDWQ26CGsmdbitOGsD8QnAngAICN9pZDRB7VjmQoe22WnC6E2wCstbkWIiIA6ALQDDWQ836G/FAI+wPBAwC2OVALEdFUx6GGcZvThVjlgRBOHoT7nTOlEBGlNQx1dnwg32bHU0M4DmCeyB1LS4pRtfiHmFM624q6hPVdHHD0+d0iNhSHokw6XQaRGY4DaMqX3vG3IewPBBsA/EbvDpXz52HrSxtRtXihlXUROWJkdAyjt8acLkN6CUVBbHA4/e0JBdcHh3HxsqWTpHaoM+OolU9itdQQjkNnFrzSX4utL21Akc9ndV1ElCdig3H0XRpAf/LDgndkXVBnxlGzH9gOjwCAPxCsB/B5poGV8+dh354dDGAiyokWyp1nuxAbSj+bzkIXgMZIOOSqMx61EG6GzprgTw7tQWVFuQ0lEZFXjIyOof/SAHp6z+Gr3vNmPayresbfAYCKxxcdADAz3aCV/lr87Zq/sa0oIvKGoiIfvl9Rjh//9dNY6a9Faels3Pyf/821ZVEN4IWKxxd9b+jalag5lVrnkeTZcX/INGjf7h08EEdEtokNxnGy/Qx6es/lGsjDABpk7hc/orc22OcrRHvo1/ZVRESUlFAUdJztwqn20xi9NZ7LQ7VDDWPp1hg/qjegcn659VUQEU2jyOfDs2vX4LNf/xJvNG5BaUlxtg+1FkA8uQhBKrohTEQkg1UravHZr3+Jfbt34IlFWbVHZwD43B8INifbsFJgCBORq1QtXoiP9uzIZWa8EUBf8gpBjmMIE5EraTPjNxq3wOcrNHr3eQD+yx8INlpQmiEMYSJyNTWMP8a6n67O5u77nW5PMISJyPWKfD5sfWkjPjm0J5t+8UYAUaeCmCFMRHmjsqIcH+3ZgS2bNxhtUVRBXT1he5+YIUxEeefZtWvwyaEPjM6KZ0CdEdu6jI0hTER5aU7pbHy0Zwc2rH/OyN20ZWwN1lT1sEcB1GUa8P0KoT3eiYiktGH9c/jk0B6jy9l+Y1cQ686Ei4q4dSURuVtlRTk++dhwe8KWIGY7gog8ocjnw0d7dhhdymZ5EDOEichTtr60EW80bjFyF0uDmCFMRJ6zakUt9u3eYWQZm2VBzBAmIk+qWrwQHxkPYtPXETOEicizKivKjQZx1OwgZggTkacZDOIZAEzda4IhTESeZzCIqwC0mfXcDGEiIhgO4lp/INhkxvMyhImIkgwG8XvJa3TmhCFMRJSisqIcb24XXkfclmt/mCFMRDTF8mVLsWXzBpGhM5Bjf5ghTEQ0jWfXrsFKf63I0NpcLpPEECYiSmPrSxtQOV9oJ8kmfyBYns1zMISJiNIo8vnw/juvixyomwGgOZvnYAgTEWUwp3Q2tm7eKDK0NpurcjCEiYh0rFpRi6eXPSky9IDR1RKPZVcSEblNT+859F8cwPXB4Ydum1M6G3NKZ5v6fD5fIaoXL0RlRbmpj+uUN7dvwfMvvgxFmcw0bB6ARgBNoo/LECbygL37j6Az0pX29ouXrXvuyvnzsHJFLVatqEWRz71X6iny+fDm9i14b9c+vaGN/kCwORIOxUUel+0IojzXcbYrYwBbLTY0jCNHW/D8iy9j7/4jGBkdc6yWXC1ftlSkLTEDBmbCDGGiPNdx1rkATqUok+iMdOEf/8ndYbx180aR1RIbRZesMYSJyHZaGLe0nkBCUZwux5A5pbPx7No1IkObRAYxhInIMS2tJ/D8iy+jp/ec06UYsm7tatNmwwxhInKUokzivV37sGPXL1wzKy7y+UTXDjfpDWAIE5EUvuo976pZ8aoVtSgtKdYbpjsb5hI1Itqe/Ne0S/YAqAaw1uidtFnxup+uxtaXhGaajtqw/u/x4YEjesMakGFGzBAmor5IOBQ1+0GTZ441Qg0hoV1wNKe+OIPrg8PY+e5rUq8tXrWiFi2tv8XorfFMwzKevMF2BBFZIhIO3YmEQ02RcKgcwAsAHj5VL4OLlwfw2ls7pe8Tr9NfKTHDHwg2pLuRIUxElouEQ81QWxTvA5gQvV9saBjPv/gyYoNxiyrL3aoVtSIrJRrS3cAQJiJbaDNjqGHcLno/RZnEq2/vlDaIi3w+rNLf/L023QE69oStMjkJ3Lihfn71avpxZWVAYSFQXKx+5DvtdblxQ/18fFz9mEp7PQoL1ddIe53I9ZJ7KtQn36IfgHqab0aKMokdu36BTz7+QMoe8bq1a3DqizN6wxowTW+YIWyGyUk1aK9eVcMlU+jqmTsXmDdPDZ0FC9R/3Wx8HLhwQX1NhoeB27ezf6xZs4Af/EB9XZYsYSi7XCQcavYHglGo12ir0hs/emscr721E/v27JAuiOeUzsYTixbi4uWBTMMawBA2kRYuX34J3Lxp3uPevPng4xUUqMGzZIl7gmd8HOjsBL75JrfQner2baC7W/0A7r8mbnld6CGRcCievGz8AQC6a9JiQ8PYu/8Idr7zuuW1GbVqRa1eCM/zB4LVkXCoL/WbDGGjtBDIZbZrxN27athfuKB+vWQJUFOj/isbu18b7XUpKACeeQZYudIbLR2DFMlXF0TCoTsAGvyB4B0A2/TGf9V7Hi2tJ7Bh/XPWF2fA8qeexOGjhXr7DTdAXbL2LYawqO5u4PPPzZ3ZZUMLnlmz7gePk7PAyUl11vvll869NnfvqjV0dqp/oOrrGcYpYkOZV4ZZsUY4G5FwqNEfCPYB+I3e2JbWE1i+7EmpNowv8vmwfNlSvW1D66Z+g6sj9Fy4ALz2GnDsmPMBnOr2baCtTa2trU0NQztNTj74/LK8Nt3dwOuvA62t9r8mlLPkUrYXRMbKuNfE8qd09xqumrpKgiGczvg4sGcPcOiQPAEznbt3HwxDO3R3A+++qz7f3bv2PKdRnZ3qa6K1ccg1kkF8XG/c6K1xnGrXXZFgq+XLlooMe+BioAzh6Vy4oIaMXb1NM6SGsVV1a3+YZHtXkM7du+of0UOHOCt2mUg41ACBtcQtrSek2xxe4MobdalfMISnam1Vf2llneHpuX37/gzezOBpa1Pf5rvpD5NG+6Oqrdsmt2gA0K83aO9+3Q10bCUwG65L/YIhnOrYMfVtbD4wazY/Pn6/9eBmt28Du3ffX95G0tNWTeiNu3h5AP2XMi4Ns1XV4oV6Q2b4A8Fq7QuGMKDOGN99N/9+QbVZcbYBqgW5meugnXT3rvqHNt/+P+ex5Jra9/XGHf/shA3ViJlTOltkn+E67ROGMKC2IPIlaKbT1ma8PeH2tkwmDGJXSe43kXGd3cXLA1L1hqsW/1BvSJ32CUO4tdUbv5AXLqhvx6fbpyHV5KQ6e86Xtkw6DGK3adQb0NIqz2xYoCXBdgQA9Zcw38Mm1c2bmQ9QjY+rQe3Gg2/ZOHbMO/+tLhcJh9oAZDwLoqf3nDTrhgVCeF5y03sPh/D4OPDZZ05XYb+7d9WgnRrEN27kV/9X1MGD+u8OSBbNmW5UlEn0fH3eplIym1M6W2SP4WrAyyF87Fh+9jtFTA3iGzfUr734emgH60h6yZM4MvaGZbpIaOX8cr0hdYBXQ1jbWtHLtCDu7vZuAGuuXnX/EjzvaM5041e9csyEAaD6Cd2WRDmghnB5plECU2r38WIbYjraLNDLAazp6GBbwh2a9QbIMhuurNC9tmk5IBDC35dolyJTdHe745Rbspd22jdJLXlVjoxn0cUGDV1P1DJzSmbrDakFvNiO+PxzpysgWdm5FzLlIprpxr6Lcpw9J7LNpj8QnOmtEL56lbNgyoxrh90g41sWnatb2ErgzLlqb4Uwf8FIT3c3e8Py69MbIMvZc6UlJXpDPDYT/uYbpysgN/DSCTwulNzYJ2Pjd/SWHCE8p1S3L+yhmfCFC1wFQGL4x9oN4pluvD6Y8WbbCISwhw7M8YALibp9m3sPyy+a6Uadi23aRmCJb513Qvj3v3e6AnITHj9wtURCjj0kRJb4eieEvbYnAuWGf7RlF89043VJ1gqL8EYIsxVBRvGPtuziThdgknJvhDAv8kjZ4B9vypHIlpbeCGEeZKFs8OeGbOCNECbKBt9BkQ28EcJ8W0nZ4M8N2cAbIUxEJCmGMBG5UV2mG0XOVJMFQ5gonTE59h8g4xjCRPmA256SDRjCROkUFDhdAaVXl+lGN12WjSFMlM483WuEkaTcdFk2b4TwggVOV0BE5qp1ugAR/Zd0r/Ix4Y0QJqK84Q8EZ+qNEThdWBZ93gjhYt3rPBE9jD83sqrOdKPAdd2kwhAmSoc/N7Kqy3SjwHXdbCNyhQ9vhHBZmdMVkBvx50ZWGWfC1U/I04oQuMJH1BshXFjI5UZkHGfCsqrLdGNlhTyrWjgTTsXlRmQUZ8LS8QeC1QBmZBpTOb/cllpEJBK6M2GPHJgDuEyNjOHPi6waMt1YWlIs1SnLsaG43pA7DGGi6fDnRVb1mW5cvmypXXXoSiiKbk84Eg55pCcM8K0lGcMQlk6yFZGxr1gl0UG5mP7FRicAL/WECwv5i0ViCgr4syKnxkw3+nyFUs2EBc6W6wO8FMIAsGSJ0xWQG/zoR05XQFMkz5JzTSsCEFoZwRAmmhZ/TmTUCJ1VEcufetKmUsTEGMLTKC4G5s51ugqS2axZDGHJJGfBGVsRpSXFUs2ER0bHMHprXG+YB0MYAJ55xukKSGb8+ZCR7ix41Yo6eyoRJLJ7WiQc8mgI19Q4XQHJjD8fUvEHguUA3ss0xucrxLq1q+0pSJBACEe1T7wXwoWF/EWj6dXU8FRl+TTrDXh27RoU+Xw2lCKu/9IVvSFR7RPvhTDAEKbp1Wc8+E428weCjdDZvF3GWXBsMC7SD45qn3gzhBcs4DpQehBnwVJJnpixX2+cjLPgPgP9YMCrIQxwNkwP4ixYGsk+cFRvXGlJsXSzYADoPNulN6Qt9Qtvh/CsWU5XQTJYuZKzYEkkl6O1QWc1BABsfWmjdLPgkdExxIZ0T1eOpn7h3RAGgM2bna6AnFZQwFmwJJIBHAVQpTf26WVPSrUuWNMZ0Z0FA5wJp2BvmDZvVlfMkKOSPeAoBAK4tKQYb27fYnlN2eg4G9Ub0h4Jh+6kfsPbIQwAmzY5XQE5ZckSnh0nAX8gWAfBAPb5CrHzndela0MA6tpggVURbVO/wRAuLubbUS8qKOAfYAn4A8EmAL+DQA8YALZu3ojKinIrS8pah/4BuQlME8KPWVKN29TXA998A9y86XQlZJdt29iGcFByBUQzdNYBp9qyeQNWrRAebquEooj0g9umtiIAzoTv27yZFwP1ivXreSzAIf5AcGZy9jsEAwG80l+LZ9eusayuXJ1qPyMyrHm6bzKENWVlwPPPO10FWa2mRl2SRrbzB4INAOLQ2QtiqpX+WmkPxAHqLPhk+2m9YcORcCg63Q1sR6SqqQGuXgW6u52uhKywYAH7wDZLLjtrgLoTmuFLnr/RuEXaFoSm5+vzuteSA3Ag3Q0M4ak2bQLGx9Uwpvwxdy7wyitOV+EZySVnjVCvhiF00C2Vz1eIrZs3Sh/AANDS+lu9IRPIsBERQ3g6r7wC7N7NA3X5YtYs4O23eSDOQsllZgCgha/hWa+mcv48vLl9i7SrIFKdbD8tsiyteboDchqG8HQKC9Wj5+++C9y963Q1lIuCAq6E0OEPBKNTvtUHIDU0qgHMnOaupk9T1/10NTY8/5yU64CnSigKWlpPiAxN24oAGMLpFRers6fduxnEblVQoP4/LCtzuhLZTQ1T23sA6llwW1G1WJ5L1us51X5GpBd8PBIOxTMN4OqITMrK1F9iLl1zp23bGMAusGH9c/jk4w9cFcAjo2Ois+AmvQGcCevRlq4dO+Z0JWTEpk1cCyy5lf5abFj/HOaUzna6FMMOHz0uMkx3FgwwhMVoew8ziN1h0ybuFy0xN4cvAPT0nsNXvef1hk1A5wrRGoawKAaxOzCAH1I5f57IHreWKi0pxqoVdVi3drUrDrqlk1AUHP5UaBZ8INOKiFQMYSMYxHJbv54BPI03t2/Bq2/vFDmIZLqV/losf0rOvX+z0fLZCZElacPQWRGRiiFsFINYTjwdOa3KinJ8tHsHjreeQP+lAUvCuLSkGKUlJQCA6icWorRkNpY/9aSrZ71T9fSew6kvhPaIaBSdBQMM4ezU1Khn1bU9tCsdOaGmhqcj66isKMfOd15/4Hv901yQMqEoiA0+2LooLZk9bf823ffzUUJRsHf/EZGhXZFwyFAwMISzVV+vBjH3mXAWAzhr6ZaE5UvrwEw7fr5P5B3EBNR9MgzhOuFc8CCQsxjAZIPDnx7Hxcu6l7EHgCaRJWlTMYRzxSB2BgOYbNBxtku0D9wVCYeED8alYgibgUFsLwYw2SA2GBc9KSOrNoSGIWwWBrE9GMBkg4SiGFnW15BNG0LDEDYTg9haDGCyQUJR8NpbwgF83OhqiKkYwmbbtIlXb7YCA5hsoAWw4BmG/ZFwqCHX52QIW6G+noFhJgYw2cBgAE9AvWpIzhjCVmFwmIOvI9nAYAADQF0ufeBUDGErMUByw9ePbJBFAL8QCYf6zHp+hrDVGCTZ4etGNsgigLdHwqFmM2vgact24KY/xjCAyQaxwTj27j9iJICPZ3tCRiYMYbswiMUwgMkGscG40e09j5uxEmI6DGE7MYgzYwCTDTrOduHDA0I7omksC2CAIWy/mhr1unW8ivODGMBkMfWqGC3ojHQZuZulAQzwwJwzeBXnBzGAyWKxwThee2undAEMMISdwyBWMYDJYifbT+PVtw2tgACAg3YEMMAQdpbXg5gBTBYaGR3Dq2/txJGjLUYv6fRCJBwSulKyGRjCTvNqEK9fzwAmy5xsP41/fuVfRTdj10wA+Duz1wHr4YE5GZSVAfv2qQfrbt50uhrrcbc5skhsMI5/+7TFaPgC6hWS6808E04UQ1gWhYXqjDjfg5gBTBZIKApaPjshehWMqbqgBrDwFZLNxBCWSb4HMQOYTJZQFJxqP4OT7aeN9n0170fCoSaTyzKEISybfA1iBjCZrONsF1paf4vRW+PZ3H0Y6hUxouZWZRxDWEaFhcDPf66eWdfd7XQ1uWMAk0kSiqJefLP9dLbhCwDtUAPYkfbDVAxhmWmrB9waxAUF6qy+rMzpSsjlRkbH0BnpyqXtACQvyJnr5YjMxhCWnVuDmAFMJui/NICOs11Gz3SbznEAjbLMflMxhN1g0ya1RdHZ6XQlYhjAlANt1ttxNppLy0EjTe83HYawW6xfr4aa7DuwMYApCyOjY+jpPYfOs11GTy9OZwJAkxX7/5qNIewmsm+FOXcusHkzA5iExAbj6Ok9j56vz5kVvJqDUANYutbDdBjCbiNrEM+dq86ACwudroQkFRuM4/rgMPovDaCn91wuB9jSOQ41fONmP7CVGMJuVFMDFBcDBw/KsScxA5imSCgKYsnAvT4YR/+lAStCV+PK8NUwhN1qwYL7J3U4GcQMYE+LDcaRUCbRf2kAiYSC64PDiA3FrQxczQSAZgAH3Bq+Goawm2k7sDkVxEuW3F+5QdJKKAp6vj6P0VtjD3y/avHCtPcZGR17aHzfxfub4mSxQY5ZhgE0AWhzS89XD0PY7bQgPngQuH3bvuflXsCuEBuMY8euX5ix1MtpxwE0y7zULFsM4XxQVqae5mzXfhMMYNdweQB3QW055M2sdzoM4Xxh18Y/K1eqa5ZJev2XBtwYwO0AolCDN+5sKfZgCOcTq4OYG/GQ+Yahhm4UeT7jTYchnG+s2oGNAUzmmMD90I06cSUL2TCE85WZG/8wgCk7EwD6oAZuH4A+r7QYjGAI57Ncg5j7QJAYbYuzKIA7uB+4nmstZIMhnO82bVLPrmszuIUqA9j1rg/G9YYMA8g0qA9qqKaKJv+9w1aCORjCXlBfrwax6H4Ts2YB27YxgF1O4Ky1Zqevr0YMYe8Q3fiHpyET2epRpwsgG+mdZMEAJrIdZ8Jeo+3AdvTog6c5cx8IIkc8hocb7w8YGR1D1WKbqiF7LFgA7NsHXL2qfl1crH5QXkndcCeNuA1lkI7HoB4BXZtuwNSdlCiPLFjgdAXkrLjTBRB7wkR5a/TWLadLIAEMYaI8JbB5D9f5SoAhTJSHRkb124g8o00ODGGiPCRwLKffjjpIH0OYKA/1X9JdGcFZsCQYwkR5SKAdEbWhDBLAECbKQzH9zXt0B5A9GMJEeSahKIgNDesN48oISTCEifKMQD8Y3IZSHrohnEgodtRBRCbp1z9duUtvANnnUegcJb0+qPu2hogkIjATjtpQBgl6FDq9IUXhTJjILUZGx0T6wVEbSiFBujNhgf+hRCSJnt5zekMmIuFQ1IZSSNCjIg16geUuRCSBzrO67d6oDWWQAdqBuYynMPYJHG0lImcJtiIMXvGVrKaFcMbZcIwH54ikd6r9tMgwhrBkhEJYoM9ERA5KKAo6IrqtiHbunCYfLYSjmQYpyiT7wkQS6zjbJXSJextKIYMeBb49e2Yi08AO/YY/ETlEoBUxHAmH2IqQUOoZcxn/Bwm81SEiB7S0nhC5ikazDaVQFoRDWFEmORsmkkxCUXBS7IDcAatroex8G8LJtypsSRC5yOFPW0R6wcd5QE5eUzfwac40+OLlAaEdmojIev2XBtAp1iZssrgUysHUENZ9y7J3/2GLSiEiUQlFEf1dPB4Jh+IWl0M5+E7qF0PXrtypeHzRjwGUp7uD9tanavFCSwsjovR27T2Eq/99XW/YBICfDF278kcbSqIsTbefcJPenU62n+a6YSKHnGw/ja96z4sMPcBesPy+M/UbQ9euxPVmw/fu3cPvr17Dj2ufxne/+10r6yOiFD295/DhgV+JDO2PhEM/s7oeyl26K2s06N0xNjSMw5+2mFsNEaUVG4xj7/4josMbLCyFTPTQTBj4tjf8JwCWZbpzbGgYI6NjWP7UUkuKIyJVbDCOV9/eKbIcDQDej4RD/251TWSOaUMYACoeX9QL4B8AzMz0AAxiImv19J7Djl37RAO4KxIONVhcEpkobQgPXbvyx4rHF0UB/IvegzCIiaxxsv00PjzwK9y7d09k+DCAOq6GcJe0IQwAQ9eujFQ8vmgCwE/0Hig2NIyer89h6Y+qUVTkM61AIi9KKAp27T2Ez784I3qXCQA/4Zpg98kYwgAwdO1Kb8Xji+YDqNYb+4c7E+iIdKFs7p+i7M//zJQCibym/9IA3t6xW2QdsGYCQJ3IpcpIProhDADJtsRqAHP0xt67dw/R//wa1wfj+MFf/gVnxUSCRkbHcPhoC44cFdoPItWWSDj0H1bVRdZ6RHSgPxCcCXXz9yrR+/h8hXh27RqsW7saRT6GMdF0EoqCU+1ncLL9tNHwnQDQwH2C3U04hIHsghi4H8Yr/bWYUzrbyF2J8tbI6BhOtZ9GR0ToqhhTsQWRJwyFMPBtELcBqM3mCZ9e9iRWrajF8mVcSUHe1HG2Cz2950RPPZ5OP9QZMAM4DxgOYY0/EGwGsDHb+/t8hVi+bCmqFi9E1eKFnCFT3kooCnq+Po/+SwPo6T2Xzaw3VTvUAOaeEHki6xAGAH8g2AB1+8sZuRZSWlKMyopyfL+iHFWLF6LIV4jKivJcH5bIdrHBOK4PDiM2GEf/pQHEhobNeNgJAE2RcIhXyMgzOYUwAPgDwXKom8Fn1Z4gIl1dUGe/cacLIfPlHMIafyDYCHUbzJxnxUQEQJ39NkbCoWanCyHrCK0TFpE8qeNXAP4PwF8B+J5Zj03kMRMAPgDws0g41Ot0MWQt02bCqZIrKBqTH5wZE4mZgHqMhZuxe4glIaxJhnE91DA2tLaYyEP6oYZvG8PXeywN4VT+QLAa6kbT9QDm2fW8RJIahrrevpnrfb3NthBOlVxRUQ+gLvnBlgV5QRfUM07bGLykcSSEp0qGcnXKx8zkvwxncqt+AHEAfQCikXAo6mg1JK3/B3DUdh/UDJ/eAAAAAElFTkSuQmCC\" class=\"coffee-icon\" alt=\"Coffee icon\">Buy me a coffee</a><a class=\"patreon-button\" href=\"https://www.patreon.com/taniarascia\" target=\"_blank\" rel=\"noopener noreferrer\"><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAWgAAAFoCAYAAAB65WHVAAAgAElEQVR4Xu3df4xlZ33f8e/5cWd/jLFa22Bq1j8As2sXEyARxkBxwKRqcexWCTZRqxLaSiikSasoapQ0aUiTKI0iUGiiSiX5JwFaVZUJalUbGjWxcWnsULeJ7drEvwplF9sU4wDG692de855+ny+33NmxmvHyJ693OfuvF/27NyZuXNn5tyZz3nO93yf51Qn3n99MgBAceqT3wEAKAMBDQCFIqABoFAENAAUioAGgEIR0ABQKAIaAApFQANAoQhoACgUAQ0AhSKgAaBQBDQAFIqABoBCEdAAUCgCGgAKRUADQKEIaAAoFAENAIUioAGgUAQ0ABSKgAaAQhHQAFAoAhoACkVAA0ChCGgAKBQBDQCFIqABoFAENAAUioAGgEIR0ABQKAIaAApFQANAoQhoACgUAQ0AhSKgAaBQBDQAFIqABoBCEdAAUCgCGgAKRUADQKEIaAAoFAENAIUioAGgUAQ0ABSKgAaAQhHQAFAoAhoACkVAA0ChCGgAKBQBDQCFIqABoFAENAAUioAGgEIR0ABQKAIaAApFQANAoQhoACgUAQ0AhSKgAaBQBDQAFIqABoBCEdAAUCgCGgAKRUADQKEIaAAoFAENAIUioAGgUAQ0ABSKgAaAQhHQAFAoAhoACkVAA0ChCGgAKBQBDQCFIqABoFAENAAUioAGgEIR0ABQKAIaAApFQANAoQhoACgUAQ0AhSKgAaBQBDQAFIqABoBCEdAAUCgCGgAKRUADQKEIaAAoFAENAIUioAGgUAQ0ABSKgAaAQhHQAFAoAhoACkVAA0ChCGgAKBQBDQCFIqABoFAENAAUioAGgEIR0ABQKAIaAApFQK+4Kg35xWzwp1K3Bxuq8WPVeGMH9Nh6saozPf72929/u1RN/haHSt9nbCffXvnG9P1X1j3tbf+3is/RfScp+R2elbazf3xI/lgp9RaPtW175fvocauk52n6s4vvaXretkzfL3+eux2/ASuu97/3lJ9IBU+T/00eSi7NbSsoXthLquJrVEP8qjw9SMrw7Dui+P77esjbo/awS5V+nvxz9K3fo8/bqq9aG/Jd/f3jTk7br7FZ/lx9XjyOh7i+jkJ4DFUP8fzGMHT6BBuayh9Lz4O+nr/49zZ4aNdJX7/L98vPy5Dfzp+k7yl2qOP29fvH5/b1hr8Pu1d14v3X/8VDA6yEzVGYRmk5dN5114bN27k1XWunYhDWpNY6H0FXVucwSnVj//G7Zvmt2XOOLJdr3JHkQLVaoZeD2H+G/Gaft1OTd2oeotOOTaPe2JbaZP36GWYHLrTmwEU27N9v9TkvtubMsy3N9ljvRy06ZokRcN801szzI7T5jSOPmh37htnhw5aOPWnpgXs9/Kdw1/by5ymHeZVDus8fawc9Ug5s7Tt8Bxv313OJ3Y2AXnEph0/d5T/wtsvBk3zUd95njucwmv8FI8vnxwNFvyExuLTU5uDIX+fxt66Po85SbY30NUJthjZGr/l2m/LI1eb5RaEdI+bq0CEbDn23zV55qdkFF1ras26x+eLPQ0cSUSKJx9Tbecv4fTTI1qaocgDrQEP30cc3Hf6/1j/6RUv33Wv1Qw9aeuwr/vUt7xhMo3D/3rRxe3+fl0IqBXj++LafA7sPAb3imtTZvG5zyEQ5Qkn64lu/maNnZvNKh9E7EyO/PL7LrxVsXaVySm+PXXlWDhkdgu/0KyyGSg9OIVf3kdIW5Rpts3rvmTa87nJrv+uNZgcPmu1/kSlytQ1rL3koaKv8eixt6KMnHS34l1DZxD+msD55hxifX+v1OHK2frDukS9Z/eD/tnT7H1n/5S/a5t7PR+T5dj5CqfveR/l6XOxeBPSKixGg6qt6q/bD+Jd+9kQ+mp5b48Fw8mc8f34YrrDSYbhpyFjbo987y1+uzflUdoD0+fueaR/j3/vM+kMX29obvs+6t7wl/0yqRccRgraf1+/zvbTJ9GPVGuX6faYw1jYYR9RT4I4hPD3GtF+YXvvHTWWhfKSTd3D69MHPGSis84e/8aj1N/8X27j7c9Z87Rv+/DUqoXj5qC/8KAWLRkCvuKTD5GHDmjzsS4NOOtV27q3f8rprn0Okecao7vkZKtVEK5vn0Gjr2oMp5cd87K37cwiNh+ZLt/U9KDQ16lQt18sECs+1fWavv9xm73y3pXNekjdaHkFXrYdtvke+7+CPMMvbbtBZvno6EagSg+fySaPnOFrR5zQql6TxPuafGiWK8Z5V/uBQKZwjmPU4zfh1Kg9fpXSUOobbbrX+jlssPXC/l0ueUSrBrkNArzgF0SyPx1R6aBWe+S/6nP/+pDV9vt2M7V87EIGX4mRjPjyva40Ca/t/V+41nVzb6eOfGs8MaIXkbC1/j993rVXvuNpsr2rmeeQ6aMSbIzkHa10pHLeNUL1NTh8fxiG0xrnawlNQ1l7+2KITeQp0nTxVAEd55OQ6tG7rpdfOTkciGn3XCm6dpIzH8e9N37dGzw993uaf+qTZ/XdbqSUkfGcQ0CtvSoytP+RzP/vkZnA+sy76/Gx/nO1h/NUr18dbiw6Q+Pk85MZui2iZ0/cWAVv7yD5uR+DlEe6br7K1695rad/+bY9Vnoj4vLPI27arO2sHlVTytq7n1t91p9U3fNTmX3vMjwT0c22VtPL9qg1vf/Q6da1jgehSUeug7quTn5RIVhvPHopWVTPTr6mOEKLGm283EVTqI46JITFq1mSa6uCl1v7cB232nh8pPpxlrEabQtlPSnoZRB9orXnt6yz98r+y2d96V/5Z1nzEXasmXs/yz937fXTSUzso35HlbaVw1gnjma3FNsFKI6BRNHUzKHy8jJM6D2mfSNJrIkn0MPvoen3dqh98n7U/8S/MDlykz9zx0cN3Tux8vJ6t/5p8lNDnwO71U+dAvvp6m/3sh6y9+NW+U+rS1D0zeC/33GdDNn5CdM1LONpWx6xqSzg/gJ0goFG0rom+4OiwiL7gWpNPmi5Gkxo1H3hZDrA8ar7qb/qhfgwc1a990oMVKHqp9Q0n/96ndsCkcPWyxlhiOvvcvPP5BbPr/66PmDV7UR9u8xC6qXRCccive9uo+9hpaZZi4R02+PYIaBStHuY+ySTWpYg+4dRE65uXOd52rTU/9yGzs84aOyvGvuNqriHp0x6rRGrC846O8VtV+KodTycLVZPW+9X4N810rK+6xmY//WtWn/MSn43o5R5TN41q8pW36GmErZZC1vJYfTyDKFpS+6Ba0Dyg8qF7PZ4c3Lvudeb6uvda7wNFtRgq0HXaLU4kqiuifGMZQqPocSq4slrT6/2EYa31PdQXHT3bfgRx/ius/WcftOaVl/mnauSc+vHkoaLZd1TqoabEseoIaBRtc5W+SiPC/Ja6SfatW5MP95s3XuUlAk2iUYRrhqNeT4sUqaW5fHlHor7opO98mvwSNWn1T2tfNPgkFwX32MGi8F1ft/Ynf8GqN11paZj5aFo1eZ1IVD/89NhYbTyDKJpOgkVdVrPxcvj+lQttLY8ehwtebprcEaGsEacSTdO61W6mfmK1361AEdo8jr0bxXcqm1WZmFKvaeq+mFKtckgb20KTkxTnObTb9/y4Ndf8bWu77UcLUTKJZVaxyghoLJVqpprevLUw0PgyrjznB+uNQikfwr/sVXnU+PNWnfMSa/roHx4rzlGD1d3SGHj+7yr9esf3qu97Et9/9Hz7z+UFad3QScG4vybd1Ff/HWv/wY/5EYba79R6l+pOZxottqc+P1oTp5cI8M0vhUKt0m8wTkOqH/vay1oj2bSWyBhKg7o3Bk+Rps+H9i87ZPVPfsDqffsjcjQde1uY7VZTUPeXv9Wa9/64nyhUd8ssb7/ZoDCOkbTeP+vVI63avErezda64SgWAY0li/U9PDS03odmaQwxLp7WRa4ufEUeOf9zM62p4ctxKph1DxLGx9xaW0SzKa/4a7Z29Q/5djyukfK45vUsD6l1e950foJVvdSDzb1mjbIR0Fi6uGxXHMrrzN64gFwOld7sjHWr3vOjVu3da0ltc4MGz15lNnVG73ZepfD+aZV5Gquvvt7szVf60rC9V+O7HMzTVWJUo2/GHmr+9FcBzxKWausSWlpzus0DZPUAVx46dT+z5p98wJoDOiEYl5Eaal06KurLWilut/MlYLWKYaMe6HhP88M/ZnbJJX7Flsr2+ChaRyLzfjwR2agMwp/+KuBZwlLpCjB+gq/WdIscIqaZgmony6/f+z6r1a2Rqd3MSyE6mVj5pV69swF5I6hXPGkG4TSLMo+W3/cz1p79Ui9lTH/ma77maXS29Pk/atDl41ccRYhV2Xq/bJc1Oaqv+N788g4vZHgXg5871MhaUzA2bKb70oYQRxt5O2jNjri2S1Tn6337rPqRfzreq/OOF013UYfHVJNmpbvy8QxhqXSl62ghG9u+cgjP/tJZ1rzrH3pvmc5jxVVcFD6DDYNOca1t3X+XqyufvpJHz53XoWNZ2F57PKvOv8ia6/7+OPkl6s5qa/QrwTuG0KUjoLFUsYSm2usirH0NiR/+xzacscfimoBR2oheYNVSfb03i9imBi0K6ZS09KrCObbN1APevP0as4OXeoinesN0oVzxWjQj6OLxDGGpZnmw11V9TNdWYLz9r1t16K96HzQnAXeurzas+Xv/yLdvnfbEOytdAV590IygS0dAY6nUAqaihUbIzVlnW3PtD/kaGk2tsgcBslN1tWb1WS+16vuv89KHzyL0s6txXUWUjYDGUmlk5zVR1U+vuc5s737VOujVPUX8IERHKNf8gKUXv3js9Kht7uuUsH1LxzOEpVJngdq9qoOvsfaN7/AJKDppqGoHl2zaOV9v2gv4M2veeV10yeRtvNevfcgRSukIaCxZrPdcX/tuX3JTJ7tcDhVftA07FpPik9Vveps1l7zGe8hV99eVxVE2AhpL5Qvrv+rVZq+6RAVTv2hqrLERV/DGzmjn55fVGo9Ghnf+oM20ZrRWxGOmT/F4hrBUGs2111wX/c6+9Fo00XmcbC48jxfK15XympH+z0cqhy6zWpcH05ocsZVRMAIaC+choUkm4zrEIeqfa+dfZOniS2P0nD8Yrbnq41WvLofgO6azhCoXjeVmjaTrq9/99PugWAQ0Fmprtl/tJwP9gDtnhl8/TzPe3q4rcbexloRGdF7V0CfF/bAzlbZtfq1FpvTaF/1/81us2bt/c8f5bCcLY/Yhlo2AxkLFeai4YqCkOq5EvZE/0KyfadXr3uCjPJ8xqI/rUFy3VTslJHbMl9dWXV8D6bEOXdmaVVdc+ZzrQceMRCwbAY2FUrFCuVD7KE1TUqKtzq9E/drvsXrv+jiS04VT9UqJEm9HZGMntAW1/oYvqKRp9brq+dBZ86arWHJ0BfAMYaG8W2AcRfsoOb+tFi+NjpvLrjAVRz3AFdqbZY1YJAk7t1VhquKa5xpNa93tA+db/bILvJRBOaNcBDQWSrME1S2gBX20FrHCYI+6M9bOtOr1rzctgxn9BbqCtdrBxiurbFvbGC9crxOvQ4SwX/lcz0Z+5ZNXXnu5lz2YEFQuAhoLp4kSfR4RpzaHb68rp5i1r3uD6ZJVnsVe2misH6+uMtWj/aQhdqTV5B9dFEE1aD9SUSlpw69h2OaA1kncOH04dc1MJw05hCkBAY2FmuqcdR0LyueM9h7cdOhQHjArBFTuiMX3Gx89jyFtCm4mquxUHKFoG8cuz2dtpjUbhsG6Cy602dpeShwFI6CxULp0VYSuLlyqRXpUdu6tfc0V5stC+K+gglknE30oPc6riOsOYmdizezYprHbi20dJY/8nktePV5RfTpfMN03njssF38BWKgob9bjVT+SNd1g7dnn2bC+V1Fx8t3xnfaqV/sEIu1E9RxNrXdVFUvAYrkIaHxHaBU1PyHV5LA+eHAcqfHrt2zVocsszhKoGJLG6xU2XgLh+Vk+ngEslDqfVd6op980nZU6/+Vej8byVeddEKdqPYxrH0GrBKXZnWqHxHIR0FioKYinfugqj6Db814e7+MQeun8BOGBC8yjoOq8tKGdaj3MbTZevxDLQ0BjoXpVNserePgFX3tdbfoC79iglWv59JxUe14UV7VJrc8y9DVSfLU7RtDLRkBjoTRi1hxuX0k0j6Z7rUW8b91Hz+qHxnL5mhuHLvb6s99u2jiy0SXIqEEvHc8AFqrpxllsPlhurT7/3Gjp0lssGL90VVIFeo8HcqvbQ++jaR3xcNHe5eMvBAs1VHP/Y9evmtq5bN+ZPkKrxxXssFzee37w0jiiGVvs1K8e5SfiYdl4BrBQdRV1Ta91apSmdaC93EE6A98OAY3FGhfq0UhaHQInXrTf310rn5liDDwnAhoLNc0kjD5bs7XzDowf0P/0QgPPhYDGQnlrXUpR1/TlRvfFScKKNZ+Bb4eAxkIpnHWZK5U31HIXU4hPvheAZ0NAY8E0Ly2uotKlzuoTT/h7NRmCLg7guRHQWCif7OAXG9QlrSrrDh+JD8RZwq07AngGAhoLVafBel8pKfpqNflB5ei42je1jmWLySi1H+doLQ5NJvJ1oMedKpaLgMZCaVaaQtrDOfWas+YnBwefvIJl0xFO8/gjcbmx1FrKe07focYeFEvGXwkWbPAw1robOll44vBhL2/ElVZOvi++46rKNh7/qupPcSI3j5y3spk2m2UjoLFw+qNvciC3OZHrY0ejk8M0kiahly4la48fN13/UTM+9RwFTc1/2j2xBAQ0FkrX6oirReuyV6px5hH1I4ej/Y5+u6XTldNPHDkcE4nyKHruo+Yh1u9mpufSEdBYqHGs7L3PjbWx7vDXHh2neRMAS5eDeO3xR8fyRuU16DhpqLVTeH6WjYDGQvlVVKq4GKmueqdD6OrhwxHN/P0v37EnbP7nj21OINq8wjfPTREIaCyUj5iH3qd6a1Q2z4fSSScK84hNozcsV//wEV+ru66n9Z/H1QY9oDlJuGwENBYqjph1zejKZxOuWW/DQ/d4n+32ErRqoSdjFHdq6AjGj2TG7a3tOq2RYg/ea744f+pjUlHVmV+TkH1nEQhoLJQfLmuxJA/b2oYc1unoU5byyG37BVWGfEddEms6MTWFCnZGo2L1OGtbJ9+2KmXknaXqzBo133+fv2/7iHm6FiEnCZePgMaCxR+/Rmh1H6M2BYPdf7d/9GmjaF1cVt0d216wMxoVRzBvf58unKDt21v/0H1jR834MbVyjBKHMEtHQGOhNCqeDpf9ArL+zjxafvCeWG50Ovzut5Yf3T6Kxs6oE8N7m1VSGo9i5noa6hzOd92ZP37cd5iqQ+u5UijHTpNoKAHPAhZK7VsaoXWVas7jrMKcxPO777R07Kgv2u81UR1uq/d27CBQWGDnhiap6u87u5ggVNnM19rIz8vdt9tQzzY7OFIdo2cuFlsOAhoLpyneM2t9EoRG0xqtNbZhw11/6jUOhbFq0FNIi9egn+XEIZ6vwZqxVOHbd/BjmgjhO/8kPx91lJaq8YTuWIf2BZPo4lg6AhoLNZUpFLzTNGK13ikk7HO3RGnDD619LP20jgO9jVNIOz9fByW/3P0n1h9/YgziZ9Jz5F0dWCqeASzUFMw61Navm4LXJ0NUM5s/eKf13/imaTDny0ML3RunVprKFvqn9+2rk7bd7Tfb2tDkINb0e2nH17H0aJSYiIdl4xnAwnnlU9OIqzEoNGZWV0dqbbjlP421T4X3oGGz39//Jah3rPYOjdiW3qGR3+6//hVLd/4v26h1AlfBrBjYGkkrnNsc7NSil4+AxlINt33GqqeO2pA2bKi1BGny0bQP+AiIHZt2iNqiarfzI5jbPusfi3W6UTICGkuVjh+1/o9vsSbNcnjkF/VNq8nAg2WrJxcvjHfGxO7OX7oTRy39wY3WV1FuQtkIaCxVm0O5v/nGGD2b9xxYVfdWb59miBfMJwWNMwOl+sPft27jqDXV1uQUlIu/AixVnzasffzrNvzhp32cp6YPH0X7rJWtYMEL422L3o2Rt6dKSZ+50VvrdA6Ay46Vj2cIS6XJhRvqLLjpk1Yde9KvvpKs9U4Cfj13rvceZ+36Gku3fNqGJ5+w6YSgpt6jbPwFYKm6HBxN6mw4noPjP38iRnyavDLoFcfgO9WotU7Fo8e/Yv2NN/geMfqbaxtmJ98bpSGgsVSaVZiq1nRNvPmtN9nw6GHr1GlQ6/2UOE6V+b/9SN6o+aikH7zGr/5oRtDlI6CxVDFI9mut+PoQ/Uf/db4V60ZM7WGqSftr75GeTm7RIjaJboxYbyPejp5zX4U7B3F/9x02PPB58wsnaMenFplq7uukoGwENJZrXCB+WiCpf+QLNtz0CRvqaeGkZINPtojRni5CK0kTKcbbu9nWCVUlb+zwtK08pPN70/FvWvroR/KRinrMhzyArvN+sPE+xoE+8+IR0FgqRYRCpR6Stz23fZsD+t9bc+Swn9yqh85Hej56nn5bfelMzYLjEF3HHj6dWydakxajimZFdcCk/LHutz9s/fEnTVdN8UWR6ipv497LHVw1pXwENJZK1yoccghrjeJ6DA6r9lj6Nx8yO/FEDhadyRqnKo+H8pujaEaA0ZqocpAmpHjhPv6kVdqwm24wu+8er/P7Uq+DQjrlba37aDYQCV06AhpLFSO7WNR/qi13acO6rz9mQz4014lChY1fsmkcMeuSTCpvxJodu512alNdfh6ZqzW4H7rH+nwkMl1vUB9vtK0HrcihO+fAjuuQoWAENJbKSxc5OHxqdx4Rp16Nd5X5FcDv+h+Wbvi416PrrvIgVx3ESx4aFY4nxXa3aJuLhaZm0ahx5IvWfeSD1lVaCCkfcdS6VG/vk4Ji4f6o+yusUTYCGksVIzutbJcjo2/jQqY5ZdQBpmVKfRr4H99sQzv3IJpoEtx0iazdzE+u+maJbZOOfsv63/o1q44dt7Ve8dzmEfRc3eZ5O7eb4dwn1fYJ6NIR0FgqjfzSoHavOOTudGKw7yOoUzItI50+9hEbbr9N97Zp+vd0qazdTt0a044qHXvS5h/+ZWsef9zbFOdt5ZOAvOUuxRVtdPTRNVHH56K85SOgsVSqkYYI5KhFx229VpSo4jx8/Desv+PmOPnlXQqRznHiUH2/kVJTvfX0C+/pB9LPGS1zopY631bHn7Du13/J7OEveG1eO7scxeP2jUtcRe05TsxubXeUjGcJRVNEe53V9tjwO3kkfcet/nY/zjKMw3sdy8fFab19rNcFAvTx1a+BjO3fsYjUZklCNeeYZOIfP348j5x/yVsTJ1rr2TcBVhoBjaKp/U6TLJQ2GgXOf+c3zW77b/nQXb+6ar/TeDFG1QqwWhMwGl3aSdPHV//XW0cCnY4I+qktTrssJe+4A3rqmPUf/oBVR45su3xVlDJiwSmsstX/DcZpLQ7Ho8UuJlo0tvHx37TuY781jiLjStW1yiLe2rG1lnR3Gvx2q8bcqkOjrvLOqjdNfI9p8XlH9PBhm3/gRy19eRo5qxtGJ1krD/TT4eff7XgKUTS/np7WjKi1wp1myqlvOr99+x/Yid/4RbNjT1hq8seiXy9a9jTJuZpbexq0kXkfuE6i5tHzLLV53Kx2uvzz/s/P2PDrv+gjaIW3avUKZu3QvMSTt0fr65lglRHQKJoyNvkZP11tWiPoPh/KR126fuAum//qz1p9+IjfUZ0fqj1vzqg7DX67/ejBDxR04nTDmmPHrP+937X+d3/bW+qGqvMTo+rW0Op0Ku/oc/rT4GfHafErjNOZRoRaNVp1VYWORpNT2cPyiLJ7/CvW/epPWfrUDR5UKgCo5KFRtt5edTGhJLo1hkceto08au5v/v08kp7nHz/vpNJavlerDeNHG2pZ1MGEjjR6n9KNVcYziKJFu5zGzipveMXZppODXU6i2aB+3sb6m/6Dzf/lT1t6+Ev5HrXXYKdOh1UW7YZ5VHzjJ63/lZ8ye+QhHy23lcJZf776OTu/Co2ONrzA4y14g6/BgdVGQGMlKIDG+PHX6uNVX69eq3vBpzvncO5+5WfMPvExs42n/POmBZbitk6xKfGj4yNKJ1Gnjv7pIU5G6n6bjdTPTLmp9W3r9lZfsn+eX2YqPu5vjl9D9/WShd433nbayfj79Tj+aF5D7nX7wT+z7ud/woab/p0NtY4ezF/72tnTpJ2xpzkC22/5y+bjY2VVJ95//bZfN6yeKUC29rXnfvbJ6Ak2ZcXO/kq3P872mWdfvXJ9vLXsfbx+/tZr07paSF3n28Nxs/W/bO3b32n1VddY2rfXQ2xaI1lLcqqPOpYxjXr2FNTaFURAKqQVmPF5er9e+VheJyvHmY5+EtPXwhgXyd+2jYZx2/uraTtOj1WrVzttruXs7YHjjkNrZKT/c4+lT/2eDffflx/nhKmcoxGyVsHWuT//+jb39+P0RUCvvN0e0DEa1di6azSrTj9vHPqr1GE5nNeu+n5r3nZNvr2eA1Gr442h63eLn2kawUYARwD6I3j9N8JTi7/5x3zkrtG2FnXSSDXW1osSg27FjEidqFQJ3Ufk+lzfPYyfr5G6njtfqS/596FWwe6Be63+9Cetv/9P4/v3ArR6uuP788/2kXJM4S5h+2NxCOiVt7sD2kfAajMbxhOKTZQJYnk886DUlUP6M9atvuxya6/9AavOPm9zRBujXt1fKR8/owJUfJSd9LNrlBpXePHTkLWCWhNkPGrHENb9dZHW+FyNpLu6ywHf5IdNfpmpynu1/auOu4/Ydn49xjv+yIbb/6tV9/+Zv0/tgpoN6CcA/SSptnTjn5fyD9V0+jnjSjQ4fRHQK293B7R+foWZ16PVtVHp5Jimgpvf1mpumonYNWZ7ckh2CtjzXmH1O/6G2Xd/T37neoyE1fHgIR2jcH+fRtX6Tz+33siPNk2C8dKEX9lFwRt9yptlC4W5truXK5LNc0A3Y8lEo1+NyKuqs+7ww1bdcmd/lgoAAAYbSURBVJP1d95hw8bXrenXzGvrujyV9zZHLbrzK6XUvp5zV8396zc2i6+5s6cXhSOgV95uD2hRoGkhZNVwNTLVSFPjW03rUDDqROJgsxx8vWrKGtGqxFDNLB24yNYuf5PND73W2gMX5MzL99f60wp85b3uq9D22oamko8BmzT6HrdN/py4huJWAGsQHu1+CuOxpHHsqPUPfN7SnZ+z/qF7rf5zrToX29ZPCnppZJwJmGIJ1vg64/estbLzff3koY+wT9oMOO0Q0Ctvdwe0Z6SXOLTOceW9v5qwMaXXZjh6cKosnG+rPNC28dpnKo4hume/tRdebMMrD5kduNDqM8606hWHPLB1fT99ramGHfXnKG/oBJ+XhbVeRqOP5dvHvmX28GFLh79gw5ePWHXkC9Y9/GVTZVuVbt9Z1FG3VmeGf99puq2g13cfHSoe2l560YzKMby1Vp12Rvz1ntYI6JW3uwM6fv64Ista/mejVngp5cbSw1hXnu7rIdtEJ8a0/Ob0M8QoNd+nic6IqY1NJ+lmBw96uUQlhrU9Z1h//oUqnvgFWesjR0yL4vso/qmjlo58yVRMidZAiedoOoEYYRs7EyV7490iupt2LPE9xcg5PiuoDq3b8Vha3zlV0/twuiKgV95uD2jg9MVfFwAUioAGgEIR0ABQKAIaAApFQANAoQhoACgUAQ0AhSKgAaBQBDQAFIqABoBCEdAAUCgCGgAKRUADQKEIaAAoFAENAIUioAGgUAQ0ABSKgAaAQhHQAFAoAhoACkVAA0ChCGgAKBQBDQCFIqABoFAENAAUioAGgEIR0ABQKAIaAApFQANAoQhoACgUAQ0AhSKgV1xKyapkNlR6Mpv8eshvJMv/WlVV/vGdvMjgvyb57fx4uqXHrZJu8esDLFJ14v3Xx18hVlKEcG/bw7JKQw5Tva799U7UVW9DfviqaTcDW3yHwG8OsFAMgVZcrwRWWmrMnObxvvrUPa1DavJOoDFPadMvTPIv1wyxIwCwOKfuLxlL0SgkGw1xB6tsjymoc6TmEK1zUCtAd/aS6hgqp/x4GkHn9/jIuc+/OXofgMXhL2zFpRzMQ1qzNo+kqypZl8O5z//pbY1y4yl+4S+V6tmpM9Wh9fj+vrxTUEgzggYWi4BeedPItvbR7SyPateGxuY5qjXK3bGqy2Gcx+Sp3zwZaXWcjExVe/K9AZxCp+JPGEs1KC+tq+JsYOo726j7HNIzj+yTSxbP90Wj866urVGJI7/UKT/qMOQR+iyH94YBWBwCesVVqbW6T1ZVMcKtGpUlKps3XU7rNTu5ZPF8X1Tj3pNHz11+/KS6Rjphda2QzuHsrXYAFoW/sBWnGrS31A2Nv05ei658pBuj4J3RY3bW+OMp+K2aRbudhu38+gALxV8YABSKgAaAQhHQAFAoAhoACkVAA0ChCGgAKBQBDQCFIqABoFAENAAUioAGgEIR0ABQKAIaAApFQANAoQhoACgUAQ0AhSKgAaBQBDQAFIqABoBCEdAAUCgCGgAKRUADQKEIaAAoFAENAIUioAGgUAQ0ABSKgAaAQhHQAFAoAhoACkVAA0ChCGgAKBQBDQCFIqABoFAENAAUioAGgEIR0ABQKAIaAApFQANAoQhoACgUAQ0AhSKgAaBQBDQAFIqABoBCEdAAUCgCGgAKRUADQKEIaAAoFAENAIUioAGgUAQ0ABSKgAaAQhHQAFAoAhoACkVAA0ChCGgAKBQBDQCFIqABoFAENAAUioAGgEIR0ABQKAIaAApFQANAoQhoACgUAQ0AhSKgAaBQBDQAFIqABoBCEdAAUCgCGgAKRUADQKEIaAAoFAENAIUioAGgUAQ0ABSKgAaAQhHQAFAoAhoACkVAA0ChCGgAKBQBDQCFIqABoFAENAAUioAGgEIR0ABQKAIaAApFQANAoQhoACgUAQ0AhSKgAaBQBDQAFIqABoBCEdAAUCgCGgAKRUADQKEIaAAoFAENAIUioAGgUAQ0ABSKgAaAQhHQAFAoAhoACkVAA0ChCGgAKBQBDQCFIqABoFAENAAUioAGgEIR0ABQKAIaAApFQANAoQhoACgUAQ0Ahfr/uU3T+mf3ZBIAAAAASUVORK5CYII=\" height=\"50\" width=\"50\" alt=\"Patreon\"> Become a Patron</a></div></div></div></div></aside></main><footer class=\"footer container\"><div><a href=\"https://ko-fi.com/taniarascia\" target=\"_blank\" rel=\"noopener noreferrer\">Ko-Fi</a><a href=\"https://patreon.com/taniarascia\" target=\"_blank\" rel=\"noopener noreferrer\">Patreon</a><a href=\"/newsletter\">Newsletter</a><a href=\"https://www.taniarascia.com/rss.xml\" target=\"_blank\" rel=\"noopener noreferrer\">RSS</a></div><div><a href=\"https://github.com/taniarascia\" title=\"Open-source on GitHub\"><img src=\"/static/github-d160ace5798527574789e89ec034e8f7.png\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"footer-img\" alt=\"GitHub\"></a><a href=\"https://www.netlify.com/\" title=\"Hosted by Netlify\"><img src=\"/static/netlify-95e178f5b1dc1a2327595784442a866c.png\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"footer-img\" alt=\"Netlify\"></a><a href=\"https://www.gatsbyjs.org/\" title=\"Built with Gatsby\"><img src=\"/static/gatsby-b7637c262ad964cf2f70abbbfc9e1f93.png\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"footer-img\" alt=\"Gatsby\"></a></div></footer></div><div id=\"gatsby-announcer\" aria-live=\"assertive\" aria-atomic=\"true\" style=\"position: absolute; top: 0px; width: 1px; height: 1px; padding: 0px; overflow: hidden; clip: rect(0px, 0px, 0px, 0px); white-space: nowrap; border: 0px;\"></div></div><script>\n  \n  \n  if(true) {\n    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\n  }\n  if (typeof ga === \"function\") {\n    ga('create', 'UA-42068444-1', 'auto', {});\n      \n      \n      \n      \n      \n      }</script><script id=\"gatsby-script-loader\">/*<![CDATA[*/window.pagePath=\"/writing-an-emulator-in-javascript-chip8/\";/*]]>*/</script><script id=\"gatsby-chunk-mapping\">/*<![CDATA[*/window.___chunkMapping={\"app\":[\"/app-5c1fd5ef4f43d4d3f147.js\"],\"component---src-templates-page-js\":[\"/component---src-templates-page-js-82edc5383c4eefe91d2b.js\"],\"component---src-templates-post-js\":[\"/component---src-templates-post-js-5f55a8fdf39da6b23c8d.js\"],\"component---src-templates-tag-js\":[\"/component---src-templates-tag-js-a1829a793155181909bc.js\"],\"component---src-templates-category-js\":[\"/component---src-templates-category-js-7e46bef4444d7be1f3c5.js\"],\"component---src-pages-404-js\":[\"/component---src-pages-404-js-4039ed3b5f251515b961.js\"],\"component---src-pages-blog-js\":[\"/component---src-pages-blog-js-bc68cc8b306a68c4c08d.js\"],\"component---src-pages-categories-js\":[\"/component---src-pages-categories-js-80fd2a921cc8f675ddba.js\"],\"component---src-pages-index-js\":[\"/component---src-pages-index-js-275093b522f974827e39.js\"],\"component---src-pages-publications-js\":[\"/component---src-pages-publications-js-3123ed91c9f6acd7168a.js\"],\"component---src-pages-tags-js\":[\"/component---src-pages-tags-js-2b332e8dc13216cf2b52.js\"]};/*]]>*/</script><script src=\"/webpack-runtime-5b7b05e48ca06db45e88.js\" async=\"\"></script><script src=\"/app-5c1fd5ef4f43d4d3f147.js\" async=\"\"></script><script src=\"/commons-021d876ba06fcad6bf02.js\" async=\"\"></script><script src=\"/component---src-templates-post-js-5f55a8fdf39da6b23c8d.js\" async=\"\"></script><script src=\"/styles-945a5a4f8d9964885e02.js\" async=\"\"></script>","text":"Tania Rascia\nAbout\nArticles\nNewsletter\nWriting an Emulator in JavaScript (and Interfacing with Multiple UIs)\nApril 13th, 2020\n/\nShare\n/\nEdit ✏️\njavascriptnodeemulator\n\nI spent a good portion of my childhood playing emulated NES and SNES games on my computer, but I never imagined I'd write an emulator myself one day. However, my boyfriend Vanya challenged me to write a Chip-8 interpreter to learn some of the basic concepts of lower-level programming languages and how a CPU works, and the end result is a Chip-8 emulator in JavaScript that I wrote with his guidance.\n\nAlthough there are endless implementations of the Chip-8 interpreter in every programming language imaginable, this one is a bit unique. My Chip8.js code interfaces with not just one but three environments, existing as a web app, a CLI app, and a native app.\n\nYou can take a look at the web app demo and the source here:\n\nDemo\nSource code\n\nThere are plenty of guides on how to make a Chip-8 emulator, such as Mastering Chip8, How to Write an Emulator, and most importantly, Cowgod's Chip-8 Technical Reference, the primary resource used for my own emulator, and a website so old it ends in .HTM. As such, this isn't intended to be a how-to guide, but an overview of how I built the emulator, what major concepts I learned, and some JavaScript specifics for making a browser, CLI, or native app.\n\nContents\nWhat is Chip-8\nWhat Goes Into a Chip-8 Interpreter?\nDecoding Chip-8 Instructions\nReading the ROM\nThe Instruction Cycle - Fetch, Decode, Execute\n\nCreating a CPU Interface for I/O\n\nCLI App - Interfacing with the Terminal\nWeb App - Interfacing with the Browser\nNative App - Interfacing with the Native Platform\nWhat is Chip-8?\n\nI had never heard of Chip-8 before embarking on this project, so I assume most people haven't either unless they're already into emulators. Chip-8 is a very simple interpreted programming language that was developed in the 1970s for hobbyist computers. People wrote basic Chip-8 programs that mimicked popular games of the time, such as Pong, Tetris, Space Invaders, and probably other unique games lost to the annuls of time.\n\nA virtual machine that plays these games is actually a Chip-8 interpreter, not technically an emulator, as an emulator is software that emulates the hardware of a specific machine, and Chip-8 programs aren't tied to any hardware in specific. Often, Chip-8 interpreters were used on graphing calculators.\n\nNonetheless, it's close enough to being an emulator that it's usually the starting project for anyone who wants to learn how to build an emulator, since it's significantly more simple than creating an NES emulator or anything beyond that. It's also a good starting point for a lot of CPU concepts in general, like memory, stacks, and I/O, things I deal with on a daily basis in the infinitely more complex world of a JavaScript runtime.\n\nWhat Goes Into a Chip-8 Interpreter?\n\nThere was a lot of pre-learning I had to do to even get started understanding what I was working with, since I had never learned about computer science basics before. So I wrote Understanding Bits, Bytes, Bases, and Writing a Hex Dump in JavaScript which goes over much of that.\n\nTo summarize, there are two major takeaways of that article:\n\nBits and Bytes - A bit is a binary digit - 0 or 1, true or false, on or off. Eight bits is a byte, which is the basic unit of information that computers work with.\nNumber Bases - Decimal is the base number system we're most used to dealing with, but computers usually work with binary (base 2) or hexadecimal (base 16). 1111 in binary, 15 in decimal, and f in hexadecimal are all the same number.\nNibbles - Also, 4 bits is a nibble, which is cute, and I had to deal with them a bit in this project.\nPrefixes - In JavaScript, 0x is a prefix for a hex number, and 0b is a prefix for a binary number.\n\nI also wrote a CLI snake game in preparation of figuring out how to work with pixels in the terminal for this project.\n\nA CPU is the main processor of a computer that executes the instructions of a program. In this case, it consists of various bits of state, described below, and an instruction cycle with fetch, decode, and execute steps.\n\nMemory\nProgram counter\nRegisters\nIndex register\nStack\nStack pointer\nKey input\nGraphical output\nTimers\nMemory\n\nChip-8 can access up to 4 kilobytes of memory (RAM). (That's 0.002% of the storage space on a floppy disk.) The vast majority of data in the CPU is stored in memory.\n\n4kb is 4096 bytes, and JavaScript has some helpful typed arrays, like Uint8Array which is a fixed-size array of a certain element - in this case 8-bits.\n\nlet memory = new Uint8Array(4096)\n\nYou can access and use this array like a regular array, from memory[0] to memory[4095] and set each element to a value up to 255. Anything above that will fall back to that (for example, memory[0] = 300 would result in memory[0] === 255).\n\nProgram counter\n\nThe program counter stores the address of the current instruction as an 16-bit integer. Every single instruction in Chip-8 will update the program counter (PC) when it is done to go on to the next instruction, by accessing memory with PC as the index.\n\nIn the Chip-8 memory layout, 0x000 to 0x1FF in memory is reserved, so it starts at 0x200.\n\nlet PC = 0x200 // memory[PC] will access the address of  the current instruvtion\n\n*You'll notice the memory array is 8-bit and the PC is a 16-bit integer, so two program codes will be combined to make a big endian opcode.\n\nRegisters\n\nMemory is generally used for long-term storage and program data, so registers exist as a kind of \"short-term memory\" for immediate data and computations. Chip-8 has 16 8-bit registers. They're referred as V0 through VF.\n\nlet registers = new Uint8Array(16)\nIndex register\n\nThere is a special 16-bit register that accesses a specific point in memory, referred to as I. The I register exists mostly for reading and writing to memory in general, since the addressable memory is 16-bit as well.\n\nlet I = 0\nStack\n\nChip-8 has the ability to go into subroutines, and a stack for keeping track of where to return to. The stack is 16 16-bit values, meaning the program can go into 16 nested subroutines before experiencing a \"stack overflow\".\n\nlet stack = new Uint16Array(16)\nStack pointer\n\nThe stack pointer (SP) is an 8-bit integer that points to a location in the stack. It only needs to be 8-bit even though the stack is 16-bit because it's only referencing the index of the stack, so only needs to be 0 thorough 15.\n\nlet SP = -1\n\n// stack[SP] will access the current return address in the stack\nTimers\n\nChip-8 is capable of a glorious single beep as far as sound goes. To be honest, I didn't bother implementing an actual output for the \"music\", though the CPU itself is all set up to interface properly with it. There are two timers, both 8-bit registers - a sound timer (ST) for deciding when to beep and a delay timer (DT) for timing some events throughout the game. They count down at 60 Hz.\n\nlet DT = 0\nlet ST = 0\nKey input\n\nChip-8 was set up to interface with the amazing hex keyboard. It looked like this:\n\n┌───┬───┬───┬───┐\n│ 1 │ 2 │ 3 │ C │\n│ 4 │ 5 │ 6 │ D │\n│ 7 │ 8 │ 9 │ E │\n│ A │ 0 │ B │ F │\n└───┴───┴───┴───┘\n\nIn practice, only a few of the keys seem to be used, and you can map them to whatever 4x4 grid you want, but they're pretty inconsistent between games.\n\nGraphical output\n\nChip-8 uses a monochromatic 64x32 resolution display. Each pixel is either on or off.\n\nSprites that can be saved in memory are 8x15 - eight pixels wide by fifteen pixels high. Chip-8 also comes with a font set, but it only contains the characters in the hex keyboard, so not overall the most useful font set.\n\nCPU\n\nPut it all together, and you get the CPU state.\n\nCPU\nclass CPU {\n  constructor() {\n    this.memory = new Uint8Array(4096)\n    this.registers = new Uint8Array(16)\n    this.stack = new Uint16Array(16)\n    this.ST = 0\n    this.DT = 0\n    this.I = 0\n    this.SP = -1\n    this.PC = 0x200\n  }\n}\nDecoding Chip-8 Instructions\n\nChip-8 has 36 instructions. All the instructions are listed here. All instructions are 2 bytes (16-bits) long. Each instruction is encoded by an opcode (operation code) and operand, the data being operated on.\n\nAn example of an instruction could be like this operation on two variables:\n\nx = 1\ny = 2\n\nADD x, y\n\nIn which ADD is the opcode and x, y are the operands. This type of language is known as an assembly language. This instruction would map to:\n\nx = x + y\n\nWith this instruction set I'll have to store this data in 16-bits, so every instrution ends up being a number from 0x0000 to 0xffff. Each digit position in these sets is a nibble (4-bit).\n\nSo how can I get from nnnn to something like ADD x, y, that is a little more understandable? Well, I'll start by looking at one of the instructions from Chip-8, which is basically the same as the above example:\n\nInstruction\tDescription\n8xy4\tADD Vx, Vy\n\nSo what are we dealing with here? There's one keyword, ADD, and two arguments, Vx and Vy, which we've established above are registers.\n\nThere are several opcode mnemonics (which are like keywords), such as:\n\nADD (add)\nSUB (subtract)\nJP (jump)\nSKP (skip)\nRET (return)\nLD (load)\n\nAnd there are several type of operand values, such as:\n\nAddress (I)\nRegister (Vx, Vy)\nConstant (N or NN for nibble or byte)\n\nThe next step is to find a way to interpret the 16-bit opcode as these more understandable instructions.\n\nBit Masking\n\nEach instruction contains a pattern that will always be the same, and variables that can change. For 8xy4, the pattern is 8__4. The two nibbles in the middle are the variables. By creating a bitmask for that pattern, I can determine the instruction.\n\nTo mask, you use the bitwise AND (&) with a mask and match it to a pattern. So if the instruction 8124 came up, you would want to make sure the nibble in position 1 and 4 are on (passed through) and the nibble in position 2 and 3 are off (masked out). The mask then becomes f00f.\n\nconst opcode = 0x8124\nconst mask = 0xf00f\nconst pattern = 0x8004\n\nconst isMatch = (opcode & mask) === pattern // true\n  8124\n& f00f\n  ====\n  8004\n\nSimilarly, 0f00 and 00f0 will mask the variables, and right-shifting (>>) them will access the correct nibble.\n\nconst x = (0x8124 & 0x0f00) >> 8 // 1\n\n// (0x8124 & 0x0f00) is 100000000 in binary\n// right shifting by 8 (>> 8) will remove 8 zeroes from the right\n// This leaves us with 1\n\nconst y = (0x8124 & 0x00f0) >> 4 // 2\n// (0x8124 & 0x00f0) is 100000 in binary\n// right shifting by 4 (>> 4) will remove 4 zeroes from the right\n// This leaves us with 10, the binary equivalent of 2\n\nSo for each of the 36 instructions, I made an object with a unique identifier, mask, pattern, and arguments.\n\nconst instruction = {\n  id: 'ADD_VX_VY',\n  name: 'ADD',\n  mask: 0xf00f,\n  pattern: 0x8004,\n  arguments: [\n    { mask: 0x0f00, shift: 8, type: 'R' },\n    { mask: 0x00f0, shift: 4, type: 'R' }\n  ]\n}\n\nNow that I have these objects, each opcode can be disassembled into a unique identifier, and the values of the arguments can be determined. I made an INSTRUCTION_SET array containing all these instructions and a disassembler. I also wrote tests for every one to ensure they all worked correctly.\n\nDisassembler\nfunction disassemble(opcode) {\n  // Find the instruction from the opcode\n  const instruction = INSTRUCTION_SET.find(\n    instruction => (opcode & instruction.mask) === instruction.pattern\n  )\n  // Find the argument(s)\n  const args = instruction.arguments.map(arg => (opcode & arg.mask) >> arg.shift)\n\n  // Return an object containing the instruction data and arguments\n  return { instruction, args }\n}\nReading the ROM\n\nSince we're considering this project an emulator, each Chip-8 program file can be considered a ROM. The ROM is just binary data, and we're writing the program to interpret it. We can imagine the Chip8 CPU to be a virtual console, and a Chip-8 ROM to be a virtual game cartridge.\n\nThe ROM buffer will take the raw binary file and translate it into 16-bit big endian words (a word is a unit of data consisting of a set amount of bits). This is where that hex dump article comes in handy. I'm collecting the binary data and converting it into blocks that I can use, in this case the 16-bit opcodes. Big endian means that the most significant byte will be first in the buffer, so when it encounters the two bytes 12 34, it will create a 1234 16-bit code. A little endian code would look like 3412.\n\nRomBuffer.js\nclass RomBuffer {\n  /**\n   * @param {binary} fileContents ROM binary\n   */\n  constructor(fileContents) {\n    this.data = []\n\n    // Read the raw data buffer from the file\n    const buffer = fileContents\n\n    // Create 16-bit big endian opcodes from the buffer\n    for (let i = 0; i < buffer.length; i += 2) {\n      this.data.push((buffer[i] << 8) | (buffer[i + 1] << 0))\n    }\n  }\n}\n\nThe data returned from this buffer is the \"game\".\n\nThe CPU will have a load() method - like loading a cartridge into a console - that will take the data from this buffer and place it into memory. Both the buffer and memory act as arrays in JavaScript, so loading the memory is just a matter of looping through the buffer and placing the bytes into the memory array.\n\nThe Instruction Cycle - Fetch, Decode, Execute\n\nNow I have the instruction set and game data all ready to be interpreted. The CPU just needs to do something with it. The instruction cycle consists of three steps - fetch, decode, and execute.\n\nFetch - Get the data stored in memory using the program counter\nDecode - Disassemble the 16-bit opcode to get the decoded instruction and argument values\nExecute - Perform the operation based on the decoded instruction and update the program counter\n\nHere's a condensed and simplified version of how load, fetch, decode, and execute work in the code. These CPU cycle methods are private and not exposed.\n\nThe first step, fetch, will access the current opcode from memory.\n\nFetch\n// Get address value from memory\nfunction fetch() {\n  return memory[PC]\n}\n\nThe next step, decode, will disassemble the opcode into the more understandable instruction set I created earlier.\n\nDecode\n// Decode instruction\nfunction decode(opcode) {\n  return disassemble(opcode)\n}\n\nThe last step, execute, will consist of a switch with all 36 instructions as cases, and perform the relevant operation for the one it finds, then update the program counter so the next fetch cycle finds the next opcode. Any error handling will go here as well, which will halt the CPU.\n\nExecute\n// Execute instruction\nfunction execute(instruction) {\n  const { id, args } = instruction\n\n  switch (id) {\n    case 'ADD_VX_VY':\n      // Perform the instruction operation\n      registers[args[0]] += registers[args[1]]\n\n      // Update program counter to next instruction\n      PC = PC + 2\n      break\n    case 'SUB_VX_VY':\n    // etc...\n  }\n}\n\nWhat I end up with is the CPU, with all the state and the instruction cycle. There are two methods exposed on the CPU - load, which is the equivalent of loading a cartridge into a console with the romBuffer as the game, and step, which is the three functions of the instruction cycle (fetch, decode, execute). step will run in an infinite loop.\n\nCPU.js\nclass CPU {\n  constructor() {\n    this.memory = new Uint8Array(4096)\n    this.registers = new Uint8Array(16)\n    this.stack = new Uint16Array(16)\n    this.ST = 0\n    this.DT = 0\n    this.I = 0\n    this.SP = -1\n    this.PC = 0x200\n  }\n\n  // Load buffer into memory\n  load(romBuffer) {\n    this.reset()\n\n    romBuffer.forEach((opcode, i) => {\n      this.memory[i] = opcode\n    })\n  }\n\n  // Step through each instruction\n  step() {\n    const opcode = this._fetch()\n    const instruction = this._decode(opcode)\n\n    this._execute(instruction)\n  }\n\n  _fetch() {\n    return this.memory[this.PC]\n  }\n\n  _decode(opcode) {\n    return disassemble(opcode)\n  }\n\n  _execute(instruction) {\n    const { id, args } = instruction\n\n    switch (id) {\n      case 'ADD_VX_VY':\n        this.registers[args[0]] += this.registers[args[1]]\n        this.PC = this.PC + 2\n        break\n    }\n  }\n}\n\nOnly one aspect of the project is missing now, and a pretty important one - the ability to actually play and see the game.\n\nCreating a CPU Interface for I/O\n\nSo now I have this CPU that's interpreting and executing instructions and updating all its own state, but I can't do anything with it yet. In order to play a game, you have to see it and be able to interact with it.\n\nThis is where input/output, or I/O, comes in. I/O is the communication between the CPU and the outside world.\n\nInput is data received by the CPU\nOutput is data sent from the CPU\n\nSo for me, the input will be through the keyboard, and the output will be graphics onto the screen.\n\nI could just mix the I/O code in with the CPU directly, but then I would be tied to one environment. By creating a generic CPU interface to connect the I/O and the CPU, I can interface with any system.\n\nThe first thing to do was look through the instructions and find any that have to do with I/O. A few examples of those instructions:\n\nCLS - Clear the screen\nLD Vx, K - Wait for a key press, store the value of the key in Vx.\nDRW Vx, Vy, nibble - Display n-byte sprite starting at memory location I\n\nBased on that, we'll want the interface to have methods like:\n\nclearDisplay()\nwaitKey()\ndrawPixel() (drawSprite would have been 1:1, but it ended up to be easier doing it pixel-by-pixel from the interface)\n\nJavaScript doesn't really have a concept of an abstract class as far as I could find, but I created one by making a class that could not itself be instantiated, with methods that can only be used from classes that extend it. Here are all the interface methods on the class:\n\nCpuInterface.js\n// Abstract CPU interface class\nclass CpuInterface {\n  constructor() {\n    if (new.target === CpuInterface) {\n      throw new TypeError('Cannot instantiate abstract class')\n    }\n  }\n\n  clearDisplay() {\n    throw new TypeError('Must be implemented on the inherited class.')\n  }\n\n  waitKey() {\n    throw new TypeError('Must be implemented on the inherited class.')\n  }\n\n  getKeys() {\n    throw new TypeError('Must be implemented on the inherited class.')\n  }\n\n  drawPixel() {\n    throw new TypeError('Must be implemented on the inherited class.')\n  }\n\n  enableSound() {\n    throw new TypeError('Must be implemented on the inherited class.')\n  }\n\n  disableSound() {\n    throw new TypeError('Must be implemented on the inherited class.')\n  }\n}\n\nHere's how it will work: the interface will be loaded into the CPU on initialization, and the CPU will be able to access methods on the interface.\n\nclass CPU {\n  // Initialize the interface\n  constructor(cpuInterface) {\n    this.interface = cpuInterface\n  }\n\n  _execute(instruction) {\n    const { id, args } = instruction\n\n    switch (id) {\n      case 'CLS':\n        // Use the interface while executing an instruction\n        this.interface.clearDisplay()\n  }\n}\n\nBefore setting up the interface with any real environment (web, terminal, or native) I created a mock interface for tests. It doesn't actually hook up to any I/O but it helped me to set up the state of the interface and prepare it for real data. I'll ignore the sound ones, because that was never implemented with actual speaker output, so that leaves the keyboard and screen.\n\nScreen\n\nThe screen has a resolution of 64 pixels wide by 32 pixels tall. So as far as the CPU and interface is concerned, its a 64x32 grid of bits that are either on or off. To set up an empty screen, I can just make a 3D array of zeroes to represent all pixels being off. A frame buffer is a portion of memory containing a bitmapped image that will be rendered to a display.\n\nMockCpuInterface.js\n// Interface for testing\nclass MockCpuInterface extends CpuInterface {\n  constructor() {\n    super()\n\n    // Store the screen data in the frame buffer\n    this.frameBuffer = this.createFrameBuffer()\n  }\n\n  // Create 3D array of zeroes\n  createFrameBuffer() {\n    let frameBuffer = []\n\n    for (let i = 0; i < 32; i++) {\n      frameBuffer.push([])\n      for (let j = 0; j < 64; j++) {\n        frameBuffer[i].push(0)\n      }\n    }\n\n    return frameBuffer\n  }\n\n  // Update a single pixel with a value (0 or 1)\n  drawPixel(x, y, value) {\n    this.frameBuffer[y][x] ^= value\n  }\n}\n\nSo I end up with something like this to represent the screen (when printing it as a newline-separated string):\n\n0000000000000000000000000000000000000000000000000000000000000000\n0000000000000000000000000000000000000000000000000000000000000000\n0000000000000000000000000000000000000000000000000000000000000000\n...etc...\n\nIn the DRW function, the CPU will loop through the sprite it pulled from memory and update each pixel in the sprite (some details left out for brevity).\n\ncase 'DRW_VX_VY_N':\n  // The interpreter reads n bytes from memory, starting at the address stored in I\n  for (let i = 0; i < args[2]; i++) {\n    let line = this.memory[this.I + i]\n      // Each byte is a line of eight pixels\n      for (let position = 0; position < 8; position++) {\n        // ...Get value, x, and y...\n        this.interface.drawPixel(x, y, value)\n      }\n    }\n\nThe clearDisplay() function is the only other method that will be used for interacting with the screen. This is all the CPU interface needs for interacting with the screen.\n\nKeys\n\nFor keys, I mapped the original hex keyboard to the following 4x4 grid of keys:\n\n┌───┬───┬───┬───┐\n│ 1 │ 2 │ 3 │ 4 │\n│ Q │ W │ E │ R │\n│ A │ S │ D │ F │\n│ Z │ X │ C │ V │\n└───┴───┴───┴───┘\n\nI put the keys in an array.\n\n// prettier-ignore\nconst keyMap = [\n  '1', '2', '3', '4',\n  'q', 'w', 'e', 'r', \n  'a', 's', 'd', 'f', \n  'z', 'x', 'c', 'v'\n]\n\nAnd create some state to store the currently pressed keys.\n\nthis.keys = 0\n\nIn the interface, keys is a binary number consisting of 16 digits where each index represents a key. Chip-8 just wants to know at any given time which keys are pressed out of the 16 and makes a decision based on that. A few examples below:\n\n0b1000000000000000 // V is pressed (keyMap[15], or index 15)\n0b0000000000000011 // 1 and 2 are pressed (index 0, 1)\n0b0000000000110000 // Q and W are pressed (index 4, 5)\n\nNow if, for example, V is pressed (keyMap[15]) and the operand is 0xf (decimal 15), the key is pressed. Left shifting (<<) with 1 will create a binary number with a 1 followed by as many zeroes as are in the left shift.\n\ncase 'SKP_VX':\n  // Skip next instruction if key with the value of Vx is pressed\n  if (this.interface.getKeys() & (1 << this.registers[args[0]])) {\n   // Skip instruction\n  } else {\n    // Go to next instruction\n  }\n\nThere is one other key method, waitKey, where the instruction is to wait for a keypress and return the key once pressed.\n\nCLI App - Interfacing with the Terminal\n\nThe first interface I made was for the terminal. This was less familiar to me than working with the DOM as I have never made any sort of graphical app in terminal, but it wasn't too difficult.\n\nCurses is a library used to create text user interfaces in the terminal. Blessed is a library wrapping curses for Node.js.\n\nScreen\n\nThe frame buffer that contains the bitmap of the screen data is the same for all implementations, but the way the screen interfaces with each environment will be different.\n\nWith blessed, I just defined a screen object:\n\nthis.screen = blessed.screen({ smartCSR: true })\n\nAnd used fillRegion or clearRegion on the pixel with a full unicode block to fill it out, using the frameBuffer as the data source.\n\ndrawPixel(x, y, value) {\n  this.frameBuffer[y][x] ^= value\n\n  if (this.frameBuffer[y][x]) {\n    this.screen.fillRegion(this.color, '█', x, x + 1, y, y + 1)\n  } else {\n    this.screen.clearRegion(x, x + 1, y, y + 1)\n  }\n\n  this.screen.render()\n}\nKeys\n\nThe key handler was not too different from what I would expect with the DOM. If a key is pressed, the handler passes the key along, which I can then use to find the index and update the keys object with any new additional keys that have been pressed.\n\nthis.screen.on('keypress', (_, key) => {\n  const keyIndex = keyMap.indexOf(key.full)\n\n  if (keyIndex) {\n    this._setKeys(keyIndex)\n  }\n})\n\nThe only particularly weird thing was that blessed didn't have a any keyup event that I could use, so I had to just simulate one by setting an interval that would periodically clear the keys.\n\nsetInterval(() => {\n  // Emulate a keyup event to clear all pressed keys\n  this._resetKeys()\n}, 100)\nEntrypoint\n\nEverything is set up now - the rom buffer to convert the binary data to opcodes, the interface to connect I/O, the CPU containing state, the instruction cycle, and two exposed methods - one to load the game, and one to step through a cycle. So I create a cycle function which will run the CPU instructions in an infinite loop.\n\nterminal.js\nconst fs = require('fs')\nconst { CPU } = require('../classes/CPU')\nconst { RomBuffer } = require('../classes/RomBuffer')\nconst { TerminalCpuInterface } = require('../classes/interfaces/TerminalCpuInterface')\n\n// Retrieve the ROM file\nconst fileContents = fs.readFileSync(process.argv.slice(2)[0])\n\n// Initialize the terminal interface\nconst cpuInterface = new TerminalCpuInterface()\n\n// Initialize the CPU with the interface\nconst cpu = new CPU(cpuInterface)\n\n// Convert the binary code into opcodes\nconst romBuffer = new RomBuffer(fileContents)\n\n// Load the game\ncpu.load(romBuffer)\n\nfunction cycle() {\n  cpu.step()\n\n  setTimeout(cycle, 3)\n}\n\ncycle()\n\nThere is also a delay timer in the cycle function, but I removed it from the example for clarity.\n\nNow I can run a script of the terminal entrypoint file and pass a ROM as the argument to play the game.\n\nnpm run play:terminal roms/PONG\nWeb App - Interfacing with the Browser\n\nThe next interface I made was for the web, communicating with the browser and the DOM. I made this version of the emulator a bit more fancy, since the browser is more of my familiar environment and I can't resist the urge to make retro looking websites. This one also allows you to switch between games.\n\nScreen\n\nFor the screen, I used the Canvas API, which uses CanvasRenderingContext2D for the drawing surface. Using fillRect with canvas was basically the same as fillRegion in blessed.\n\nthis.screen = document.querySelector('canvas')\nthis.context = this.screen.getContext('2d')\nthis.context.fillStyle = 'black'\nthis.context.fillRect(0, 0, this.screen.width, this.screen.height)\n\nOne slight difference I made here is I multiplied all the pixels by 10 so the screen would be more visible.\n\nthis.multiplier = 10\nthis.screen.width = DISPLAY_WIDTH * this.multiplier\nthis.screen.height = DISPLAY_HEIGHT * this.multiplier\n\nThis made the drawPixel command more verbose, but otherwise the same concept.\n\ndrawPixel(x, y, value) {\n  this.frameBuffer[y][x] ^= value\n\n  if (this.frameBuffer[y][x]) {\n    this.context.fillStyle = COLOR\n    this.context.fillRect(\n      x * this.multiplier,\n      y * this.multiplier,\n      this.multiplier,\n      this.multiplier\n    )\n  } else {\n    this.context.fillStyle = 'black'\n    this.context.fillRect(\n      x * this.multiplier,\n      y * this.multiplier,\n      this.multiplier,\n      this.multiplier\n    )\n  }\n}\nKeys\n\nI had access to a lot more key event handlers with the DOM, so I was able to easily handle the keyup and keydown events without any hacks.\n\n// Set keys on key down\ndocument.addEventListener('keydown', event => {\n  const keyIndex = keyMap.indexOf(event.key)\n\n  if (keyIndex) {\n    this._setKeys(keyIndex)\n  }\n})\n\n// Reset keys on keyup\ndocument.addEventListener('keyup', event => {\n  this._resetKeys()\n})\n}\nEntrypoint\n\nI handled working with the modules by importing all of them and setting them to the global object, then using Browserify to use them in the browser. Setting them to the global makes them available on the window so I could use the code output in a browser script. Nowadays I might use Webpack or something else for this, but it was quick and simple.\n\nweb.js\nconst { CPU } = require('../classes/CPU')\nconst { RomBuffer } = require('../classes/RomBuffer')\nconst { WebCpuInterface } = require('../classes/interfaces/WebCpuInterface')\n\nconst cpuInterface = new WebCpuInterface()\nconst cpu = new CPU(cpuInterface)\n\n// Set CPU and Rom Buffer to the global object, which will become window in the\n// browser after bundling.\nglobal.cpu = cpu\nglobal.RomBuffer = RomBuffer\n\nThe web entrypoint uses the same cycle function as the terminal implementation, but has a function to fetch each ROM and reset the display every time a new one is selected. I'm used to working with json data and fetch, but in this case I fetched the raw arrayBuffer from the response.\n\n// Fetch the ROM and load the game\nasync function loadRom() {\n  const rom = event.target.value\n  const response = await fetch(`./roms/${rom}`)\n  const arrayBuffer = await response.arrayBuffer()\n  const uint8View = new Uint8Array(arrayBuffer)\n  const romBuffer = new RomBuffer(uint8View)\n\n  cpu.interface.clearDisplay()\n  cpu.load(romBuffer)\n}\n\n// Add the ability to select a game\ndocument.querySelector('select').addEventListener('change', loadRom)\n\nThe HTML includes a canvas and a select.\n\n<canvas></canvas>\n<select>\n  <option disabled selected>Load ROM...</option>\n  <option value=\"CONNECT4\">Connect4</option>\n  <option value=\"PONG\">Pong</option>\n</select>\n\nThen I just deployed the code onto GitHub pages because it's static.\n\nNative App - Interfacing with the Native Platform\n\nI also made an experimental native UI implementation. I used Raylib, a programming library for programming simple games that had bindings for Node.js.\n\nI consider this version experimental just because it's really slow compared to the other ones, so it's less usable, but everything works correctly with the keys and screen.\n\nEntrypoint\n\nRaylib works a bit differently than the other implementations because Raylib itself runs in a loop, meaning I won't end up using the cycle function.\n\nconst r = require('raylib')\n\n// As long as the window shouldn't close...\nwhile (!r.WindowShouldClose()) {\n  // Fetch, decode, execute\n  cpu.step()\n\n  r.BeginDrawing()\n  // Paint screen with amy changes\n  r.EndDrawing()\n}\n\nr.CloseWindow()\nScreen\n\nWithin the beginDrawing() and endDrawing() methods, the screen will update. For the Raylib implementation I accessed the interface directly from the script instead of keeping everything contained in the interface, but it works.\n\nr.BeginDrawing()\n\ncpu.interface.frameBuffer.forEach((y, i) => {\n  y.forEach((x, j) => {\n    if (x) {\n      r.DrawRectangleRec({ x, y, width, height }, r.GREEN)\n    } else {\n      r.DrawRectangleRec({ x, y, width, height }, r.BLACK)\n    }\n  })\n})\n\nr.EndDrawing()\nKeys\n\nGetting the keys to work on Raylib was the last thing I worked on. It was more difficult to figure out because I had to do everything in the IsKeyDown method - there was a GetKeyPressed method, but it had side effects and caused problems. So instead of just waiting for a keypress like the other implementations, I had to loop through all keys and check if they were down, and append them to the key bitmask if so.\n\nlet keyDownIndices = 0\n// Run through all possible keys\nfor (let i = 0; i < nativeKeyMap.length; i++) {\n  const currentKey = nativeKeyMap[i]\n  // If key is already down, add index to key down map\n  // This will also lift up any keys that aren't pressed\n  if (r.IsKeyDown(currentKey)) {\n    keyDownIndices |= 1 << i\n  }\n}\n\n// Set all pressed keys\ncpu.interface.setKeys(keyDownIndices)\n\nThat's it for the native implementation. It was more of a challenge than the other ones, but I'm glad I did it to round out the interface and see how well it would work on drastically different platforms.\n\nConclusion\n\nSo that's my Chip-8 project! Once again, you can check out the source on GitHub. I learned a lot about lower level programming concepts and how a CPU operates, and also about the capabilities of JavaScript outside of a browser app or REST API server. I still have a few things left to do in this project, like attempt to make a (very) simple game, but the emulator is complete, and I'm proud to have finished it.\n\nAuthor\n\nHey, I’m Tania, a full stack software engineer. I write about what I know to help viewers like you. My site has no ads, sponsors, or bullshit. If you enjoy my content, please consider supporting what I do!\n\nBuy me a coffee\nBecome a Patron\nKo-Fi\nPatreon\nNewsletter\nRSS"}

{"l":"https://martinfowler.com/articles/class-too-large.html","n":"Refactoring: This class is too large","html":"<header id=\"banner\" style=\"background-image: url(&quot;/banner.png&quot;); background-repeat: no-repeat\">\n\n<div class=\"name-logo\"><a href=\"https://martinfowler.com\"><img src=\"/mf-name-white.png\"></a></div>\n  <div class=\"search\">\n    <!-- SiteSearch Google -->\n    <form method=\"GET\" action=\"https://www.google.com/search\">\n      <input type=\"hidden\" name=\"ie\" value=\"UTF-8\">\n      <input type=\"hidden\" name=\"oe\" value=\"UTF-8\">\n      <input class=\"field\" type=\"text\" name=\"q\" size=\"15\" maxlength=\"255\" value=\"\">\n      <button class=\"button\" type=\"submit\" name=\"btnG\" value=\" \" title=\"Search\">\n      <input type=\"hidden\" name=\"domains\" value=\"martinfowler.com\">\n      <input type=\"hidden\" name=\"sitesearch\" value=\"\"> \n      <input type=\"hidden\" name=\"sitesearch\" value=\"martinfowler.com\">\n    \n  </button></form></div>\n\n<div class=\"menu-button navmenu-button\"><a class=\"icon icon-bars\" href=\"#navmenu-bottom\"></a></div>\n\n<nav class=\"top-menu\">\n<ul>\n<li><a class=\"\" href=\"https://refactoring.com\">Refactoring</a></li>\n\n<li><a class=\"\" href=\"/agile.html\">Agile</a></li>\n\n<li><a class=\"\" href=\"/architecture\">Architecture</a></li>\n\n<li><a class=\"\" href=\"/aboutMe.html\">About</a></li>\n\n<li><a class=\"tw\" href=\"https://www.thoughtworks.com\">ThoughtWorks</a></li>\n\n<li><a class=\"icon icon-rss\" href=\"/feed.atom\" title=\"feed\"></a></li>\n\n<li><a class=\"icon icon-twitter\" href=\"https://www.twitter.com/martinfowler\" title=\"twitter stream\"></a></li>\n</ul>\n</nav>\n</header>\n<nav id=\"top-navmenu\">\n<nav class=\"navmenu\">\n<div class=\"nav-head\">  <div class=\"search\">\n    <!-- SiteSearch Google -->\n    <form method=\"GET\" action=\"https://www.google.com/search\">\n      <input type=\"hidden\" name=\"ie\" value=\"UTF-8\">\n      <input type=\"hidden\" name=\"oe\" value=\"UTF-8\">\n      <input class=\"field\" type=\"text\" name=\"q\" size=\"15\" maxlength=\"255\" value=\"\">\n      <button class=\"button\" type=\"submit\" name=\"btnG\" value=\" \" title=\"Search\">\n      <input type=\"hidden\" name=\"domains\" value=\"martinfowler.com\">\n      <input type=\"hidden\" name=\"sitesearch\" value=\"\"> \n      <input type=\"hidden\" name=\"sitesearch\" value=\"martinfowler.com\">\n    \n  </button></form></div>\n\n<div class=\"closediv\">\n<span class=\"close\" title=\"close\"></span>\n</div>\n</div>\n\n<div class=\"nav-body\">\n<div class=\"topics\">\n<h2>Topics</h2>\n\n<p><a href=\"/architecture\">Architecture</a></p>\n\n<p><a href=\"https://refactoring.com\">Refactoring</a></p>\n\n<p><a href=\"/agile.html\">Agile</a></p>\n\n<p><a href=\"/delivery.html\">Delivery</a></p>\n\n<p><a href=\"/microservices\">Microservices</a></p>\n\n<p><a href=\"/data\">Data</a></p>\n\n<p><a href=\"/testing\">Testing</a></p>\n\n<p><a href=\"/dsl.html\">DSL</a></p>\n</div>\n\n<div class=\"about\">\n<h2>about me</h2>\n\n<p><a href=\"/aboutMe.html\">About</a></p>\n\n<p><a href=\"/books\">Books</a></p>\n\n<p><a href=\"/faq.html\">FAQ</a></p>\n</div>\n\n<div class=\"content\">\n<h2>content</h2>\n\n<p><a href=\"/videos.html\">Videos</a></p>\n\n<p><a href=\"/tags\">Content Index</a></p>\n\n<p><a href=\"/articles/eurogames\">Board Games</a></p>\n\n<p><a href=\"/photos\">Photography</a></p>\n</div>\n\n<div class=\"tw\">\n<h2>ThoughtWorks</h2>\n\n<p><a href=\"https://thoughtworks.com/insights\">Insights</a></p>\n\n<p><a href=\"https://thoughtworks.com/careers\">Careers</a></p>\n\n<p><a href=\"https://thoughtworks.com/products\">Products</a></p>\n</div>\n\n<div class=\"feeds\">\n<h2>follow</h2>\n\n<p><a href=\"https://www.twitter.com/martinfowler\">Twitter</a></p>\n\n<p><a href=\"/feed.atom\">RSS</a></p>\n</div>\n</div>\n</nav>\n</nav>\n\n<div class=\"contents dropdown-container\">\n<button class=\"dropdown-button\">\n<h2>Contents</h2>\n</button>\n\n<div class=\"hidden\" id=\"dropdownLinks\"><a href=\"#OutlineOfTheProblem\">Outline of the problem</a><a href=\"#WhyRefactor\">Why refactor?</a><a href=\"#how\">How do I do it?</a><a href=\"#rearrange-methods\">1. Rearrange methods</a><a href=\"#analyse-rels\">2. Analyse relationships between file-loading methods</a><a href=\"#PlanOfAction\">Plan of action</a><a href=\"#modify-staying\">3. Modify the methods that are staying behind</a><a href=\"#covering-tests\">4. Create covering tests for the new FileLoader class</a><a href=\"#create-fileloader\">5. Create new FileLoader class and move two methods</a><a href=\"#move-methods\">6. Move the other methods to the new FileLoader class</a><a href=\"#extract-more-classes\">7. Extract more new classes</a><a href=\"#Recap\">Recap</a><a href=\"#WhatsNext\">What's next?</a>\n<h3>Sidebars</h3>\n\n<ul>\n<li><a href=\"#approach\">Language and approach</a>\n<ul>\n<li><a href=\"#C\">C#</a></li>\n\n<li><a href=\"#Test-drivenDevelopment\">Test-driven development</a></li>\n</ul>\n</li>\n\n<li><a href=\"#continual-refactoring\">How to avoid getting here in the first place</a></li>\n\n<li><a href=\"#how-to-read\">How to read this article</a></li>\n\n<li><a href=\"#separate-moves\">Principle: Always commit moves and renames separately from edits.</a></li>\n\n<li><a href=\"#abbreviations\">Abbreviated method names</a></li>\n\n<li><a href=\"#one-thing\">Principle: Do one thing at a time. Focus!</a></li>\n\n<li><a href=\"#automated refactorings\">Automated refactorings</a></li>\n\n<li><a href=\"#memb-var\">A note on member variables</a></li>\n\n<li><a href=\"#order\">A note on the order of the commits</a></li>\n\n<li><a href=\"#reality\">The reality: Most teams own problematic code</a></li>\n</ul>\n</div>\n</div>\n\n<main>\n<h1>Refactoring: This class is too large</h1>\n\n<p class=\"subtitle\">\n    An example of refactoring from a real (flawed) code base. \n  </p>\n\n<p class=\"abstract\"><i>    \n    In this article I walk through a\n    set of refactorings from a real code base. \n    This is not intended to demonstrate perfection, but it does represent reality.\n  </i></p>\n\n<p class=\"date\">14 April 2020</p>\n\n<div class=\"frontMatter\">\n<div class=\"frontLeft\">\n<div class=\"author\"><a href=\"https://twitter.com/ClareSudbery\"><img alt=\"Photo of Clare Sudbery\" src=\"class-too-large/Pete9141-small.jpg\" width=\"80\"></a>\n<p class=\"name\"><a href=\"https://twitter.com/ClareSudbery\">Clare Sudbery</a></p>\n\n<div class=\"bio\">\n<p>Writer, speaker, asker of questions and enthusiast of Extreme Programming - Clare \n    is an ex high school maths teacher and a consultant with 20 years of software engineering\n    experience. She is on a mission to awaken the inner geek in people everywhere - \n    particularly those not traditionally encouraged to geek out.</p>\n</div>\n</div>\n\n<div class=\"clear\"></div>\n\n<div class=\"tags\"></div>\n</div>\n\n<div class=\"frontRight\">\n<div class=\"contents\">\n<h2>Contents</h2>\n\n<ul>\n<li><a href=\"#OutlineOfTheProblem\">Outline of the problem</a></li>\n\n<li><a href=\"#WhyRefactor\">Why refactor?</a></li>\n\n<li><a href=\"#how\">How do I do it?</a></li>\n\n<li><a href=\"#rearrange-methods\">1. Rearrange methods</a></li>\n\n<li><a href=\"#analyse-rels\">2. Analyse relationships between file-loading methods</a></li>\n\n<li><a href=\"#PlanOfAction\">Plan of action</a></li>\n\n<li><a href=\"#modify-staying\">3. Modify the methods that are staying behind</a></li>\n\n<li><a href=\"#covering-tests\">4. Create covering tests for the new FileLoader class</a></li>\n\n<li><a href=\"#create-fileloader\">5. Create new FileLoader class and move two methods</a></li>\n\n<li><a href=\"#move-methods\">6. Move the other methods to the new FileLoader class</a></li>\n\n<li><a href=\"#extract-more-classes\">7. Extract more new classes</a></li>\n\n<li><a href=\"#Recap\">Recap</a></li>\n\n<li><a href=\"#WhatsNext\">What's next?</a></li>\n</ul>\n\n<h3>Sidebars</h3>\n\n<ul>\n<li><a href=\"#approach\">Language and approach</a>\n<ul>\n<li><a href=\"#C\">C#</a></li>\n\n<li><a href=\"#Test-drivenDevelopment\">Test-driven development</a></li>\n</ul>\n</li>\n\n<li><a href=\"#continual-refactoring\">How to avoid getting here in the first place</a></li>\n\n<li><a href=\"#how-to-read\">How to read this article</a></li>\n\n<li><a href=\"#separate-moves\">Principle: Always commit moves and renames separately from edits.</a></li>\n\n<li><a href=\"#abbreviations\">Abbreviated method names</a></li>\n\n<li><a href=\"#one-thing\">Principle: Do one thing at a time. Focus!</a></li>\n\n<li><a href=\"#automated refactorings\">Automated refactorings</a></li>\n\n<li><a href=\"#memb-var\">A note on member variables</a></li>\n\n<li><a href=\"#order\">A note on the order of the commits</a></li>\n\n<li><a href=\"#reality\">The reality: Most teams own problematic code</a></li>\n</ul>\n</div>\n</div>\n</div>\n\n<div class=\"paperBody shallow\">\n<p>\n      This is a story about refactoring.\n      It's the third item in the TDD \n      <a href=\"https://martinfowler.com/articles/workflowsOfRefactoring/#tdd\"> red-green-refactor cycle</a><span class=\"foot-ref\"><a href=\"#footnote-tdd\">[1]</a></span> and it's\n      the thing we do all the time, right? Except when we don't.\n    </p>\n\n<p>\n      I have an unruly code base which has suffered from refactoring neglect, so I've \n      been bringing it back into line. \n      In this article I will take a <i>class that is too large</i>, and make it smaller.\n    </p>\n\n<aside class=\"sidebar\" id=\"approach\">\n<h1>Language and approach</h1>\n\n<section id=\"C\">\n<h2>C#</h2>\n\n<p>\n            I generally write code in whatever language suits the client, the project and the problem at hand. \n            But the majority of my career has been in the .Net space, so C# is my comfort zone and my default go-to. \n            The examples in this article are written in C#, but I hope the code snippets included are simple \n            enough to follow even if you don't know the language.\n          </p>\n</section>\n\n<section id=\"Test-drivenDevelopment\">\n<h2>Test-driven development</h2>\n\n<p>\n            I'm a big fan of Test-Driven Development (TDD) <span class=\"foot-ref\"><a href=\"#footnote-tdd\">[1]</a></span>, \n            and the code presented here was mostly written using that approach.            \n            But I have to confess that after 20 years as an engineer, \n            I have at least half a career of bad \n            habits behind me and I don't always get things right.  \n          </p>\n</section>\n</aside>\n\n<section id=\"OutlineOfTheProblem\">\n<h2>Outline of the problem</h2>\n\n<p>The story begins with a boring domestic chore. I've written some\n      personal accounting software - <a href=\"https://github.com/claresudbery/Reconciliate/tree/Refactor-examples\">Reconciliate</a>.\n      It works on the\n      command line and performs the following actions:</p>\n\n<ol>\n<li>Loads my own comma-separated data:\n          \n<ul>\n<li>My record of recent bank and credit card transactions.</li>\n\n<li>My predicted monthly and annual transactions (based on data in a\n        central spreadsheet).</li>\n\n<li>Any unreconciled previously-recorded data.</li>\n</ul>\n</li>\n\n<li>Loads third-party comma-separated data (from bank and credit card companies).</li>\n\n<li>Reconciles the third-party data against my own data.</li>\n\n<li>Writes everything back to a central spreadsheet.</li>\n</ol>\n\n<p>I have some bugs that need fixing and some features to add. But my\n      typical workflow is to arrive at the laptop late at night after putting my\n      youngest to bed, with only a small amount of time before it will be <i>my</i>\n      bedtime, and often a few weeks after the last time I saw the code. In\n      these circumstances it's horribly easy to think things like, \"Well I know\n      this code is a mess, but I don't have time to get my head round it and fix\n      it now...\"</p>\n\n<p>Clearly this is not ideal.</p>\n\n<p>There's one class in particular - the <code>ReconciliationIntro</code> class \n      - which is giving me a headache\n      whenever I look at it. It's bloated and convoluted and impossible to <i>fit\n      in my head</i>&nbsp;<span class=\"foot-ref\"><a href=\"#footnote-fits-in-my-head\">[2]</a></span>. This has created a nasty \n      feedback loop: \"Because this code is \n      so hard to reason about, refactoring will take more time and energy than I\n      have, so I'll put up with it even longer - even though it means I can't\n      even make small changes any more because it takes so long for me to\n      understand the code's current state and decide where the change should\n      go.\" </p>\n\n<p>For instance, I want to add the ability to handle another credit card.\n      In a lot of places I've used\n      <a href=\"https://medium.com/@shanikae/polymorphism-explained-simply-7294c8deeef7\">polymorphism</a>\n      and <a href=\"https://en.wikipedia.org/wiki/Strategy_pattern\">the strategy pattern</a>\n      to keep the unique behaviour of each credit card neatly encapsulated. But\n      the <code>ReconciliationIntro</code> class is one place where, because of the poor\n      design of the code and the lack of clear \n      <a href=\"https://en.wikipedia.org/wiki/Separation_of_concerns\">context separation</a>, \n      if I add another\n      credit card I'll be making an already bloated class even worse. It\n      contains four duplicated code paths for each of four types of data (Bank In,\n      Bank Out, Credit Card 1 and Credit Card 2), and if I add Credit Card 3\n      right now I'll end up following the same anti-pattern.</p>\n\n<p>My overall aim is to replace this code with more generic\n      code, via the strategy pattern <span class=\"foot-ref\"><a href=\"#footnote-refactoring-to-patterns\">[3]</a></span>. \n      But there are four problems standing in my way:</p>\n\n<ol>\n<li>This one large class, (<code>ReconciliationIntro</code>), is taking too\n        much responsibility.</li>\n\n<li>There's a lot of private nested code, which is hard to unit-test\n        because it has no public interface.</li>\n\n<li>Within <code>ReconciliationIntro</code>, there's one large method that's doing\n        too much.</li>\n\n<li>There are several methods in <code>ReconciliationIntro</code> which use the\n        same repeated pattern but with different details.</li>\n</ol>\n\n<p>\n        I plan to fix all of these problems, in the order listed above. \n        This <a href=\"https://www.martinfowler.com/articles/preparatory-refactoring-example.html\">preparatory refactoring</a>\n        will get me to the point where I can easily encapsulate the behaviour of each credit \n        card / account. As <a href=\"https://twitter.com/KentBeck/status/250733358307500032?s=20\">Kent Beck says</a>, \n        \"Make the change easy, then make the easy change.\" \n      </p>\n\n<p>\n        This article is about tackling the first problem in the above list: <i>This class is too\n        large</i>.\n      </p>\n</section>\n\n<section id=\"WhyRefactor\">\n<h2>Why refactor?</h2>\n\n<p>I can't easily reason about the <code>ReconciliationIntro</code> class because it\n      has too many responsibilities. It was originally designed as the\n      entrance hall to the software, and all it did was display a few messages\n      and then instantiate the classes that do the main work.\n      But over time a lot of other code has snuck in. I want to make it easier to add \n      another credit card, so I'm going to start\n      by <i>breaking this large class into smaller classes</i>.</p>\n\n<p>The benefits will be several:</p>\n\n<ul>\n<li>By moving groups of methods into separate classes I'll create clear \n        <a href=\"https://en.wikipedia.org/wiki/Separation_of_concerns\">contexts</a> and minimise tight coupling. \n        This means that:</li>\n\n<ul>\n<li>I'll know where to go when I want to make changes or fix issues.</li>\n\n<li>When I amend the code, I'll only have to work with small\n          isolated sections that fit in my head <span class=\"foot-ref\"><a href=\"#footnote-fits-in-my-head\">[2]</a></span>\n          - I won't have to understand\n          the whole system.</li>\n\n<li>Any manipulation of state will only happen locally in a small context\n          - so I won't have to worry about one area of the system changing state in\n          another.</li>\n</ul>\n</ul>\n</section>\n\n<section id=\"how\">\n<aside class=\"sidebar\" id=\"continual-refactoring\">\n<h2>How to avoid getting here in the first place</h2>\n\n<p>\n          Could I have avoided being in this position? Yes, of course. \n          Rather than despairing about a lack of time,\n          I could have made small continuous changes whenever I encountered problem areas.\n          That's part of what the refactor stage of\n          the <a href=\"https://martinfowler.com/articles/workflowsOfRefactoring/#tdd\">red-green-refactor cycle</a>\n          is for, and it's a habit you can reinstate <i>at any time</i>.\n        </p>\n\n<p>\n          But it's worth acknowledging that when coding under pressure, you're \n          not always in a fit state to make the \n          right choices. Your code \n          can quickly reach a level of crustiness that makes a refactor feel \n          insurmountable.\n          At these times it's always worth using small changes to make things \n          better piece by piece, \n          no matter what state your code is in. \n        </p>\n</aside>\n\n<h2>How do I do it? </h2>\n\n<p>To my\n      mind, the most important principle when refactoring (and when writing new\n      code) is to move in tiny steps. I have several connected aims:</p>\n\n<ul>\n<li>At every step, I want the code to compile and the tests to run.</li>\n\n<li>If a change causes any tests to fail, I want to be able to fix them\n        instantly. By making small changes and small commits, I can see which\n        change caused the tests to fail and I only need to rewind / examine a\n        small amount of code to find the problem.</li>\n\n<li>I can keep track of where I am in in my head. It's horribly easy to\n        embark on a relatively simple refactor, only to find it has repercussions\n        beyond your original intention. At this point, if you're not in the habit\n        of keeping the code compiling and the tests passing at every step, you can\n        find yourself lost in a rabbit hole that's difficult to exit: Your\n        code isn't compiling and your tests aren't even running, let alone passing.</li>\n</ul>\n\n<p>\n        For this to work, I need the code being refactored to be\n        covered by tests. This has already been done before I start refactoring, \n        although it's worth noting\n        that one of my aims in a future refactoring will be to make the code even\n        more testable.\n      </p>\n\n<p><a href=\"/books/refactoring.html\">Refactoring, by Martin Fowler</a> is a recommended\n        further read and lays out some basic refactoring principles. He also emphasises\n        the value of moving in tiny steps and building the code / running your \n        tests after every small commit.\n      </p>\n\n<p>Beyond these basic principles, I'll aim to follow a logical series of\n      steps which are outlined below.</p>\n\n<aside class=\"sidebar\" id=\"how-to-read\">\n<h2>How to read this article</h2>\n\n<p>This is a real code base and a messy code base (hence the refactoring), \n        so there's a lot of code. \n        For those who want to know more, I do link to the code repeatedly. \n        But I've deliberately kept the descriptions high-level, and you don't <i>need</i> \n        to follow those links.</p>\n</aside>\n</section>\n\n<section id=\"rearrange-methods\">\n<h2>1. Rearrange methods</h2>\n\n<p>I'll start by using <a href=\"https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/preprocessor-directives/preprocessor-region\">regions</a> to rearrange all the\n      methods in the <a href=\"https://github.com/claresudbery/Reconciliate/blob/Refactor-genericise-start/Console/Reconciliation/ReconciliationIntro.cs\"><code>ReconciliationIntro</code> class</a> into sensible\n      groupings&nbsp;(<a href=\"https://github.com/claresudbery/Reconciliate/commit/f2d9932\">commit f2d9932</a>) <span class=\"foot-ref\"><a href=\"#footnote-commits-not-compulsory\">[4]</a></span>:</p>\n\n<div class=\"figure \" id=\"class-split-into-regions-v2.png\"><img src=\"class-too-large/class-split-into-regions-v2.png\">\n<p class=\"photoCaption\">Figure 1: ReconciliationIntro after\n      methods rearranged into regions</p>\n</div>\n\n<div class=\"clear\"></div>\n\n<aside class=\"sidebar\" id=\"separate-moves\">\n<h2>Principle: Always commit moves and renames separately from edits.</h2>\n\n<p>It's important that I move code around like this as a separate task\n        and <a href=\"https://github.com/claresudbery/Reconciliate/commit/f2d9932\">in a separate commit</a>, without\n        editing the code in any way. When you rearrange methods, the resulting\n        code difference will include many added/deleted chunks of code. If the\n        code has been changed as well as moved, you can't easily tell whether\n        lines have been deleted or moved, and whether moved lines are the\n        same or different. As Dan Terhorst-North says, \"A change should be \n        structural or behavioural, but never both.\"</p>\n\n<div class=\"figure \" id=\"move-in-a-separate-commit-smaller-narrower2.png\"><img src=\"class-too-large/move-in-a-separate-commit-smaller-narrower2.png\">\n<p class=\"photoCaption\">Figure 2: What a commit\n        looks like when you've moved code around</p>\n</div>\n\n<div class=\"clear\"></div>\n</aside>\n\n<p>Now that I've grouped my methods into what feels like a reasonable set of \n      <a href=\"https://en.wikipedia.org/wiki/Separation_of_concerns\">contexts</a>, \n      I'd like to pull these out into separate classes. But where to\n      start? The file loading code contains the most duplication, and is causing the\n      most pain. Ultimately I want to make this code more generic, but first I want to\n      pull it out so I can see it without distraction. I'll extract a new <code>FileLoader</code>\n      class. The other groupings will also become separate classes but they'll be a\n      lot simpler, so I'll focus most of this article on the file-loading code.</p>\n</section>\n\n<section id=\"analyse-rels\">\n<aside class=\"sidebar\" id=\"abbreviations\">\n<h2>Abbreviated method names</h2>\n\n<p>\n          The naming of anything - from methods to pubs to children - is a notoriously difficult \n          enterprise. My tendency to verbosity is as evident in my method names \n          as it is in the longwinded stories you'll hear if you meet me in a pub. \n          Before refactoring, the duplication of code meant that method names \n          were being used to differentiate between contexts - and this resulted \n          in some long names.\n          To avoid gigantic images I've abbreviated names in most of the \n          diagrams, as follows:\n          \n</p><ul>\n<li><b>BBI</b>: bank_and_bank_in (\"bank\" and \"bank_in\" represent two different views - the bank's, and my own)</li>\n\n<li><b>BBO</b>: bank_and_bank_out (\"bank\" and \"bank_out\" as with \"bank\" and \"bank_in\" above)</li>\n\n<li><b>CC1</b>: cred_card1_and_cred_card1_in_out (\"cred_card1\" and \"cred_card1_in_out\" as with \"bank\" and \"bank_in\" above)</li>\n\n<li><b>CC2</b>: cred_card2_and_cred_card2_in_out (as with \"cred_card1\" above)</li>\n\n<li><b>Merge_bd</b>: Merge_bespoke_data</li>\n\n<li><b>BM</b>: budgeting_months</li>\n\n<li><b>ccds</b>: credit_card_debits</li>\n\n<li><b>wpf</b>: with_pending_file</li>\n\n<li><b>CC</b>: cred_card</li>\n\n<li><b>DDs</b>: direct_debits</li>\n</ul>\n<p></p>\n</aside>\n\n<h2>2. Analyse relationships between file-loading methods</h2>\n\n<p>So far all I've done is move some code around in the same class. I\n      rebuilt the code and ran all the tests before I committed, but unless I\n      was clumsy I'd expect my previous commit to be trivial. I need to be a\n      little more thoughtful about what I do next.</p>\n\n<p>I've used one of my regions to identify methods to pull out into \n      a new <code>FileLoader</code>\n      class, but how can I be sure this will work? Are there any hidden\n      dependencies? I'll discover this by drawing out the relationships\n      between the methods I want to move. The ones to be moved are marked in\n      blue.</p>\n\n<div class=\"figure \" id=\"File-loading-code-diagram-01-v2-small.png\"><img src=\"class-too-large/File-loading-code-diagram-01-v2-small.png\">\n<p class=\"photoCaption\">Figure 3: File-loading\n      methods to be moved \n      (<a href=\"#abbreviations\">abbreviations</a>)</p>\n</div>\n\n<div class=\"clear\"></div>\n\n<p>I can see straight away that it's not a strictly self-contained \n      context: Some of the\n      blue methods are calling back out to methods (shown in black and green) that I want to\n      keep in a separate class. There are a couple of ways I could handle this, which\n      I <a href=\"#modify-staying\">discuss below</a>. But now I'm at\n      a place where I can define a plan of action. </p>\n</section>\n\n<section id=\"PlanOfAction\">\n<h2>Plan of action</h2>\n\n<p> By the time I'm done, the original large <code>ReconciliationIntro</code> class \n      will have been broken down into \n      the pared-down version plus five new classes shown in \n      the diagram below. Note that there isn't a one-to-one mapping between\n      regions and classes, because later on when I reach \n      <a href=\"#extract-more-classes\">step 7</a>, I'll end up refining my first groupings \n      into some finer-grained boundaries.</p>\n\n<div class=\"figure \" id=\"MasterPlan-darker-text-taller.png\"><img src=\"class-too-large/MasterPlan-darker-text-taller.png\">\n<p class=\"photoCaption\">Figure 4: Plan of action</p>\n</div>\n\n<div class=\"clear\"></div>\n\n<p>\n        My overall aim is to break this large class down into smaller classes.\n        In steps 1 and 2 above, I used <a href=\"#rearrange-methods\">regions</a> \n        and <a href=\"#analyse-rels\">a diagram</a> to identify distinct areas of \n        code and then analyse relationships between some of the methods. That gave me enough \n        information to start thinking about how I can tackle this job in tiny steps. \n      </p>\n\n<p>\n        The resulting plan is summarised below and then described in detail further down. \n        I reached this plan by thinking about how I could \n        proceed using steps that were <a href=\"#how\">as small as possible</a>. Often what I'm \n        doing is setting things up so that the <i>next</i> change will be \n        as small and simple as possible. I'm making small \n        changes to facilitate more small changes - yet again following \n        <a href=\"https://twitter.com/KentBeck/status/250733358307500032?s=20\">Kent Beck's dictum</a> to \n        \"Make the change easy, then make the easy change.\"\n      </p>\n\n<p>\n        Depending on your circumstances \n        you might not follow the same plan, but it's not a bad template if you're not sure how to proceed. \n        Your priority is to set yourself up for safe incremental changes:\n      </p>\n\n<ol>\n<li>\n<p><a href=\"#rearrange-methods\">Rearrange methods</a></p>\n\n<p>Group all the methods in the class into sensible groupings, as described\n          <a href=\"#rearrange-methods\">above</a>.</p>\n</li>\n\n<li>\n<p><a href=\"#analyse-rels\">Analyse\n          relationships between file-loading methods</a></p>\n\n<p>Identify how the\n          file-loading code is connected to the rest of the code in \n          the <code>ReconciliationIntro</code> class, as\n          described <a href=\"#analyse-rels\">above</a>.</p>\n</li>\n\n<li>\n<p><a href=\"#modify-staying\">Modify the\n          methods that are staying behind</a></p>\n\n<p>There are methods which\n          will stay in the parent class but are currently called by those that are\n          moving. Some modification will be required to make this work.</p>\n</li>\n\n<li>\n<p><a href=\"#covering-tests\">Create covering\n          tests for the new <code>FileLoader</code> class</a></p>\n\n<p>The new <code>FileLoader</code> class\n          needs to be covered by tests. The tests for the code to be moved already\n          exist, but they'll be moved into a new <code>FileLoaderTests</code> class.</p>\n</li>\n\n<li>\n<p><a href=\"#create-fileloader\">Create new\n          <code>FileLoader</code> class and move two methods</a></p>\n\n<p><a href=\"#how\">Following the principle of tiny steps</a>, I'll move\n          just two methods (a public method and a private method called by it)\n          before I move the rest.</p>\n</li>\n\n<li>\n<p><a href=\"#move-methods\">Move the other\n          methods to the new <code>FileLoader</code> class</a></p>\n\n<p>This is where it gets\n          exciting. All that file-loading code I'm interested in will finally\n          get a new home!</p>\n</li>\n\n<li>\n<p><a href=\"#extract-more-classes\">Extract more new classes</a></p>\n\n<p>Once I've dealt with the file-loading code, I'll create some more new\n          classes for the other code regions. </p>\n</li>\n</ol>\n\n<p>The new <code>FileLoader</code> class will be responsible for loading various\n      sources of comma-separated data and merging them ready for reconciliation.\n      This file-loading code is where most of the pain currently lies, so that's the \n      bit I'll describe in the most detail. \n      You can see the original code before refactoring <a href=\"https://github.com/claresudbery/Reconciliate/blob/Refactor-genericise-start/Console/Reconciliation/ReconciliationIntro.cs\">here</a>, but if you follow that link all you'll\n      learn is that it's too big to fit in your head! The slimmed down\n      post-refactor version is <a href=\"https://github.com/claresudbery/Reconciliate/blob/Refactor-examples/Console/Reconciliation/ReconciliationIntro.cs\">here</a>.</p>\n\n<p>So, now I can continue with the plan:</p>\n</section>\n\n<section id=\"modify-staying\">\n<h2>3. Modify the methods that are staying behind</h2>\n\n<p>I've identified two methods - <code>Set_path</code> and\n      <code>Recursively_ask_for_budgeting_months</code> - which are called by file-loading\n      methods:</p>\n\n<div class=\"figure \" id=\"File-loading-code-diagram-01b-v2-small.png\"><img src=\"class-too-large/File-loading-code-diagram-01b-v2-small.png\">\n<p class=\"photoCaption\">Figure 5: Methods called\n      by file-loading methods (<a href=\"#abbreviations\">abbreviations</a>)</p>\n</div>\n\n<div class=\"clear\"></div>\n\n<p>As long as those methods are not too tightly coupled with the\n      file-loading class, I can either</p>\n\n<ul>\n<li>Make them public so I can call back to them from\n        the new <code>FileLoader</code> class.</li>\n\n<li>Move the calls out of the file-loading code and into other native\n        <code>ReconciliationIntro</code> methods instead.</li>\n</ul>\n\n<p>I'll use the first approach for <code>Recursively_ask_for_budgeting_months</code> and \n      the second for <code>Set_path</code>, which will bring me to the following situation:</p>\n\n<div class=\"figure \" id=\"File-loading-code-diagram-02-v2-sm.png\"><img src=\"class-too-large/File-loading-code-diagram-02-v2-sm.png\">\n<p class=\"photoCaption\">Figure 6: \n      File-loading methods after moving (<a href=\"#abbreviations\">abbreviations</a>)</p>\n</div>\n\n<div class=\"clear\"></div>\n\n<p>Note that the methods marked as <code>FileLoader</code> methods in the diagram\n      will still be in the <code>ReconciliationIntro</code> class at the end of this step,\n      but this will <i>enable</i> me to move them into the <code>FileLoader</code> class, which\n      will happen in <a href=\"#create-fileloader\">step 5</a> \n      and <a href=\"#move-methods\">step 6</a> below.</p>\n\n<p><code>Recursively_ask_for_budgeting_months</code> will eventually be a public\n      method in another class, but for now I just want to make sure I can call\n      it from elsewhere. It turns out it already is public, which was done so\n      that it could be tested. This in itself is a code smell - it's a sign\n      that it would be better off as part of the public interface of a separate\n      class.</p>\n\n<p>The other method called from the file-loading code is <code>Set_path</code>. This\n      changes the value of an internal path variable, so I'll choose option 2:\n      I'll call it separately and pass the resulting data into the file-loading\n      method via a parameter. </p>\n\n<aside class=\"sidebar\" id=\"one-thing\">\n<h2>Principle: Do one thing at a time. Focus!</h2>\n\n<p>In the process of editing <code>Set_path</code>, I've noticed a couple of other\n        changes I want to make. </p>\n\n<p>Firstly, <code>Set_path</code> has the side effect of altering the\n        <code>_path</code> member variable. It would be better if it was\n        self-contained and just returned a new path. </p>\n\n<p>Secondly, currently <code>Set_path</code> is being called in two\n        places - just before <code>Create_pending_csvs</code> is called, and much\n        lower down in the chain of events, from within another method called\n        <code>Set_path_and_file_names</code>. If I follow the chain of different\n        methods involved here, I realise they're not called in a sensible order\n        and there's a lot of redundancy. The code is hard to follow, and it \n        would be tempting to refactor it now. </p>\n\n<p>But I'm in the middle of another refactoring, so I make a note (on my\n        Trello board) and leave these changes for later. Otherwise I'll get\n        distracted from the task at hand and could get the code into a strange\n        state and lose track of what I'm doing. Focus is important!</p>\n</aside>\n\n<p>Note that these might not normally stay as separate commits (I could use\n      micro-commits and then squash them into larger commits), but I'm keeping\n      the small commits intact to make the steps clear. I compile and run the\n      tests at every step:</p>\n\n<ol>\n<li>\n<p>\n            Modify the calling method (<code>Create_pending_csvs</code>) so that it takes a\n            parameter, but initially give it a default value \n            (<a href=\"https://github.com/claresudbery/Reconciliate/commit/acc3519\">commit acc3519</a>) <span class=\"foot-ref\"><a href=\"#footnote-commits-not-compulsory\">[4]</a></span> so\n            that the code still compiles:\n          </p>\n\n<div class=\"code-change-series\">\n<pre>private void Create_pending_csvs()\n{\n  // Some code\n}\n</pre>\n<span class=\"trans-arrow\">⇓</span>\n<pre>private void Create_pending_csvs(<span class=\"colblind-highlight\">string path = \"\"</span>)\n{\n  // Some code\n}\n</pre>\n</div>\n</li>\n\n<li>\n<p>\n            Call <code>Set_path</code> separately before calling <code>Create_pending_csvs</code>.\n            Take the resulting new <code>_path</code> member variable (see <a href=\"#one-thing\">sidebar</a>), and pass\n            it into <code>Create_pending_csvs</code> (<a href=\"https://github.com/claresudbery/Reconciliate/commit/c5ebc2f\">commit c5ebc2f</a>) <span class=\"foot-ref\"><a href=\"#footnote-commits-not-compulsory\">[4]</a></span>:\n          </p>\n\n<div class=\"code-change-series\">\n<pre>case \"1\":\n{\n  Create_pending_csvs();\n}\nbreak;\n</pre>\n<span class=\"trans-arrow\">⇓</span>\n<pre>case \"1\":\n{\n  Set_path();\n  Create_pending_csvs(<span class=\"colblind-highlight\">_path</span>);\n}\nbreak;\n</pre>\n</div>\n</li>\n\n<li>\n<p>\n            Remove the call to <code>Set_path</code> from within\n            <code>Create_pending_csvs</code>, and use the passed-in value instead of\n            the member variable (<a href=\"https://github.com/claresudbery/Reconciliate/commit/6df8f97\">commit 6df8f97</a>) <span class=\"foot-ref\"><a href=\"#footnote-commits-not-compulsory\">[4]</a></span>:\n          </p>\n\n<div class=\"code-change-series\">\n<pre>private void Create_pending_csvs(string path = \"\")\n{\n  try\n  {\n    Set_path();\n    var pending_csv_file_creator = new PendingCsvFileCreator(_path);\n</pre>\n<span class=\"trans-arrow\">⇓</span>\n<pre>private void Create_pending_csvs(string path = \"\")\n{\n  try\n  {\n    <span class=\"colblind-deleted\">Set_path();</span>\n    var pending_csv_file_creator = new PendingCsvFileCreator(<span class=\"colblind-highlight\">path</span>);\n</pre>\n</div>\n</li>\n\n<li>\n<p>\n            Finally, remove the default value from the <code>Create_pending_csvs</code>\n            parameter - thereby forcing all clients to pass a value in \n            (<a href=\"https://github.com/claresudbery/Reconciliate/commit/2be56ea\">commit 2be56ea</a>) <span class=\"foot-ref\"><a href=\"#footnote-commits-not-compulsory\">[4]</a></span>.\n            Note that by doing things in this order, I keep the code compiling at all\n            times: \n          </p>\n\n<div class=\"code-change-series\">\n<pre>private void Create_pending_csvs(string path = \"\")\n{\n  // Some code\n}\n</pre>\n<span class=\"trans-arrow\">⇓</span>\n<pre>private void Create_pending_csvs(string path <span class=\"colblind-deleted\">= \"\"</span>)\n{\n  // Some code\n}\n</pre>\n</div>\n</li>\n</ol>\n</section>\n\n<section id=\"covering-tests\">\n<h2>4. Create covering tests for the new <code>FileLoader</code> class</h2>\n\n<p>My first choice of method to move will be\n      <code>Bank_and_bank_out_ _Merge_bespoke_data_with_pending_file</code>. And the first\n      thing I want to do is copy any covering tests into a new test class for\n      the about-to-be-created <code>FileLoader</code> class. There is already one test\n      for this method -\n      <a href=\"https://github.com/claresudbery/Reconciliate-git-experiments/blob/f374fbdbf695a590ba7f7e3cd61a506222b742f0/ConsoleCatchallTests/Reconciliation/Loaders/BankAndBankOutDataTests.cs#L79\">M_MergeBespokeDataWithPendingFile_ \n      WillAddMostRecentCredCardDirectDebits</a>\n      - and its job is to make sure this method merges new direct debit data\n      correctly with a 'pending' file (which is being built to contain all new\n      transaction data). </p>\n\n<p>Note that I'm only <i>moving</i> tests, not writing new ones. People can\n      get so used to the TDD <span class=\"foot-ref\"><a href=\"#footnote-tdd\">[1]</a></span> concept of writing tests \n      before writing code that\n      they assume you need to write new tests <i>whenever you work on code</i>.\n      This is often not the case when refactoring. Ideally my functionality\n      will already be covered by tests, and when refactoring I'm not changing\n      the functionality. So instead of writing new tests, I'm using the existing ones\n      to verify the functionality still works as originally intended.</p>\n\n<p>This is a good time to review this test: It's a while since I wrote\n      it, so I should be able to spot quickly whether it makes sense. I want\n      my tests to be clear and easy to read - they should act as documentation\n      for my system behaviour. The first thing I notice is that it contains an\n      assert method - <code>Assert_direct_debit_details_are_correct</code> - whose name\n      is inadequate. What is the definition of \"correct\"? I rewrite the test\n      to make it easier to read, which involves quite a lot of changes. In the\n      interest of keeping this a digestible read I won't go into the changes\n      made, but you can view them in <a href=\"https://github.com/claresudbery/Reconciliate/commit/f090f26\">commit f090f26</a>\n      and <a href=\"https://github.com/claresudbery/Reconciliate/commit/6a6cece\">commit 6a6cece</a>. <span class=\"foot-ref\"><a href=\"#footnote-commits-not-compulsory\">[4]</a></span></p>\n\n<p>Now that I've refactored the test I'll copy it into a new test\n      class, along with some associated private helper methods. Note that\n      although this and other tests are destined to operate on a new\n      <code>FileLoader</code> class, they'll still act on the old <code>ReconciliationIntro</code>\n      class until I'm sure my new test class has everything it needs. Also\n      note that until everything is safely moved, my test code is duplicated.\n      </p>\n\n<aside class=\"sidebar\" id=\"automated refactorings\">\n<h2>Automated refactorings</h2>\n\n<p>\n          It's worth being aware that there are many automatable refactoring tasks \n          which require significantly more care when tools like\n          <a href=\"https://www.jetbrains.com/resharper/\">Resharper</a>&nbsp;<span class=\"foot-ref\"><a href=\"#footnote-resharper\">[5]</a></span>\n          are not available.\n        </p>\n\n<p>\n          For instance, with Resharper you can quickly\n          and confidently rename a method that has clients throughout a large code base. \n          But without this tool, such a change might be handled differently\n          - for instance by creating a temporary wrapper method.\n        </p>\n</aside>\n\n<p>I first create the new test class in the same file as the original\n      (<a href=\"https://github.com/claresudbery/Reconciliate/commit/491c795\">commit 491c795</a>) <span class=\"foot-ref\"><a href=\"#footnote-commits-not-compulsory\">[4]</a></span>, so that it's easy to see what I'm copying.\n      Then I can get <a href=\"https://www.jetbrains.com/resharper/\">Resharper</a>&nbsp;<span class=\"foot-ref\"><a href=\"#footnote-resharper\">[5]</a></span> and Visual Studio to move everything into a new file for\n      me (<a href=\"https://github.com/claresudbery/Reconciliate/commit/c9317c0\">commit c9317c0</a>) <span class=\"foot-ref\"><a href=\"#footnote-commits-not-compulsory\">[4]</a></span>.</p>\n\n<div class=\"figure \" id=\"Move-BBO-Tests-02-v5-small.png\"><img src=\"class-too-large/Move-BBO-Tests-02-v5-small.png\">\n<p class=\"photoCaption\">Figure 7: Move BBO tests</p>\n</div>\n\n<div class=\"clear\"></div>\n</section>\n\n<section id=\"create-fileloader\">\n<h2>5. Create new <code>FileLoader</code> class and move two methods</h2>\n\n<p>Now that my test class is up and running, I can create the new\n      <code>FileLoader</code> class. </p>\n\n<p>The method that's furthest down the chain - the lowest leaf in <a href=\"#modify-staying\">my\n      tree of methods</a> - is\n      <code>Bank_and_bank_out__ Add_most_recent_credit_card_direct_debits</code>. This is\n      a private method with no independent tests (it's tested via the public\n      calling method), so I'm going to move both it and its caller\n      (<code>Bank_and_bank_out__ Merge_bespoke_data_with_pending_file</code>). These will\n      be the first two methods to be moved into my new class. </p>\n\n<p>Again, I'll move in baby steps to avoid my tests going red and keep\n      my code building at all times. After each of the following steps I make\n      sure the code builds and the tests are passing.</p>\n\n<ol>\n<li>\n<p>\n            This is the situation I begin with. A <code>FileLoaderTests</code> class has\n            been created, but it is testing code that still lives in the\n            <code>ReconciliationIntro</code> class:\n          </p>\n\n<div class=\"figure \" id=\"New-FileLoader-class-v4-00-small.png\"><img src=\"class-too-large/New-FileLoader-class-v4-00-small.png\">\n<p class=\"photoCaption\">Figure 8: New FileLoader class part 1 \n          (<a href=\"#abbreviations\">abbreviations</a>)</p>\n</div>\n\n<div class=\"clear\"></div>\n</li>\n\n<li>\n<p>\n            I start by creating a new <code>FileLoader</code> class. One of my file-loading methods\n            (<code>Bank_and_bank_out__ Add_most_recent_credit_card_direct_debits</code>) is\n            private, and will also be private at the end of this process. It will only ever be called by \n            the method that's about to follow it into the new class. It's not\n            individually covered by tests, so I can just copy it over to the new\n            class and have it ready and waiting when its caller is moved \n            (see <a href=\"https://github.com/claresudbery/Reconciliate/commit/0341476\">commit 0341476</a>) <span class=\"foot-ref\"><a href=\"#footnote-commits-not-compulsory\">[4]</a></span>. \n            But I will need to make it temporarily public:\n          </p>\n\n<div class=\"figure \" id=\"New-FileLoader-class-v4-01-v3-small.png\"><img src=\"class-too-large/New-FileLoader-class-v4-01-v3-small.png\">\n<p class=\"photoCaption\">Figure 9: New FileLoader class part 2 \n          (<a href=\"#abbreviations\">abbreviations</a>)</p>\n</div>\n\n<div class=\"clear\"></div>\n</li>\n\n<li>\n<p>\n            Now I can create an instance of my new <code>FileLoader</code> class in the \n            <code>ReconciliationIntro</code> class and call its new public method, instead \n            of the old private method. I can also delete the old private method \n            (see <a href=\"https://github.com/claresudbery/Reconciliate/commit/bde2ae2\">commit bde2ae2</a>) <span class=\"foot-ref\"><a href=\"#footnote-commits-not-compulsory\">[4]</a></span>:\n          </p>\n\n<div class=\"figure \" id=\"New-FileLoader-class-v4-02-v3-small.png\"><img src=\"class-too-large/New-FileLoader-class-v4-02-v3-small.png\">\n<p class=\"photoCaption\">Figure 10: New FileLoader class part 3 \n          (<a href=\"#abbreviations\">abbreviations</a>)</p>\n</div>\n\n<div class=\"clear\"></div>\n</li>\n\n<li>\n<p>\n            Copy the original caller into the new class \n            (see <a href=\"https://github.com/claresudbery/Reconciliate/commit/f0a5a59\">commit f0a5a59</a>) <span class=\"foot-ref\"><a href=\"#footnote-commits-not-compulsory\">[4]</a></span>. \n            Note that at this point it's duplicated:\n          </p>\n\n<div class=\"figure \" id=\"New-FileLoader-class-v3-05-v3-small.png\"><img src=\"class-too-large/New-FileLoader-class-v3-05-v3-small.png\">\n<p class=\"photoCaption\">Figure 11: New FileLoader class part 4 \n          (<a href=\"#abbreviations\">abbreviations</a>)</p>\n</div>\n\n<div class=\"clear\"></div>\n</li>\n\n<li>\n<p>\n            Change the object I'm testing from being a <code>ReconciliationIntro</code>\n            instance to being a new <code>FileLoader</code> instance. Point the tests at the new copy \n            of the original caller. Note that because the private method it calls has also been copied, my\n            tests will pass (see <a href=\"https://github.com/claresudbery/Reconciliate/commit/3d573e3\">commit 3d573e3</a>) <span class=\"foot-ref\"><a href=\"#footnote-commits-not-compulsory\">[4]</a></span>:\n          </p>\n\n<div class=\"figure \" id=\"New-FileLoader-class-v3-06-v3-small.png\"><img src=\"class-too-large/New-FileLoader-class-v3-06-v3-small.png\">\n<p class=\"photoCaption\">Figure 12: New FileLoader class part 5 \n          (<a href=\"#abbreviations\">abbreviations</a>)</p>\n</div>\n\n<div class=\"clear\"></div>\n</li>\n\n<li>\n<p>\n            Now I can call the original caller directly from the <code>ReconciliationIntro</code> \n            class (see <a href=\"https://github.com/claresudbery/Reconciliate/commit/77c0b14\">commit 77c0b14</a>) <span class=\"foot-ref\"><a href=\"#footnote-commits-not-compulsory\">[4]</a></span>:\n          </p>\n\n<div class=\"figure \" id=\"New-FileLoader-class-v3-07-v3-small.png\"><img src=\"class-too-large/New-FileLoader-class-v3-07-v3-small.png\">\n<p class=\"photoCaption\">Figure 13: New FileLoader class part 6 \n          (<a href=\"#abbreviations\">abbreviations</a>)</p>\n</div>\n\n<div class=\"clear\"></div>\n</li>\n\n<li>\n<p>\n            Make the originally-private method private again, and delete the original caller. \n            I'll delete the old test class too, as all its tests have now been duplicated \n            in <code>FileLoaderTests</code>.\n            (see <a href=\"https://github.com/claresudbery/Reconciliate/commit/27f1a59\">commit 27f1a59</a>) <span class=\"foot-ref\"><a href=\"#footnote-commits-not-compulsory\">[4]</a></span>:\n          </p>\n\n<div class=\"figure \" id=\"New-FileLoader-class-v3-08-v3-small.png\"><img src=\"class-too-large/New-FileLoader-class-v3-08-v3-small.png\">\n<p class=\"photoCaption\">Figure 14: New FileLoader class part 7 \n          (<a href=\"#abbreviations\">abbreviations</a>)</p>\n</div>\n\n<div class=\"clear\"></div>\n</li>\n</ol>\n</section>\n\n<section id=\"move-methods\">\n<h2>6. Move the other methods to the new <code>FileLoader</code> class</h2>\n\n<p>Now I can move all the other methods. I'll handle them one by one,\n      starting with the simplest and keeping an eye out for dependencies\n      (between methods, and on any member data). I'll need to consider the\n      following:</p>\n\n<ul>\n<li>Do I want to rename any methods?</li>\n\n<li>Do I want to replace any parameter lists with new objects?</li>\n\n<li>Are there any redundant parameters?</li>\n\n<li>Are any of the internal nested callees altering state? What impact\n        does this have?</li>\n</ul>\n\n<p>I could inline those lower down in the chain before moving them, but\n      if I did I'd break the tests which call them as public methods. So\n      instead I move them on their own. I do it in the order explained below,\n      acting on one at a time and starting with those at the end of the chain\n      - ie the outermost leaves on the following tree:</p>\n\n<div class=\"figure \" id=\"Move-FileLoader-methods-part-1-narrower.png\"><img src=\"class-too-large/Move-FileLoader-methods-part-1-narrower.png\">\n<p class=\"photoCaption\">Figure 15: FileLoader method tree \n      (<a href=\"#abbreviations\">abbreviations</a>)</p>\n</div>\n\n<div class=\"clear\"></div>\n\n<p>For each one, I use the following approach:</p>\n\n<ul>\n<li>Create a copy of the method in the destination class, keeping the\n        original in place. Make the new method public.</li>\n\n<li>Call the new method instead of the original.</li>\n\n<li>Copy any covering tests into the new test class, and make sure\n        they test the new code.</li>\n\n<li>Delete the old method and the old tests.</li>\n</ul>\n\n<p>I already moved\n      <code>Bank_and_bank_out__ Merge_bespoke_data_with_pending_file</code> and\n      <code>Bank_and_bank_out__ Add_most_recent_credit_card_direct_debits</code>\n      (<a href=\"https://github.com/claresudbery/Reconciliate/commit/0341476\">commit 0341476</a> to <a href=\"https://github.com/claresudbery/Reconciliate/commit/27f1a59\">commit 27f1a59</a>), \n      so now I repeat the same actions for each of the other\n      methods (<a href=\"https://github.com/claresudbery/Reconciliate/commit/7cd53f6\">commit 7cd53f6</a> \n      to <a href=\"https://github.com/claresudbery/Reconciliate/commit/7ab95f2\">commit 7ab95f2</a>) <span class=\"foot-ref\"><a href=\"#footnote-commits-not-compulsory\">[4]</a></span>. I don't\n      commit every tiny step this time, but I still go through the same set of\n      steps. After each step, I make sure the code builds and the tests are\n      passing (apart from when I deliberately make a test fail).\n      </p>\n\n<p>I refactored some tests earlier, and I can repeat those changes for \n      tests that follow the same\n      pattern. For some methods the move is very simple, because they have no\n      test coverage. This is part of why I'm doing this refactor, to\n      make that code more easily testable.</p>\n\n<aside class=\"sidebar\" id=\"memb-var\">\n<h2>A note on member variables</h2>\n\n<p>The four load methods (<code>Load_bank_and_bank_in</code>, etc) are\n        all using two member variables from <code>ReconciliationIntro</code>:\n        <code>_input_output</code> and <code>_spreadsheet_factory</code>. So\n        when these methods are added to <code>FileLoader</code>, I need to\n        introduce these variables as members in <code>FileLoader</code> too,\n        by injecting them into the constructor. <code>_input_output</code> is\n        already being injected, but when I introduce\n        <code>_spreadsheet_factory</code> I initially give it a default value.\n        This is so the code will still build, and is done before I switch over\n        to using the new methods. This way I can fix all the places that need\n        to inject a spreadsheet factory into <code>FileLoader</code> at my\n        leisure. </p>\n\n<p>See <a href=\"https://github.com/claresudbery/Reconciliate/commit/ce559f2\">commit ce559f2</a> and <a href=\"https://github.com/claresudbery/Reconciliate/commit/7e86292\">commit 7e86292</a> \n        for the actual code changes <span class=\"foot-ref\"><a href=\"#footnote-commits-not-compulsory\">[4]</a></span>, \n        but here is a simplification focusing only on the\n        relevant parts:</p>\n\n<div class=\"code-change-series\">\n<pre>internal class ReconciliationIntro\n{\n    private readonly IInputOutput _input_output;\n\n    public ReconciliationInterface Load_correct_files()\n    {\n        Load_bank_and_bank_in(); \n    }\n\n    public ReconciliationInterface Load_bank_and_bank_in() \n    {\n        var file_loader = new FileLoader(_input_output);\n        file_loader.Load_bank_and_bank_in();\n    }\n}\n\ninternal class FileLoader\n{\n    private readonly IInputOutput _input_output;\n\n    public FileLoader(IInputOutput input_output)\n    {\n        _input_output = input_output;\n    }\n\n    public ReconciliationInterface Load_bank_and_bank_in() \n    {\n        _input_output.Output_line(\"Some text\");\n    }\n}\n</pre>\n<span class=\"trans-arrow\">⇓</span>\n<pre>// Still compiles, because ISpreadsheetRepoFactory object has default value in constructor.\n\ninternal class FileLoader\n{\n    private readonly IInputOutput _input_output;\n<span class=\"colblind-highlight\">    private readonly ISpreadsheetRepoFactory _spreadsheet_factory;</span>\n\n    public FileLoader(\n        IInputOutput input_output, \n<span class=\"colblind-highlight\">        ISpreadsheetRepoFactory spreadsheet_factory = null)</span>\n    {\n        _input_output = input_output;\n<span class=\"colblind-highlight\">        _spreadsheet_factory = spreadsheet_factory;</span>\n    }\n\n    public ReconciliationInterface Load_bank_and_bank_in() \n    {\n<span class=\"colblind-highlight\">        var pending_file_io = new FileIO&lt;BankRecord&gt;(_spreadsheet_factory);</span>\n        _input_output.Output_line(\"Some text\");\n    }\n}\n</pre>\n<span class=\"trans-arrow\">⇓</span>\n<pre>// Now ReconciliationIntro can inject member vars into FileLoader and it will all work.\n// Other clients aren't injecting yet, but some time soon we'll amend them all.\n// Finally after that we can remove the default value from the FileLoader constructor.\n\ninternal class ReconciliationIntro\n{\n    private readonly IInputOutput _input_output;\n<span class=\"colblind-highlight\">    private readonly ISpreadsheetRepoFactory <span class=\"colblind-highlight\">_spreadsheet_factory</span>;</span>\n\n    public ReconciliationInterface Load_correct_files()\n    {\n        var file_loader = new FileLoader(_input_output, <span class=\"colblind-highlight\">_spreadsheet_factory</span>);\n        file_loader.Load_bank_and_bank_in(); \n    }\n}\n</pre>\n</div>\n</aside>\n</section>\n\n<section id=\"extract-more-classes\">\n<h2>7. Extract more new classes</h2>\n\n<aside class=\"sidebar\" id=\"order\">\n<h2>A note on the order of the commits</h2>\n\n<p>My main motivation for this refactoring is to remove\n        duplication and introduce a strategy pattern \n        <span class=\"foot-ref\"><a href=\"#footnote-refactoring-to-patterns\">[3]</a></span> for the four data types in\n        the file loading code. This means that if you look at the commits \n        you'll see that after extracting the <code>FileLoader</code> class, \n        I moved on to other things. But when I came back\n        to write up this article, I couldn't bear to leave the\n        <code>ReconciliationIntro</code> class in its still-bloated state, so I\n        got on with extracting the rest of the classes - starting from\n        <a href=\"https://github.com/claresudbery/Reconciliate/commit/3446a54\">commit 3446a54</a>.</p>\n</aside>\n\n<p>When <a href=\"#rearrange-methods\">adding regions at the start</a>,\n      I identified some <b>Get budgeting months</b> functionality which\n      creates its own clear <a href=\"https://en.wikipedia.org/wiki/Separation_of_concerns\">context</a>, \n      so I extract these methods out into\n      a new <code>BudgetingMonthService</code> class. This is very quick and\n      simple because these methods only have one public entry point\n      (see <a href=\"https://github.com/claresudbery/Reconciliate/commit/6103f0b\">commit 6103f0b</a>) <span class=\"foot-ref\"><a href=\"#footnote-commits-not-compulsory\">[4]</a></span>.\n      </p>\n\n<p><code>ReconciliationIntro</code> is still too big, but the methods all\n      call one another and now that I've spent more time refamiliarising myself\n      with the code I'm not convinced my two remaining regions of <code>User\n      Instructions and Input</code> and <code>Debug Spreadsheet Operations</code> are\n      the best ways of dividing the remaining code. To help myself think about\n      it, I use a spreadsheet to quickly illustrate the call hierarchy. </p>\n\n<div class=\"figure \" id=\"LastRecIntroClasses-v2-small-more-legible.png\"><img src=\"class-too-large/LastRecIntroClasses-v2-small-more-legible.png\">\n<p class=\"photoCaption\">Figure 16: Call hierarchy</p>\n</div>\n\n<div class=\"clear\"></div>\n\n<p>This allows me to see that there are THREE self-contained areas of\n      code, not two: <code>User instructions</code>, <code>Gathering file / path info</code> and\n      <code>Debug mode switching code</code>. </p>\n\n<p>I remove the original regions (<a href=\"https://github.com/claresudbery/Reconciliate/commit/4c57927\">commit 4c57927</a>) and replace\n      them with four new regions (<a href=\"https://github.com/claresudbery/Reconciliate/commit/3446a54\">commit 3446a54</a>) \n      <span class=\"foot-ref\"><a href=\"#footnote-commits-not-compulsory\">[4]</a></span>. I rearrange the\n      methods to fit in the new regions, and these will now translate into three\n      new classes: <code>Communicator</code>, <code>PathSetter</code> and\n      <code>DebugModeSwitcher</code> (<code>FileLoader</code> and <code>BudgetingMonthService</code> \n      are not shown on this diagram because they have already been extracted): </p>\n\n<div class=\"figure \" id=\"MasterPlan-part2-darker-text-taller.png\"><img src=\"class-too-large/MasterPlan-part2-darker-text-taller.png\">\n<p class=\"photoCaption\">Figure 17: Identifying final \n      ReconciliationIntro classes</p>\n</div>\n\n<div class=\"clear\"></div>\n\n<p>I create these new classes gradually and safely using the same\n      principles as for <code>BudgetingMonthService</code>, removing the new regions once\n      they've served their purpose (see <a href=\"https://github.com/claresudbery/Reconciliate/commit/7f464a4\">commit 7f464a4</a> to\n      <a href=\"https://github.com/claresudbery/Reconciliate/commit/7e118c1\">commit 7e118c1</a>).</p>\n\n<p>\n        It's worth noting that when extracting new classes from a larger class, \n        I want them to be independent. For this reason\n        I'm deliberately avoiding the anti-pattern which can sometimes arise,\n        where extracted classes are automatically injected as a dependency\n        into the constructor of the original class.\n      </p>\n\n<p>The <code>PathSetter</code> class turns out to be non-trivial - see\n      <a href=\"https://github.com/claresudbery/Reconciliate/commit/2921220\">commit 2921220</a> to <a href=\"https://github.com/claresudbery/Reconciliate/commit/398539a\">commit 398539a</a><span class=\"foot-ref\"><a href=\"#footnote-commits-not-compulsory\">[4]</a></span>. This is due to the\n      currently-slightly-tortuous nature of the path-setting code, something I\n      noticed <a href=\"#one-thing\">at the end of\n      step 3</a>. By extracting this code into a separate class and giving it\n      its own clear <a href=\"https://en.wikipedia.org/wiki/Separation_of_concerns\">context</a>, \n      I'm already making this code a bit better -\n      but it will still need some attention.</p>\n\n<p>Finally, my <code>ReconciliationIntro</code> class is \n      <a href=\"https://github.com/claresudbery/Reconciliate/blob/Refactor-examples/Console/Reconciliation/ReconciliationIntro.cs\">cleaner and simpler</a>, and the\n      original 41 methods have been reduced to three: \n      <code>Start</code>, <code>Reconciliate</code> and\n      <code>Do_matching</code>:</p>\n\n<div class=\"figure \" id=\"Final-ReconciliationIntro-class.png\"><img src=\"class-too-large/Final-ReconciliationIntro-class.png\">\n<p class=\"photoCaption\">Figure 18: Final ReconciliationIntro class</p>\n</div>\n\n<div class=\"clear\"></div>\n</section>\n\n<section id=\"Recap\">\n<h2>Recap</h2>\n\n<aside class=\"sidebar\" id=\"reality\">\n<h2>The reality: Most teams own problematic code</h2>\n\n<p>Note that it's tempting to say, \"But your code only got into this state\n        because you were coding alone, late at night in snatched chunks of spare\n        time. Well-disciplined teams with amazing software engineering practices\n        would never see their code bases get into this state.\" But most teams are not\n        perfect, and most teams find themselves taking shortcuts because of time\n        pressures at some time or other. Sometimes brilliant teams have to handle code\n        written by less-fortunate teams. For whatever reasons, it is likely that most\n        software engineers will find themselves at some point or other having to\n        refactor code that has got out of hand.</p>\n\n<p>I confess I've been nervous about exposing my code base to the public\n        gaze, because clearly it's far from perfect. But this is reality. Even\n        the best coders (and I don't count myself as one of them) will likely \n        have problematic\n        code lurking somewhere on their hard drives.</p>\n</aside>\n\n<p><i>My class was too large</i>. I had developed undesirable coding habits \n      and I wanted\n      to stop and make things better before adding any new functionality.</p>\n\n<p>To fix my too-large class, I took the following actions:</p>\n\n<ul>\n<li><a href=\"#rearrange-methods\">Rearranged methods</a> into\n        sensible groupings, to help identify new classes.</li>\n\n<li><a href=\"#analyse-rels\">Analysed\n        relationships between file-loading methods</a>, so that I could work out\n        how to create a new <code>FileLoader</code> class with minimum coupling\n        with the rest of the code.</li>\n\n<li><a href=\"#modify-staying\">Modified\n        the methods that were staying behind</a>, so that they could be called\n        by those that are moving (if necessary).</li>\n\n<li><a href=\"#covering-tests\">Created covering\n        tests for the new <code>FileLoader</code> class</a>, by creating a new\n        <code>FileLoaderTests</code> class.</li>\n\n<li><a href=\"#create-fileloader\">Created the new\n        <code>FileLoader</code> class and moved two methods</a>.</li>\n\n<li><a href=\"#move-methods\">Moved the other\n        methods to the new <code>FileLoader</code> class</a>.</li>\n\n<li><a href=\"#extract-more-classes\">Extracted more new classes</a>.</li>\n</ul>\n\n<p>I <a href=\"#how\">moved in tiny steps</a>, and I compiled and ran the\n      tests at every step. Now I have a much smaller class which calls\n      functionality from several other also-smaller classes, and each one of \n      them is easier to fit in my head.</p>\n</section>\n\n<section id=\"WhatsNext\">\n<h2>What's next?</h2>\n\n<p>Note that this article ends in the middle of the refactor, so if you\n      want to see the relevant state of the code before moving on to the next\n      steps, you need to \n      <a href=\"https://git-scm.com/docs/git-checkout\">checkout</a> the <a href=\"https://github.com/claresudbery/Reconciliate/commit/6103f0b\">commit 6103f0b</a>.\n      Note also that I completed most of <a href=\"#extract-more-classes\">step 7</a>\n      in this article <i>after</i> that commit (explanation\n      <a href=\"#order\">here</a>).</p>\n\n<p>At <a href=\"https://github.com/claresudbery/Reconciliate/commit/6103f0b\">commit 6103f0b</a>, \n      I've pulled the file-loading code out into the <code>FileLoader</code> class and have\n      a clearer view of the main challenge. \n      The following four methods (visible in situ <a href=\"https://github.com/claresudbery/Reconciliate/blob/6103f0b7076291882a43acca368075135f407498/Console/Reconciliation/Loaders/FileLoader.cs#L111\">here</a>) \n      are clearly problematic:</p>\n\n<ul>\n<li><code>Load_bank_and_bank_in</code></li>\n\n<li><code>Load_bank_and_bank_out</code></li>\n\n<li><code>Load_cred_card1_and_cred_card1_in_out</code></li>\n\n<li><code>Load_cred_card2_and_cred_card2_in_out</code></li>\n</ul>\n\n<p>They have the following problems:</p>\n\n<ul>\n<li>There is a lot of duplication - at a glance, they look identical.</li>\n\n<li>They are way too long.</li>\n\n<li>They create objects internally and pass them into one another in a\n        closely inter-dependent way which is not testable.</li>\n</ul>\n\n<p>These are all problems I want to solve, but before I do any more\n      refactoring I really need some tests around those methods. That's what\n      I'll do next. My desire is to write about it in a follow-up article, \n      but I've learnt better than to make promises about that kind of thing, \n      so for now it's an exercise for the reader.</p>\n</section>\n\n<hr class=\"bodySep\">\n</div>\n\n<div class=\"appendix\">\n<section id=\"Acknowledgements\">\n<h2>Acknowledgements</h2>\n\n<p>Many thanks to the following people, who very kindly read early drafts of this article and \n      contributed invaluable feedback and suggestions: \n      <a href=\"https://twitter.com/paulapaultweets\">Paula Paul</a>, <a href=\"https://twitter.com/martinfowler\">Martin Fowler</a>, \n      <a href=\"https://twitter.com/pritibiyani\">Priti Biyani</a>, <a href=\"https://twitter.com/RNovaglia\">Riccardo Novaglia</a>, \n      <a href=\"https://twitter.com/tastapod\">Dan Terhorst-North</a>, <a href=\"https://twitter.com/KevlinHenney\">Kevlin Henney</a>, \n      <a href=\"https://twitter.com/sf105\">Steve Freeman</a>, <a href=\"https://twitter.com/jonskeet\">Jon Skeet</a>, \n      <a href=\"https://twitter.com/SalFreudenberg\">Sal Freudenberg</a>, <a href=\"https://twitter.com/jr261\">Joe Ray</a>, \n      <a href=\"https://twitter.com/the_sheps\">Chris Shepherd</a>, <a href=\"https://twitter.com/LukeMorton\">Luke Morton</a>, \n      <a href=\"https://www.linkedin.com/in/scott-giminiani/\">Scott Giminiani</a>, <a href=\"https://www.linkedin.com/in/richard-foster-293939163/\">Richard Foster</a>, \n      Marcos Bezerra, <a href=\"https://twitter.com/gwawr_\">Sam Carrington</a>.\n      </p>\n</section>\n\n<div class=\"footnote-list\">\n<h2>Footnotes</h2>\n\n<div class=\"footnote-list-item\" id=\"footnote-tdd\">\n<p><span class=\"num\">1: </span><b>TDD</b> stands for Test-Driven Development, a technique to ensure that all units of code are tested, and that\n      the tests describe the behaviour of the system. This is done by writing the tests <i>before</i> \n      you write the code to make those tests pass. There's a lot more that can be said about it, but it's not \n      the focus of this article. You can read more about it <a href=\"https://martinfowler.com/bliki/TestDrivenDevelopment.html\">here</a>.\n    </p>\n</div>\n\n<div class=\"footnote-list-item\" id=\"footnote-fits-in-my-head\">\n<p><span class=\"num\">2: </span><b>\"Fits In My Head\"</b> is one of the patterns in Dan Terhorst-North's \n      <a href=\"https://leanpub.com/softwarefaster\">Software, Faster book</a> (a work still in progress). \n      He talks about the importance of being able to comprehend any chunk of code\n      by \"fitting it in your head.\"\n      The name came from <a href=\"https://www.thoughtworks.com/profiles/james-lewis\">James Lewis</a>, and Dan describes it \n      <a href=\"https://www.youtube.com/watch?v=XqgwHXsQA1g&amp;feature=youtu.be&amp;t=510\">in this talk</a>, \n      but Dan tells me the concept may have originated with \n      <a href=\"https://neo4j.com/blog/contributor/alistair-jones/\">Alistair Jones</a>.\n    </p>\n</div>\n\n<div class=\"footnote-list-item\" id=\"footnote-refactoring-to-patterns\">\n<p><span class=\"num\">3: </span><b>Refactoring to the strategy pattern:</b> \n      A large part of the aim of this refactoring is to enable use of the \n      <a href=\"https://en.wikipedia.org/wiki/Strategy_pattern\">strategy pattern</a>. The business of \"refactoring to patterns\" \n      has a whole <a href=\"https://www.martinfowler.com/books/r2p.html\">book devoted to it, by Joshua Kerievsky</a> \n      - and is worth a read if you want to know more. Indeed as Martin Fowler says, \"Many people have said \n      they find a refactoring approach to be a better way of learning about patterns, because you see in \n      gradual stages the interplay of problem and solution.\"\n    </p>\n</div>\n\n<div class=\"footnote-list-item\" id=\"footnote-commits-not-compulsory\">\n<p><span class=\"num\">4: </span><b>Commit links:</b> Don't feel obligated to follow the commit links! More on that in the \n      <a href=\"#how-to-read\"><i>How to read this article</i> sidebar</a>.\n    </p>\n</div>\n\n<div class=\"footnote-list-item\" id=\"footnote-resharper\">\n<p><span class=\"num\">5: </span><b>Resharper</b> is a commonly-used Visual Studio extension used for things such\n      as code editing. However it is not free, and is being increasingly eclipsed\n      by native Visual Studio tooling.\n    </p>\n</div>\n</div>\n</div>\n\n<div class=\"appendix\">\n<h2 id=\"SignificantRevisions\">Significant Revisions</h2>\n\n<p><i>14 April 2020: </i>first published</p>\n</div>\n</main>\n\n<nav id=\"bottom-navmenu\" style=\"display: none;\">\n<nav class=\"navmenu\">\n<div class=\"nav-head\">  <div class=\"search\">\n    <!-- SiteSearch Google -->\n    <form method=\"GET\" action=\"https://www.google.com/search\">\n      <input type=\"hidden\" name=\"ie\" value=\"UTF-8\">\n      <input type=\"hidden\" name=\"oe\" value=\"UTF-8\">\n      <input class=\"field\" type=\"text\" name=\"q\" size=\"15\" maxlength=\"255\" value=\"\">\n      <button class=\"button\" type=\"submit\" name=\"btnG\" value=\" \" title=\"Search\">\n      <input type=\"hidden\" name=\"domains\" value=\"martinfowler.com\">\n      <input type=\"hidden\" name=\"sitesearch\" value=\"\"> \n      <input type=\"hidden\" name=\"sitesearch\" value=\"martinfowler.com\">\n    \n  </button></form></div>\n\n<div class=\"closediv\">\n<span class=\"close\" title=\"close\"></span>\n</div>\n</div>\n\n<div class=\"nav-body\">\n<div class=\"topics\">\n<h2>Topics</h2>\n\n<p><a href=\"/architecture\">Architecture</a></p>\n\n<p><a href=\"https://refactoring.com\">Refactoring</a></p>\n\n<p><a href=\"/agile.html\">Agile</a></p>\n\n<p><a href=\"/delivery.html\">Delivery</a></p>\n\n<p><a href=\"/microservices\">Microservices</a></p>\n\n<p><a href=\"/data\">Data</a></p>\n\n<p><a href=\"/testing\">Testing</a></p>\n\n<p><a href=\"/dsl.html\">DSL</a></p>\n</div>\n\n<div class=\"about\">\n<h2>about me</h2>\n\n<p><a href=\"/aboutMe.html\">About</a></p>\n\n<p><a href=\"/books\">Books</a></p>\n\n<p><a href=\"/faq.html\">FAQ</a></p>\n</div>\n\n<div class=\"content\">\n<h2>content</h2>\n\n<p><a href=\"/videos.html\">Videos</a></p>\n\n<p><a href=\"/tags\">Content Index</a></p>\n\n<p><a href=\"/articles/eurogames\">Board Games</a></p>\n\n<p><a href=\"/photos\">Photography</a></p>\n</div>\n\n<div class=\"tw\">\n<h2>ThoughtWorks</h2>\n\n<p><a href=\"https://thoughtworks.com/insights\">Insights</a></p>\n\n<p><a href=\"https://thoughtworks.com/careers\">Careers</a></p>\n\n<p><a href=\"https://thoughtworks.com/products\">Products</a></p>\n</div>\n\n<div class=\"feeds\">\n<h2>follow</h2>\n\n<p><a href=\"https://www.twitter.com/martinfowler\">Twitter</a></p>\n\n<p><a href=\"/feed.atom\">RSS</a></p>\n</div>\n</div>\n</nav>\n</nav>\n<footer id=\"page-footer\">\n<div class=\"tw-logo\">\n<a href=\"http://www.thoughtworks.com\">\n<img src=\"/tw-white-300.png\">\n</a>\n</div>\n<div class=\"menu-button\">\n<div class=\"icon-bars navmenu-button\"></div>\n</div>\n<div class=\"copyright\">\n<p>© Martin Fowler | <a href=\"http://www.thoughtworks.com/privacy-policy\">Privacy Policy</a> | <a href=\"/aboutMe.html#disclosures\">Disclosures</a></p>\n</div>\n</footer>\n<!-- Google Analytics -->\n<script>\nwindow.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;\nga('create', 'UA-17005812-1', 'auto');\nga('send', 'pageview');\n</script>\n<script async=\"\" src=\"https://www.google-analytics.com/analytics.js\"></script>\n<!-- End Google Analytics -->\n\n\n\n<script src=\"/jquery-1.11.3.min.js\" type=\"text/javascript\"></script>\n\n<script src=\"/mfcom.js\" type=\"text/javascript\"></script>\n\n\n","text":" \nRefactoring\nAgile\nArchitecture\nAbout\nThoughtWorks\nRefactoring: This class is too large\n\nAn example of refactoring from a real (flawed) code base.\n\nIn this article I walk through a set of refactorings from a real code base. This is not intended to demonstrate perfection, but it does represent reality.\n\n14 April 2020\n\nClare Sudbery\n\nWriter, speaker, asker of questions and enthusiast of Extreme Programming - Clare is an ex high school maths teacher and a consultant with 20 years of software engineering experience. She is on a mission to awaken the inner geek in people everywhere - particularly those not traditionally encouraged to geek out.\n\nCONTENTS\nOutline of the problem\nWhy refactor?\nHow do I do it?\n1. Rearrange methods\n2. Analyse relationships between file-loading methods\nPlan of action\n3. Modify the methods that are staying behind\n4. Create covering tests for the new FileLoader class\n5. Create new FileLoader class and move two methods\n6. Move the other methods to the new FileLoader class\n7. Extract more new classes\nRecap\nWhat's next?\nSIDEBARS\nLanguage and approach\nC#\nTest-driven development\nHow to avoid getting here in the first place\nHow to read this article\nPrinciple: Always commit moves and renames separately from edits.\nAbbreviated method names\nPrinciple: Do one thing at a time. Focus!\nAutomated refactorings\nA note on member variables\nA note on the order of the commits\nThe reality: Most teams own problematic code\n\nThis is a story about refactoring. It's the third item in the TDD red-green-refactor cycle[1] and it's the thing we do all the time, right? Except when we don't.\n\nI have an unruly code base which has suffered from refactoring neglect, so I've been bringing it back into line. In this article I will take a class that is too large, and make it smaller.\n\nLanguage and approach\nC#\n\nI generally write code in whatever language suits the client, the project and the problem at hand. But the majority of my career has been in the .Net space, so C# is my comfort zone and my default go-to. The examples in this article are written in C#, but I hope the code snippets included are simple enough to follow even if you don't know the language.\n\nTest-driven development\n\nI'm a big fan of Test-Driven Development (TDD) [1], and the code presented here was mostly written using that approach. But I have to confess that after 20 years as an engineer, I have at least half a career of bad habits behind me and I don't always get things right.\n\nOutline of the problem\n\nThe story begins with a boring domestic chore. I've written some personal accounting software - Reconciliate. It works on the command line and performs the following actions:\n\nLoads my own comma-separated data:\nMy record of recent bank and credit card transactions.\nMy predicted monthly and annual transactions (based on data in a central spreadsheet).\nAny unreconciled previously-recorded data.\nLoads third-party comma-separated data (from bank and credit card companies).\nReconciles the third-party data against my own data.\nWrites everything back to a central spreadsheet.\n\nI have some bugs that need fixing and some features to add. But my typical workflow is to arrive at the laptop late at night after putting my youngest to bed, with only a small amount of time before it will be my bedtime, and often a few weeks after the last time I saw the code. In these circumstances it's horribly easy to think things like, \"Well I know this code is a mess, but I don't have time to get my head round it and fix it now...\"\n\nClearly this is not ideal.\n\nThere's one class in particular - the ReconciliationIntro class - which is giving me a headache whenever I look at it. It's bloated and convoluted and impossible to fit in my head [2]. This has created a nasty feedback loop: \"Because this code is so hard to reason about, refactoring will take more time and energy than I have, so I'll put up with it even longer - even though it means I can't even make small changes any more because it takes so long for me to understand the code's current state and decide where the change should go.\"\n\nFor instance, I want to add the ability to handle another credit card. In a lot of places I've used polymorphism and the strategy pattern to keep the unique behaviour of each credit card neatly encapsulated. But the ReconciliationIntro class is one place where, because of the poor design of the code and the lack of clear context separation, if I add another credit card I'll be making an already bloated class even worse. It contains four duplicated code paths for each of four types of data (Bank In, Bank Out, Credit Card 1 and Credit Card 2), and if I add Credit Card 3 right now I'll end up following the same anti-pattern.\n\nMy overall aim is to replace this code with more generic code, via the strategy pattern [3]. But there are four problems standing in my way:\n\nThis one large class, (ReconciliationIntro), is taking too much responsibility.\nThere's a lot of private nested code, which is hard to unit-test because it has no public interface.\nWithin ReconciliationIntro, there's one large method that's doing too much.\nThere are several methods in ReconciliationIntro which use the same repeated pattern but with different details.\n\nI plan to fix all of these problems, in the order listed above. This preparatory refactoring will get me to the point where I can easily encapsulate the behaviour of each credit card / account. As Kent Beck says, \"Make the change easy, then make the easy change.\"\n\nThis article is about tackling the first problem in the above list: This class is too large.\n\nWhy refactor?\n\nI can't easily reason about the ReconciliationIntro class because it has too many responsibilities. It was originally designed as the entrance hall to the software, and all it did was display a few messages and then instantiate the classes that do the main work. But over time a lot of other code has snuck in. I want to make it easier to add another credit card, so I'm going to start by breaking this large class into smaller classes.\n\nThe benefits will be several:\n\nBy moving groups of methods into separate classes I'll create clear contexts and minimise tight coupling. This means that:\nI'll know where to go when I want to make changes or fix issues.\nWhen I amend the code, I'll only have to work with small isolated sections that fit in my head [2] - I won't have to understand the whole system.\nAny manipulation of state will only happen locally in a small context - so I won't have to worry about one area of the system changing state in another.\nHow to avoid getting here in the first place\n\nCould I have avoided being in this position? Yes, of course. Rather than despairing about a lack of time, I could have made small continuous changes whenever I encountered problem areas. That's part of what the refactor stage of the red-green-refactor cycle is for, and it's a habit you can reinstate at any time.\n\nBut it's worth acknowledging that when coding under pressure, you're not always in a fit state to make the right choices. Your code can quickly reach a level of crustiness that makes a refactor feel insurmountable. At these times it's always worth using small changes to make things better piece by piece, no matter what state your code is in.\n\nHow do I do it?\n\nTo my mind, the most important principle when refactoring (and when writing new code) is to move in tiny steps. I have several connected aims:\n\nAt every step, I want the code to compile and the tests to run.\nIf a change causes any tests to fail, I want to be able to fix them instantly. By making small changes and small commits, I can see which change caused the tests to fail and I only need to rewind / examine a small amount of code to find the problem.\nI can keep track of where I am in in my head. It's horribly easy to embark on a relatively simple refactor, only to find it has repercussions beyond your original intention. At this point, if you're not in the habit of keeping the code compiling and the tests passing at every step, you can find yourself lost in a rabbit hole that's difficult to exit: Your code isn't compiling and your tests aren't even running, let alone passing.\n\nFor this to work, I need the code being refactored to be covered by tests. This has already been done before I start refactoring, although it's worth noting that one of my aims in a future refactoring will be to make the code even more testable.\n\nRefactoring, by Martin Fowler is a recommended further read and lays out some basic refactoring principles. He also emphasises the value of moving in tiny steps and building the code / running your tests after every small commit.\n\nBeyond these basic principles, I'll aim to follow a logical series of steps which are outlined below.\n\nHow to read this article\n\nThis is a real code base and a messy code base (hence the refactoring), so there's a lot of code. For those who want to know more, I do link to the code repeatedly. But I've deliberately kept the descriptions high-level, and you don't need to follow those links.\n\n1. Rearrange methods\n\nI'll start by using regions to rearrange all the methods in the ReconciliationIntro class into sensible groupings (commit f2d9932) [4]:\n\nFigure 1: ReconciliationIntro after methods rearranged into regions\n\nPrinciple: Always commit moves and renames separately from edits.\n\nIt's important that I move code around like this as a separate task and in a separate commit, without editing the code in any way. When you rearrange methods, the resulting code difference will include many added/deleted chunks of code. If the code has been changed as well as moved, you can't easily tell whether lines have been deleted or moved, and whether moved lines are the same or different. As Dan Terhorst-North says, \"A change should be structural or behavioural, but never both.\"\n\nFigure 2: What a commit looks like when you've moved code around\n\nNow that I've grouped my methods into what feels like a reasonable set of contexts, I'd like to pull these out into separate classes. But where to start? The file loading code contains the most duplication, and is causing the most pain. Ultimately I want to make this code more generic, but first I want to pull it out so I can see it without distraction. I'll extract a new FileLoader class. The other groupings will also become separate classes but they'll be a lot simpler, so I'll focus most of this article on the file-loading code.\n\nAbbreviated method names\n\nThe naming of anything - from methods to pubs to children - is a notoriously difficult enterprise. My tendency to verbosity is as evident in my method names as it is in the longwinded stories you'll hear if you meet me in a pub. Before refactoring, the duplication of code meant that method names were being used to differentiate between contexts - and this resulted in some long names. To avoid gigantic images I've abbreviated names in most of the diagrams, as follows:\n\nBBI: bank_and_bank_in (\"bank\" and \"bank_in\" represent two different views - the bank's, and my own)\nBBO: bank_and_bank_out (\"bank\" and \"bank_out\" as with \"bank\" and \"bank_in\" above)\nCC1: cred_card1_and_cred_card1_in_out (\"cred_card1\" and \"cred_card1_in_out\" as with \"bank\" and \"bank_in\" above)\nCC2: cred_card2_and_cred_card2_in_out (as with \"cred_card1\" above)\nMerge_bd: Merge_bespoke_data\nBM: budgeting_months\nccds: credit_card_debits\nwpf: with_pending_file\nCC: cred_card\nDDs: direct_debits\n\n2. Analyse relationships between file-loading methods\n\nSo far all I've done is move some code around in the same class. I rebuilt the code and ran all the tests before I committed, but unless I was clumsy I'd expect my previous commit to be trivial. I need to be a little more thoughtful about what I do next.\n\nI've used one of my regions to identify methods to pull out into a new FileLoader class, but how can I be sure this will work? Are there any hidden dependencies? I'll discover this by drawing out the relationships between the methods I want to move. The ones to be moved are marked in blue.\n\nFigure 3: File-loading methods to be moved (abbreviations)\n\nI can see straight away that it's not a strictly self-contained context: Some of the blue methods are calling back out to methods (shown in black and green) that I want to keep in a separate class. There are a couple of ways I could handle this, which I discuss below. But now I'm at a place where I can define a plan of action.\n\nPlan of action\n\nBy the time I'm done, the original large ReconciliationIntro class will have been broken down into the pared-down version plus five new classes shown in the diagram below. Note that there isn't a one-to-one mapping between regions and classes, because later on when I reach step 7, I'll end up refining my first groupings into some finer-grained boundaries.\n\nFigure 4: Plan of action\n\nMy overall aim is to break this large class down into smaller classes. In steps 1 and 2 above, I used regions and a diagram to identify distinct areas of code and then analyse relationships between some of the methods. That gave me enough information to start thinking about how I can tackle this job in tiny steps.\n\nThe resulting plan is summarised below and then described in detail further down. I reached this plan by thinking about how I could proceed using steps that were as small as possible. Often what I'm doing is setting things up so that the next change will be as small and simple as possible. I'm making small changes to facilitate more small changes - yet again following Kent Beck's dictum to \"Make the change easy, then make the easy change.\"\n\nDepending on your circumstances you might not follow the same plan, but it's not a bad template if you're not sure how to proceed. Your priority is to set yourself up for safe incremental changes:\n\nRearrange methods\n\nGroup all the methods in the class into sensible groupings, as described above.\n\nAnalyse relationships between file-loading methods\n\nIdentify how the file-loading code is connected to the rest of the code in the ReconciliationIntro class, as described above.\n\nModify the methods that are staying behind\n\nThere are methods which will stay in the parent class but are currently called by those that are moving. Some modification will be required to make this work.\n\nCreate covering tests for the new FileLoader class\n\nThe new FileLoader class needs to be covered by tests. The tests for the code to be moved already exist, but they'll be moved into a new FileLoaderTests class.\n\nCreate new FileLoader class and move two methods\n\nFollowing the principle of tiny steps, I'll move just two methods (a public method and a private method called by it) before I move the rest.\n\nMove the other methods to the new FileLoader class\n\nThis is where it gets exciting. All that file-loading code I'm interested in will finally get a new home!\n\nExtract more new classes\n\nOnce I've dealt with the file-loading code, I'll create some more new classes for the other code regions.\n\nThe new FileLoader class will be responsible for loading various sources of comma-separated data and merging them ready for reconciliation. This file-loading code is where most of the pain currently lies, so that's the bit I'll describe in the most detail. You can see the original code before refactoring here, but if you follow that link all you'll learn is that it's too big to fit in your head! The slimmed down post-refactor version is here.\n\nSo, now I can continue with the plan:\n\n3. Modify the methods that are staying behind\n\nI've identified two methods - Set_path and Recursively_ask_for_budgeting_months - which are called by file-loading methods:\n\nFigure 5: Methods called by file-loading methods (abbreviations)\n\nAs long as those methods are not too tightly coupled with the file-loading class, I can either\n\nMake them public so I can call back to them from the new FileLoader class.\nMove the calls out of the file-loading code and into other native ReconciliationIntro methods instead.\n\nI'll use the first approach for Recursively_ask_for_budgeting_months and the second for Set_path, which will bring me to the following situation:\n\nFigure 6: File-loading methods after moving (abbreviations)\n\nNote that the methods marked as FileLoader methods in the diagram will still be in the ReconciliationIntro class at the end of this step, but this will enable me to move them into the FileLoader class, which will happen in step 5 and step 6 below.\n\nRecursively_ask_for_budgeting_months will eventually be a public method in another class, but for now I just want to make sure I can call it from elsewhere. It turns out it already is public, which was done so that it could be tested. This in itself is a code smell - it's a sign that it would be better off as part of the public interface of a separate class.\n\nThe other method called from the file-loading code is Set_path. This changes the value of an internal path variable, so I'll choose option 2: I'll call it separately and pass the resulting data into the file-loading method via a parameter.\n\nPrinciple: Do one thing at a time. Focus!\n\nIn the process of editing Set_path, I've noticed a couple of other changes I want to make.\n\nFirstly, Set_path has the side effect of altering the _path member variable. It would be better if it was self-contained and just returned a new path.\n\nSecondly, currently Set_path is being called in two places - just before Create_pending_csvs is called, and much lower down in the chain of events, from within another method called Set_path_and_file_names. If I follow the chain of different methods involved here, I realise they're not called in a sensible order and there's a lot of redundancy. The code is hard to follow, and it would be tempting to refactor it now.\n\nBut I'm in the middle of another refactoring, so I make a note (on my Trello board) and leave these changes for later. Otherwise I'll get distracted from the task at hand and could get the code into a strange state and lose track of what I'm doing. Focus is important!\n\nNote that these might not normally stay as separate commits (I could use micro-commits and then squash them into larger commits), but I'm keeping the small commits intact to make the steps clear. I compile and run the tests at every step:\n\nModify the calling method (Create_pending_csvs) so that it takes a parameter, but initially give it a default value (commit acc3519) [4] so that the code still compiles:\n\nprivate void Create_pending_csvs()\n{\n  // Some code\n}\n\n⇓\nprivate void Create_pending_csvs(string path = \"\")\n{\n  // Some code\n}\n\n\nCall Set_path separately before calling Create_pending_csvs. Take the resulting new _path member variable (see sidebar), and pass it into Create_pending_csvs (commit c5ebc2f) [4]:\n\ncase \"1\":\n{\n  Create_pending_csvs();\n}\nbreak;\n\n⇓\ncase \"1\":\n{\n  Set_path();\n  Create_pending_csvs(_path);\n}\nbreak;\n\n\nRemove the call to Set_path from within Create_pending_csvs, and use the passed-in value instead of the member variable (commit 6df8f97) [4]:\n\nprivate void Create_pending_csvs(string path = \"\")\n{\n  try\n  {\n    Set_path();\n    var pending_csv_file_creator = new PendingCsvFileCreator(_path);\n\n⇓\nprivate void Create_pending_csvs(string path = \"\")\n{\n  try\n  {\n    Set_path();\n    var pending_csv_file_creator = new PendingCsvFileCreator(path);\n\n\nFinally, remove the default value from the Create_pending_csvs parameter - thereby forcing all clients to pass a value in (commit 2be56ea) [4]. Note that by doing things in this order, I keep the code compiling at all times:\n\nprivate void Create_pending_csvs(string path = \"\")\n{\n  // Some code\n}\n\n⇓\nprivate void Create_pending_csvs(string path = \"\")\n{\n  // Some code\n}\n\n4. Create covering tests for the new FileLoader class\n\nMy first choice of method to move will be Bank_and_bank_out_ _Merge_bespoke_data_with_pending_file. And the first thing I want to do is copy any covering tests into a new test class for the about-to-be-created FileLoader class. There is already one test for this method - M_MergeBespokeDataWithPendingFile_ WillAddMostRecentCredCardDirectDebits - and its job is to make sure this method merges new direct debit data correctly with a 'pending' file (which is being built to contain all new transaction data).\n\nNote that I'm only moving tests, not writing new ones. People can get so used to the TDD [1] concept of writing tests before writing code that they assume you need to write new tests whenever you work on code. This is often not the case when refactoring. Ideally my functionality will already be covered by tests, and when refactoring I'm not changing the functionality. So instead of writing new tests, I'm using the existing ones to verify the functionality still works as originally intended.\n\nThis is a good time to review this test: It's a while since I wrote it, so I should be able to spot quickly whether it makes sense. I want my tests to be clear and easy to read - they should act as documentation for my system behaviour. The first thing I notice is that it contains an assert method - Assert_direct_debit_details_are_correct - whose name is inadequate. What is the definition of \"correct\"? I rewrite the test to make it easier to read, which involves quite a lot of changes. In the interest of keeping this a digestible read I won't go into the changes made, but you can view them in commit f090f26 and commit 6a6cece. [4]\n\nNow that I've refactored the test I'll copy it into a new test class, along with some associated private helper methods. Note that although this and other tests are destined to operate on a new FileLoader class, they'll still act on the old ReconciliationIntro class until I'm sure my new test class has everything it needs. Also note that until everything is safely moved, my test code is duplicated.\n\nAutomated refactorings\n\nIt's worth being aware that there are many automatable refactoring tasks which require significantly more care when tools like Resharper [5] are not available.\n\nFor instance, with Resharper you can quickly and confidently rename a method that has clients throughout a large code base. But without this tool, such a change might be handled differently - for instance by creating a temporary wrapper method.\n\nI first create the new test class in the same file as the original (commit 491c795) [4], so that it's easy to see what I'm copying. Then I can get Resharper [5] and Visual Studio to move everything into a new file for me (commit c9317c0) [4].\n\nFigure 7: Move BBO tests\n\n5. Create new FileLoader class and move two methods\n\nNow that my test class is up and running, I can create the new FileLoader class.\n\nThe method that's furthest down the chain - the lowest leaf in my tree of methods - is Bank_and_bank_out__ Add_most_recent_credit_card_direct_debits. This is a private method with no independent tests (it's tested via the public calling method), so I'm going to move both it and its caller (Bank_and_bank_out__ Merge_bespoke_data_with_pending_file). These will be the first two methods to be moved into my new class.\n\nAgain, I'll move in baby steps to avoid my tests going red and keep my code building at all times. After each of the following steps I make sure the code builds and the tests are passing.\n\nThis is the situation I begin with. A FileLoaderTests class has been created, but it is testing code that still lives in the ReconciliationIntro class:\n\nFigure 8: New FileLoader class part 1 (abbreviations)\n\nI start by creating a new FileLoader class. One of my file-loading methods (Bank_and_bank_out__ Add_most_recent_credit_card_direct_debits) is private, and will also be private at the end of this process. It will only ever be called by the method that's about to follow it into the new class. It's not individually covered by tests, so I can just copy it over to the new class and have it ready and waiting when its caller is moved (see commit 0341476) [4]. But I will need to make it temporarily public:\n\nFigure 9: New FileLoader class part 2 (abbreviations)\n\nNow I can create an instance of my new FileLoader class in the ReconciliationIntro class and call its new public method, instead of the old private method. I can also delete the old private method (see commit bde2ae2) [4]:\n\nFigure 10: New FileLoader class part 3 (abbreviations)\n\nCopy the original caller into the new class (see commit f0a5a59) [4]. Note that at this point it's duplicated:\n\nFigure 11: New FileLoader class part 4 (abbreviations)\n\nChange the object I'm testing from being a ReconciliationIntro instance to being a new FileLoader instance. Point the tests at the new copy of the original caller. Note that because the private method it calls has also been copied, my tests will pass (see commit 3d573e3) [4]:\n\nFigure 12: New FileLoader class part 5 (abbreviations)\n\nNow I can call the original caller directly from the ReconciliationIntro class (see commit 77c0b14) [4]:\n\nFigure 13: New FileLoader class part 6 (abbreviations)\n\nMake the originally-private method private again, and delete the original caller. I'll delete the old test class too, as all its tests have now been duplicated in FileLoaderTests. (see commit 27f1a59) [4]:\n\nFigure 14: New FileLoader class part 7 (abbreviations)\n\n6. Move the other methods to the new FileLoader class\n\nNow I can move all the other methods. I'll handle them one by one, starting with the simplest and keeping an eye out for dependencies (between methods, and on any member data). I'll need to consider the following:\n\nDo I want to rename any methods?\nDo I want to replace any parameter lists with new objects?\nAre there any redundant parameters?\nAre any of the internal nested callees altering state? What impact does this have?\n\nI could inline those lower down in the chain before moving them, but if I did I'd break the tests which call them as public methods. So instead I move them on their own. I do it in the order explained below, acting on one at a time and starting with those at the end of the chain - ie the outermost leaves on the following tree:\n\nFigure 15: FileLoader method tree (abbreviations)\n\nFor each one, I use the following approach:\n\nCreate a copy of the method in the destination class, keeping the original in place. Make the new method public.\nCall the new method instead of the original.\nCopy any covering tests into the new test class, and make sure they test the new code.\nDelete the old method and the old tests.\n\nI already moved Bank_and_bank_out__ Merge_bespoke_data_with_pending_file and Bank_and_bank_out__ Add_most_recent_credit_card_direct_debits (commit 0341476 to commit 27f1a59), so now I repeat the same actions for each of the other methods (commit 7cd53f6 to commit 7ab95f2) [4]. I don't commit every tiny step this time, but I still go through the same set of steps. After each step, I make sure the code builds and the tests are passing (apart from when I deliberately make a test fail).\n\nI refactored some tests earlier, and I can repeat those changes for tests that follow the same pattern. For some methods the move is very simple, because they have no test coverage. This is part of why I'm doing this refactor, to make that code more easily testable.\n\nA note on member variables\n\nThe four load methods (Load_bank_and_bank_in, etc) are all using two member variables from ReconciliationIntro: _input_output and _spreadsheet_factory. So when these methods are added to FileLoader, I need to introduce these variables as members in FileLoader too, by injecting them into the constructor. _input_output is already being injected, but when I introduce _spreadsheet_factory I initially give it a default value. This is so the code will still build, and is done before I switch over to using the new methods. This way I can fix all the places that need to inject a spreadsheet factory into FileLoader at my leisure.\n\nSee commit ce559f2 and commit 7e86292 for the actual code changes [4], but here is a simplification focusing only on the relevant parts:\n\ninternal class ReconciliationIntro\n{\n    private readonly IInputOutput _input_output;\n\n    public ReconciliationInterface Load_correct_files()\n    {\n        Load_bank_and_bank_in(); \n    }\n\n    public ReconciliationInterface Load_bank_and_bank_in() \n    {\n        var file_loader = new FileLoader(_input_output);\n        file_loader.Load_bank_and_bank_in();\n    }\n}\n\ninternal class FileLoader\n{\n    private readonly IInputOutput _input_output;\n\n    public FileLoader(IInputOutput input_output)\n    {\n        _input_output = input_output;\n    }\n\n    public ReconciliationInterface Load_bank_and_bank_in() \n    {\n        _input_output.Output_line(\"Some text\");\n    }\n}\n\n⇓\n// Still compiles, because ISpreadsheetRepoFactory object has default value in constructor.\n\ninternal class FileLoader\n{\n    private readonly IInputOutput _input_output;\n    private readonly ISpreadsheetRepoFactory _spreadsheet_factory;\n\n    public FileLoader(\n        IInputOutput input_output, \n        ISpreadsheetRepoFactory spreadsheet_factory = null)\n    {\n        _input_output = input_output;\n        _spreadsheet_factory = spreadsheet_factory;\n    }\n\n    public ReconciliationInterface Load_bank_and_bank_in() \n    {\n        var pending_file_io = new FileIO<BankRecord>(_spreadsheet_factory);\n        _input_output.Output_line(\"Some text\");\n    }\n}\n\n⇓\n// Now ReconciliationIntro can inject member vars into FileLoader and it will all work.\n// Other clients aren't injecting yet, but some time soon we'll amend them all.\n// Finally after that we can remove the default value from the FileLoader constructor.\n\ninternal class ReconciliationIntro\n{\n    private readonly IInputOutput _input_output;\n    private readonly ISpreadsheetRepoFactory _spreadsheet_factory;\n\n    public ReconciliationInterface Load_correct_files()\n    {\n        var file_loader = new FileLoader(_input_output, _spreadsheet_factory);\n        file_loader.Load_bank_and_bank_in(); \n    }\n}\n\n7. Extract more new classes\nA note on the order of the commits\n\nMy main motivation for this refactoring is to remove duplication and introduce a strategy pattern [3] for the four data types in the file loading code. This means that if you look at the commits you'll see that after extracting the FileLoader class, I moved on to other things. But when I came back to write up this article, I couldn't bear to leave the ReconciliationIntro class in its still-bloated state, so I got on with extracting the rest of the classes - starting from commit 3446a54.\n\nWhen adding regions at the start, I identified some Get budgeting months functionality which creates its own clear context, so I extract these methods out into a new BudgetingMonthService class. This is very quick and simple because these methods only have one public entry point (see commit 6103f0b) [4].\n\nReconciliationIntro is still too big, but the methods all call one another and now that I've spent more time refamiliarising myself with the code I'm not convinced my two remaining regions of User Instructions and Input and Debug Spreadsheet Operations are the best ways of dividing the remaining code. To help myself think about it, I use a spreadsheet to quickly illustrate the call hierarchy.\n\nFigure 16: Call hierarchy\n\nThis allows me to see that there are THREE self-contained areas of code, not two: User instructions, Gathering file / path info and Debug mode switching code.\n\nI remove the original regions (commit 4c57927) and replace them with four new regions (commit 3446a54) [4]. I rearrange the methods to fit in the new regions, and these will now translate into three new classes: Communicator, PathSetter and DebugModeSwitcher (FileLoader and BudgetingMonthService are not shown on this diagram because they have already been extracted):\n\nFigure 17: Identifying final ReconciliationIntro classes\n\nI create these new classes gradually and safely using the same principles as for BudgetingMonthService, removing the new regions once they've served their purpose (see commit 7f464a4 to commit 7e118c1).\n\nIt's worth noting that when extracting new classes from a larger class, I want them to be independent. For this reason I'm deliberately avoiding the anti-pattern which can sometimes arise, where extracted classes are automatically injected as a dependency into the constructor of the original class.\n\nThe PathSetter class turns out to be non-trivial - see commit 2921220 to commit 398539a[4]. This is due to the currently-slightly-tortuous nature of the path-setting code, something I noticed at the end of step 3. By extracting this code into a separate class and giving it its own clear context, I'm already making this code a bit better - but it will still need some attention.\n\nFinally, my ReconciliationIntro class is cleaner and simpler, and the original 41 methods have been reduced to three: Start, Reconciliate and Do_matching:\n\nFigure 18: Final ReconciliationIntro class\n\nRecap\nThe reality: Most teams own problematic code\n\nNote that it's tempting to say, \"But your code only got into this state because you were coding alone, late at night in snatched chunks of spare time. Well-disciplined teams with amazing software engineering practices would never see their code bases get into this state.\" But most teams are not perfect, and most teams find themselves taking shortcuts because of time pressures at some time or other. Sometimes brilliant teams have to handle code written by less-fortunate teams. For whatever reasons, it is likely that most software engineers will find themselves at some point or other having to refactor code that has got out of hand.\n\nI confess I've been nervous about exposing my code base to the public gaze, because clearly it's far from perfect. But this is reality. Even the best coders (and I don't count myself as one of them) will likely have problematic code lurking somewhere on their hard drives.\n\nMy class was too large. I had developed undesirable coding habits and I wanted to stop and make things better before adding any new functionality.\n\nTo fix my too-large class, I took the following actions:\n\nRearranged methods into sensible groupings, to help identify new classes.\nAnalysed relationships between file-loading methods, so that I could work out how to create a new FileLoader class with minimum coupling with the rest of the code.\nModified the methods that were staying behind, so that they could be called by those that are moving (if necessary).\nCreated covering tests for the new FileLoader class, by creating a new FileLoaderTests class.\nCreated the new FileLoader class and moved two methods.\nMoved the other methods to the new FileLoader class.\nExtracted more new classes.\n\nI moved in tiny steps, and I compiled and ran the tests at every step. Now I have a much smaller class which calls functionality from several other also-smaller classes, and each one of them is easier to fit in my head.\n\nWhat's next?\n\nNote that this article ends in the middle of the refactor, so if you want to see the relevant state of the code before moving on to the next steps, you need to checkout the commit 6103f0b. Note also that I completed most of step 7 in this article after that commit (explanation here).\n\nAt commit 6103f0b, I've pulled the file-loading code out into the FileLoader class and have a clearer view of the main challenge. The following four methods (visible in situ here) are clearly problematic:\n\nLoad_bank_and_bank_in\nLoad_bank_and_bank_out\nLoad_cred_card1_and_cred_card1_in_out\nLoad_cred_card2_and_cred_card2_in_out\n\nThey have the following problems:\n\nThere is a lot of duplication - at a glance, they look identical.\nThey are way too long.\nThey create objects internally and pass them into one another in a closely inter-dependent way which is not testable.\n\nThese are all problems I want to solve, but before I do any more refactoring I really need some tests around those methods. That's what I'll do next. My desire is to write about it in a follow-up article, but I've learnt better than to make promises about that kind of thing, so for now it's an exercise for the reader.\n\nAcknowledgements\n\nMany thanks to the following people, who very kindly read early drafts of this article and contributed invaluable feedback and suggestions: Paula Paul, Martin Fowler, Priti Biyani, Riccardo Novaglia, Dan Terhorst-North, Kevlin Henney, Steve Freeman, Jon Skeet, Sal Freudenberg, Joe Ray, Chris Shepherd, Luke Morton, Scott Giminiani, Richard Foster, Marcos Bezerra, Sam Carrington.\n\nFootnotes\n\n1: TDD stands for Test-Driven Development, a technique to ensure that all units of code are tested, and that the tests describe the behaviour of the system. This is done by writing the tests before you write the code to make those tests pass. There's a lot more that can be said about it, but it's not the focus of this article. You can read more about it here.\n\n2: \"Fits In My Head\" is one of the patterns in Dan Terhorst-North's Software, Faster book (a work still in progress). He talks about the importance of being able to comprehend any chunk of code by \"fitting it in your head.\" The name came from James Lewis, and Dan describes it in this talk, but Dan tells me the concept may have originated with Alistair Jones.\n\n3: Refactoring to the strategy pattern: A large part of the aim of this refactoring is to enable use of the strategy pattern. The business of \"refactoring to patterns\" has a whole book devoted to it, by Joshua Kerievsky - and is worth a read if you want to know more. Indeed as Martin Fowler says, \"Many people have said they find a refactoring approach to be a better way of learning about patterns, because you see in gradual stages the interplay of problem and solution.\"\n\n4: Commit links: Don't feel obligated to follow the commit links! More on that in the How to read this article sidebar.\n\n5: Resharper is a commonly-used Visual Studio extension used for things such as code editing. However it is not free, and is being increasingly eclipsed by native Visual Studio tooling.\n\nSignificant Revisions\n\n14 April 2020: first published\n\n© Martin Fowler | Privacy Policy | Disclosures"}

{"l":"https://crdt.tech/","n":"Conflict-free Replicated Data Type (CRDT)","html":"\n    <header>\n    <nav class=\"js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar\">\n        <a class=\"navbar-brand\" href=\"/\">\n            <span class=\"navbar-logo\"><img src=\"/assets/img/crdt-lattice.png\" width=\"30\" height=\"30\"></span>\n            <span class=\"font-weight-bold\">Conflict-free Replicated Data Types</span>\n        </a>\n        <div class=\"td-navbar-nav-scroll ml-md-auto\" id=\"main_navbar\">\n                <ul class=\"navbar-nav mt-2 mt-lg-0\">\n                        <li class=\"nav-item mr-4 mb-2 mb-lg-0\">\n                            <a class=\"nav-link\" href=\"https://github.com/ept/crdt-website\" target=\"_blank\"><span>GitHub</span></a>\n                        </li>\n                </ul>\n        </div>\n      \n    </nav>\n</header>\n\n    <div class=\"container-fluid td-outer\">\n      <div class=\"td-main\">\n        <div class=\"row flex-lg-nowrap\">\n          <div class=\"col-12 col-md-3 col-lg-2 td-sidebar d-print-none\">\n          <div id=\"td-sidebar-menu\" class=\"td-sidebar__inner\">  \n  <nav class=\"td-sidebar-nav pt-2 pl-4\" id=\"td-section-nav\">\n<ul class=\"td-sidebar-nav__section pr-md-3\">\n  <li class=\"td-sidebar-nav__section-title\">\n    <a href=\"/\" class=\"align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section\">About CRDTs</a>\n  </li><ul>\n    <li id=\"about-crdts\">\n        <ul class=\"td-sidebar-nav__section pr-md-3\">\n          <li class=\"td-sidebar-nav__section-title\">\n            <a href=\"/resources\" class=\"align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section\">Resources</a>\n          </li>\n          <ul><li id=\"\"></li></ul>\n          <li class=\"td-sidebar-nav__section-title\">\n            <a href=\"/papers.html\" class=\"align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section\">Papers</a>\n          </li>\n          <ul><li id=\"\"></li></ul>\n          <li class=\"td-sidebar-nav__section-title\">\n            <a href=\"/implementations\" class=\"align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section\">Implementations</a>\n          </li>\n          <ul><li id=\"\"></li></ul>\n          <li class=\"td-sidebar-nav__section-title\">\n            <a href=\"/glossary\" class=\"align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section\">CRDT Glossary</a>\n          </li>\n          <ul><li id=\"\"></li></ul>\n          <li class=\"td-sidebar-nav__section-title\">\n            <a href=\"/community\" class=\"align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section\">Community</a>\n          </li>\n          <ul><li id=\"\"></li></ul>\n    </ul>\n  </li></ul></ul></nav>\n</div>\n\n          </div>\n          <div class=\"d-none d-lg-block col-lg-2 td-toc d-print-none\">\n              <div class=\"td-page-meta ml-2 pb-1 pt-2 mb-0\">\n                  <a href=\"https://github.com/ept/crdt-website/edit/master/pages/index.md\" target=\"_blank\"><i class=\"fa fa-edit fa-fw\"></i> Edit this page</a>\n<a href=\"https://github.com/ept/crdt-website/issues/new?body=Issue%20on%3a%20https://github.com/ept/crdt-website/tree/master/pages/index.md\" target=\"_blank\"><i class=\"fab fa-github fa-fw\"></i> Create issue</a>\n\n              </div>\n              <nav id=\"TableOfContents\"><ul>\n              <li><ul id=\"TOC\">\n                <!-- Links will be appended here-->\n              <li id=\"link_about-crdts\" class=\"md-nav__item\"><a class=\"md-nav__link\" href=\"#about-crdts\" title=\"About CRDTs\">About CRDTs</a><nav class=\"md-nav\"><ul class=\"md-nav__list\"></ul></nav></li></ul></li>\n              </ul></nav>\n          </div>\n          <main class=\"col-12 col-md-9 col-lg-8 pl-md-5\" role=\"main\">\n            <div class=\"td-content\">\n              <p><img src=\"/assets/img/crdt-logo.png\" style=\"width: 100%; max-width: 700px\"></p>\n\n<h1 id=\"about-crdts\">About CRDTs<a class=\"headerlink\" style=\"color:red\" href=\"#about-crdts\" title=\"Permanent link\">¶</a></h1>\n\n<p>A <strong>Conflict-free Replicated Data Type</strong> (CRDT) is a data structure that\nsimplifies distributed data storage systems and multi-user applications.</p>\n\n<p>In many systems, copies of some data need to be stored on multiple computers\n(known as <strong>replicas</strong>). Examples of such systems include:</p>\n\n<ul>\n  <li>Mobile apps that store data on the local device, and that need to sync that\ndata to other devices belonging to the same user (such as calendars, notes,\ncontacts, or reminders);</li>\n  <li>Distributed databases, which maintain multiple replicas of the data (in the\nsame datacenter or in different locations) so that the system continues\nworking correctly if some of the replicas are offline;</li>\n  <li>Collaboration software, such as Google Docs, Trello, Figma, or many others, in\nwhich several users can concurrently make changes to the same file or data;</li>\n  <li>Large-scale data storage and processing systems, which replicate data in order\nto achieve global scalability.</li>\n</ul>\n\n<p>All such systems need to deal with the fact that the data may be concurrently\nmodified on different replicas. Broadly speaking, there are two possible ways of\ndealing with such data modifications:</p>\n\n<dl>\n  <dt>Strongly consistent replication:</dt>\n  <dd>In this model, the replicas coordinate with each other to decide when and how\nto apply the modifications. This approach enables strong consistency models\nsuch as serializable transactions and linearizability. However, waiting for\nthis coordination reduces the performance of these systems; moreover, the CAP\ntheorem tells us that it is impossible to make any data changes on a replica\nwhile it is disconnected from the rest of the system (e.g. due to a network\npartition, or because it is a mobile device with intermittent connectivity).</dd>\n  <dt>Optimistic replication:</dt>\n  <dd>In this model, users may modify the data on any replica independently of any\nother replica, even if the replica is offline or disconnected from the others.\nThis approach enables maximum performance and availability, but it can lead to\nconflicts when multiple clients or users concurrently modify the same piece of\ndata. These conflicts then need to be resolved when the replicas communicate\nwith each other.</dd>\n</dl>\n\n<p>Conflict-free Replicated Data Types (CRDTs) are used in systems with optimistic\nreplication, where they take care of conflict resolution. CRDTs ensure that, no\nmatter what data modifications are made on different replicas, the data can\nalways be merged into a consistent state. This merge is performed automatically\nby the CRDT, without requiring any special conflict resolution code or user\nintervention.</p>\n\n<p>For more details on CRDTs, you can read the article\n“<a href=\"https://arxiv.org/pdf/1805.06358.pdf\">Conflict-free Replicated Data Types</a>”\nby Nuno Preguiça, Carlos Baquero, and Marc Shapiro (2018), or the older\n“<a href=\"https://hal.inria.fr/inria-00555588/document\">A comprehensive study of Convergent and Commutative Replicated Data Types</a>”\nby Marc Shapiro, Nuno Preguiça, Carlos Baquero, and Marek Zawirski (2011).</p>\n\n<script src=\"https://code.jquery.com/jquery-3.3.1.min.js\" integrity=\"sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=\" crossorigin=\"anonymous\"></script>\n\n<script>\n$(document).ready(function() {\n\n    var toc = $('#TOC');\n\n    // Select each header\n    sections = $('.td-content h1');\n        $.each(sections, function(idx, v) {\n            section = $(v);\n            var div_id = $(section).attr('id');\n            var div_text = section.text().split('¶')[0];\n            var parent = $(\"#\" + div_id)\n            var content = '<li id=\"link_' + div_id + '\" class=\"md-nav__item\"><a class=\"md-nav__link\" href=\"#' + div_id + '\" title=\"' + div_text +'\">' + div_text +'</a></li>';\n            $(toc).append(content);\n\n            // Add section code to subnavigation\n            var children = $('<nav class=\"md-nav\"><ul class=\"md-nav__list\"></nav></ul>')\n            var contenders = $(\"#\" + div_id).nextUntil(\"h1\");\n            $.each(contenders, function(idx, contender){\n               if($(contender).is('h2') || $(contender).is('h3')) {\n                   var contender_id = $(contender).attr('id');\n                   var contender_text = $(contender).text().split('¶')[0];\n                   var content = '<li class=\"md-nav__item\"><a class=\"md-nav__link\" href=\"#' + contender_id + '\" title=\"' + contender_text +'\">' + contender_text +'</a></li>';\n                   children.append(content);\n                }\n             })\n             $(\"#link_\" + div_id).append(children);\n        });\n    });\n</script>\n\n<script>\nvar headers = [\"h1\", \"h2\", \"h3\", \"h4\"]\nvar colors = [\"red\", \"orange\", \"green\", \"blue\"]\n\n$.each(headers, function(i, header){\n    var color = colors[i];\n    $(header).each(function () {\n        var href=$(this).attr(\"id\");\n        $(this).append('<a class=\"headerlink\" style=\"color:' + color + '\" href=\"#' + href + '\" title=\"Permanent link\">¶</a>')\n    });\n})\n</script>\n\n\n\n\n              \n              <br>\n\n\n           </div>\n          </main>\n        </div>\n      </div>\n      <footer class=\"bg-dark pt-3 row d-print-none\">\n  <div class=\"container-fluid mx-sm-5\">\n    <div class=\"row\">\n      <div class=\"col-6 col-sm-4 text-xs-center order-sm-2\">\n        \n\n</div>\n<div class=\"col-6 col-sm-4 text-right text-xs-center order-sm-3\">\n<ul class=\"list-inline mb-0\">  \n  <li class=\"list-inline-item mx-2 h3\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"\" aria-label=\"GitHub\" data-original-title=\"GitHub\">\n    <a class=\"text-white\" target=\"_blank\" href=\"https://github.com/ept/crdt-website\">\n      <i class=\"fab fa-github\"></i>\n    </a>\n  </li>\n</ul>\n</div>\n<div class=\"col-12 col-sm-4 text-center py-2 order-sm-2\">\n  <small class=\"text-white\">\n    This site is maintained by Martin Kleppmann, Annette Bieniusa, and Marc Shapiro.\n    If you find any problems or want to add something, please\n    <a href=\"https://github.com/ept/crdt-website/issues/new\">open an issue or PR</a>.\n    The theme is based on <a href=\"https://vsoch.github.io/docsy-jekyll/\">Docsy Jekyll</a>.\n  </small>\n  \n      </div>\n    </div>\n  </div>\n</footer>\n\n    </div>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js\" integrity=\"sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49\" crossorigin=\"anonymous\"></script>\n<script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js\" integrity=\"sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy\" crossorigin=\"anonymous\"></script>\n<script src=\"/assets/js/main.js\"></script>\n\n  \n\n","text":" Conflict-free Replicated Data Types\nGitHub\nAbout CRDTs\nResources\nPapers\nImplementations\nCRDT Glossary\nCommunity\n\nAbout CRDTs¶\n\nA Conflict-free Replicated Data Type (CRDT) is a data structure that simplifies distributed data storage systems and multi-user applications.\n\nIn many systems, copies of some data need to be stored on multiple computers (known as replicas). Examples of such systems include:\n\nMobile apps that store data on the local device, and that need to sync that data to other devices belonging to the same user (such as calendars, notes, contacts, or reminders);\nDistributed databases, which maintain multiple replicas of the data (in the same datacenter or in different locations) so that the system continues working correctly if some of the replicas are offline;\nCollaboration software, such as Google Docs, Trello, Figma, or many others, in which several users can concurrently make changes to the same file or data;\nLarge-scale data storage and processing systems, which replicate data in order to achieve global scalability.\n\nAll such systems need to deal with the fact that the data may be concurrently modified on different replicas. Broadly speaking, there are two possible ways of dealing with such data modifications:\n\nStrongly consistent replication:\nIn this model, the replicas coordinate with each other to decide when and how to apply the modifications. This approach enables strong consistency models such as serializable transactions and linearizability. However, waiting for this coordination reduces the performance of these systems; moreover, the CAP theorem tells us that it is impossible to make any data changes on a replica while it is disconnected from the rest of the system (e.g. due to a network partition, or because it is a mobile device with intermittent connectivity).\nOptimistic replication:\nIn this model, users may modify the data on any replica independently of any other replica, even if the replica is offline or disconnected from the others. This approach enables maximum performance and availability, but it can lead to conflicts when multiple clients or users concurrently modify the same piece of data. These conflicts then need to be resolved when the replicas communicate with each other.\n\nConflict-free Replicated Data Types (CRDTs) are used in systems with optimistic replication, where they take care of conflict resolution. CRDTs ensure that, no matter what data modifications are made on different replicas, the data can always be merged into a consistent state. This merge is performed automatically by the CRDT, without requiring any special conflict resolution code or user intervention.\n\nFor more details on CRDTs, you can read the article “Conflict-free Replicated Data Types” by Nuno Preguiça, Carlos Baquero, and Marc Shapiro (2018), or the older “A comprehensive study of Convergent and Commutative Replicated Data Types” by Marc Shapiro, Nuno Preguiça, Carlos Baquero, and Marek Zawirski (2011).\n\n\n\nThis site is maintained by Martin Kleppmann, Annette Bieniusa, and Marc Shapiro. If you find any problems or want to add something, please open an issue or PR. The theme is based on Docsy Jekyll."}

{"l":"https://enterprisecraftsmanship.com/posts/when-to-mock/","n":"When to mock","html":"<div class=\"sumo-form-wrapper welcome-mat-popup\"><div class=\"welcome-mat-popup-content sumome-wysiwyg-responsive-format-default\" style=\"top: 0px;\"><div class=\"sumome-react-wysiwyg-grid\"><div class=\"sumome-react-wysiwyg-popup-animation-group\"><span><div class=\"sumome-animated-undefined sumome-react-wysiwyg-popup-container sumome-react-wysiwyg-welcome-mat sumome-react-wysiwyg-is-resizing\" style=\"width: 0px; height: 0px;\"><link href=\"https://fonts.googleapis.com/css?family=Lato:900,900italic,800,800italic,700,700italic,600,600italic,500,500italic,400,400italic,300,300italic,200,200italic,100,100italic\" rel=\"stylesheet\" type=\"text/css\"><div class=\"sumome-react-wysiwyg-component sumome-react-wysiwyg-outside-horizontal-resize-handles sumome-react-wysiwyg-outside-vertical-resize-handles sumome-react-wysiwyg-welcome-mat-gridRow sumome-react-wysiwyg-gridRow\" style=\"left: 0px; top: 0px; width: 0px; height: 0px; position: absolute;\"><div class=\"sumome-react-wysiwyg-move-handle sumome-react-wysiwyg-component-is-drag-disabled\" style=\"size: 4px; height: 100%;\"><div class=\"sumome-wysiwyg-gridRow-contents\" style=\"position: absolute; top: 0px; left: 0px; bottom: 0px; right: 0px;\"><div class=\"sumome-react-wysiwyg-component sumome-react-wysiwyg-outside-horizontal-resize-handles sumome-react-wysiwyg-outside-vertical-resize-handles sumome-react-wysiwyg-welcome-mat-gridColumn sumome-react-wysiwyg-gridColumn sumome-gridColumn-small-12\" style=\"left: 0px; top: 0px; width: 0px; height: 0px; position: absolute;\"><div class=\"sumome-react-wysiwyg-move-handle sumome-react-wysiwyg-component-is-drag-disabled\" style=\"size: 4px; height: 100%;\"><div class=\"sumome-wysiwyg-gridColumn-contents sumome-react-wysiwyg-content-align-center\" style=\"position: absolute; top: 0px; left: 0px; bottom: 0px; right: 0px;\"><div class=\"sumome-react-wysiwyg-component sumome-react-wysiwyg-welcome-mat-scaledStage sumome-react-wysiwyg-scaledStage\" style=\"left: 0px; top: 0px; width: 500px; height: 500px; position: absolute; transform: scale(1.2);\"><div class=\"sumome-react-wysiwyg-move-handle sumome-react-wysiwyg-component-is-drag-disabled\" style=\"size: 6px; height: 100%;\"><div class=\"sumome-wysiwyg-scaledStage-contents\" style=\"width: 500px; height: 500px;\"><div class=\"sumome-react-wysiwyg-component sumome-react-wysiwyg-welcome-mat-button sumome-react-wysiwyg-button\" style=\"left: 61px; top: 250px; width: 185px; height: 36px; position: absolute;\"><div class=\"sumome-react-wysiwyg-move-handle\" style=\"size: 24px; height: 100%;\"><div style=\"padding: 0px; margin: 0px; display: block; width: 100%; height: 100%; position: relative; overflow: hidden; z-index: 0; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px; border-color: rgb(0, 0, 0); border-style: solid; border-radius: 4px; border-width: 0px;\"><button style=\"color: rgb(255, 255, 255); background-color: rgba(47, 141, 123, 0.75); font-family: Lato, sans-serif; font-weight: 400; font-style: normal; font-size: 16px; line-height: 1.5; text-shadow: rgba(0, 0, 0, 0) 0px 0px 0px; padding: 0px; margin: 0px; display: block; width: 100%; height: 100%; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px inset; cursor: pointer;\">I'm In!</button></div></div></div><div class=\"sumome-react-wysiwyg-component sumome-react-wysiwyg-welcome-mat-text sumome-react-wysiwyg-text\" style=\"left: 0px; top: 93px; width: 500px; position: absolute;\"><div class=\"sumome-react-wysiwyg-move-handle\" style=\"size: 25px; height: 100%;\"><div role=\"button\" tabindex=\"0\"><p style=\"color: rgb(46, 54, 57); background-color: rgba(0, 0, 0, 0); font-family: Lato, sans-serif; font-weight: 700; font-style: normal; font-size: 28px; text-align: center; border-width: 0px; border-color: rgb(0, 0, 0); border-style: solid; border-radius: 0px; line-height: 1; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px, rgba(0, 0, 0, 0) 0px 0px 0px inset; text-shadow: rgba(0, 0, 0, 0) 0px 0px 0px; padding: 0px; margin: 0px; letter-spacing: normal;\">5 Unit Testing Mistakes</p></div></div></div><div class=\"sumome-react-wysiwyg-component sumome-react-wysiwyg-welcome-mat-text sumome-react-wysiwyg-text\" style=\"left: 0px; top: 139px; width: 500px; position: absolute;\"><div class=\"sumome-react-wysiwyg-move-handle\" style=\"size: 25px; height: 100%;\"><div role=\"button\" tabindex=\"0\"><p style=\"color: rgb(94, 94, 94); background-color: rgba(0, 0, 0, 0); font-family: Lato, sans-serif; font-weight: 400; font-style: normal; font-size: 18px; text-align: center; border-width: 0px; border-color: rgb(0, 0, 0); border-style: solid; border-radius: 0px; line-height: 1.5; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px, rgba(0, 0, 0, 0) 0px 0px 0px inset; text-shadow: rgba(0, 0, 0, 0) 0px 0px 0px; padding: 0px; margin: 0px; letter-spacing: normal;\">Take the free 5-day class</p></div></div></div><div class=\"sumome-react-wysiwyg-component sumome-react-wysiwyg-welcome-mat-textField sumome-react-wysiwyg-textField\" style=\"left: 60px; top: 186px; width: 380px; height: 40px; position: absolute;\"><div class=\"sumome-react-wysiwyg-move-handle\" style=\"size: 29px; height: 100%;\"><div><div></div><input type=\"text\" value=\"\" name=\"email\" spellcheck=\"false\" placeholder=\"Enter your best email\" autocomplete=\"off\" style=\"color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); font-family: Lato, sans-serif; font-weight: 400; font-style: normal; font-size: 14px; text-align: center; border-width: 1px; border-color: rgb(204, 204, 204); border-style: solid; border-radius: 3px; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px, rgba(0, 0, 0, 0) 0px 0px 0px inset; text-shadow: rgba(0, 0, 0, 0) 0px 0px 0px; padding: 0px 14px; margin: 0px; display: block; width: 100%; max-height: 52px; height: 40px; transition: none 0s ease 0s;\"></div></div></div><div class=\"sumome-react-wysiwyg-component sumome-react-wysiwyg-welcome-mat-button sumome-react-wysiwyg-button\" style=\"left: 255px; top: 250px; width: 185px; height: 36px; position: absolute;\"><div class=\"sumome-react-wysiwyg-move-handle\" style=\"size: 24px; height: 100%;\"><div style=\"padding: 0px; margin: 0px; display: block; width: 100%; height: 100%; position: relative; overflow: hidden; z-index: 0; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px; border-color: rgb(0, 0, 0); border-style: solid; border-radius: 4px; border-width: 0px;\"><button style=\"color: rgb(255, 255, 255); background-color: rgb(155, 155, 155); font-family: Lato, sans-serif; font-weight: 400; font-style: normal; font-size: 16px; line-height: 1.5; text-shadow: rgba(0, 0, 0, 0) 0px 0px 0px; padding: 0px; margin: 0px; display: block; width: 100%; height: 100%; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px inset; cursor: pointer;\">No Thanks</button></div></div></div><div class=\"sumome-react-wysiwyg-component sumome-react-wysiwyg-close-button sumome-react-wysiwyg-welcome-mat-image sumome-react-wysiwyg-image\" style=\"left: 234px; top: 440px; width: 32px; height: 32px; position: absolute;\"><div class=\"sumome-react-wysiwyg-move-handle\" style=\"size: 18px; height: 100%;\"><div style=\"position: relative; width: 100%; height: 100%; overflow: hidden; z-index: 0; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px; border-color: rgb(0, 0, 0); border-style: solid; border-radius: 0px; border-width: 0px; cursor: pointer;\"><div class=\"sumome-react-svg-image-container\" style=\"background-color: rgba(255, 255, 255, 0); fill: rgb(247, 80, 115); padding: 0px; margin: 0px; display: block; position: absolute; left: 0px; top: 0px; width: 100%; height: 100%; background-size: cover; background-position: center center; background-repeat: no-repeat;\"><svg xmlns=\"http://www.w3.org/2000/svg\" id=\"Layer_1\" data-name=\"Layer 1\" viewBox=\"0 0 46 46\" preserveAspectRatio=\"none\" style=\"height: 100%; width: 100%; position: absolute; top: 0; left: 0;\"><title>close</title><path d=\"M23,32a2,2,0,0,1-1.41-.59l-10.5-10.5a2,2,0,0,1,2.83-2.83L23,27.17l9.09-9.09a2,2,0,0,1,2.83,2.83l-10.5,10.5A2,2,0,0,1,23,32Z\"></path><path d=\"M23,2A21,21,0,1,1,2,23,21,21,0,0,1,23,2m0-2A23,23,0,1,0,46,23,23,23,0,0,0,23,0Z\"></path></svg></div><div style=\"position: absolute; top: 0px; left: 0px; bottom: 0px; right: 0px; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px inset;\"></div></div></div></div></div></div></div><div class=\"sumome-react-wysiwyg-component sumome-react-wysiwyg-welcome-mat-background sumome-react-wysiwyg-background\" style=\"left: 0px; top: 0px; width: 100%; height: 100%; position: absolute;\"><div class=\"sumome-react-wysiwyg-move-handle\" style=\"size: 15px; height: 100%;\"><div style=\"position: relative; width: 100%; height: 100%; overflow: hidden; z-index: 0; box-shadow: rgb(252, 248, 245) 0px 0px 0px; border-color: rgb(255, 255, 255); border-style: solid; border-width: 8px 0px 0px;\"><div style=\"background-color: rgb(252, 248, 245); fill: rgb(0, 0, 0); padding: 0px; margin: 0px; display: block; background-image: url(&quot;//media.sumo.com/b5e7e9cea65ab0a65984f90679f4006f5de6277e0e46ee9e4fafbf4a3396d5eb&quot;); position: absolute; left: 0px; top: 0px; width: 100%; height: 100%; background-size: cover; background-position: center center; background-repeat: no-repeat;\"></div><div style=\"position: absolute; top: 0px; left: 0px; bottom: 0px; right: 0px; box-shadow: rgb(252, 248, 245) 0px 0px 0px inset;\"></div></div></div></div></div></div></div></div></div></div></div></span></div></div></div></div>\n    \t\t<nav class=\"nav\">\n\t\t\t<div class=\"nav-container\">\n\t\t\t\t<a href=\"/\">\n\t\t\t\t\t<h2 class=\"nav-title\">Enterprise Craftsmanship</h2>\n\t\t\t\t</a>\n\t\t\t\t<ul>\n    <li><a href=\"/posts\">Blog</a></li>\n    <li><a href=\"/book\">Unit Testing Book</a></li>\n    <li><a href=\"/online-training\">Online Courses</a></li>\n    <li><a href=\"/about\">About</a></li>\n    <li><a href=\"/archives\">Archives</a></li>\n</ul>\n\t\t\t</div>\n\t\t</nav>\n\n    <div class=\"container\">\n\t  \n\t  <div class=\"row\">\n\t    <div class=\"col-md-9 mainbar\">\n          \n\n<main>\n\t<div class=\"post\">\n\t\t<h1 class=\"post-title\">When to Mock</h1>\n<div class=\"post-line\"></div>\n\n\t\t<div class=\"post-info\">\n\t<time datetime=\"2020-04-15 00:00:00 +0000 UTC\">April 15, 2020</time>\n</div>\n\n\n\t\t<div class=\"paragraph\">\n<p>The use of mocks in unit testing is a controversial topic (maybe less so now than several years ago). I remember how, throughout my programming career, I went from mocking almost every dependency, to the \"no-mocks\" policy, and then to \"only mock external dependencies\".</p>\n</div>\n<div class=\"paragraph\">\n<p>None of this practices are good enough. In this article, I’ll show you which dependencies to mock, and which to use as is in your tests.</p>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_what_is_a_mock\">What is a mock?</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Before jumping to the topic of when to mock, let’s discuss what a mock is.</p>\n</div>\n<div class=\"sidebarblock\">\n<div class=\"content\">\n<div class=\"title\">Mock vs test double</div>\n<div class=\"paragraph\">\n<p>People often use the terms <em>test double</em> and <em>mock</em> as synonyms, but technically, they are not:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>A <strong>test double</strong> is an overarching term that describes all kinds of non-production-ready, fake dependencies in tests. Such a dependency looks and behaves like its release-intended counterpart but is actually a simplified version that reduces complexity and facilitates testing.</p>\n<div class=\"paragraph\">\n<p>This term was introduced by Gerard Meszaros in his book <a href=\"https://www.amazon.com/xUnit-Test-Patterns-Refactoring-Code/dp/0131495054\">xUnit Test Patterns: Refactoring Test Code</a>. The name itself comes from the notion of a stunt double in movies.</p>\n</div>\n</li>\n<li>\n<p>A <strong>mock</strong> is just one kind of such dependencies.</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>According to Gerard Meszaros, there are 5 types of test doubles:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Dummy</p>\n</li>\n<li>\n<p>Stub</p>\n</li>\n<li>\n<p>Spy</p>\n</li>\n<li>\n<p>Mock</p>\n</li>\n<li>\n<p>Fake</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>Such a variety may look intimidating, but in reality, they can all be grouped together into just two types: mocks and stubs.</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/2020/2020-04-13-mocks-and-stubs.png\" alt=\"2020 04 13 mocks and stubs\">\n</div>\n<div class=\"title\">All variations of test doubles can be categorized into two types: mocks and stubs</div>\n</div>\n<div class=\"paragraph\">\n<p>The difference between these two types boils down to the following:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Mocks help to emulate and examine <strong>outcoming</strong> interactions. These interactions are calls the system under test (SUT) makes to its dependencies to change their state.</p>\n</li>\n<li>\n<p>Stubs help to emulate <strong>incoming</strong> interactions. These interactions are calls the SUT makes to its dependencies to get input data.</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>For example, sending an email is an outcoming interaction: that interaction results in a side effect in the SMTP server. A test double emulating such an interaction is a mock.</p>\n</div>\n<div class=\"paragraph\">\n<p>Retrieving data from the database is an incoming interaction — it doesn’t result in a side effect. The corresponding test double is a stub.</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/2020/2020-04-13-incoming-outcoming.png\" alt=\"2020 04 13 incoming outcoming\">\n</div>\n<div class=\"title\">Mocks are for outcoming interaction; stubs — for incoming</div>\n</div>\n<div class=\"paragraph\">\n<p>All other differences between the five types of test doubles are insignificant implementation details:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><strong>Spies</strong> serve the same role as mocks. The distinction is that spies are written manually, whereas mocks are created with the help of a mocking framework. Sometimes people refer to spies as <strong>handwritten mocks</strong>.</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>On the other hand, the difference between stubs, dummies, and fakes is in how intelligent they are:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>A <strong>dummy</strong> is a simple, hard-coded value such as a <code>null</code> value or a made-up string. It’s used to satisfy the SUT’s method signature and doesn’t participate in producing the final outcome.</p>\n</li>\n<li>\n<p>A <strong>stub</strong> is more sophisticated. It’s a fully fledged dependency that you configure to return different values for different scenarios.</p>\n</li>\n<li>\n<p>A <strong>fake</strong> is the same as a stub for most purposes. The difference is in the rationale for its creation: a fake is usually implemented to replace a dependency that doesn’t yet exist.</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>Notice the difference between mocks and stubs (aside from outcoming versus incoming interactions). Mocks help to <strong>emulate and examine</strong> interactions between the SUT and its dependencies, while stubs only help to <strong>emulate</strong> those interactions. This is an important distinction. You will see why shortly.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_mock_the_tool_vs_mock_the_test_double\">Mock-the-tool vs. mock-the-test-double</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>The term <em>mock</em> is overloaded and can mean different things in different circumstances. I mentioned already that people often use this term to mean any test double, whereas mocks are only a subset of test doubles.</p>\n</div>\n<div class=\"paragraph\">\n<p>But there’s another meaning for the term <em>mock</em>. You can refer to the classes from mocking libraries as mocks, too. These classes help you create actual mocks, but they themselves are not mocks per se:</p>\n</div>\n<div class=\"paragraph\">\n\n\n\n\n\n\n<div class=\"highlight\"><pre class=\"chroma\"><code class=\"language-csharp\" data-lang=\"csharp\"><span class=\"na\">[Fact]</span>\n<span class=\"k\">public</span> <span class=\"k\">void</span> <span class=\"n\">Sending_a_greetings_email</span><span class=\"p\">()</span>\n<span class=\"p\">{</span>\n    <span class=\"c1\">// Using a mock-the-tool to create a mock-the-test-double\n</span><span class=\"c1\"></span>    <span class=\"kt\">var</span> <span class=\"n\">mock</span> <span class=\"p\">=</span> <span class=\"k\">new</span> <span class=\"n\">Mock</span><span class=\"p\">&lt;</span><span class=\"n\">IEmailGateway</span><span class=\"p\">&gt;();</span>\n    <span class=\"kt\">var</span> <span class=\"n\">sut</span> <span class=\"p\">=</span> <span class=\"k\">new</span> <span class=\"n\">Controller</span><span class=\"p\">(</span><span class=\"n\">mock</span><span class=\"p\">.</span><span class=\"n\">Object</span><span class=\"p\">);</span>\n\n    <span class=\"n\">sut</span><span class=\"p\">.</span><span class=\"n\">GreetUser</span><span class=\"p\">(</span><span class=\"s\">\"user@email.com\"</span><span class=\"p\">);</span>\n\n    <span class=\"c1\">// Examining the call from the SUT to the test double\n</span><span class=\"c1\"></span>    <span class=\"n\">mock</span><span class=\"p\">.</span><span class=\"n\">Verify</span><span class=\"p\">(</span>\n        <span class=\"n\">x</span> <span class=\"p\">=&gt;</span> <span class=\"n\">x</span><span class=\"p\">.</span><span class=\"n\">SendGreetingsEmail</span><span class=\"p\">(</span><span class=\"s\">\"user@email.com\"</span><span class=\"p\">),</span>\n        <span class=\"n\">Times</span><span class=\"p\">.</span><span class=\"n\">Once</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n\n</div>\n<div class=\"paragraph\">\n<p>This test uses the <code>Mock</code> class from the <a href=\"https://github.com/moq/moq4\">Moq mocking library</a>. This class is a tool that enables you to create a test double — a mock. In other words, the class <code>Mock</code> (or <code>Mock&lt;IEmailGateway&gt;</code>) is a <em>mock-the-tool</em>, while the instance of that class, <code>mock</code>, is a <em>mock-the-test-double</em>.</p>\n</div>\n<div class=\"paragraph\">\n<p>It’s important not to conflate a mock-the-tool with a mock-the-test-double because you can use a mock-the-tool to create both types of test doubles: mocks and stubs.</p>\n</div>\n<div class=\"paragraph\">\n<p>Here’s another example of a test that uses the <code>Mock</code> class. The instance of that class is a stub, not mock:</p>\n</div>\n<div class=\"paragraph\">\n\n\n\n\n\n\n<div class=\"highlight\"><pre class=\"chroma\"><code class=\"language-csharp\" data-lang=\"csharp\"><span class=\"na\">[Fact]</span>\n<span class=\"k\">public</span> <span class=\"k\">void</span> <span class=\"n\">Creating_a_report</span><span class=\"p\">()</span>\n<span class=\"p\">{</span>\n    <span class=\"c1\">// Using a mock-the-tool to create a stub\n</span><span class=\"c1\"></span>    <span class=\"kt\">var</span> <span class=\"n\">stub</span> <span class=\"p\">=</span> <span class=\"k\">new</span> <span class=\"n\">Mock</span><span class=\"p\">&lt;</span><span class=\"n\">IDatabase</span><span class=\"p\">&gt;();</span>\n    <span class=\"c1\">// Setting up a canned answer\n</span><span class=\"c1\"></span>    <span class=\"n\">stub</span><span class=\"p\">.</span><span class=\"n\">Setup</span><span class=\"p\">(</span><span class=\"n\">x</span> <span class=\"p\">=&gt;</span> <span class=\"n\">x</span><span class=\"p\">.</span><span class=\"n\">GetNumberOfUsers</span><span class=\"p\">()).</span><span class=\"n\">Returns</span><span class=\"p\">(</span><span class=\"m\">10</span><span class=\"p\">);</span>\n    <span class=\"kt\">var</span> <span class=\"n\">sut</span> <span class=\"p\">=</span> <span class=\"k\">new</span> <span class=\"n\">Controller</span><span class=\"p\">(</span><span class=\"n\">stub</span><span class=\"p\">.</span><span class=\"n\">Object</span><span class=\"p\">);</span>\n\n    <span class=\"n\">Report</span> <span class=\"n\">report</span> <span class=\"p\">=</span> <span class=\"n\">sut</span><span class=\"p\">.</span><span class=\"n\">CreateReport</span><span class=\"p\">();</span>\n\n    <span class=\"n\">Assert</span><span class=\"p\">.</span><span class=\"n\">Equal</span><span class=\"p\">(</span><span class=\"m\">10</span><span class=\"p\">,</span> <span class=\"n\">report</span><span class=\"p\">.</span><span class=\"n\">NumberOfUsers</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n\n</div>\n<div class=\"paragraph\">\n<p>This test double emulates an incoming interaction — a call that provides the SUT with input data.</p>\n</div>\n<div class=\"paragraph\">\n<p>On the other hand, in the previous example, the call to <code>SendGreetingsEmail()</code> is an outcoming interaction. Its sole purpose is to incur a side effect — send an email.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_don_t_assert_interactions_with_stubs\">Don’t assert interactions with stubs</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>As I mentioned above, mocks help to <strong>emulate and examine</strong> outcoming interactions between the SUT and its dependencies, while stubs only help to <strong>emulate</strong> incoming interactions, <strong><em>not</em></strong> examine them.</p>\n</div>\n<div class=\"paragraph\">\n<p>The difference between the two stems from this guideline: <mark>you should never assert interactions with stubs</mark>. A call from the SUT to a stub is not part of the end result the SUT produces. Such a call is only a means to produce the end result; it’s an implementation detail. Asserting interactions with stubs is a common anti-pattern that leads to brittle tests.</p>\n</div>\n<div class=\"paragraph\">\n<p>The only way to avoid test brittleness is to make those tests verify the end result (which, ideally, should be meaningful to a non-programmer), not implementation details.</p>\n</div>\n<div class=\"paragraph\">\n<p>In the above examples, the check</p>\n</div>\n<div class=\"paragraph\">\n\n\n\n\n\n\n<div class=\"highlight\"><pre class=\"chroma\"><code class=\"language-csharp\" data-lang=\"csharp\"><span class=\"n\">mock</span><span class=\"p\">.</span><span class=\"n\">Verify</span><span class=\"p\">(</span><span class=\"n\">x</span> <span class=\"p\">=&gt;</span> <span class=\"n\">x</span><span class=\"p\">.</span><span class=\"n\">SendGreetingsEmail</span><span class=\"p\">(</span><span class=\"s\">\"user@email.com\"</span><span class=\"p\">))</span>\n</code></pre></div>\n\n</div>\n<div class=\"paragraph\">\n<p>corresponds to an actual outcome, and that outcome is meaningful to a domain expert: sending a greetings email is something business people would want the system to do.</p>\n</div>\n<div class=\"paragraph\">\n<p>At the same time, the call to <code>GetNumberOfUsers()</code> is not an outcome at all. It’s an internal implementation detail regarding how the SUT gathers data necessary for the report creation. Therefore, asserting this call would lead to test fragility. It doesn’t matter how the SUT generates the end result, as long as that result is correct.</p>\n</div>\n<div class=\"paragraph\">\n<p>Here’s an example of such a fragile test:</p>\n</div>\n<div class=\"paragraph\">\n\n\n\n\n\n\n<div class=\"highlight\"><pre class=\"chroma\"><code class=\"language-csharp\" data-lang=\"csharp\"><span class=\"na\">[Fact]</span>\n<span class=\"k\">public</span> <span class=\"k\">void</span> <span class=\"n\">Creating_a_report</span><span class=\"p\">()</span>\n<span class=\"p\">{</span>\n    <span class=\"kt\">var</span> <span class=\"n\">stub</span> <span class=\"p\">=</span> <span class=\"k\">new</span> <span class=\"n\">Mock</span><span class=\"p\">&lt;</span><span class=\"n\">IDatabase</span><span class=\"p\">&gt;();</span>\n    <span class=\"n\">stub</span><span class=\"p\">.</span><span class=\"n\">Setup</span><span class=\"p\">(</span><span class=\"n\">x</span> <span class=\"p\">=&gt;</span> <span class=\"n\">x</span><span class=\"p\">.</span><span class=\"n\">GetNumberOfUsers</span><span class=\"p\">()).</span><span class=\"n\">Returns</span><span class=\"p\">(</span><span class=\"m\">10</span><span class=\"p\">);</span>\n    <span class=\"kt\">var</span> <span class=\"n\">sut</span> <span class=\"p\">=</span> <span class=\"k\">new</span> <span class=\"n\">Controller</span><span class=\"p\">(</span><span class=\"n\">stub</span><span class=\"p\">.</span><span class=\"n\">Object</span><span class=\"p\">);</span>\n\n    <span class=\"n\">Report</span> <span class=\"n\">report</span> <span class=\"p\">=</span> <span class=\"n\">sut</span><span class=\"p\">.</span><span class=\"n\">CreateReport</span><span class=\"p\">();</span>\n\n    <span class=\"n\">Assert</span><span class=\"p\">.</span><span class=\"n\">Equal</span><span class=\"p\">(</span><span class=\"m\">10</span><span class=\"p\">,</span> <span class=\"n\">report</span><span class=\"p\">.</span><span class=\"n\">NumberOfUsers</span><span class=\"p\">);</span>\n    <span class=\"c1\">// Asserting an interaction with a stub\n</span><span class=\"c1\"></span>    <span class=\"n\">stub</span><span class=\"p\">.</span><span class=\"n\">Verify</span><span class=\"p\">(</span>\n        <span class=\"n\">x</span> <span class=\"p\">=&gt;</span> <span class=\"n\">x</span><span class=\"p\">.</span><span class=\"n\">GetNumberOfUsers</span><span class=\"p\">(),</span>\n        <span class=\"n\">Times</span><span class=\"p\">.</span><span class=\"n\">Once</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n\n</div>\n<div class=\"paragraph\">\n<p>This practice of verifying things that aren’t part of the end result is also called <strong>overspecification</strong>. Most commonly, overspecification takes place when examining interactions. Checking for interactions with stubs is a flaw that’s quite easy to spot because tests shouldn’t check for <strong><em>any</em></strong> interactions with stubs.</p>\n</div>\n<div class=\"paragraph\">\n<p>Mocks are a more complicated subject: not all uses of mocks lead to test fragility, but a lot of them do. You’ll see why shortly.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_using_mocks_and_stubs_together\">Using mocks and stubs together</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Sometimes you need to create a test double that exhibits the properties of both a mock and a stub:</p>\n</div>\n<div class=\"paragraph\">\n\n\n\n\n\n\n<div class=\"highlight\"><pre class=\"chroma\"><code class=\"language-csharp\" data-lang=\"csharp\"><span class=\"na\">[Fact]</span>\n<span class=\"k\">public</span> <span class=\"k\">void</span> <span class=\"n\">Purchase_fails_when_not_enough_inventory</span><span class=\"p\">()</span>\n<span class=\"p\">{</span>\n    <span class=\"kt\">var</span> <span class=\"n\">storeMock</span> <span class=\"p\">=</span> <span class=\"k\">new</span> <span class=\"n\">Mock</span><span class=\"p\">&lt;</span><span class=\"n\">IStore</span><span class=\"p\">&gt;();</span>\n    <span class=\"c1\">// Setting up a canned answer\n</span><span class=\"c1\"></span>    <span class=\"n\">storeMock</span>\n        <span class=\"p\">.</span><span class=\"n\">Setup</span><span class=\"p\">(</span><span class=\"n\">x</span> <span class=\"p\">=&gt;</span> <span class=\"n\">x</span><span class=\"p\">.</span><span class=\"n\">HasEnoughInventory</span><span class=\"p\">(</span><span class=\"n\">Product</span><span class=\"p\">.</span><span class=\"n\">Shampoo</span><span class=\"p\">,</span> <span class=\"m\">5</span><span class=\"p\">))</span>\n        <span class=\"p\">.</span><span class=\"n\">Returns</span><span class=\"p\">(</span><span class=\"k\">false</span><span class=\"p\">);</span>\n    <span class=\"kt\">var</span> <span class=\"n\">sut</span> <span class=\"p\">=</span> <span class=\"k\">new</span> <span class=\"n\">Customer</span><span class=\"p\">();</span>\n\n    <span class=\"kt\">bool</span> <span class=\"n\">success</span> <span class=\"p\">=</span> <span class=\"n\">sut</span><span class=\"p\">.</span><span class=\"n\">Purchase</span><span class=\"p\">(</span><span class=\"n\">storeMock</span><span class=\"p\">.</span><span class=\"n\">Object</span><span class=\"p\">,</span> <span class=\"n\">Product</span><span class=\"p\">.</span><span class=\"n\">Shampoo</span><span class=\"p\">,</span> <span class=\"m\">5</span><span class=\"p\">);</span>\n\n    <span class=\"n\">Assert</span><span class=\"p\">.</span><span class=\"n\">False</span><span class=\"p\">(</span><span class=\"n\">success</span><span class=\"p\">);</span>\n    <span class=\"c1\">// Examining a call from the SUT to the mock\n</span><span class=\"c1\"></span>    <span class=\"n\">storeMock</span><span class=\"p\">.</span><span class=\"n\">Verify</span><span class=\"p\">(</span>\n        <span class=\"n\">x</span> <span class=\"p\">=&gt;</span> <span class=\"n\">x</span><span class=\"p\">.</span><span class=\"n\">RemoveInventory</span><span class=\"p\">(</span><span class=\"n\">Product</span><span class=\"p\">.</span><span class=\"n\">Shampoo</span><span class=\"p\">,</span> <span class=\"m\">5</span><span class=\"p\">),</span>\n        <span class=\"n\">Times</span><span class=\"p\">.</span><span class=\"n\">Never</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n\n</div>\n<div class=\"paragraph\">\n<p>This test uses <code>storeMock</code> for two purposes: it returns a canned answer and verifies a method call made by the SUT.</p>\n</div>\n<div class=\"paragraph\">\n<p>Notice, though, that these are two different methods: the test sets up the answer from <code>HasEnoughInventory()</code> but then verifies the call to <code>RemoveInventory()</code>. Thus, the rule of not asserting interactions with stubs is not violated here.</p>\n</div>\n<div class=\"paragraph\">\n<p>When a test double is both a mock and a stub, it’s still called a mock, not a stub. That’s mostly because you need to pick one name, but also because being a mock is a more important fact than being a stub.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_mocks_vs_stubs_and_commands_vs_queries\">Mocks vs. stubs and commands vs. queries</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>The notion of mocks and stubs ties to the command query separation (CQS) principle. The CQS principle states that every method should be either a command or a query, but not both:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><strong>Commands</strong> are methods that produce side effects and don’t return any value (return <code>void</code>). Examples of side effects include mutating an object’s state, changing a file in the file system, and so on.</p>\n</li>\n<li>\n<p><strong>Queries</strong> are the opposite of that — they are side-effect free and return a value.</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>In other words, asking a question should not change the answer. Code that maintains such a clear separation becomes easier to read.</p>\n</div>\n<div class=\"paragraph\">\n<p>Test doubles that substitute commands become mocks. Similarly, test doubles that substitute queries are stubs:</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/2020/2020-04-13-cqs.png\" alt=\"2020 04 13 cqs\">\n</div>\n<div class=\"title\">Commands correspond to mocks; queries — to stubs</div>\n</div>\n<div class=\"paragraph\">\n<p>Look at the two tests from the previous examples again (I’m showing their relevant parts here):</p>\n</div>\n<div class=\"paragraph\">\n\n\n\n\n\n\n<div class=\"highlight\"><pre class=\"chroma\"><code class=\"language-csharp\" data-lang=\"csharp\"><span class=\"kt\">var</span> <span class=\"n\">mock</span> <span class=\"p\">=</span> <span class=\"k\">new</span> <span class=\"n\">Mock</span><span class=\"p\">&lt;</span><span class=\"n\">IEmailGateway</span><span class=\"p\">&gt;();</span>\n<span class=\"n\">mock</span><span class=\"p\">.</span><span class=\"n\">Verify</span><span class=\"p\">(</span><span class=\"n\">x</span> <span class=\"p\">=&gt;</span> <span class=\"n\">x</span><span class=\"p\">.</span><span class=\"n\">SendGreetingsEmail</span><span class=\"p\">(</span><span class=\"s\">\"user@email.com\"</span><span class=\"p\">));</span>\n\n<span class=\"kt\">var</span> <span class=\"n\">stub</span> <span class=\"p\">=</span> <span class=\"k\">new</span> <span class=\"n\">Mock</span><span class=\"p\">&lt;</span><span class=\"n\">IDatabase</span><span class=\"p\">&gt;();</span>\n<span class=\"n\">stub</span><span class=\"p\">.</span><span class=\"n\">Setup</span><span class=\"p\">(</span><span class=\"n\">x</span> <span class=\"p\">=&gt;</span> <span class=\"n\">x</span><span class=\"p\">.</span><span class=\"n\">GetNumberOfUsers</span><span class=\"p\">()).</span><span class=\"n\">Returns</span><span class=\"p\">(</span><span class=\"m\">10</span><span class=\"p\">);</span>\n</code></pre></div>\n\n</div>\n<div class=\"paragraph\">\n<p><code>SendGreetingsEmail()</code> is a command whose side effect is sending an email. The test double that substitutes this command is a mock.</p>\n</div>\n<div class=\"paragraph\">\n<p>On the other hand, <code>GetNumberOfUsers()</code> is a query that returns a value and doesn’t mutate the database state. The corresponding test double is a stub.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_when_to_mock\">When to mock</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>With all these definitions out of the way, let’s talk about when you should use mocks.</p>\n</div>\n<div class=\"paragraph\">\n<p>You obviously don’t want to mock the system under test (SUT) itself, so the question of \"When to mock?\" boils down to this: \"Which types of dependencies you should replace with a mock, and which — use as is in tests?\"</p>\n</div>\n<div class=\"paragraph\">\n<p>Here are all types of unit testing dependencies I listed in the <a href=\"/posts/unit-testing-dependencies\">previous article</a>:</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/2020/2020-04-02-dependencies-7.png\" alt=\"2020 04 02 dependencies 7\">\n</div>\n<div class=\"title\">Types of unit testing dependencies</div>\n</div>\n<div class=\"paragraph\">\n<p>To re-iterate:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>A <strong>shared dependency</strong> is a dependency that is shared between tests and provides means for those tests to affect each other’s outcome.</p>\n</li>\n<li>\n<p>A <strong>private dependency</strong> is any dependency that is not shared.</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>A shared dependency corresponds to a mutable out-of-process dependency in the vast majority of cases, that’s why I’m using these two notions as synonyms here. (Check out my previous post for more details: <a href=\"/posts/unit-testing-dependencies\">Unit Testing Dependencies: The Complete Guide</a>.)</p>\n</div>\n<div class=\"paragraph\">\n<p>There are two schools of unit testing with their own views on which types of dependencies to replace with mocks:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><strong>The London school</strong> (also known as the mockist school) advocates for replacing all mutable dependencies (collaborators) with mocks.</p>\n</li>\n<li>\n<p><strong>The classical school</strong> (also known as the Detroit school) advocates for the replacement of only shared (mutable out-of-process) dependencies.</p>\n</li>\n</ul>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/2020/2020-04-13-dependencies-schools.png\" alt=\"2020 04 13 dependencies schools\">\n</div>\n<div class=\"title\">Types of unit testing dependencies and the schools of unit testing</div>\n</div>\n<div class=\"paragraph\">\n<p><mark>Both schools are wrong in their treatment of mocks</mark>, though the classical school is less so than the London school.</p>\n</div>\n<div class=\"sidebarblock\">\n<div class=\"content\">\n<div class=\"title\">Mocks and immutable out-of-process dependencies</div>\n<div class=\"paragraph\">\n<p>What about immutable out-of-process dependencies? Shouldn’t they be mocked out too, according to at least one of the schools?</p>\n</div>\n<div class=\"paragraph\">\n<p>Immutable out-of-process dependencies (such as a read-only API service), <em>should</em> be replaced with a test double, but that test double would be a stub, not a mock.</p>\n</div>\n<div class=\"paragraph\">\n<p>That’s, once again, due to the differences between mocks and stubs:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Mocks are for <span class=\"u\">outcoming</span> interactions (commands) — interactions that leave a side effect in the dependency-collaborator.</p>\n</li>\n<li>\n<p>Stubs are for <span class=\"u\">incoming</span> interactions (queries) — interactions that don’t leave a side effect in the dependency.</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>Interactions with immutable out-of-process dependencies are, by definition, <strong><em>incoming</em></strong> and thus shouldn’t be checked for in tests, only stubbed out with canned answers (both schools are OK with that).</p>\n</div>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>I’ll first describe why the London school is wrong, and then — why the classical approach is wrong too.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_don_t_mock_all_mutable_dependencies\">Don’t mock all mutable dependencies</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>You shouldn’t mock all mutable dependencies. To see why, we need to look at two types of communications in a typical application: intra-system and inter-system.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><strong>Intra-system communications</strong> are communications between classes inside your application</p>\n</li>\n<li>\n<p><strong>Inter-system communications</strong> are when your application talks to other applications.</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>Here they are on a diagram:</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/2020/2020-04-14-inter-intra.png\" alt=\"2020 04 14 inter intra\">\n</div>\n<div class=\"title\">Intra-system and inter-system communications</div>\n</div>\n<div class=\"paragraph\">\n<p>There’s a huge difference between the two: <mark>intra-system communications are implementation details; inter-system communications are not.</mark></p>\n</div>\n<div class=\"paragraph\">\n<p>Intra-system communications are implementation details because the collaborations your domain classes go through in order to perform an operation are not part of their observable behavior. These collaborations don’t have an immediate connection to the client’s goal. Thus, coupling to such collaborations leads to fragile tests.</p>\n</div>\n<div class=\"paragraph\">\n<p>Inter-system communications are a different matter. Unlike collaborations between classes inside your application, the way your system talks to the external world forms the observable behavior of that system as a whole. It’s part of the contract your application must hold at all times.</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/2020/2020-04-14-inter-intra-2.png\" alt=\"2020 04 14 inter intra 2\">\n</div>\n<div class=\"title\">Intra-system communications are implementation details; inter-system communications form the observable behavior of your application as a whole</div>\n</div>\n<div class=\"paragraph\">\n<p>This attribute of inter-system communications stems from the way separate applications evolve together. One of the main principles of such an evolution is maintaining backward compatibility. Regardless of the refactorings you perform inside your system, the communication pattern it uses to talk to external applications should always stay in place, so that external applications can understand it. For example, messages your application emits on a bus should preserve their structure, the calls issued to an SMTP service should have the same number and type of parameters, and so on.</p>\n</div>\n<div class=\"paragraph\">\n<p><mark>The use of mocks cements the communication pattern between the system under test and the dependency (makes that pattern harder to change).</mark> This is <strong><em>exactly</em></strong> what you want when verifying communications between your system and external applications. Conversely, using mocks to verify communications between classes inside your system couples your tests to implementation details, making them fragile.</p>\n</div>\n<div class=\"paragraph\">\n<p>Intra-system communications correspond to mutable in-process dependencies:</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/2020/2020-04-14-dependencies.png\" alt=\"2020 04 14 dependencies\">\n</div>\n<div class=\"title\">Intra-system communications are communications with mutable in-process dependencies</div>\n</div>\n<div class=\"paragraph\">\n<p>And so, the London school is wrong because it encourages the use of mocks for all mutable dependencies and doesn’t differentiate between intra-system (in-process) and inter-system (out-of-process) communications.</p>\n</div>\n<div class=\"paragraph\">\n<p>As a result, tests check communications between classes just as much as they check communications between your application and external systems. This indiscriminate use of mocks is why following the London school often results in fragile tests — tests that couple to implementation details.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_don_t_mock_all_out_of_process_dependencies\">Don’t mock all out-of-process dependencies</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>The classical school is better at this issue because it advocates for substituting only out-of-process dependencies such as an SMTP service, a message bus, and so on. But the classical school is not ideal in its treatment of inter-system communications, either. This school also encourages excessive use of mocks, albeit not as much as the London school.</p>\n</div>\n<div class=\"paragraph\">\n<p>Not all out-of-process dependencies should be mocked out. <mark>If an out-of-process dependency is only accessible through your application, then communications with such a dependency are not part of your system’s observable behavior.</mark> An out-of-process dependency that can’t be observed externally, in effect, acts as part of your application. Communications with such a dependency become implementation details: they don’t have to stay in place after refactoring and therefore shouldn’t be verified with mocks.</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/2020/2020-04-14-inter-intra-3.png\" alt=\"2020 04 14 inter intra 3\">\n</div>\n<div class=\"title\">Some inter-system communications are implementation details too</div>\n</div>\n<div class=\"paragraph\">\n<p>Remember, the requirement to always preserve the communication pattern between your application and external systems stems from the necessity to maintain backward compatibility. You have to maintain the way your application talks to external systems. That’s because you can’t change those external systems simultaneously with your application; they may follow a different deployment cycle, or you might simply not have control over them.</p>\n</div>\n<div class=\"paragraph\">\n<p>But when your application acts as a proxy to an external system, and no client can access it directly, the backward-compatibility requirement vanishes. Now you can deploy your application together with this external system, and it won’t affect the clients. The communication pattern with such a system becomes an implementation detail.</p>\n</div>\n<div class=\"paragraph\">\n<p>A good example here is an application database: a database that is used only by your application. No external system has access to this database. Therefore, you can modify the communication pattern between your system and the application database in any way you like, as long as it doesn’t break existing functionality. Because that database is completely hidden from the eyes of the clients, you can even replace it with an entirely different storage mechanism, and no one will notice.</p>\n</div>\n<div class=\"paragraph\">\n<p><mark>The use of mocks for out-of-process dependencies that you have a full control over also leads to brittle tests</mark>. You don’t want your tests to turn red every time you split a table in the database or modify the type of one of the parameters in a stored procedure. The database and your application must be treated as one system.</p>\n</div>\n<div class=\"paragraph\">\n<p>This distinction splits out-of-process dependencies into two subcategories:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><strong>Managed dependencies</strong> — out-of-process dependencies you have full control over. These dependencies are only accessible through your application; interactions with them aren’t visible to the external world. A typical example is the application database. External systems don’t access your database directly; they do that through the API your application provides.</p>\n</li>\n<li>\n<p><strong>Unmanaged dependencies</strong> — out-of-process dependencies you don’t have full control over. Interactions with such dependencies <strong><em>are</em></strong> observable externally. Examples include an SMTP server and a message bus: both produce side effects visible to other applications.</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>Only unmanaged dependencies should be replaced with mocks. Use real instances of managed dependencies in tests.</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/2020/2020-04-14-dependencies-2.png\" alt=\"2020 04 14 dependencies 2\">\n</div>\n<div class=\"title\">Only unmanaged dependencies can be replaced with mocks</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_further_reading\">Further reading</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Of course, using real instances of managed dependencies in tests poses an obvious issue: how do you test them such that your tests remain fast and reliable?</p>\n</div>\n<div class=\"paragraph\">\n<p>You’ll see this subject covered in depth in my book:</p>\n</div>\n<table class=\"tableblock frame-all grid-all spread\">\n<colgroup>\n<col style=\"width: 33.3333%;\">\n<col style=\"width: 66.6667%;\">\n</colgroup>\n<tbody>\n<tr>\n<td class=\"tableblock halign-left valign-top\"></td>\n<td class=\"tableblock halign-left valign-top\"></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><span class=\"image\"><a class=\"image\" href=\"/book-amazon\"><img src=\"/images/book-2.png\" alt=\"Unit Testing Principles\" width=\"150\" height=\"and Patterns\"></a></span></p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><a href=\"/book-amazon\">Unit Testing Principles, Practices, and Patterns</a></p></td>\n</tr>\n</tbody>\n</table>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_summary\">Summary</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Test double is an overarching term that describes all kinds of non-production-ready, fake dependencies in tests.</p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>There are five variations of test doubles — dummy, stub, spy, mock, and fake — that can be grouped in just two types: mocks and stubs.</p>\n</li>\n<li>\n<p>Spies are functionally the same as mocks; dummies and fakes serve the same role as stubs.</p>\n</li>\n</ul>\n</div>\n</li>\n<li>\n<p>The differences between mocks vs stubs:</p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Mocks help emulate and examine outcoming interactions: calls from the SUT to its dependencies that change the state of those dependencies.</p>\n</li>\n<li>\n<p>Stubs help emulate incoming interactions: calls the SUT makes to its dependencies to get input data.</p>\n</li>\n<li>\n<p>Asserting interactions with stubs always leads to fragile tests.</p>\n</li>\n<li>\n<p>Test doubles that substitute CQS commands are mocks. Test doubles that substitute CQS queries are stubs.</p>\n</li>\n</ul>\n</div>\n</li>\n<li>\n<p>A mock-the-tool is a class from a mocking library that you can use to create a mock-the-test-double or a stub.</p>\n</li>\n<li>\n<p>Out-of-process dependencies can be categorized into 2 subcategories: managed and unmanaged dependencies.</p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Managed dependencies are out-of-process dependencies that are only accessible through your application. Interactions with managed dependencies aren’t observable externally. A typical example is the application database.</p>\n</li>\n<li>\n<p>Unmanaged dependencies are out-of-process dependencies that other applications have access to. Interactions with unmanaged dependencies are observable externally. Typical examples include an SMTP server and a message bus.</p>\n</li>\n<li>\n<p>Communications with managed dependencies are implementation details; communications with unmanaged dependencies are part of your system’s observable behavior.</p>\n</li>\n<li>\n<p>Use real instances of managed dependencies in integration tests; replace unmanaged dependencies with mocks.</p>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_related\">Related</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"/posts/unit-testing-dependencies/\">Unit Testing Dependencies: The Complete Guide</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n\n\t\t<ul class=\"pager\">\n  <li class=\"previous\">\n    <a href=\"/posts/unit-testing-dependencies/\" class=\"left arrow\">← Unit Testing Dependencies: The Complete Guide</a>\n  </li>\n</ul>\n\n<h2>Subscribe</h2>\n\n<hr>\n\n<form action=\"https://www.getdrip.com/forms/162681596/submissions\" method=\"post\" data-drip-embedded-form=\"162681596\">\n<div data-drip-attribute=\"description\" style=\"font-size:90%;margin: 15px 0px;\">I don't post everything on my blog. Don't miss smaller tips and updates. Sign up to my mailing list below.</div>\n\n<div class=\"container\">\n<div class=\"row\">\n<div class=\"col-md-5\" style=\"padding:0px;\">\n  <input type=\"email\" id=\"drip-email\" name=\"fields[email]\" style=\"width:100%;border: 1px solid #777;font-size:90%;padding: 2px 5px;\" placeholder=\"Your email\" value=\"\">\n</div>\n<div class=\"col-md-2\" style=\"padding:0px\">\n  <input type=\"submit\" value=\"Sign up\" style=\"font-size:90%;margin-left: 10px;\" data-drip-attribute=\"sign-up-button\">\n</div>\n</div>\n</div>\n</form>\n\n\n\n\n<h2>Comments</h2>\n\n<hr>\n\n\n\t<div id=\"disqus_thread\"></div>\n<script type=\"application/javascript\">\n    var disqus_config = function () {\n    this.page.identifier = '2020 when-to-mock';\n    this.page.title = 'When to mock';\n    \n    };\n    (function() {\n        if ([\"localhost\", \"127.0.0.1\"].indexOf(window.location.hostname) != -1) {\n            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';\n            return;\n        }\n        var d = document, s = d.createElement('script'); s.async = true;\n        s.src = '//' + \"enterprisecraftsmanship\" + '.disqus.com/embed.js';\n        s.setAttribute('data-timestamp', +new Date());\n        (d.head || d.body).appendChild(s);\n    })();\n</script>\n<noscript>Please enable JavaScript to view the <a href=\"https://disqus.com/?ref_noscript\">comments powered by Disqus.</a></noscript>\n<a href=\"https://disqus.com\" class=\"dsq-brlink\">comments powered by <span class=\"logo-disqus\">Disqus</span></a>\n\n\n\t</div>\n\n\t<div class=\"pagination\">\n\t\t<a href=\"#\" class=\"top\">Top</a>\n\t</div>\n</main>\n\n\n\t\t</div>\n\t\t<div class=\"col-md-3 sidebar\">\n          <div class=\"self\">\n<img src=\"/images/photo.png\" alt=\"Vladimir Khorikov\">\n<h6>Vladimir Khorikov</h6>\n<a href=\"https://twitter.com/vkhorikov\" target=\"_blank\">\n<img src=\"data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2232%22%20height%3D%2232%22%3E%3Cg%3E%3Crect%20fill%3D%22%2355ACEE%22%20width%3D%2232%22%20height%3D%2232%22%2F%3E%3Cpath%20fill%3D%22%23fff%22%20d%3D%22M28%208.557c-.884.391-1.833.656-2.828.774%201.017-.608%201.798-1.573%202.166-2.725-.953.566-2.006.976-3.129%201.194-.897-.957-2.177-1.555-3.594-1.555-2.719%200-4.924%202.206-4.924%204.925%200%20.386.043.762.128%201.124-4.093-.208-7.723-2.168-10.15-5.146-.422.726-.666%201.573-.666%202.476%200%201.709.869%203.214%202.191%204.099-.807-.026-1.565-.248-2.23-.615v.061c0%202.388%201.698%204.377%203.951%204.83-.414.112-.849.171-1.297.171-.317%200-.625-.031-.927-.086.628%201.956%202.446%203.38%204.6%203.419-1.686%201.319-3.809%202.108-6.115%202.108-.398%200-.79-.024-1.175-.069%202.178%201.396%204.767%202.213%207.549%202.213%209.056%200%2014.011-7.506%2014.011-14.012l-.016-.637c.96-.694%201.795-1.56%202.455-2.549z%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E\" alt=\"Twitter\"></a>\n<a href=\"mailto:vlad@enterprisecraftsmanship.com\" target=\"_blank\">\n<img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMmSURBVFhHxZdvaI1RHMe/1/8MLYtkatNeEGKLF2iyUaRoe0GSNVsRWTYrUiTz78W82mpkhPHKaNokNpL5k/xrjFnxxhQmEfInUeb7fc65u3vun9177d7tU9/O75znuc/ve855nnPO9SBCuspmJLJYRGVRC6gUahiVQH2kWqg31G3qjKes7S/LsIQ1wMRzWKylCiiZiJQKqpJGOkw1OCEN2B7voaJN7E8FTZTaOICgBpg8ncVZaorT0HeeUHk08txUfQQYsMlvUH3pdTC+UNk0ITPduAzEMbkXmciiiVZTBQbZ0jvnp6h4JRd6dr0JDd0GyG5KIxBvUtnZ4zY2U8CGNBaPqHj23p/J+kS9Bo6x2KAYiROBhZudMObcPMK34J2toIYGCj127l9Rvt4vLgEy19tKDPj1DbhV3YXHFzxObPhJJesdWEb5kqdw4WupA6pXAq0XbWMf6HgInC4EOts9SEq1jQ4jqVyvAR+aguIrwKxc4NI+oG5Hz2GLnPcvgHNbgVqOpp61uhJI0vbhIlsGpprYj7l5wE66H8L9pnIp0FhuL4RBQ9zEe2uL2ZlJQEmTedaI0fYGF9NlYJyJg+DhO5qzH9h4HvjwEjiUyUW1wV4MQttlM3XqvXq8ZFuoxF7SZMA1MUGZwEHKP8EHbjdvcvUq4FOPTU7zrLY7vCd7C7DupPlNeBJk4I+JIyA9xwzpzBVAFaWhlup3cZ55raCG15bbmyNiqAz8MHEUzMsHSq+b+dZwF3AFDz3PvdEhA70eGEIyZjzfjwNmuBOTbWPUfJaBZhMPCPdkgG/QgHFVBvjtDAg6G9z3bkY6B+jsxw9jLD+loi4MHu46rMSE5sPA105bsZuRIhrg+ou3ivuJ7uOZpgAMtNhzFek31HvnbOgYsGyinpowrijxXhMGHkq1LD+jRjkNsSf0oVTwghYl/e367jTEFiVf0zO5cBkQdm7mU+1OQ2zQMzP47EZT9dHrp8YpqWJRZGr/hXp9lCpncsUBhP3WaUJHdR5r7DoRGUp2jTroP+T+RLXY0Ay3PMymMqhplA4z2k1/U6+pB9RdqiFUj90A/wCbXt7P+tqoKgAAAABJRU5ErkJggg==\" alt=\"Email\"></a>\n<a href=\"https://www.linkedin.com/in/vladimir-khorikov-bb482653/\" target=\"_blank\">\n<img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAK3SURBVEhLY3z/7Vf19purrrx88+03A/UAGyNjnJHU7FBd5uc6wXPOPvv2+x9UhkrgLwPDueefH779xvxUN+TbHyqbDgc3X39l/mYeCeWBgQQXa5iupJOS8N9//55+/gkVJRf8+f+fkaF8O5THwGAgzrM7zUyEmw3CXXHuaeSqyxA22YAJSgPBf4YlEfpw04Egwkg6zkAKyiEXICzQEOXSluSFcmDAWUUYyiIXICx48QlLiP/8S2n8Iyz48OvvgdtvoBww+M/AsObSCyiHXIAUBwwMCWuunHn0AcL+8P131/57u+6+hXDJBiipCAI8VEWYGRnuvf9+/fVXqBAFAMUCXnZmLRFudmaoty6//PL+5x8gQ4KbTU2YCyIIDLfDDz8A9QlwsBhI8hpI8ArxsP34/e/M449YvYtiQYy+5OJIfSiHgeHJh++y7QeBStZGGQTpSUBFGRg69t3df+/d/FBdKX4OqBAYPHz3PWjxOWAJAeWDAUocsAKDBgkwMwK5QBcz8LAxQ0QgIEBLbFWMIZrpQCAvxHk6zwroJygfDFAsIBJoSPDyc7BAOaiAiZFxZpA2lAMG5FgAB/9B3kMHZnICCkieI9OCC08/GU84Ktiwx2nGySuogQ4EPlpiUBZ5Fvz99z9h9eVzLz5//Pln/4P3PvPPQCVggB8pzsixYPO1VxdfIFz98OPPB+++QzlgIMrLDmWRZ8HTjz+gLAhgZHiJWnPwsFLmg98YJeA/1OjmYkEYS44FmOA/qgWwogAEqGMBHjBqAUFAXwv+oZYtP8ltkCGbg1IfADNImpkMKyyVXXv5ZfPN10AGsAR2VxOBCALByovPH6DmNUNJXjdVhIL9d9+eevoJwmZkq9zxC83l1APAWo8pxVQGyqMBSDWVYT60eNL7b78vv/j8h6reEGBnSTCWanRTBQAf+urSEwiEBAAAAABJRU5ErkJggg==\" alt=\"LinkedIn\">\n</a>\n</div>\n\n<div class=\"book\">\n<h6>My book</h6>\n<a href=\"/book-amazon\" target=\"_blank\">\n<img alt=\"Unit testing book\" src=\"/images/book-2.png\">\n</a>\n\n<div class=\"black-link\">\n<a data-sumome-listbuilder-id=\"6512ca46-1cc8-4a12-b62b-ebc73a98b90b\" data-sumome-trigger=\"true\" href=\"javascript:void(0);\">Click here to get a 40% discount</a>\n</div>\n</div>\n\n\n<div class=\"ps\">\n<h6>Pluralsight courses</h6>\n<a href=\"/ps-all\" target=\"_blank\">\n<img src=\"/images/PSAuthor.png\" alt=\"Pluralsight\"></a>\n\n‒ <a target=\"_blank\" href=\"/ps-unit-testing\">Pragmatic Unit Testing</a><br>\n\n‒ <a target=\"_blank\" href=\"/ps-ddd-in-practice\">Domain-Driven Design in Practice</a><br>\n\n‒ <a target=\"_blank\" href=\"/ps-func\">Applying Functional Principles in C#</a><br>\n\n‒ <a target=\"_blank\" href=\"/ps-db\">Database Delivery Best Practices</a><br>\n\n‒ <a target=\"_blank\" href=\"/ps-spec-pattern\">Specification Pattern in C#</a><br>\n\n‒ <a target=\"_blank\" href=\"/ps-anemic\">Refactoring from Anemic Domain Model</a><br>\n\n‒ <a target=\"_blank\" href=\"/ps-legacy\">Domain-Driven Design: Working with Legacy Projects</a><br>\n\n‒ <a target=\"_blank\" href=\"/ps-cqrs\">CQRS in Practice</a><br>\n\n‒ <a target=\"_blank\" href=\"/ps-ef-core\">DDD and EF Core: Preserving Encapsulation</a>\n</div>\n\n<div class=\"popular\">\n<h6>Most Popular Articles</h6>\n‒ <a href=\"/2018/06/13/ef-core-vs-nhibernate-ddd-perspective/\">EF Core 2.1 vs NHibernate 5.1: DDD perspective</a><br>\n‒ <a href=\"/posts/c-and-f-approaches-to-illegal-state/\">C# and F# approaches to illegal states</a><br>\n‒ <a href=\"/2017/09/18/optimistic-locking-automatic-retry/\">Optimistic locking and automatic retry</a><br>\n‒ <a href=\"/2016/01/11/entity-vs-value-object-the-ultimate-list-of-differences/\">Entity vs Value Object: the ultimate list of differences</a><br>\n‒ <a href=\"/2015/04/13/dto-vs-value-object-vs-poco/\">DTO vs Value Object vs POCO</a><br>\n‒ <a href=\"/2015/05/11/3-misused-of-operator-in-c-6/\">3 misuses of ?. operator in C# 6</a><br>\n‒ <a href=\"/2016/02/08/specification-pattern-c-implementation/\">Specification pattern: C# implementation</a><br>\n‒ <a href=\"/2015/08/10/database-versioning-best-practices/\">Database versioning best practices</a><br>\n‒ <a href=\"/2017/10/23/unit-testing-private-methods/\">Unit testing private methods</a><br>\n‒ <a href=\"/2015/03/20/functional-c-handling-failures-input-errors/\">Functional C#: Handling failures, input errors</a><br>\n‒ <a href=\"/2017/01/31/rest-api-response-codes-400-vs-500/\">REST API response codes: 400 vs 500</a>\n</div>\n\n<div class=\"mvp\">\n<a target=\"_blank\" href=\"https://mvp.microsoft.com/en-us/PublicProfile/5002117\">\n<img src=\"/images/MSMVP.png\" alt=\"MSMVP\"></a>\n</div>\n\n\n\n<div class=\"recentposts\">\n<h6>Recent Articles</h6>\n\n‒ <a href=\"https://enterprisecraftsmanship.com/posts/when-to-mock/\">When to Mock</a><br>\n\n‒ <a href=\"https://enterprisecraftsmanship.com/posts/unit-testing-dependencies/\">Unit Testing Dependencies: The Complete Guide</a><br>\n\n‒ <a href=\"https://enterprisecraftsmanship.com/posts/new-online-course-ddd-and-ef-core/\">EF Core and DDD: New online course</a><br>\n\n‒ <a href=\"https://enterprisecraftsmanship.com/posts/3-things-that-will-make-or-break-your-project/\">3 things that will make or break your project</a><br>\n\n‒ <a href=\"https://enterprisecraftsmanship.com/posts/assertion-messages-in-tests/\">Assertion messages in tests</a><br>\n\n‒ <a href=\"https://enterprisecraftsmanship.com/posts/is-entity-same-as-value-object/\">Is Entity the same as Value Object?</a><br>\n\n‒ <a href=\"https://enterprisecraftsmanship.com/posts/ddd-bulk-operations/\">DDD and bulk operations</a><br>\n\n‒ <a href=\"https://enterprisecraftsmanship.com/posts/combining-asp-net-core-attributes-with-value-objects/\">Combining ASP.NET Core validation attributes with Value Objects</a><br>\n\n‒ <a href=\"https://enterprisecraftsmanship.com/posts/advanced-error-handling-techniques/\">Advanced error handling techniques</a><br>\n\n‒ <a href=\"https://enterprisecraftsmanship.com/posts/you-naming-tests-wrong/\">You are naming your tests wrong!</a><br>\n\n<div style=\"padding-top:10px;\">\n<a href=\"/archives\">» All articles</a><br>\n</div>\n</div>\n\n\t\t</div>\n\t  </div>\n\t  \n\t  <div class=\"row\">\n\t    <div class=\"col-md-9\">\n          <footer>\n\t<span>\n\t© <time datetime=\"2020\">2020</time> Vladimir Khorikov. Made with <a target=\"_blank\" href=\"https://gohugo.io\">Hugo</a>.\n\t</span>\n</footer>\n\n\t\t</div>\n\t  </div>\n\t</div>\n\t\n\t\n<script async=\"\" src=\"https://www.googletagmanager.com/gtag/js?id=UA-56185457-1\"></script>\n<script>\n  window.dataLayer = window.dataLayer || [];\n  function gtag(){dataLayer.push(arguments);}\n  gtag('js', new Date());\n\n  gtag('config', 'UA-56185457-1', { 'anonymize_ip': true });\n</script>\n\n\t<script async=\"\">(function(s,u,m,o,j,v){j=u.createElement(m);v=u.getElementsByTagName(m)[0];j.async=1;j.src=o;j.dataset.sumoSiteId='81530c24640fc92186bdd6ca83f4a4c8947f80d8a68a7ad4d92925895c06d929';v.parentNode.insertBefore(j,v)})(window,document,'script','//load.sumo.com/');</script>\n  \n\n<iframe id=\"sumome-jquery-iframe\" title=\"Sumo Hidden Content\" style=\"display: none;\"></iframe><a href=\"javascript:void(0);\" title=\"Sumo\" style=\"background-color: rgb(0, 115, 183); border-radius: 3px 0px 0px 3px; box-shadow: rgba(0, 0, 0, 0.2) 0px 4px 10px; position: fixed; z-index: 2147483647; padding: 0px; width: 44px; height: 40px; text-indent: -10000px; opacity: 1; display: none !important; transition-duration: 0s; transform: scale(0, 0); animation-fill-mode: none; animation-duration: 0s;\" data-sumo-welcome-mat-data=\"{&quot;originalStyles&quot;:{&quot;transform&quot;:&quot;&quot;,&quot;transitionDuration&quot;:&quot;&quot;,&quot;animationFillMode&quot;:&quot;&quot;,&quot;animationDuration&quot;:&quot;&quot;}}\"><span style=\"position: absolute; left: -10000px; top: auto; width: 1px; height: 1px; overflow: hidden; transition-duration: 0s; transform: scale(0, 0); animation-fill-mode: none; animation-duration: 0s;\" data-sumo-welcome-mat-data=\"{&quot;originalStyles&quot;:{&quot;transform&quot;:&quot;&quot;,&quot;transitionDuration&quot;:&quot;&quot;,&quot;animationFillMode&quot;:&quot;&quot;,&quot;animationDuration&quot;:&quot;&quot;}}\">Sumo</span><span style=\"display:block;width:40px;height:40px;background:white;margin-left:4px;-webkit-border-radius: 3px 0 0 3px;-moz-border-radius: 3px 0 0 3px;-ms-border-radius: 3px 0 0 3px;-o-border-radius: 3px 0 0 3px;border-radius: 3px 0 0 3px;background-repeat:no-repeat;background-position:8px 8px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoxZDQ2MjI4YS03NWY2LTRkZTQtOGJjYy1hODc1NjRkMjYxYTUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RDQ3MUVFMDFFMjVDMTFFNjlFQjhBRjdGODU5MDJBMDUiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RDQ3MUVFMDBFMjVDMTFFNjlFQjhBRjdGODU5MDJBMDUiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoxZDQ2MjI4YS03NWY2LTRkZTQtOGJjYy1hODc1NjRkMjYxYTUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MWQ0NjIyOGEtNzVmNi00ZGU0LThiY2MtYTg3NTY0ZDI2MWE1Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+8JtvywAAAKhQTFRFzOPxSJvLA3W4Mo7FBna5w97u8vj7EHy8a67VhbzdsdTpVaLPh73d9/v9C3m6QZfJbq/WXKbR3u32JIfB3ez1KorDir/eBHW4+/3+rtPoZarUG4K/LIvDDnu7ocvkf7nbdrTY9fr8E328WKPQO5PITJ3MPpXJstXptdbq+Pv9cbHXaq3VU6HOkMLgnMnjDHq62uv1/P3+6/T53Oz1cLDX/f7+AHO3////ptOZ5QAAADh0Uk5T/////////////////////////////////////////////////////////////////////////wA7XBHKAAAAmUlEQVR42sSRRxLCMAxFRSq9907ovebr/jdDMWYGxmZL3sIqbyFbJv4B/VlkVlerKALTD3G46Mx3AOR1UZ/TsDxW6W0gfYRNVfTCFu2AWpAMgMItMW+zQJU2UjWI29D0+e5KWNPMk+A9Om+B/UgOJyCuwMJCrpuziYkIsglfRByZ/XM3eXnBFEu1kpMpjq9dxQYp/OAXTwEGAB7Rc1xVnPemAAAAAElFTkSuQmCC);\"></span></a><iframe style=\"display: none;\"></iframe><img src=\"//sumo.com/api/event/?site_id=81530c24640fc92186bdd6ca83f4a4c8947f80d8a68a7ad4d92925895c06d929&amp;app_id=156085c5-0017-4150-b225-a731ad248f38&amp;shortcut_id=&amp;visitor_id=36652cec1b10bffb4483fcd3de21ed039190b416e8d23b4ed624e95e45d258f6&amp;event=popup&amp;href=https%3A%2F%2Fenterprisecraftsmanship.com%2Fposts%2Fwhen-to-mock%2F&amp;ref=&amp;cache=0.3603056885469518\" alt=\"\" style=\"display: none;\"><img src=\"//sumo.com/api/event/?site_id=81530c24640fc92186bdd6ca83f4a4c8947f80d8a68a7ad4d92925895c06d929&amp;app_id=156085c5-0017-4150-b225-a731ad248f38.482a6bc24a645e1a6063cb49ed6b22576238bf9e51cbf5bb11880b3bfbd21e8c&amp;shortcut_id=&amp;visitor_id=36652cec1b10bffb4483fcd3de21ed039190b416e8d23b4ed624e95e45d258f6&amp;event=popup&amp;href=https%3A%2F%2Fenterprisecraftsmanship.com%2Fposts%2Fwhen-to-mock%2F&amp;ref=&amp;cache=0.9974696485423098\" alt=\"\" style=\"display: none;\"><img src=\"//sumo.com/api/event/?site_id=81530c24640fc92186bdd6ca83f4a4c8947f80d8a68a7ad4d92925895c06d929&amp;app_id=156085c5-0017-4150-b225-a731ad248f38.761ea8b8d15e3cf63bd615390fb015caa88133394a7da3da5f64897bf448c1c2&amp;shortcut_id=&amp;visitor_id=36652cec1b10bffb4483fcd3de21ed039190b416e8d23b4ed624e95e45d258f6&amp;event=popup&amp;href=https%3A%2F%2Fenterprisecraftsmanship.com%2Fposts%2Fwhen-to-mock%2F&amp;ref=&amp;cache=0.9643802252495051\" alt=\"\" style=\"display: none;\"><img src=\"//sumo.com/api/event/?site_id=81530c24640fc92186bdd6ca83f4a4c8947f80d8a68a7ad4d92925895c06d929&amp;app_id=156085c5-0017-4150-b225-a731ad248f38.482a6bc24a645e1a6063cb49ed6b22576238bf9e51cbf5bb11880b3bfbd21e8c.761ea8b8d15e3cf63bd615390fb015caa88133394a7da3da5f64897bf448c1c2&amp;shortcut_id=&amp;visitor_id=36652cec1b10bffb4483fcd3de21ed039190b416e8d23b4ed624e95e45d258f6&amp;event=popup&amp;href=https%3A%2F%2Fenterprisecraftsmanship.com%2Fposts%2Fwhen-to-mock%2F&amp;ref=&amp;cache=0.7054287561722683\" alt=\"\" style=\"display: none;\">","text":"I'm In!\n\n5 Unit Testing Mistakes\n\nTake the free 5-day class\n\nNo Thanks\nEnterprise Craftsmanship\nBlog Unit Testing Book Online Courses About Archives\nWhen to Mock\nApril 15, 2020\n\nThe use of mocks in unit testing is a controversial topic (maybe less so now than several years ago). I remember how, throughout my programming career, I went from mocking almost every dependency, to the \"no-mocks\" policy, and then to \"only mock external dependencies\".\n\nNone of this practices are good enough. In this article, I’ll show you which dependencies to mock, and which to use as is in your tests.\n\nWhat is a mock?\n\nBefore jumping to the topic of when to mock, let’s discuss what a mock is.\n\nMock vs test double\n\nPeople often use the terms test double and mock as synonyms, but technically, they are not:\n\nA test double is an overarching term that describes all kinds of non-production-ready, fake dependencies in tests. Such a dependency looks and behaves like its release-intended counterpart but is actually a simplified version that reduces complexity and facilitates testing.\n\nThis term was introduced by Gerard Meszaros in his book xUnit Test Patterns: Refactoring Test Code. The name itself comes from the notion of a stunt double in movies.\n\nA mock is just one kind of such dependencies.\n\nAccording to Gerard Meszaros, there are 5 types of test doubles:\n\nDummy\n\nStub\n\nSpy\n\nMock\n\nFake\n\nSuch a variety may look intimidating, but in reality, they can all be grouped together into just two types: mocks and stubs.\n\nAll variations of test doubles can be categorized into two types: mocks and stubs\n\nThe difference between these two types boils down to the following:\n\nMocks help to emulate and examine outcoming interactions. These interactions are calls the system under test (SUT) makes to its dependencies to change their state.\n\nStubs help to emulate incoming interactions. These interactions are calls the SUT makes to its dependencies to get input data.\n\nFor example, sending an email is an outcoming interaction: that interaction results in a side effect in the SMTP server. A test double emulating such an interaction is a mock.\n\nRetrieving data from the database is an incoming interaction — it doesn’t result in a side effect. The corresponding test double is a stub.\n\nMocks are for outcoming interaction; stubs — for incoming\n\nAll other differences between the five types of test doubles are insignificant implementation details:\n\nSpies serve the same role as mocks. The distinction is that spies are written manually, whereas mocks are created with the help of a mocking framework. Sometimes people refer to spies as handwritten mocks.\n\nOn the other hand, the difference between stubs, dummies, and fakes is in how intelligent they are:\n\nA dummy is a simple, hard-coded value such as a null value or a made-up string. It’s used to satisfy the SUT’s method signature and doesn’t participate in producing the final outcome.\n\nA stub is more sophisticated. It’s a fully fledged dependency that you configure to return different values for different scenarios.\n\nA fake is the same as a stub for most purposes. The difference is in the rationale for its creation: a fake is usually implemented to replace a dependency that doesn’t yet exist.\n\nNotice the difference between mocks and stubs (aside from outcoming versus incoming interactions). Mocks help to emulate and examine interactions between the SUT and its dependencies, while stubs only help to emulate those interactions. This is an important distinction. You will see why shortly.\n\nMock-the-tool vs. mock-the-test-double\n\nThe term mock is overloaded and can mean different things in different circumstances. I mentioned already that people often use this term to mean any test double, whereas mocks are only a subset of test doubles.\n\nBut there’s another meaning for the term mock. You can refer to the classes from mocking libraries as mocks, too. These classes help you create actual mocks, but they themselves are not mocks per se:\n\n[Fact]\npublic void Sending_a_greetings_email()\n{\n    // Using a mock-the-tool to create a mock-the-test-double\n    var mock = new Mock<IEmailGateway>();\n    var sut = new Controller(mock.Object);\n\n    sut.GreetUser(\"user@email.com\");\n\n    // Examining the call from the SUT to the test double\n    mock.Verify(\n        x => x.SendGreetingsEmail(\"user@email.com\"),\n        Times.Once);\n}\n\n\nThis test uses the Mock class from the Moq mocking library. This class is a tool that enables you to create a test double — a mock. In other words, the class Mock (or Mock<IEmailGateway>) is a mock-the-tool, while the instance of that class, mock, is a mock-the-test-double.\n\nIt’s important not to conflate a mock-the-tool with a mock-the-test-double because you can use a mock-the-tool to create both types of test doubles: mocks and stubs.\n\nHere’s another example of a test that uses the Mock class. The instance of that class is a stub, not mock:\n\n[Fact]\npublic void Creating_a_report()\n{\n    // Using a mock-the-tool to create a stub\n    var stub = new Mock<IDatabase>();\n    // Setting up a canned answer\n    stub.Setup(x => x.GetNumberOfUsers()).Returns(10);\n    var sut = new Controller(stub.Object);\n\n    Report report = sut.CreateReport();\n\n    Assert.Equal(10, report.NumberOfUsers);\n}\n\n\nThis test double emulates an incoming interaction — a call that provides the SUT with input data.\n\nOn the other hand, in the previous example, the call to SendGreetingsEmail() is an outcoming interaction. Its sole purpose is to incur a side effect — send an email.\n\nDon’t assert interactions with stubs\n\nAs I mentioned above, mocks help to emulate and examine outcoming interactions between the SUT and its dependencies, while stubs only help to emulate incoming interactions, not examine them.\n\nThe difference between the two stems from this guideline: you should never assert interactions with stubs. A call from the SUT to a stub is not part of the end result the SUT produces. Such a call is only a means to produce the end result; it’s an implementation detail. Asserting interactions with stubs is a common anti-pattern that leads to brittle tests.\n\nThe only way to avoid test brittleness is to make those tests verify the end result (which, ideally, should be meaningful to a non-programmer), not implementation details.\n\nIn the above examples, the check\n\nmock.Verify(x => x.SendGreetingsEmail(\"user@email.com\"))\n\n\ncorresponds to an actual outcome, and that outcome is meaningful to a domain expert: sending a greetings email is something business people would want the system to do.\n\nAt the same time, the call to GetNumberOfUsers() is not an outcome at all. It’s an internal implementation detail regarding how the SUT gathers data necessary for the report creation. Therefore, asserting this call would lead to test fragility. It doesn’t matter how the SUT generates the end result, as long as that result is correct.\n\nHere’s an example of such a fragile test:\n\n[Fact]\npublic void Creating_a_report()\n{\n    var stub = new Mock<IDatabase>();\n    stub.Setup(x => x.GetNumberOfUsers()).Returns(10);\n    var sut = new Controller(stub.Object);\n\n    Report report = sut.CreateReport();\n\n    Assert.Equal(10, report.NumberOfUsers);\n    // Asserting an interaction with a stub\n    stub.Verify(\n        x => x.GetNumberOfUsers(),\n        Times.Once);\n}\n\n\nThis practice of verifying things that aren’t part of the end result is also called overspecification. Most commonly, overspecification takes place when examining interactions. Checking for interactions with stubs is a flaw that’s quite easy to spot because tests shouldn’t check for any interactions with stubs.\n\nMocks are a more complicated subject: not all uses of mocks lead to test fragility, but a lot of them do. You’ll see why shortly.\n\nUsing mocks and stubs together\n\nSometimes you need to create a test double that exhibits the properties of both a mock and a stub:\n\n[Fact]\npublic void Purchase_fails_when_not_enough_inventory()\n{\n    var storeMock = new Mock<IStore>();\n    // Setting up a canned answer\n    storeMock\n        .Setup(x => x.HasEnoughInventory(Product.Shampoo, 5))\n        .Returns(false);\n    var sut = new Customer();\n\n    bool success = sut.Purchase(storeMock.Object, Product.Shampoo, 5);\n\n    Assert.False(success);\n    // Examining a call from the SUT to the mock\n    storeMock.Verify(\n        x => x.RemoveInventory(Product.Shampoo, 5),\n        Times.Never);\n}\n\n\nThis test uses storeMock for two purposes: it returns a canned answer and verifies a method call made by the SUT.\n\nNotice, though, that these are two different methods: the test sets up the answer from HasEnoughInventory() but then verifies the call to RemoveInventory(). Thus, the rule of not asserting interactions with stubs is not violated here.\n\nWhen a test double is both a mock and a stub, it’s still called a mock, not a stub. That’s mostly because you need to pick one name, but also because being a mock is a more important fact than being a stub.\n\nMocks vs. stubs and commands vs. queries\n\nThe notion of mocks and stubs ties to the command query separation (CQS) principle. The CQS principle states that every method should be either a command or a query, but not both:\n\nCommands are methods that produce side effects and don’t return any value (return void). Examples of side effects include mutating an object’s state, changing a file in the file system, and so on.\n\nQueries are the opposite of that — they are side-effect free and return a value.\n\nIn other words, asking a question should not change the answer. Code that maintains such a clear separation becomes easier to read.\n\nTest doubles that substitute commands become mocks. Similarly, test doubles that substitute queries are stubs:\n\nCommands correspond to mocks; queries — to stubs\n\nLook at the two tests from the previous examples again (I’m showing their relevant parts here):\n\nvar mock = new Mock<IEmailGateway>();\nmock.Verify(x => x.SendGreetingsEmail(\"user@email.com\"));\n\nvar stub = new Mock<IDatabase>();\nstub.Setup(x => x.GetNumberOfUsers()).Returns(10);\n\n\nSendGreetingsEmail() is a command whose side effect is sending an email. The test double that substitutes this command is a mock.\n\nOn the other hand, GetNumberOfUsers() is a query that returns a value and doesn’t mutate the database state. The corresponding test double is a stub.\n\nWhen to mock\n\nWith all these definitions out of the way, let’s talk about when you should use mocks.\n\nYou obviously don’t want to mock the system under test (SUT) itself, so the question of \"When to mock?\" boils down to this: \"Which types of dependencies you should replace with a mock, and which — use as is in tests?\"\n\nHere are all types of unit testing dependencies I listed in the previous article:\n\nTypes of unit testing dependencies\n\nTo re-iterate:\n\nA shared dependency is a dependency that is shared between tests and provides means for those tests to affect each other’s outcome.\n\nA private dependency is any dependency that is not shared.\n\nA shared dependency corresponds to a mutable out-of-process dependency in the vast majority of cases, that’s why I’m using these two notions as synonyms here. (Check out my previous post for more details: Unit Testing Dependencies: The Complete Guide.)\n\nThere are two schools of unit testing with their own views on which types of dependencies to replace with mocks:\n\nThe London school (also known as the mockist school) advocates for replacing all mutable dependencies (collaborators) with mocks.\n\nThe classical school (also known as the Detroit school) advocates for the replacement of only shared (mutable out-of-process) dependencies.\n\nTypes of unit testing dependencies and the schools of unit testing\n\nBoth schools are wrong in their treatment of mocks, though the classical school is less so than the London school.\n\nMocks and immutable out-of-process dependencies\n\nWhat about immutable out-of-process dependencies? Shouldn’t they be mocked out too, according to at least one of the schools?\n\nImmutable out-of-process dependencies (such as a read-only API service), should be replaced with a test double, but that test double would be a stub, not a mock.\n\nThat’s, once again, due to the differences between mocks and stubs:\n\nMocks are for outcoming interactions (commands) — interactions that leave a side effect in the dependency-collaborator.\n\nStubs are for incoming interactions (queries) — interactions that don’t leave a side effect in the dependency.\n\nInteractions with immutable out-of-process dependencies are, by definition, incoming and thus shouldn’t be checked for in tests, only stubbed out with canned answers (both schools are OK with that).\n\nI’ll first describe why the London school is wrong, and then — why the classical approach is wrong too.\n\nDon’t mock all mutable dependencies\n\nYou shouldn’t mock all mutable dependencies. To see why, we need to look at two types of communications in a typical application: intra-system and inter-system.\n\nIntra-system communications are communications between classes inside your application\n\nInter-system communications are when your application talks to other applications.\n\nHere they are on a diagram:\n\nIntra-system and inter-system communications\n\nThere’s a huge difference between the two: intra-system communications are implementation details; inter-system communications are not.\n\nIntra-system communications are implementation details because the collaborations your domain classes go through in order to perform an operation are not part of their observable behavior. These collaborations don’t have an immediate connection to the client’s goal. Thus, coupling to such collaborations leads to fragile tests.\n\nInter-system communications are a different matter. Unlike collaborations between classes inside your application, the way your system talks to the external world forms the observable behavior of that system as a whole. It’s part of the contract your application must hold at all times.\n\nIntra-system communications are implementation details; inter-system communications form the observable behavior of your application as a whole\n\nThis attribute of inter-system communications stems from the way separate applications evolve together. One of the main principles of such an evolution is maintaining backward compatibility. Regardless of the refactorings you perform inside your system, the communication pattern it uses to talk to external applications should always stay in place, so that external applications can understand it. For example, messages your application emits on a bus should preserve their structure, the calls issued to an SMTP service should have the same number and type of parameters, and so on.\n\nThe use of mocks cements the communication pattern between the system under test and the dependency (makes that pattern harder to change). This is exactly what you want when verifying communications between your system and external applications. Conversely, using mocks to verify communications between classes inside your system couples your tests to implementation details, making them fragile.\n\nIntra-system communications correspond to mutable in-process dependencies:\n\nIntra-system communications are communications with mutable in-process dependencies\n\nAnd so, the London school is wrong because it encourages the use of mocks for all mutable dependencies and doesn’t differentiate between intra-system (in-process) and inter-system (out-of-process) communications.\n\nAs a result, tests check communications between classes just as much as they check communications between your application and external systems. This indiscriminate use of mocks is why following the London school often results in fragile tests — tests that couple to implementation details.\n\nDon’t mock all out-of-process dependencies\n\nThe classical school is better at this issue because it advocates for substituting only out-of-process dependencies such as an SMTP service, a message bus, and so on. But the classical school is not ideal in its treatment of inter-system communications, either. This school also encourages excessive use of mocks, albeit not as much as the London school.\n\nNot all out-of-process dependencies should be mocked out. If an out-of-process dependency is only accessible through your application, then communications with such a dependency are not part of your system’s observable behavior. An out-of-process dependency that can’t be observed externally, in effect, acts as part of your application. Communications with such a dependency become implementation details: they don’t have to stay in place after refactoring and therefore shouldn’t be verified with mocks.\n\nSome inter-system communications are implementation details too\n\nRemember, the requirement to always preserve the communication pattern between your application and external systems stems from the necessity to maintain backward compatibility. You have to maintain the way your application talks to external systems. That’s because you can’t change those external systems simultaneously with your application; they may follow a different deployment cycle, or you might simply not have control over them.\n\nBut when your application acts as a proxy to an external system, and no client can access it directly, the backward-compatibility requirement vanishes. Now you can deploy your application together with this external system, and it won’t affect the clients. The communication pattern with such a system becomes an implementation detail.\n\nA good example here is an application database: a database that is used only by your application. No external system has access to this database. Therefore, you can modify the communication pattern between your system and the application database in any way you like, as long as it doesn’t break existing functionality. Because that database is completely hidden from the eyes of the clients, you can even replace it with an entirely different storage mechanism, and no one will notice.\n\nThe use of mocks for out-of-process dependencies that you have a full control over also leads to brittle tests. You don’t want your tests to turn red every time you split a table in the database or modify the type of one of the parameters in a stored procedure. The database and your application must be treated as one system.\n\nThis distinction splits out-of-process dependencies into two subcategories:\n\nManaged dependencies — out-of-process dependencies you have full control over. These dependencies are only accessible through your application; interactions with them aren’t visible to the external world. A typical example is the application database. External systems don’t access your database directly; they do that through the API your application provides.\n\nUnmanaged dependencies — out-of-process dependencies you don’t have full control over. Interactions with such dependencies are observable externally. Examples include an SMTP server and a message bus: both produce side effects visible to other applications.\n\nOnly unmanaged dependencies should be replaced with mocks. Use real instances of managed dependencies in tests.\n\nOnly unmanaged dependencies can be replaced with mocks\nFurther reading\n\nOf course, using real instances of managed dependencies in tests poses an obvious issue: how do you test them such that your tests remain fast and reliable?\n\nYou’ll see this subject covered in depth in my book:\n\n\t\n\n\n\t\n\nUnit Testing Principles, Practices, and Patterns\n\nSummary\n\nTest double is an overarching term that describes all kinds of non-production-ready, fake dependencies in tests.\n\nThere are five variations of test doubles — dummy, stub, spy, mock, and fake — that can be grouped in just two types: mocks and stubs.\n\nSpies are functionally the same as mocks; dummies and fakes serve the same role as stubs.\n\nThe differences between mocks vs stubs:\n\nMocks help emulate and examine outcoming interactions: calls from the SUT to its dependencies that change the state of those dependencies.\n\nStubs help emulate incoming interactions: calls the SUT makes to its dependencies to get input data.\n\nAsserting interactions with stubs always leads to fragile tests.\n\nTest doubles that substitute CQS commands are mocks. Test doubles that substitute CQS queries are stubs.\n\nA mock-the-tool is a class from a mocking library that you can use to create a mock-the-test-double or a stub.\n\nOut-of-process dependencies can be categorized into 2 subcategories: managed and unmanaged dependencies.\n\nManaged dependencies are out-of-process dependencies that are only accessible through your application. Interactions with managed dependencies aren’t observable externally. A typical example is the application database.\n\nUnmanaged dependencies are out-of-process dependencies that other applications have access to. Interactions with unmanaged dependencies are observable externally. Typical examples include an SMTP server and a message bus.\n\nCommunications with managed dependencies are implementation details; communications with unmanaged dependencies are part of your system’s observable behavior.\n\nUse real instances of managed dependencies in integration tests; replace unmanaged dependencies with mocks.\n\nRelated\n\nUnit Testing Dependencies: The Complete Guide\n\n← Unit Testing Dependencies: The Complete Guide\nSubscribe\nI don't post everything on my blog. Don't miss smaller tips and updates. Sign up to my mailing list below.\nComments\ncomments powered by Disqus\nTop\nVladimir Khorikov\nMY BOOK\nClick here to get a 40% discount\nPLURALSIGHT COURSES\n‒ Pragmatic Unit Testing\n‒ Domain-Driven Design in Practice\n‒ Applying Functional Principles in C#\n‒ Database Delivery Best Practices\n‒ Specification Pattern in C#\n‒ Refactoring from Anemic Domain Model\n‒ Domain-Driven Design: Working with Legacy Projects\n‒ CQRS in Practice\n‒ DDD and EF Core: Preserving Encapsulation\nMOST POPULAR ARTICLES\n‒ EF Core 2.1 vs NHibernate 5.1: DDD perspective\n‒ C# and F# approaches to illegal states\n‒ Optimistic locking and automatic retry\n‒ Entity vs Value Object: the ultimate list of differences\n‒ DTO vs Value Object vs POCO\n‒ 3 misuses of ?. operator in C# 6\n‒ Specification pattern: C# implementation\n‒ Database versioning best practices\n‒ Unit testing private methods\n‒ Functional C#: Handling failures, input errors\n‒ REST API response codes: 400 vs 500\nRECENT ARTICLES\n‒ When to Mock\n‒ Unit Testing Dependencies: The Complete Guide\n‒ EF Core and DDD: New online course\n‒ 3 things that will make or break your project\n‒ Assertion messages in tests\n‒ Is Entity the same as Value Object?\n‒ DDD and bulk operations\n‒ Combining ASP.NET Core validation attributes with Value Objects\n‒ Advanced error handling techniques\n‒ You are naming your tests wrong!\n\n» All articles\n\n© 2020 Vladimir Khorikov. Made with Hugo."}

{"l":"https://python-patterns.guide/gang-of-four/composition-over-inheritance/","n":"The Composition Over Inheritance Principle","html":"\n    \n    <p class=\"motto\">\n      •\n      <a href=\"/\">Home Page</a>\n      •\n    </p>\n    \n    <article>\n      <div class=\"section\" id=\"the-composition-over-inheritance-principle\">\n<h1>The Composition Over Inheritance Principle<a class=\"headerlink\" href=\"#the-composition-over-inheritance-principle\" title=\"Permalink to this headline\">¶</a></h1>\n<p><em>A principle from the</em> <a class=\"reference internal\" href=\"../\"><span class=\"doc\">Gang of Four book</span></a></p>\n<div class=\"admonition-verdict admonition\">\n<p class=\"first admonition-title\">Verdict</p>\n<p class=\"last\">In Python as in other programming languages,\nthis grand principle encourages software architects\nto escape from Object Orientation\nand enjoy the simpler practices\nof Object Based programming instead.</p>\n</div>\n<p>This is the second principle propounded\nby the <a class=\"reference internal\" href=\"../\"><span class=\"doc\">Gang of Four book</span></a> at the very beginning,\nin its “Introduction” chapter.\nThe principle is so important that they display it indented and in italics,\nlike this:</p>\n<blockquote>\n<div><em>Favor object composition over class inheritance.</em></div></blockquote>\n<p>Let’s take a single design problem\nand watch how this principle works itself out\nthrough several of the classic Gang of Four design patterns.\nEach design pattern will assemble simple classes,\nunburdened by inheritance,\ninto an elegant runtime solution.</p>\n<div class=\"section\" id=\"problem-the-subclass-explosion\">\n<h2>Problem: the subclass explosion<a class=\"headerlink\" href=\"#problem-the-subclass-explosion\" title=\"Permalink to this headline\">¶</a></h2>\n<p>A crucial weakness of inheritance as a design strategy\nis that a class often needs to be specialized\nalong several different design axes at once,\nleading to what the Gang of Four call\n“a proliferation of classes” in their Bridge chapter\nand\n“an explosion of subclasses to support every combination”\nin their Decorator chapter.</p>\n<p>Python’s <a class=\"reference external\" href=\"https://docs.python.org/3/library/logging.html\">logging module</a>\nis a good example in the Standard Library itself\nof a module that follows the Composition Over Inheritance principle,\nso let’s use logging as our example.\nImagine a base logging class\nthat has gradually gained subclasses\nas developers needed to send log messages to new destinations.</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n<span class=\"kn\">import</span> <span class=\"nn\">syslog</span>\n\n<span class=\"c1\"># The initial class.</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">Logger</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"nb\">file</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span> <span class=\"o\">=</span> <span class=\"nb\">file</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">message</span> <span class=\"o\">+</span> <span class=\"s1\">'</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">flush</span><span class=\"p\">()</span>\n\n<span class=\"c1\"># Two more classes, that send messages elsewhere.</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">SocketLogger</span><span class=\"p\">(</span><span class=\"n\">Logger</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">sock</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sock</span> <span class=\"o\">=</span> <span class=\"n\">sock</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sock</span><span class=\"o\">.</span><span class=\"n\">sendall</span><span class=\"p\">((</span><span class=\"n\">message</span> <span class=\"o\">+</span> <span class=\"s1\">'</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s1\">'ascii'</span><span class=\"p\">))</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">SyslogLogger</span><span class=\"p\">(</span><span class=\"n\">Logger</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">priority</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">priority</span> <span class=\"o\">=</span> <span class=\"n\">priority</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"n\">syslog</span><span class=\"o\">.</span><span class=\"n\">syslog</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">priority</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>The problem arises when this first axis of design is joined by another.\nLet’s imagine that log messages now need to be filtered —\nsome users only want to see messages with the word “Error” in them,\nand a developer responds with a new subclass of <code class=\"docutils literal notranslate\"><span class=\"pre\">Logger</span></code>:</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\"># New design direction: filtering messages.</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">FilteredLogger</span><span class=\"p\">(</span><span class=\"n\">Logger</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">pattern</span><span class=\"p\">,</span> <span class=\"nb\">file</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pattern</span> <span class=\"o\">=</span> <span class=\"n\">pattern</span>\n        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"nb\">file</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pattern</span> <span class=\"ow\">in</span> <span class=\"n\">message</span><span class=\"p\">:</span>\n            <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># It works.</span>\n\n<span class=\"n\">f</span> <span class=\"o\">=</span> <span class=\"n\">FilteredLogger</span><span class=\"p\">(</span><span class=\"s1\">'Error'</span><span class=\"p\">,</span> <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"p\">)</span>\n<span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Ignored: this is not important'</span><span class=\"p\">)</span>\n<span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Error: but you want to see this'</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>Error: but you want to see this\n</pre></div>\n</div>\n<p>The trap has now been laid,\nand will be sprung the moment the application\nneeds to filter messages\nbut write them to a socket instead of a file.\nNone of the existing classes covers that case.\nIf the developer plows on ahead with subclassing\nand creates a <code class=\"docutils literal notranslate\"><span class=\"pre\">FilteredSocketLogger</span></code>\nthat combines the features of both classes,\nthen the subclass explosion is underway.</p>\n<p>Maybe the programmer will get lucky\nand no further combinations will be needed.\nBut in the general case the application will wind up with 3×2=6 classes:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">Logger</span>            <span class=\"n\">FilteredLogger</span>\n<span class=\"n\">SocketLogger</span>      <span class=\"n\">FilteredSocketLogger</span>\n<span class=\"n\">SyslogLogger</span>      <span class=\"n\">FilteredSyslogLogger</span>\n</pre></div>\n</div>\n<p>The total number of classes will increase geometrically\nif <em>m</em> and&nbsp;<em>n</em> both continue to grow.\nThis is the “proliferation of classes”\nand “explosion of subclasses”\nthat the Gang of Four want to avoid.</p>\n<p>The solution is to recognize\nthat a class responsible for both filtering messages and logging messages\nis too complicated.\nIn modern Object Oriented practice,\nit would be accused of violating the “Single Responsibility Principle.”</p>\n<p>But how can we distribute\nthe two features of message filtering and message output\nacross different classes?</p>\n</div>\n<div class=\"section\" id=\"solution-1-the-adapter-pattern\">\n<h2>Solution #1: The Adapter Pattern<a class=\"headerlink\" href=\"#solution-1-the-adapter-pattern\" title=\"Permalink to this headline\">¶</a></h2>\n<p>One solution is the Adapter Pattern:\nto decide that the original logger class\ndoesn’t need to be improved,\nbecause any mechanism for outputting messages\ncan be wrapped up to look like the file object that the logger is expecting.</p>\n<ol class=\"arabic simple\">\n<li>So we keep the original <code class=\"docutils literal notranslate\"><span class=\"pre\">Logger</span></code>.</li>\n<li>And we also keep the <code class=\"docutils literal notranslate\"><span class=\"pre\">FilteredLogger</span></code>.</li>\n<li>But instead of creating destination-specific subclasses,\nwe adapt each destination to the behavior of a file\nand then pass the adapter to a <code class=\"docutils literal notranslate\"><span class=\"pre\">Logger</span></code> as its output file.</li>\n</ol>\n<p>Here are adapters for each of the other two outputs:</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">socket</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">FileLikeSocket</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">sock</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sock</span> <span class=\"o\">=</span> <span class=\"n\">sock</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">write</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message_and_newline</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sock</span><span class=\"o\">.</span><span class=\"n\">sendall</span><span class=\"p\">(</span><span class=\"n\">message_and_newline</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s1\">'ascii'</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">flush</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">pass</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">FileLikeSyslog</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">priority</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">priority</span> <span class=\"o\">=</span> <span class=\"n\">priority</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">write</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message_and_newline</span><span class=\"p\">):</span>\n        <span class=\"n\">message</span> <span class=\"o\">=</span> <span class=\"n\">message_and_newline</span><span class=\"o\">.</span><span class=\"n\">rstrip</span><span class=\"p\">(</span><span class=\"s1\">'</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n        <span class=\"n\">syslog</span><span class=\"o\">.</span><span class=\"n\">syslog</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">priority</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">flush</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">pass</span>\n</pre></div>\n</div>\n<p>Python encourages duck typing,\nso an adapter’s only responsibility is to offer the right methods —\nour adapters, for example, are exempt from the need\nto inherit from either the classes they wrap\nor from the <code class=\"docutils literal notranslate\"><span class=\"pre\">file</span></code> type they are imitating.\nThey are also under no obligation to re-implement\nthe full slate of more than a dozen methods that a real file offers.\nJust as it’s not important that a duck can walk if all you need is a quack,\nour adapters only need to implement the two file methods\nthat the <code class=\"docutils literal notranslate\"><span class=\"pre\">Logger</span></code> really uses.</p>\n<p>And so the subclass explosion is avoided!\nLogger objects and adapter objects\ncan be freely mixed and matched at runtime\nwithout the need to create any further classes:</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">sock1</span><span class=\"p\">,</span> <span class=\"n\">sock2</span> <span class=\"o\">=</span> <span class=\"n\">socket</span><span class=\"o\">.</span><span class=\"n\">socketpair</span><span class=\"p\">()</span>\n\n<span class=\"n\">fs</span> <span class=\"o\">=</span> <span class=\"n\">FileLikeSocket</span><span class=\"p\">(</span><span class=\"n\">sock1</span><span class=\"p\">)</span>\n<span class=\"n\">logger</span> <span class=\"o\">=</span> <span class=\"n\">FilteredLogger</span><span class=\"p\">(</span><span class=\"s1\">'Error'</span><span class=\"p\">,</span> <span class=\"n\">fs</span><span class=\"p\">)</span>\n<span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Warning: message number one'</span><span class=\"p\">)</span>\n<span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Error: message number two'</span><span class=\"p\">)</span>\n\n<span class=\"k\">print</span><span class=\"p\">(</span><span class=\"s1\">'The socket received: </span><span class=\"si\">%r</span><span class=\"s1\">'</span> <span class=\"o\">%</span> <span class=\"n\">sock2</span><span class=\"o\">.</span><span class=\"n\">recv</span><span class=\"p\">(</span><span class=\"mi\">512</span><span class=\"p\">))</span>\n</pre></div>\n</div>\n<div class=\"highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>The socket received: b'Error: message number two\\n'\n</pre></div>\n</div>\n<p>Note that it was only for the sake of example\nthat the <code class=\"docutils literal notranslate\"><span class=\"pre\">FileLikeSocket</span></code> class is written out above —\nin real life that adapter comes built-in to Python’s Standard Library.\nSimply call any socket’s <a class=\"reference external\" href=\"https://docs.python.org/3/library/socket.html#socket.socket.makefile\"><code class=\"docutils literal notranslate\"><span class=\"pre\">makefile()</span></code></a> method\nto receive a complete adapter that makes the socket look like a file.</p>\n</div>\n<div class=\"section\" id=\"solution-2-the-bridge-pattern\">\n<h2>Solution #2: The Bridge Pattern<a class=\"headerlink\" href=\"#solution-2-the-bridge-pattern\" title=\"Permalink to this headline\">¶</a></h2>\n<p>The Bridge Pattern splits a class’s behavior\nbetween an outer “abstraction” object that the caller sees\nand an “implementation” object that’s wrapped inside.\nWe can apply the Bridge Pattern to our logging example\nif we make the (perhaps slightly arbitrary) decision\nthat filtering belongs out in the “abstraction” class\nwhile output belongs in the “implementation” class.</p>\n<p>As in the Adapter case,\na separate echelon of classes now governs writing.\nBut instead of having to contort our output classes\nto match the interface of a Python <code class=\"docutils literal notranslate\"><span class=\"pre\">file</span></code> object —\nwhich required the awkward maneuver\nof adding a newline in the logger\nthat sometimes had to be removed again in the adapter —\nwe now get to define the interface of the wrapped class ourselves.</p>\n<p>So let’s design the inner “implementation” object to accept a raw message,\nrather than needing a newline appended,\nand reduce the interface to only a single method <code class=\"docutils literal notranslate\"><span class=\"pre\">emit()</span></code>\ninstead of also having to support a <code class=\"docutils literal notranslate\"><span class=\"pre\">flush()</span></code> method\nthat was usually a no-op.</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\"># The “abstractions” that callers will see.</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">Logger</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">handler</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">handler</span> <span class=\"o\">=</span> <span class=\"n\">handler</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">handler</span><span class=\"o\">.</span><span class=\"n\">emit</span><span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">)</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">FilteredLogger</span><span class=\"p\">(</span><span class=\"n\">Logger</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">pattern</span><span class=\"p\">,</span> <span class=\"n\">handler</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pattern</span> <span class=\"o\">=</span> <span class=\"n\">pattern</span>\n        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"n\">handler</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pattern</span> <span class=\"ow\">in</span> <span class=\"n\">message</span><span class=\"p\">:</span>\n            <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># The “implementations” hidden behind the scenes.</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">FileHandler</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"nb\">file</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span> <span class=\"o\">=</span> <span class=\"nb\">file</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">emit</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">message</span> <span class=\"o\">+</span> <span class=\"s1\">'</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">flush</span><span class=\"p\">()</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">SocketHandler</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">sock</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sock</span> <span class=\"o\">=</span> <span class=\"n\">sock</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">emit</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sock</span><span class=\"o\">.</span><span class=\"n\">sendall</span><span class=\"p\">((</span><span class=\"n\">message</span> <span class=\"o\">+</span> <span class=\"s1\">'</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s1\">'ascii'</span><span class=\"p\">))</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">SyslogHandler</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">priority</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">priority</span> <span class=\"o\">=</span> <span class=\"n\">priority</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">emit</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"n\">syslog</span><span class=\"o\">.</span><span class=\"n\">syslog</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">priority</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Abstraction objects and implementation objects\ncan now be freely combined at runtime:</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">handler</span> <span class=\"o\">=</span> <span class=\"n\">FileHandler</span><span class=\"p\">(</span><span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"p\">)</span>\n<span class=\"n\">logger</span> <span class=\"o\">=</span> <span class=\"n\">FilteredLogger</span><span class=\"p\">(</span><span class=\"s1\">'Error'</span><span class=\"p\">,</span> <span class=\"n\">handler</span><span class=\"p\">)</span>\n\n<span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Ignored: this will not be logged'</span><span class=\"p\">)</span>\n<span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Error: this is important'</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>Error: this is important\n</pre></div>\n</div>\n<p>This presents more symmetry than the Adapter.\nInstead of file output being native to the <code class=\"docutils literal notranslate\"><span class=\"pre\">Logger</span></code>\nbut non-file output requiring an additional class,\na functioning logger is now always built\nby composing an abstraction with an implementation.</p>\n<p>Once again,\nthe subclass explosion is avoided\nbecause two kinds of class are composed together at runtime\nwithout requiring either class to be extended.</p>\n</div>\n<div class=\"section\" id=\"solution-3-the-decorator-pattern\">\n<h2>Solution #3: The Decorator Pattern<a class=\"headerlink\" href=\"#solution-3-the-decorator-pattern\" title=\"Permalink to this headline\">¶</a></h2>\n<p>What if we wanted to apply two different filters to the same log?\nNeither of the above solutions supports multiple filters —\nsay, one filtering by priority and the other matching a keyword.</p>\n<p>Look back at the filters defined in the previous section.\nThe reason we cannot stack two filters\nis that there’s an asymmetry\nbetween the interface they offer and the interface they wrap:\nthey offer a <code class=\"docutils literal notranslate\"><span class=\"pre\">log()</span></code> method\nbut call their handler’s <code class=\"docutils literal notranslate\"><span class=\"pre\">emit()</span></code> method.\nWrapping one filter in another would result in an <code class=\"docutils literal notranslate\"><span class=\"pre\">AttributeError</span></code>\nwhen the outer filter tried to call the inner filter’s <code class=\"docutils literal notranslate\"><span class=\"pre\">emit()</span></code>.</p>\n<p>If we instead pivot our filters and handlers to offering the same interface,\nso that they all alike offer a <code class=\"docutils literal notranslate\"><span class=\"pre\">log()</span></code> method,\nthen we have arrived at the Decorator Pattern:</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\"># The loggers all perform real output.</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">FileLogger</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"nb\">file</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span> <span class=\"o\">=</span> <span class=\"nb\">file</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">message</span> <span class=\"o\">+</span> <span class=\"s1\">'</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">flush</span><span class=\"p\">()</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">SocketLogger</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">sock</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sock</span> <span class=\"o\">=</span> <span class=\"n\">sock</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sock</span><span class=\"o\">.</span><span class=\"n\">sendall</span><span class=\"p\">((</span><span class=\"n\">message</span> <span class=\"o\">+</span> <span class=\"s1\">'</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s1\">'ascii'</span><span class=\"p\">))</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">SyslogLogger</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">priority</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">priority</span> <span class=\"o\">=</span> <span class=\"n\">priority</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"n\">syslog</span><span class=\"o\">.</span><span class=\"n\">syslog</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">priority</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># The filter calls the same method it offers.</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">LogFilter</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">pattern</span><span class=\"p\">,</span> <span class=\"n\">logger</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pattern</span> <span class=\"o\">=</span> <span class=\"n\">pattern</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">logger</span> <span class=\"o\">=</span> <span class=\"n\">logger</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pattern</span> <span class=\"ow\">in</span> <span class=\"n\">message</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>For the first time,\nthe filtering code has moved outside of any particular logger class.\nInstead, it’s now a stand-alone feature\nthat can be wrapped around any logger we want.</p>\n<p>As with our first two solutions,\nfiltering can be combined with output at runtime\nwithout building any special combined classes:</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">log1</span> <span class=\"o\">=</span> <span class=\"n\">FileLogger</span><span class=\"p\">(</span><span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"p\">)</span>\n<span class=\"n\">log2</span> <span class=\"o\">=</span> <span class=\"n\">LogFilter</span><span class=\"p\">(</span><span class=\"s1\">'Error'</span><span class=\"p\">,</span> <span class=\"n\">log1</span><span class=\"p\">)</span>\n\n<span class=\"n\">log1</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Noisy: this logger always produces output'</span><span class=\"p\">)</span>\n\n<span class=\"n\">log2</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Ignored: this will be filtered out'</span><span class=\"p\">)</span>\n<span class=\"n\">log2</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Error: this is important and gets printed'</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>Noisy: this logger always produces output\nError: this is important and gets printed\n</pre></div>\n</div>\n<p>And because Decorator classes are symmetric —\nthey offer exactly the same interface they wrap —\nwe can now stack several different filters atop the same log!</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">log3</span> <span class=\"o\">=</span> <span class=\"n\">LogFilter</span><span class=\"p\">(</span><span class=\"s1\">'severe'</span><span class=\"p\">,</span> <span class=\"n\">log2</span><span class=\"p\">)</span>\n\n<span class=\"n\">log3</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Error: this is bad, but not that bad'</span><span class=\"p\">)</span>\n<span class=\"n\">log3</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Error: this is pretty severe'</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>Error: this is pretty severe\n</pre></div>\n</div>\n<p>But note the one place where the symmetry of this design breaks down:\nwhile filters can be stacked,\noutput routines cannot be combined or stacked.\nLog messages can still only be written to one output.</p>\n</div>\n<div class=\"section\" id=\"solution-4-beyond-the-gang-of-four-patterns\">\n<h2>Solution #4: Beyond the Gang of Four patterns<a class=\"headerlink\" href=\"#solution-4-beyond-the-gang-of-four-patterns\" title=\"Permalink to this headline\">¶</a></h2>\n<p>Python’s logging module wanted even more flexibility:\nnot only to support multiple filters,\nbut to support multiple outputs for a single stream of log messages.\nBased on the design of logging modules in other languages —\nsee <a class=\"reference external\" href=\"https://www.python.org/dev/peps/pep-0282/\">PEP&nbsp;282</a>’s\n“Influences” section for the main inspirations —\nthe Python logging module\nimplements its own Composition Over Inheritance pattern.</p>\n<ol class=\"arabic simple\">\n<li>The <code class=\"docutils literal notranslate\"><span class=\"pre\">Logger</span></code> class that callers interact with\ndoesn’t itself implement either filtering or output.\nInstead, it maintains a list of filters and a list of handlers.</li>\n<li>For each log message,\nthe logger calls each of its filters.\nThe message is discarded if any filter rejects it.</li>\n<li>For each log message that’s accepted by all the filters,\nthe logger loops over its output handlers\nand asks every one of them to <code class=\"docutils literal notranslate\"><span class=\"pre\">emit()</span></code> the message.</li>\n</ol>\n<p>Or, at least, that’s the core of the idea.\nThe Standard Library’s logging is in fact more complicated.\nFor example,\neach handler can carry its own list of filters\nin addition to those listed by its logger.\nAnd each handler also specifies a minimum message “level”\nlike <code class=\"docutils literal notranslate\"><span class=\"pre\">INFO</span></code> or <code class=\"docutils literal notranslate\"><span class=\"pre\">WARN</span></code> that,\nrather confusingly,\nis enforced neither by the handler itself\nnor by any of the handler’s filters,\nbut instead by an <code class=\"docutils literal notranslate\"><span class=\"pre\">if</span></code> statement\nburied deep inside the logger where it loops over the handlers.\nThe total design is thus a bit of a mess.</p>\n<p>But we can use the Standard Library logger’s basic insight —\nthat a logger’s messages\nmight deserve both multiple filters <em>and</em> multiple outputs —\nto decouple filter classes and handler classes entirely:</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\"># There is now only one logger.</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">Logger</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">filters</span><span class=\"p\">,</span> <span class=\"n\">handlers</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filters</span> <span class=\"o\">=</span> <span class=\"n\">filters</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">handlers</span> <span class=\"o\">=</span> <span class=\"n\">handlers</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"nb\">all</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">match</span><span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">f</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filters</span><span class=\"p\">):</span>\n            <span class=\"k\">for</span> <span class=\"n\">h</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">handlers</span><span class=\"p\">:</span>\n                <span class=\"n\">h</span><span class=\"o\">.</span><span class=\"n\">emit</span><span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Filters now know only about strings!</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">TextFilter</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">pattern</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pattern</span> <span class=\"o\">=</span> <span class=\"n\">pattern</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">match</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">text</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pattern</span> <span class=\"ow\">in</span> <span class=\"n\">text</span>\n\n<span class=\"c1\"># Handlers look like “loggers” did in the previous solution.</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">FileHandler</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"nb\">file</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span> <span class=\"o\">=</span> <span class=\"nb\">file</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">emit</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">message</span> <span class=\"o\">+</span> <span class=\"s1\">'</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">flush</span><span class=\"p\">()</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">SocketHandler</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">sock</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sock</span> <span class=\"o\">=</span> <span class=\"n\">sock</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">emit</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sock</span><span class=\"o\">.</span><span class=\"n\">sendall</span><span class=\"p\">((</span><span class=\"n\">message</span> <span class=\"o\">+</span> <span class=\"s1\">'</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s1\">'ascii'</span><span class=\"p\">))</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">SyslogHandler</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">priority</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">priority</span> <span class=\"o\">=</span> <span class=\"n\">priority</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">emit</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"n\">syslog</span><span class=\"o\">.</span><span class=\"n\">syslog</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">priority</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Note that only with this final pivot in our design\ndo filters really shine forth with the simplicity they deserve.\nFor the first time,\nthey accept only a string and return only a verdict.\nAll of the previous designs\neither hid filtering inside one of the logging classes itself,\nor saddled filters with additional duties\nbeyond simply rendering a verdict.</p>\n<p>In fact,\nthe word “log” has dropped entirely away from the name of the filter class,\nand for a very important reason:\nthere’s no longer anything about it that’s specific to logging!\nThe <code class=\"docutils literal notranslate\"><span class=\"pre\">TextFilter</span></code> is now entirely reusable\nin any context that happens to involve strings.\nFinally decoupled from the specific concept of logging,\nit will be easier to test and maintain.</p>\n<p>Again,\nas with all Composition Over Inheritance solutions to a problem,\nclasses are composed at runtime without needing any inheritance:</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">f</span> <span class=\"o\">=</span> <span class=\"n\">TextFilter</span><span class=\"p\">(</span><span class=\"s1\">'Error'</span><span class=\"p\">)</span>\n<span class=\"n\">h</span> <span class=\"o\">=</span> <span class=\"n\">FileHandler</span><span class=\"p\">(</span><span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"p\">)</span>\n<span class=\"n\">logger</span> <span class=\"o\">=</span> <span class=\"n\">Logger</span><span class=\"p\">([</span><span class=\"n\">f</span><span class=\"p\">],</span> <span class=\"p\">[</span><span class=\"n\">h</span><span class=\"p\">])</span>\n\n<span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Ignored: this will not be logged'</span><span class=\"p\">)</span>\n<span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Error: this is important'</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>Error: this is important\n</pre></div>\n</div>\n<p>There’s a crucial lesson here:\ndesign principles like Composition Over Inheritance are,\nin the end,\nmore important than individual patterns like the Adapter or Decorator.\nAlways follow the principle.\nBut don’t always feel constrained\nto choose a pattern from an official list.\nThe design at which we’ve now arrived\nis both more flexible and easier to maintain\nthan any of the previous designs,\neven though they were based on official Gang of Four patterns\nbut this final design is not.\nSometimes, yes, you will find an existing Design Pattern\nthat’s a perfect fit for your problem —\nbut if not,\nyour design might be stronger if you move beyond them.</p>\n</div>\n<div class=\"section\" id=\"dodge-if-statements\">\n<h2>Dodge: “if” statements<a class=\"headerlink\" href=\"#dodge-if-statements\" title=\"Permalink to this headline\">¶</a></h2>\n<p>I suspect that the above code has startled many readers.\nTo a typical Python programmer,\nsuch heavy use of classes might look entirely contrived —\nan awkward exercise in trying to make old ideas from the 1980s\nseem relevant to modern Python.</p>\n<p>When a new design requirement appears,\ndoes the typical Python programmer\nreally go write a new class?\nNo!\n“Simple is better than complex.”\nWhy add a class,\nwhen an <code class=\"docutils literal notranslate\"><span class=\"pre\">if</span></code> statement will work instead?\nA&nbsp;single logger class can gradually accrete conditionals\nuntil it handles all the same cases\nas our previous examples:</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\"># Each new feature as an “if” statement.</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">Logger</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">pattern</span><span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">,</span> <span class=\"nb\">file</span><span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">,</span> <span class=\"n\">sock</span><span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">,</span> <span class=\"n\">priority</span><span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pattern</span> <span class=\"o\">=</span> <span class=\"n\">pattern</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span> <span class=\"o\">=</span> <span class=\"nb\">file</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sock</span> <span class=\"o\">=</span> <span class=\"n\">sock</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">priority</span> <span class=\"o\">=</span> <span class=\"n\">priority</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pattern</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"bp\">None</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pattern</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">message</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"bp\">None</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">message</span> <span class=\"o\">+</span> <span class=\"s1\">'</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">flush</span><span class=\"p\">()</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sock</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"bp\">None</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sock</span><span class=\"o\">.</span><span class=\"n\">sendall</span><span class=\"p\">((</span><span class=\"n\">message</span> <span class=\"o\">+</span> <span class=\"s1\">'</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s1\">'ascii'</span><span class=\"p\">))</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">priority</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"bp\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">syslog</span><span class=\"o\">.</span><span class=\"n\">syslog</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">priority</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Works just fine.</span>\n\n<span class=\"n\">logger</span> <span class=\"o\">=</span> <span class=\"n\">Logger</span><span class=\"p\">(</span><span class=\"n\">pattern</span><span class=\"o\">=</span><span class=\"s1\">'Error'</span><span class=\"p\">,</span> <span class=\"nb\">file</span><span class=\"o\">=</span><span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"p\">)</span>\n\n<span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Warning: not that important'</span><span class=\"p\">)</span>\n<span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Error: this is important'</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>Error: this is important\n</pre></div>\n</div>\n<p>You may recognize this example\nas more typical of the Python design practices\nyou’ve encountered in real applications.</p>\n<p>The <code class=\"docutils literal notranslate\"><span class=\"pre\">if</span></code> statement approach is not entirely without benefit.\nThis class’s whole range of possible behaviors\ncan be grasped in a single reading of the code from top to bottom.\nThe parameter list might look verbose but,\nthanks to Python’s optional keyword arguments,\nmost calls to the class won’t need to provide all four arguments.</p>\n<p>(It’s true that this class can handle only one file and one socket,\nbut that’s an incidental simplification for the sake of readability.\nWe could easily pivot the <code class=\"docutils literal notranslate\"><span class=\"pre\">file</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">socket</span></code> parameters\nto lists named <code class=\"docutils literal notranslate\"><span class=\"pre\">files</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">sockets</span></code>.)</p>\n<p>Given that every Python programmer learns <code class=\"docutils literal notranslate\"><span class=\"pre\">if</span></code> quickly,\nbut can take much longer to understand classes,\nit might seem a clear win\nfor code to rely on the simplest possible mechanism\nthat will get a feature working.\nBut let’s balance that temptation by making explicit what’s been lost\nby dodging Composition Over Inheritance:</p>\n<ol class=\"arabic simple\">\n<li><strong>Locality.</strong>\nReorganizing the code to use <code class=\"docutils literal notranslate\"><span class=\"pre\">if</span></code> statements\nhasn’t been an unmitigated win for readability.\nIf you are tasked with improving or debugging one particular feature —\nsay, the support for writing to a socket —\nyou will find that you can’t read its code all in one place.\nThe code behind that single feature\nis scattered between the initializer’s parameter list,\nthe initializer’s code,\nand the <code class=\"docutils literal notranslate\"><span class=\"pre\">log()</span></code> method itself.</li>\n<li><strong>Deletability.</strong>\nAn underappreciated property of good design\nis that it makes deleting features easy.\nPerhaps only veterans of large and mature Python applications\nwill strongly enough appreciate\nthe importance of code deletion to a project’s health.\nIn the case of our class-based solutions,\nwe can trivially delete a feature like logging to a socket\nby removing the <code class=\"docutils literal notranslate\"><span class=\"pre\">SocketHandler</span></code> class and its unit tests\nonce the application no longer needs it.\nBy contrast,\ndeleting the socket feature from the forest of <code class=\"docutils literal notranslate\"><span class=\"pre\">if</span></code> statements\nnot only requires caution\nto avoid breaking adjacent code,\nbut raises the awkward question of what to do\nwith the <code class=\"docutils literal notranslate\"><span class=\"pre\">socket</span></code> parameter in the initializer.\nCan it be removed?\nNot if we need to keep the list of positional parameters consistent —\nwe would need to retain the parameter,\nbut raise an exception if it’s ever used.</li>\n<li><strong>Dead code analysis.</strong>\nRelated to the previous point\nis the fact that when we use Composition Over Inheritance,\ndead code analyzers\ncan trivially detect\nwhen the last use of <code class=\"docutils literal notranslate\"><span class=\"pre\">SocketHandler</span></code> in the codebase disappears.\nBut dead code analysis is often helpless to make a determination like\n“you can now remove all the attributes and <code class=\"docutils literal notranslate\"><span class=\"pre\">if</span></code> statements\nrelated to socket output,\nbecause no surviving call to the initializer\npasses anything for <code class=\"docutils literal notranslate\"><span class=\"pre\">socket</span></code> other than <code class=\"docutils literal notranslate\"><span class=\"pre\">None</span></code>.”</li>\n<li><strong>Testing.</strong>\nOne of the strongest signals about code health that our tests provide\nis how many lines of irrelevant code have to run\nbefore reaching the line under test.\nTesting a feature like logging to a socket is easy\nif the test can simply spin up a <code class=\"docutils literal notranslate\"><span class=\"pre\">SocketHandler</span></code> instance,\npass it a live socket,\nand ask it to <code class=\"docutils literal notranslate\"><span class=\"pre\">emit()</span></code> a message.\nNo code runs except code relevant to the feature.\nBut testing socket logging in our forest of <code class=\"docutils literal notranslate\"><span class=\"pre\">if</span></code> statements\nwill run at least three times the number of lines of code.\nHaving to set up a logger\nwith the right combination of several features\nmerely to test one of them\nis an important warning sign,\nthat might seem trivial in this small example\nbut becomes crucial as a system grows larger.</li>\n<li><strong>Efficiency.</strong>\nI’m deliberately putting this point last,\nbecause readability and maintainability\nare generally more important concerns.\nBut the design problems with the forest of <code class=\"docutils literal notranslate\"><span class=\"pre\">if</span></code> statements\nare also signalled by the approach’s inefficiency.\nEven if you want a simple unfiltered log to a single file,\nevery single message will be forced to run an <code class=\"docutils literal notranslate\"><span class=\"pre\">if</span></code> statement\nagainst every possible feature you could have enabled.\nThe technique of composition, by contrast,\nonly runs code for the features you’ve composed together.</li>\n</ol>\n<p>For all of these reasons,\nI suggest that the apparent simplicity of the <code class=\"docutils literal notranslate\"><span class=\"pre\">if</span></code> statement forest\nis, from the point of view of software design, largely an illusion.\nThe ability to read the logger top-to-bottom as a single piece of code\ncomes at the cost of several other kinds of conceptual expense\nthat will grow sharply with the size of the codebase.</p>\n</div>\n<div class=\"section\" id=\"dodge-multiple-inheritance\">\n<h2>Dodge: Multiple Inheritance<a class=\"headerlink\" href=\"#dodge-multiple-inheritance\" title=\"Permalink to this headline\">¶</a></h2>\n<p>Some Python projects\nfall short of practicing Composition Over Inheritance\nbecause they are tempted to dodge the principle\nby means of a controversial feature of the Python language:\nmultiple inheritance.</p>\n<p>Let’s return to the example code we started with,\nwhere <code class=\"docutils literal notranslate\"><span class=\"pre\">FilteredLogger</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">SocketLogger</span></code>\nwere two different subclasses of a base <code class=\"docutils literal notranslate\"><span class=\"pre\">Logger</span></code> class.\nIn a language that only supported single inheritance,\na <code class=\"docutils literal notranslate\"><span class=\"pre\">FilteredSocketLogger</span></code>\nwould have to choose\nto inherit either from <code class=\"docutils literal notranslate\"><span class=\"pre\">SocketLogger</span></code> or <code class=\"docutils literal notranslate\"><span class=\"pre\">FilteredLogger</span></code>,\nand would then have to duplicate code from the other class.</p>\n<p>But Python supports multiple inheritance,\nso the new <code class=\"docutils literal notranslate\"><span class=\"pre\">FilteredSocketLogger</span></code>\ncan list both <code class=\"docutils literal notranslate\"><span class=\"pre\">SocketLogger</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">FilteredLogger</span></code> as base classes\nand inherit from both:</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\"># Our original example’s base class and subclasses.</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">Logger</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"nb\">file</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span> <span class=\"o\">=</span> <span class=\"nb\">file</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">message</span> <span class=\"o\">+</span> <span class=\"s1\">'</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">flush</span><span class=\"p\">()</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">SocketLogger</span><span class=\"p\">(</span><span class=\"n\">Logger</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">sock</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sock</span> <span class=\"o\">=</span> <span class=\"n\">sock</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sock</span><span class=\"o\">.</span><span class=\"n\">sendall</span><span class=\"p\">((</span><span class=\"n\">message</span> <span class=\"o\">+</span> <span class=\"s1\">'</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s1\">'ascii'</span><span class=\"p\">))</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">FilteredLogger</span><span class=\"p\">(</span><span class=\"n\">Logger</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">pattern</span><span class=\"p\">,</span> <span class=\"nb\">file</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pattern</span> <span class=\"o\">=</span> <span class=\"n\">pattern</span>\n        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"nb\">file</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pattern</span> <span class=\"ow\">in</span> <span class=\"n\">message</span><span class=\"p\">:</span>\n            <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># A class derived through multiple inheritance.</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">FilteredSocketLogger</span><span class=\"p\">(</span><span class=\"n\">FilteredLogger</span><span class=\"p\">,</span> <span class=\"n\">SocketLogger</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">pattern</span><span class=\"p\">,</span> <span class=\"n\">sock</span><span class=\"p\">):</span>\n        <span class=\"n\">FilteredLogger</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">pattern</span><span class=\"p\">,</span> <span class=\"bp\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">SocketLogger</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">sock</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Works just fine.</span>\n\n<span class=\"n\">logger</span> <span class=\"o\">=</span> <span class=\"n\">FilteredSocketLogger</span><span class=\"p\">(</span><span class=\"s1\">'Error'</span><span class=\"p\">,</span> <span class=\"n\">sock1</span><span class=\"p\">)</span>\n<span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Warning: not that important'</span><span class=\"p\">)</span>\n<span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Error: this is important'</span><span class=\"p\">)</span>\n\n<span class=\"k\">print</span><span class=\"p\">(</span><span class=\"s1\">'The socket received: </span><span class=\"si\">%r</span><span class=\"s1\">'</span> <span class=\"o\">%</span> <span class=\"n\">sock2</span><span class=\"o\">.</span><span class=\"n\">recv</span><span class=\"p\">(</span><span class=\"mi\">512</span><span class=\"p\">))</span>\n</pre></div>\n</div>\n<div class=\"highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>The socket received: b'Error: this is important\\n'\n</pre></div>\n</div>\n<p>This bears several striking resemblances\nto our Decorator Pattern solution.\nIn both cases:</p>\n<ul class=\"simple\">\n<li>There’s a logger class for each kind of output\n(instead of our Adapter’s asymmetry\nbetween writing files directly\nbut non-files through an adapter).</li>\n<li>The <code class=\"docutils literal notranslate\"><span class=\"pre\">message</span></code> preserves the exact value provided by the caller\n(instead of our Adapter’s habit\nof replacing it with a file-specific value\nby appending a newline).</li>\n<li>The filter and loggers are symmetric\nin that they both implement the same method <code class=\"docutils literal notranslate\"><span class=\"pre\">log()</span></code>.\n(Our other solutions besides the Decorator\nhad filter classes offering one method\nand output classes offering another).</li>\n<li>The filter never tries to produce output on its own but,\nif a message survives filtering,\ndefers the task of output to other code.</li>\n</ul>\n<p>These close similarities\nwith our earlier Decorator solution\nmean that we can compare it with this new code\nto make an unusually sharp comparison\nbetween Composition Over Inheritance and multiple inheritance.\nLet’s sharpen the focus still further with a question:</p>\n<p><em>If we have thorough unit tests for both the logger and filter,\nhow confident are we that they will work together?</em></p>\n<ol class=\"arabic\">\n<li><p class=\"first\">The success of the Decorator example\ndepends only on the public behaviors of each class:\nthat the <code class=\"docutils literal notranslate\"><span class=\"pre\">LogFilter</span></code> offers a <code class=\"docutils literal notranslate\"><span class=\"pre\">log()</span></code> method\nthat in turn calls <code class=\"docutils literal notranslate\"><span class=\"pre\">log()</span></code> on the object it wraps\n(which a test can trivially verify using a tiny fake logger),\nand that each logger offers a working <code class=\"docutils literal notranslate\"><span class=\"pre\">log()</span></code> method.\nAs long as our unit tests verify these two public behaviors,\nwe can’t break composition\nwithout failing our unit tests.</p>\n<p>Multiple inheritance, by contrast,\ndepends on behavior that cannot be verified\nby simply instantiating the classes in question.\nThe public behavior of a <code class=\"docutils literal notranslate\"><span class=\"pre\">FilteredLogger</span></code>\nis that it offers a <code class=\"docutils literal notranslate\"><span class=\"pre\">log()</span></code> method\nthat both filters and writes to a file.\nBut multiple inheritance doesn’t merely depend on that public behavior,\nbut on how that behavior is implemented internally.\nMultiple inheritance will work\nif the method is deferring to its base class using <code class=\"docutils literal notranslate\"><span class=\"pre\">super()</span></code>,\nbut not if the method does its own <code class=\"docutils literal notranslate\"><span class=\"pre\">write()</span></code> to the file,\neven though either implementation would satisfy the unit test.</p>\n<p>A test suite must therefore go beyond unit testing\nand perform actual multiple inheritance on the class —\nor else monkey patch to verify that <code class=\"docutils literal notranslate\"><span class=\"pre\">log()</span></code> calls <code class=\"docutils literal notranslate\"><span class=\"pre\">super().log()</span></code> —\nto guarantee that multiple inheritance keeps working\nas future developers work on the code.</p>\n</li>\n<li><p class=\"first\">Multiple inheritance has introduced a new <code class=\"docutils literal notranslate\"><span class=\"pre\">__init__()</span></code> method\nbecause neither base class’s <code class=\"docutils literal notranslate\"><span class=\"pre\">__init__()</span></code> method\naccepts enough arguments for a combined filter and logger.\nThat new code needs to be tested,\nso at least one test will be necessary\nfor every new subclass.</p>\n<p>You might be tempted to concoct a scheme\nto avoid a new <code class=\"docutils literal notranslate\"><span class=\"pre\">__init__()</span></code> for every subclass,\nlike accepting <code class=\"docutils literal notranslate\"><span class=\"pre\">*args</span></code> and then passing them on to <code class=\"docutils literal notranslate\"><span class=\"pre\">super().__init__()</span></code>.\n(If you do pursue that approach,\nreview the classic essay “<a class=\"reference external\" href=\"https://fuhm.net/super-harmful/\">Python’s Super Considered Harmful</a>”\nwhich argues that only <code class=\"docutils literal notranslate\"><span class=\"pre\">**kw</span></code> is in fact safe.)\nThe problem with such a scheme is that it hurts readability —\nyou can no longer figure out what arguments an <code class=\"docutils literal notranslate\"><span class=\"pre\">__init__()</span></code> method takes\nsimply by reading its parameter list.\nAnd type checking tools\nwill no longer be able to guarantee correctness.</p>\n<p>But whether you give each derived class its own <code class=\"docutils literal notranslate\"><span class=\"pre\">__init__()</span></code>\nor design them to chain together,\nyour unit tests of the original <code class=\"docutils literal notranslate\"><span class=\"pre\">FilteredLogger</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">SocketLogger</span></code>\ncan’t by themselves guarantee\nthat the classes initialize correctly when combined.</p>\n<p>By contrast,\nthe Decorator’s design leaves its initializers\nhappily and strictly orthogonal.\nThe filter accepts its <code class=\"docutils literal notranslate\"><span class=\"pre\">pattern</span></code>,\nthe logger accepts its <code class=\"docutils literal notranslate\"><span class=\"pre\">sock</span></code>,\nand there is no possible conflict between the two.</p>\n</li>\n<li><p class=\"first\">Finally,\nit’s possible that two classes work fine on their own,\nbut have class or instance attributes with the same name\nthat will collide\nwhen the classes are combined through multiple inheritance.</p>\n<p>Yes,\nour small examples here\nmake the chance of collision look too small to worry about —\nbut remember that these examples are merely standing in\nfor the vastly more complicated classes\nyou might write in real applications.</p>\n<p>Whether the programmer writes tests to guard against collision\nby running <code class=\"docutils literal notranslate\"><span class=\"pre\">dir()</span></code> on instances of each class\nand checking for attributes they have in common,\nor by writing an integration test\nfor every possible subclass,\nthe original unit tests of the two separate classes\nwill once again have failed to guarantee\nthat they can combine cleanly through multiple inheritance.</p>\n</li>\n</ol>\n<p>For any of these reasons,\nthe unit tests of two base classes can stay green\neven as their ability to be combined through multiple inheritance\nis broken.\nThis means that the Gang of Four’s\n“explosion of subclasses to support every combination”\nwill also afflict your tests.\nOnly by testing\nevery combination of <em>m</em>×<em>n</em> base classes in your application\ncan you make it safe for the application to use such classes at runtime.</p>\n<p>In addition to breaking the guarantees of unit testing,\nmultiple inheritance involves at least three further liabilities.</p>\n<ol class=\"arabic simple\" start=\"4\">\n<li>Introspection is simple in the Decorator case.\nSimply <code class=\"docutils literal notranslate\"><span class=\"pre\">print(my_filter.logger)</span></code> or view that attribute in a debugger\nto see what sort of output logger is attached.\nIn the case of multiple inheritance, however,\nyou can only learn which filter and logger have been combined\nby examining the metadata of the class itself —\neither by reading its <code class=\"docutils literal notranslate\"><span class=\"pre\">__mro__</span></code>\nor subjecting the object to a series of <code class=\"docutils literal notranslate\"><span class=\"pre\">isinstance()</span></code> tests.</li>\n<li>It’s trivial in the Decorator case\nto take a live combination of a filter and logger\nand at runtime to swap in a different logger\nthrough assignment to the <code class=\"docutils literal notranslate\"><span class=\"pre\">.logger</span></code> attribute —\nsay, because the user has just toggled a preference\nin the application’s interface.\nBut to do the same in the multiple inheritance case\nwould require the rather more objectionable maneuver\nof overwriting the object’s class.\nWhile changing an object’s class at runtime\nis not impossible in a dynamic language like Python,\nit’s generally considered a symptom\nthat software design has gone wrong.</li>\n<li>Finally,\nmultiple inheritance provides no built-in mechanism\nto help the programmer order the base classes correctly.\nThe <code class=\"docutils literal notranslate\"><span class=\"pre\">FilteredSocketLogger</span></code>\nwon’t successfully write to a socket if its base classes are swapped and,\nas dozens of Stack Overflow questions attest,\nPython programmers have perpetual difficultly\nwith putting third-party base classes in the right order.\nThe Decorator pattern, by contrast,\nmakes it obvious which way the classes compose:\nthe filter’s <code class=\"docutils literal notranslate\"><span class=\"pre\">__init__()</span></code> wants a <code class=\"docutils literal notranslate\"><span class=\"pre\">logger</span></code> object,\nbut the logger’s <code class=\"docutils literal notranslate\"><span class=\"pre\">__init__()</span></code> doesn’t ask for a <code class=\"docutils literal notranslate\"><span class=\"pre\">filter</span></code>.</li>\n</ol>\n<p>Multiple inheritance, then,\nincurs a number of liabilities\nwithout adding a single advantage.\nAt least in this example,\nsolving a design problem with inheritance\nis strictly worse than a design based on composition.</p>\n</div>\n<div class=\"section\" id=\"dodge-mixins\">\n<h2>Dodge: Mixins<a class=\"headerlink\" href=\"#dodge-mixins\" title=\"Permalink to this headline\">¶</a></h2>\n<p>The <code class=\"docutils literal notranslate\"><span class=\"pre\">FilteredSocketLogger</span></code> in the previous section\nneeded its own custom <code class=\"docutils literal notranslate\"><span class=\"pre\">__init__()</span></code> method\nbecause it needed to accept arguments for both of its base classes.\nBut it turns out that this liability\ncan be avoided.\nOf course,\nin cases where a subclass doesn’t require any extra data,\nthe problem doesn’t arise.\nBut even classes that do require extra data\ncan have it delivered by other means.</p>\n<p>We can make the <code class=\"docutils literal notranslate\"><span class=\"pre\">FilteredLogger</span></code>\nmore friendly to multiple inheritance\nif we provide a default value for <code class=\"docutils literal notranslate\"><span class=\"pre\">pattern</span></code> in the class itself\nand then invite callers to customize the attribute directly,\nout-of-band of initialization:</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\"># Don’t accept a “pattern” during initialization.</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">FilteredLogger</span><span class=\"p\">(</span><span class=\"n\">Logger</span><span class=\"p\">):</span>\n    <span class=\"n\">pattern</span> <span class=\"o\">=</span> <span class=\"s1\">''</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pattern</span> <span class=\"ow\">in</span> <span class=\"n\">message</span><span class=\"p\">:</span>\n            <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Multiple inheritance is now simpler.</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">FilteredSocketLogger</span><span class=\"p\">(</span><span class=\"n\">FilteredLogger</span><span class=\"p\">,</span> <span class=\"n\">SocketLogger</span><span class=\"p\">):</span>\n    <span class=\"k\">pass</span>  <span class=\"c1\"># This subclass needs no extra code!</span>\n\n<span class=\"c1\"># The caller can just set “pattern” directly.</span>\n\n<span class=\"n\">logger</span> <span class=\"o\">=</span> <span class=\"n\">FilteredSocketLogger</span><span class=\"p\">(</span><span class=\"n\">sock1</span><span class=\"p\">)</span>\n<span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">pattern</span> <span class=\"o\">=</span> <span class=\"s1\">'Error'</span>\n\n<span class=\"c1\"># Works just fine.</span>\n\n<span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Warning: not that important'</span><span class=\"p\">)</span>\n<span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Error: this is important'</span><span class=\"p\">)</span>\n\n<span class=\"k\">print</span><span class=\"p\">(</span><span class=\"s1\">'The socket received: </span><span class=\"si\">%r</span><span class=\"s1\">'</span> <span class=\"o\">%</span> <span class=\"n\">sock2</span><span class=\"o\">.</span><span class=\"n\">recv</span><span class=\"p\">(</span><span class=\"mi\">512</span><span class=\"p\">))</span>\n</pre></div>\n</div>\n<div class=\"highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>The socket received: b'Error: this is important\\n'\n</pre></div>\n</div>\n<p>Having pivoted the <code class=\"docutils literal notranslate\"><span class=\"pre\">FilteredLogger</span></code>\nto an initialization maneuver\nthat’s orthogonal to that of its base class,\nwhy not push the idea of orthogonality to its logical conclusion?\nWe can convert the <code class=\"docutils literal notranslate\"><span class=\"pre\">FilteredLogger</span></code> to a “mixin”\nthat lives entirely outside the class hierarchy\nwith which multiple inheritance will combine it.</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\"># Simplify the filter by making it a mixin.</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">FilterMixin</span><span class=\"p\">:</span>  <span class=\"c1\"># No base class!</span>\n    <span class=\"n\">pattern</span> <span class=\"o\">=</span> <span class=\"s1\">''</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pattern</span> <span class=\"ow\">in</span> <span class=\"n\">message</span><span class=\"p\">:</span>\n            <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Multiple inheritance looks the same as above.</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">FilteredLogger</span><span class=\"p\">(</span><span class=\"n\">FilterMixin</span><span class=\"p\">,</span> <span class=\"n\">FileLogger</span><span class=\"p\">):</span>\n    <span class=\"k\">pass</span>  <span class=\"c1\"># Again, the subclass needs no extra code.</span>\n\n<span class=\"c1\"># Works just fine.</span>\n\n<span class=\"n\">logger</span> <span class=\"o\">=</span> <span class=\"n\">FilteredLogger</span><span class=\"p\">(</span><span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"p\">)</span>\n<span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">pattern</span> <span class=\"o\">=</span> <span class=\"s1\">'Error'</span>\n<span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Warning: not that important'</span><span class=\"p\">)</span>\n<span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"s1\">'Error: this is important'</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>Error: this is important\n</pre></div>\n</div>\n<p>The mixin is conceptually simpler\nthan the filtered subclass we saw in the last section:\nit has no base class that might complicate method resolution order,\nso <code class=\"docutils literal notranslate\"><span class=\"pre\">super()</span></code> will always call\nthe next base class listed in the <code class=\"docutils literal notranslate\"><span class=\"pre\">class</span></code> statement.</p>\n<p>A mixin also has a simpler testing story than the equivalent subclass.\nWhereas the <code class=\"docutils literal notranslate\"><span class=\"pre\">FilteredLogger</span></code> would need tests\nthat both run it standalone\nand also combine it with other classes,\nthe <code class=\"docutils literal notranslate\"><span class=\"pre\">FilterMixin</span></code> only needs tests that combine it with a logger.\nBecause the mixin is by itself incomplete,\na test can’t even be written that runs it standalone.</p>\n<p>But all the other liabilities of multiple inheritance still apply.\nSo while the mixin pattern\ndoes improve the readability and conceptual simplicity\nof multiple inheritance,\nit’s not a complete solution for its problems.</p>\n</div>\n<div class=\"section\" id=\"dodge-building-classes-dynamically\">\n<h2>Dodge: Building classes dynamically<a class=\"headerlink\" href=\"#dodge-building-classes-dynamically\" title=\"Permalink to this headline\">¶</a></h2>\n<p>As we saw in the previous two sections,\nneither traditional multiple inheritance nor mixins\nsolve the Gang of Four’s problem\nof “an explosion of subclasses to support every combination” —\nthey merely avoid code duplication when two classes need to be combined.</p>\n<p>Multiple inheritance still requires, in the general case,\n“a proliferation of classes” with <em>m</em>×<em>n</em> class statements\nthat each look like:</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">class</span> <span class=\"nc\">FilteredSocketLogger</span><span class=\"p\">(</span><span class=\"n\">FilteredLogger</span><span class=\"p\">,</span> <span class=\"n\">SocketLogger</span><span class=\"p\">):</span>\n    <span class=\"o\">...</span>\n</pre></div>\n</div>\n<p>But it turns out that Python offers a workaround.</p>\n<p>Imagine that our application reads a configuration file\nto learn the log filter and log destination it should use,\na file whose contents aren’t known until runtime.\nInstead of building all <em>m</em>×<em>n</em> possible classes ahead of time\nand then selecting the right one,\nwe can wait and take advantage of the fact\nthat Python not only supports the <code class=\"docutils literal notranslate\"><span class=\"pre\">class</span></code> statement\nbut a builtin <code class=\"docutils literal notranslate\"><span class=\"pre\">type()</span></code> function\nthat creates new classes dynamically at runtime:</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\"># Imagine 2 filtered loggers and 3 output loggers.</span>\n\n<span class=\"n\">filters</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"s1\">'pattern'</span><span class=\"p\">:</span> <span class=\"n\">PatternFilteredLog</span><span class=\"p\">,</span>\n    <span class=\"s1\">'severity'</span><span class=\"p\">:</span> <span class=\"n\">SeverityFilteredLog</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n<span class=\"n\">outputs</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"s1\">'file'</span><span class=\"p\">:</span> <span class=\"n\">FileLog</span><span class=\"p\">,</span>\n    <span class=\"s1\">'socket'</span><span class=\"p\">:</span> <span class=\"n\">SocketLog</span><span class=\"p\">,</span>\n    <span class=\"s1\">'syslog'</span><span class=\"p\">:</span> <span class=\"n\">SyslogLog</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\"># Select the two classes we want to combine.</span>\n\n<span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"s1\">'config'</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n    <span class=\"n\">filter_name</span><span class=\"p\">,</span> <span class=\"n\">output_name</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">()</span>\n\n<span class=\"n\">filter_cls</span> <span class=\"o\">=</span> <span class=\"n\">filters</span><span class=\"p\">[</span><span class=\"n\">filter_name</span><span class=\"p\">]</span>\n<span class=\"n\">output_cls</span> <span class=\"o\">=</span> <span class=\"n\">outputs</span><span class=\"p\">[</span><span class=\"n\">output_name</span><span class=\"p\">]</span>\n\n<span class=\"c1\"># Build a new derived class (!)</span>\n\n<span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">filter_name</span><span class=\"o\">.</span><span class=\"n\">replace</span><span class=\"p\">(</span><span class=\"s1\">'Log'</span><span class=\"p\">,</span> <span class=\"s1\">''</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"n\">output_name</span>\n<span class=\"bp\">cls</span> <span class=\"o\">=</span> <span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"n\">filter_cls</span><span class=\"p\">,</span> <span class=\"n\">output_cls</span><span class=\"p\">),</span> <span class=\"p\">{})</span>\n\n<span class=\"c1\"># Call it as usual to produce an instance.</span>\n\n<span class=\"n\">logger</span> <span class=\"o\">=</span> <span class=\"bp\">cls</span><span class=\"p\">(</span><span class=\"o\">...</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>The tuple of classes passed to <code class=\"docutils literal notranslate\"><span class=\"pre\">type()</span></code>\nhas the same meaning\nas the series of base classes in a <code class=\"docutils literal notranslate\"><span class=\"pre\">class</span></code> statement.\nThe <code class=\"docutils literal notranslate\"><span class=\"pre\">type()</span></code> call above creates a new class\nthrough multiple inheritance from both a filtered logger and an output logger.</p>\n<p>Before you ask:\nyes,\nit would also work\nto build a <code class=\"docutils literal notranslate\"><span class=\"pre\">class</span></code> statement as plain text\nand then pass it to <code class=\"docutils literal notranslate\"><span class=\"pre\">eval()</span></code>.</p>\n<p>But building classes on-the-fly carries severe liabilities.</p>\n<ul class=\"simple\">\n<li>Readability suffers.\nA&nbsp;human reading the above snippet of code\nwill have to do extra work\nto determine what sort of object an instance of <code class=\"docutils literal notranslate\"><span class=\"pre\">cls</span></code> is.\nAlso, many Python programmers\naren’t familiar with <code class=\"docutils literal notranslate\"><span class=\"pre\">type()</span></code>\nand will need to stop and puzzle over its documentation.\nIf they have difficulty with the novel concept\nthat classes can be defined dynamically,\nthey might still be confused.</li>\n<li>If a constructed class like <code class=\"docutils literal notranslate\"><span class=\"pre\">PatternFilteredFileLog</span></code>\nis named in an exception or error message,\nthe developer will probably be unhappy to discover\nthat nothing comes up when they search the code for that class name.\nDebugging becomes more difficult\nwhen you cannot even locate a class.\nConsiderable time may be spent\nsearching the codebase for <code class=\"docutils literal notranslate\"><span class=\"pre\">type()</span></code> calls\nand trying to determine which one generated the class.\nSometimes developers have to resort\nto calling each method with bad arguments\nand using the line numbers in the resulting tracebacks\nto track down the base classes.</li>\n<li>Type introspection will, in the general case,\nfail for classes constructed dynamically at runtime.\n“Jump to class” shortcuts in your editor\nwon’t have anywhere to take you\nwhen you highlight an instance of <code class=\"docutils literal notranslate\"><span class=\"pre\">PatternFilteredFileLog</span></code>\nin the debugger.\nAnd type checking engines like\n<a class=\"reference external\" href=\"https://github.com/python/mypy\">mypy</a>\nand <a class=\"reference external\" href=\"https://github.com/facebook/pyre-check\">pyre-check</a>\nwill be unlikely to offer the strong protections for your generated class\nthat they’re able to provide\nfor normal Python classes.</li>\n<li>The beautiful Jupyter Notebook feature <code class=\"docutils literal notranslate\"><span class=\"pre\">%autoreload</span></code>\npossesses a nearly preternatural ability\nto detect and reload modified source code in a live Python interpreter.\nBut it’s foiled, for example, by the multiple inheritance classes\nthat <a class=\"reference external\" href=\"https://github.com/matplotlib/matplotlib/blob/54b426397c0e7567edaee4f7f77036c2b8569573/lib/matplotlib/axes/_subplots.py#L180\">matplotlib builds at runtime</a>\nthrough <code class=\"docutils literal notranslate\"><span class=\"pre\">type()</span></code> calls inside its <code class=\"docutils literal notranslate\"><span class=\"pre\">subplot_class_factory()</span></code>.</li>\n</ul>\n<p>Once its liabilities are weighed,\nthe attempt to use runtime class generation as a last-ditch maneuver\nto rescue the already faulty mechanism of multiple inheritance\nstands as a <em>reductio ad absurdum</em>\nof the entire project of dodging Composition Over Inheritance\nwhen you need an object’s behavior\nto vary over several independent axes.</p>\n</div>\n</div>\n\n    </article>\n    <hr>\n    <p class=\"copyright\">\n      ©&nbsp;2018–2020&nbsp;<a href=\"http://rhodesmill.org/brandon/\">Brandon&nbsp;Rhodes</a>\n    </p>\n  \n","text":"• Home Page •\n\nThe Composition Over Inheritance Principle¶\n\nA principle from the Gang of Four book\n\nVerdict\n\nIn Python as in other programming languages, this grand principle encourages software architects to escape from Object Orientation and enjoy the simpler practices of Object Based programming instead.\n\nThis is the second principle propounded by the Gang of Four book at the very beginning, in its “Introduction” chapter. The principle is so important that they display it indented and in italics, like this:\n\nFavor object composition over class inheritance.\n\nLet’s take a single design problem and watch how this principle works itself out through several of the classic Gang of Four design patterns. Each design pattern will assemble simple classes, unburdened by inheritance, into an elegant runtime solution.\n\nProblem: the subclass explosion¶\n\nA crucial weakness of inheritance as a design strategy is that a class often needs to be specialized along several different design axes at once, leading to what the Gang of Four call “a proliferation of classes” in their Bridge chapter and “an explosion of subclasses to support every combination” in their Decorator chapter.\n\nPython’s logging module is a good example in the Standard Library itself of a module that follows the Composition Over Inheritance principle, so let’s use logging as our example. Imagine a base logging class that has gradually gained subclasses as developers needed to send log messages to new destinations.\n\nimport sys\nimport syslog\n\n# The initial class.\n\nclass Logger(object):\n    def __init__(self, file):\n        self.file = file\n\n    def log(self, message):\n        self.file.write(message + '\\n')\n        self.file.flush()\n\n# Two more classes, that send messages elsewhere.\n\nclass SocketLogger(Logger):\n    def __init__(self, sock):\n        self.sock = sock\n\n    def log(self, message):\n        self.sock.sendall((message + '\\n').encode('ascii'))\n\nclass SyslogLogger(Logger):\n    def __init__(self, priority):\n        self.priority = priority\n\n    def log(self, message):\n        syslog.syslog(self.priority, message)\n\n\nThe problem arises when this first axis of design is joined by another. Let’s imagine that log messages now need to be filtered — some users only want to see messages with the word “Error” in them, and a developer responds with a new subclass of Logger:\n\n# New design direction: filtering messages.\n\nclass FilteredLogger(Logger):\n    def __init__(self, pattern, file):\n        self.pattern = pattern\n        super().__init__(file)\n\n    def log(self, message):\n        if self.pattern in message:\n            super().log(message)\n\n# It works.\n\nf = FilteredLogger('Error', sys.stdout)\nf.log('Ignored: this is not important')\nf.log('Error: but you want to see this')\n\nError: but you want to see this\n\n\nThe trap has now been laid, and will be sprung the moment the application needs to filter messages but write them to a socket instead of a file. None of the existing classes covers that case. If the developer plows on ahead with subclassing and creates a FilteredSocketLogger that combines the features of both classes, then the subclass explosion is underway.\n\nMaybe the programmer will get lucky and no further combinations will be needed. But in the general case the application will wind up with 3×2=6 classes:\n\nLogger            FilteredLogger\nSocketLogger      FilteredSocketLogger\nSyslogLogger      FilteredSyslogLogger\n\n\nThe total number of classes will increase geometrically if m and n both continue to grow. This is the “proliferation of classes” and “explosion of subclasses” that the Gang of Four want to avoid.\n\nThe solution is to recognize that a class responsible for both filtering messages and logging messages is too complicated. In modern Object Oriented practice, it would be accused of violating the “Single Responsibility Principle.”\n\nBut how can we distribute the two features of message filtering and message output across different classes?\n\nSolution #1: The Adapter Pattern¶\n\nOne solution is the Adapter Pattern: to decide that the original logger class doesn’t need to be improved, because any mechanism for outputting messages can be wrapped up to look like the file object that the logger is expecting.\n\nSo we keep the original Logger.\nAnd we also keep the FilteredLogger.\nBut instead of creating destination-specific subclasses, we adapt each destination to the behavior of a file and then pass the adapter to a Logger as its output file.\n\nHere are adapters for each of the other two outputs:\n\nimport socket\n\nclass FileLikeSocket:\n    def __init__(self, sock):\n        self.sock = sock\n\n    def write(self, message_and_newline):\n        self.sock.sendall(message_and_newline.encode('ascii'))\n\n    def flush(self):\n        pass\n\nclass FileLikeSyslog:\n    def __init__(self, priority):\n        self.priority = priority\n\n    def write(self, message_and_newline):\n        message = message_and_newline.rstrip('\\n')\n        syslog.syslog(self.priority, message)\n\n    def flush(self):\n        pass\n\n\nPython encourages duck typing, so an adapter’s only responsibility is to offer the right methods — our adapters, for example, are exempt from the need to inherit from either the classes they wrap or from the file type they are imitating. They are also under no obligation to re-implement the full slate of more than a dozen methods that a real file offers. Just as it’s not important that a duck can walk if all you need is a quack, our adapters only need to implement the two file methods that the Logger really uses.\n\nAnd so the subclass explosion is avoided! Logger objects and adapter objects can be freely mixed and matched at runtime without the need to create any further classes:\n\nsock1, sock2 = socket.socketpair()\n\nfs = FileLikeSocket(sock1)\nlogger = FilteredLogger('Error', fs)\nlogger.log('Warning: message number one')\nlogger.log('Error: message number two')\n\nprint('The socket received: %r' % sock2.recv(512))\n\nThe socket received: b'Error: message number two\\n'\n\n\nNote that it was only for the sake of example that the FileLikeSocket class is written out above — in real life that adapter comes built-in to Python’s Standard Library. Simply call any socket’s makefile() method to receive a complete adapter that makes the socket look like a file.\n\nSolution #2: The Bridge Pattern¶\n\nThe Bridge Pattern splits a class’s behavior between an outer “abstraction” object that the caller sees and an “implementation” object that’s wrapped inside. We can apply the Bridge Pattern to our logging example if we make the (perhaps slightly arbitrary) decision that filtering belongs out in the “abstraction” class while output belongs in the “implementation” class.\n\nAs in the Adapter case, a separate echelon of classes now governs writing. But instead of having to contort our output classes to match the interface of a Python file object — which required the awkward maneuver of adding a newline in the logger that sometimes had to be removed again in the adapter — we now get to define the interface of the wrapped class ourselves.\n\nSo let’s design the inner “implementation” object to accept a raw message, rather than needing a newline appended, and reduce the interface to only a single method emit() instead of also having to support a flush() method that was usually a no-op.\n\n# The “abstractions” that callers will see.\n\nclass Logger(object):\n    def __init__(self, handler):\n        self.handler = handler\n\n    def log(self, message):\n        self.handler.emit(message)\n\nclass FilteredLogger(Logger):\n    def __init__(self, pattern, handler):\n        self.pattern = pattern\n        super().__init__(handler)\n\n    def log(self, message):\n        if self.pattern in message:\n            super().log(message)\n\n# The “implementations” hidden behind the scenes.\n\nclass FileHandler:\n    def __init__(self, file):\n        self.file = file\n\n    def emit(self, message):\n        self.file.write(message + '\\n')\n        self.file.flush()\n\nclass SocketHandler:\n    def __init__(self, sock):\n        self.sock = sock\n\n    def emit(self, message):\n        self.sock.sendall((message + '\\n').encode('ascii'))\n\nclass SyslogHandler:\n    def __init__(self, priority):\n        self.priority = priority\n\n    def emit(self, message):\n        syslog.syslog(self.priority, message)\n\n\nAbstraction objects and implementation objects can now be freely combined at runtime:\n\nhandler = FileHandler(sys.stdout)\nlogger = FilteredLogger('Error', handler)\n\nlogger.log('Ignored: this will not be logged')\nlogger.log('Error: this is important')\n\nError: this is important\n\n\nThis presents more symmetry than the Adapter. Instead of file output being native to the Logger but non-file output requiring an additional class, a functioning logger is now always built by composing an abstraction with an implementation.\n\nOnce again, the subclass explosion is avoided because two kinds of class are composed together at runtime without requiring either class to be extended.\n\nSolution #3: The Decorator Pattern¶\n\nWhat if we wanted to apply two different filters to the same log? Neither of the above solutions supports multiple filters — say, one filtering by priority and the other matching a keyword.\n\nLook back at the filters defined in the previous section. The reason we cannot stack two filters is that there’s an asymmetry between the interface they offer and the interface they wrap: they offer a log() method but call their handler’s emit() method. Wrapping one filter in another would result in an AttributeError when the outer filter tried to call the inner filter’s emit().\n\nIf we instead pivot our filters and handlers to offering the same interface, so that they all alike offer a log() method, then we have arrived at the Decorator Pattern:\n\n# The loggers all perform real output.\n\nclass FileLogger:\n    def __init__(self, file):\n        self.file = file\n\n    def log(self, message):\n        self.file.write(message + '\\n')\n        self.file.flush()\n\nclass SocketLogger:\n    def __init__(self, sock):\n        self.sock = sock\n\n    def log(self, message):\n        self.sock.sendall((message + '\\n').encode('ascii'))\n\nclass SyslogLogger:\n    def __init__(self, priority):\n        self.priority = priority\n\n    def log(self, message):\n        syslog.syslog(self.priority, message)\n\n# The filter calls the same method it offers.\n\nclass LogFilter:\n    def __init__(self, pattern, logger):\n        self.pattern = pattern\n        self.logger = logger\n\n    def log(self, message):\n        if self.pattern in message:\n            self.logger.log(message)\n\n\nFor the first time, the filtering code has moved outside of any particular logger class. Instead, it’s now a stand-alone feature that can be wrapped around any logger we want.\n\nAs with our first two solutions, filtering can be combined with output at runtime without building any special combined classes:\n\nlog1 = FileLogger(sys.stdout)\nlog2 = LogFilter('Error', log1)\n\nlog1.log('Noisy: this logger always produces output')\n\nlog2.log('Ignored: this will be filtered out')\nlog2.log('Error: this is important and gets printed')\n\nNoisy: this logger always produces output\nError: this is important and gets printed\n\n\nAnd because Decorator classes are symmetric — they offer exactly the same interface they wrap — we can now stack several different filters atop the same log!\n\nlog3 = LogFilter('severe', log2)\n\nlog3.log('Error: this is bad, but not that bad')\nlog3.log('Error: this is pretty severe')\n\nError: this is pretty severe\n\n\nBut note the one place where the symmetry of this design breaks down: while filters can be stacked, output routines cannot be combined or stacked. Log messages can still only be written to one output.\n\nSolution #4: Beyond the Gang of Four patterns¶\n\nPython’s logging module wanted even more flexibility: not only to support multiple filters, but to support multiple outputs for a single stream of log messages. Based on the design of logging modules in other languages — see PEP 282’s “Influences” section for the main inspirations — the Python logging module implements its own Composition Over Inheritance pattern.\n\nThe Logger class that callers interact with doesn’t itself implement either filtering or output. Instead, it maintains a list of filters and a list of handlers.\nFor each log message, the logger calls each of its filters. The message is discarded if any filter rejects it.\nFor each log message that’s accepted by all the filters, the logger loops over its output handlers and asks every one of them to emit() the message.\n\nOr, at least, that’s the core of the idea. The Standard Library’s logging is in fact more complicated. For example, each handler can carry its own list of filters in addition to those listed by its logger. And each handler also specifies a minimum message “level” like INFO or WARN that, rather confusingly, is enforced neither by the handler itself nor by any of the handler’s filters, but instead by an if statement buried deep inside the logger where it loops over the handlers. The total design is thus a bit of a mess.\n\nBut we can use the Standard Library logger’s basic insight — that a logger’s messages might deserve both multiple filters and multiple outputs — to decouple filter classes and handler classes entirely:\n\n# There is now only one logger.\n\nclass Logger:\n    def __init__(self, filters, handlers):\n        self.filters = filters\n        self.handlers = handlers\n\n    def log(self, message):\n        if all(f.match(message) for f in self.filters):\n            for h in self.handlers:\n                h.emit(message)\n\n# Filters now know only about strings!\n\nclass TextFilter:\n    def __init__(self, pattern):\n        self.pattern = pattern\n\n    def match(self, text):\n        return self.pattern in text\n\n# Handlers look like “loggers” did in the previous solution.\n\nclass FileHandler:\n    def __init__(self, file):\n        self.file = file\n\n    def emit(self, message):\n        self.file.write(message + '\\n')\n        self.file.flush()\n\nclass SocketHandler:\n    def __init__(self, sock):\n        self.sock = sock\n\n    def emit(self, message):\n        self.sock.sendall((message + '\\n').encode('ascii'))\n\nclass SyslogHandler:\n    def __init__(self, priority):\n        self.priority = priority\n\n    def emit(self, message):\n        syslog.syslog(self.priority, message)\n\n\nNote that only with this final pivot in our design do filters really shine forth with the simplicity they deserve. For the first time, they accept only a string and return only a verdict. All of the previous designs either hid filtering inside one of the logging classes itself, or saddled filters with additional duties beyond simply rendering a verdict.\n\nIn fact, the word “log” has dropped entirely away from the name of the filter class, and for a very important reason: there’s no longer anything about it that’s specific to logging! The TextFilter is now entirely reusable in any context that happens to involve strings. Finally decoupled from the specific concept of logging, it will be easier to test and maintain.\n\nAgain, as with all Composition Over Inheritance solutions to a problem, classes are composed at runtime without needing any inheritance:\n\nf = TextFilter('Error')\nh = FileHandler(sys.stdout)\nlogger = Logger([f], [h])\n\nlogger.log('Ignored: this will not be logged')\nlogger.log('Error: this is important')\n\nError: this is important\n\n\nThere’s a crucial lesson here: design principles like Composition Over Inheritance are, in the end, more important than individual patterns like the Adapter or Decorator. Always follow the principle. But don’t always feel constrained to choose a pattern from an official list. The design at which we’ve now arrived is both more flexible and easier to maintain than any of the previous designs, even though they were based on official Gang of Four patterns but this final design is not. Sometimes, yes, you will find an existing Design Pattern that’s a perfect fit for your problem — but if not, your design might be stronger if you move beyond them.\n\nDodge: “if” statements¶\n\nI suspect that the above code has startled many readers. To a typical Python programmer, such heavy use of classes might look entirely contrived — an awkward exercise in trying to make old ideas from the 1980s seem relevant to modern Python.\n\nWhen a new design requirement appears, does the typical Python programmer really go write a new class? No! “Simple is better than complex.” Why add a class, when an if statement will work instead? A single logger class can gradually accrete conditionals until it handles all the same cases as our previous examples:\n\n# Each new feature as an “if” statement.\n\nclass Logger:\n    def __init__(self, pattern=None, file=None, sock=None, priority=None):\n        self.pattern = pattern\n        self.file = file\n        self.sock = sock\n        self.priority = priority\n\n    def log(self, message):\n        if self.pattern is not None:\n            if self.pattern not in message:\n                return\n        if self.file is not None:\n            self.file.write(message + '\\n')\n            self.file.flush()\n        if self.sock is not None:\n            self.sock.sendall((message + '\\n').encode('ascii'))\n        if self.priority is not None:\n            syslog.syslog(self.priority, message)\n\n# Works just fine.\n\nlogger = Logger(pattern='Error', file=sys.stdout)\n\nlogger.log('Warning: not that important')\nlogger.log('Error: this is important')\n\nError: this is important\n\n\nYou may recognize this example as more typical of the Python design practices you’ve encountered in real applications.\n\nThe if statement approach is not entirely without benefit. This class’s whole range of possible behaviors can be grasped in a single reading of the code from top to bottom. The parameter list might look verbose but, thanks to Python’s optional keyword arguments, most calls to the class won’t need to provide all four arguments.\n\n(It’s true that this class can handle only one file and one socket, but that’s an incidental simplification for the sake of readability. We could easily pivot the file and socket parameters to lists named files and sockets.)\n\nGiven that every Python programmer learns if quickly, but can take much longer to understand classes, it might seem a clear win for code to rely on the simplest possible mechanism that will get a feature working. But let’s balance that temptation by making explicit what’s been lost by dodging Composition Over Inheritance:\n\nLocality. Reorganizing the code to use if statements hasn’t been an unmitigated win for readability. If you are tasked with improving or debugging one particular feature — say, the support for writing to a socket — you will find that you can’t read its code all in one place. The code behind that single feature is scattered between the initializer’s parameter list, the initializer’s code, and the log() method itself.\nDeletability. An underappreciated property of good design is that it makes deleting features easy. Perhaps only veterans of large and mature Python applications will strongly enough appreciate the importance of code deletion to a project’s health. In the case of our class-based solutions, we can trivially delete a feature like logging to a socket by removing the SocketHandler class and its unit tests once the application no longer needs it. By contrast, deleting the socket feature from the forest of if statements not only requires caution to avoid breaking adjacent code, but raises the awkward question of what to do with the socket parameter in the initializer. Can it be removed? Not if we need to keep the list of positional parameters consistent — we would need to retain the parameter, but raise an exception if it’s ever used.\nDead code analysis. Related to the previous point is the fact that when we use Composition Over Inheritance, dead code analyzers can trivially detect when the last use of SocketHandler in the codebase disappears. But dead code analysis is often helpless to make a determination like “you can now remove all the attributes and if statements related to socket output, because no surviving call to the initializer passes anything for socket other than None.”\nTesting. One of the strongest signals about code health that our tests provide is how many lines of irrelevant code have to run before reaching the line under test. Testing a feature like logging to a socket is easy if the test can simply spin up a SocketHandler instance, pass it a live socket, and ask it to emit() a message. No code runs except code relevant to the feature. But testing socket logging in our forest of if statements will run at least three times the number of lines of code. Having to set up a logger with the right combination of several features merely to test one of them is an important warning sign, that might seem trivial in this small example but becomes crucial as a system grows larger.\nEfficiency. I’m deliberately putting this point last, because readability and maintainability are generally more important concerns. But the design problems with the forest of if statements are also signalled by the approach’s inefficiency. Even if you want a simple unfiltered log to a single file, every single message will be forced to run an if statement against every possible feature you could have enabled. The technique of composition, by contrast, only runs code for the features you’ve composed together.\n\nFor all of these reasons, I suggest that the apparent simplicity of the if statement forest is, from the point of view of software design, largely an illusion. The ability to read the logger top-to-bottom as a single piece of code comes at the cost of several other kinds of conceptual expense that will grow sharply with the size of the codebase.\n\nDodge: Multiple Inheritance¶\n\nSome Python projects fall short of practicing Composition Over Inheritance because they are tempted to dodge the principle by means of a controversial feature of the Python language: multiple inheritance.\n\nLet’s return to the example code we started with, where FilteredLogger and SocketLogger were two different subclasses of a base Logger class. In a language that only supported single inheritance, a FilteredSocketLogger would have to choose to inherit either from SocketLogger or FilteredLogger, and would then have to duplicate code from the other class.\n\nBut Python supports multiple inheritance, so the new FilteredSocketLogger can list both SocketLogger and FilteredLogger as base classes and inherit from both:\n\n# Our original example’s base class and subclasses.\n\nclass Logger(object):\n    def __init__(self, file):\n        self.file = file\n\n    def log(self, message):\n        self.file.write(message + '\\n')\n        self.file.flush()\n\nclass SocketLogger(Logger):\n    def __init__(self, sock):\n        self.sock = sock\n\n    def log(self, message):\n        self.sock.sendall((message + '\\n').encode('ascii'))\n\nclass FilteredLogger(Logger):\n    def __init__(self, pattern, file):\n        self.pattern = pattern\n        super().__init__(file)\n\n    def log(self, message):\n        if self.pattern in message:\n            super().log(message)\n\n# A class derived through multiple inheritance.\n\nclass FilteredSocketLogger(FilteredLogger, SocketLogger):\n    def __init__(self, pattern, sock):\n        FilteredLogger.__init__(self, pattern, None)\n        SocketLogger.__init__(self, sock)\n\n# Works just fine.\n\nlogger = FilteredSocketLogger('Error', sock1)\nlogger.log('Warning: not that important')\nlogger.log('Error: this is important')\n\nprint('The socket received: %r' % sock2.recv(512))\n\nThe socket received: b'Error: this is important\\n'\n\n\nThis bears several striking resemblances to our Decorator Pattern solution. In both cases:\n\nThere’s a logger class for each kind of output (instead of our Adapter’s asymmetry between writing files directly but non-files through an adapter).\nThe message preserves the exact value provided by the caller (instead of our Adapter’s habit of replacing it with a file-specific value by appending a newline).\nThe filter and loggers are symmetric in that they both implement the same method log(). (Our other solutions besides the Decorator had filter classes offering one method and output classes offering another).\nThe filter never tries to produce output on its own but, if a message survives filtering, defers the task of output to other code.\n\nThese close similarities with our earlier Decorator solution mean that we can compare it with this new code to make an unusually sharp comparison between Composition Over Inheritance and multiple inheritance. Let’s sharpen the focus still further with a question:\n\nIf we have thorough unit tests for both the logger and filter, how confident are we that they will work together?\n\nThe success of the Decorator example depends only on the public behaviors of each class: that the LogFilter offers a log() method that in turn calls log() on the object it wraps (which a test can trivially verify using a tiny fake logger), and that each logger offers a working log() method. As long as our unit tests verify these two public behaviors, we can’t break composition without failing our unit tests.\n\nMultiple inheritance, by contrast, depends on behavior that cannot be verified by simply instantiating the classes in question. The public behavior of a FilteredLogger is that it offers a log() method that both filters and writes to a file. But multiple inheritance doesn’t merely depend on that public behavior, but on how that behavior is implemented internally. Multiple inheritance will work if the method is deferring to its base class using super(), but not if the method does its own write() to the file, even though either implementation would satisfy the unit test.\n\nA test suite must therefore go beyond unit testing and perform actual multiple inheritance on the class — or else monkey patch to verify that log() calls super().log() — to guarantee that multiple inheritance keeps working as future developers work on the code.\n\nMultiple inheritance has introduced a new __init__() method because neither base class’s __init__() method accepts enough arguments for a combined filter and logger. That new code needs to be tested, so at least one test will be necessary for every new subclass.\n\nYou might be tempted to concoct a scheme to avoid a new __init__() for every subclass, like accepting *args and then passing them on to super().__init__(). (If you do pursue that approach, review the classic essay “Python’s Super Considered Harmful” which argues that only **kw is in fact safe.) The problem with such a scheme is that it hurts readability — you can no longer figure out what arguments an __init__() method takes simply by reading its parameter list. And type checking tools will no longer be able to guarantee correctness.\n\nBut whether you give each derived class its own __init__() or design them to chain together, your unit tests of the original FilteredLogger and SocketLogger can’t by themselves guarantee that the classes initialize correctly when combined.\n\nBy contrast, the Decorator’s design leaves its initializers happily and strictly orthogonal. The filter accepts its pattern, the logger accepts its sock, and there is no possible conflict between the two.\n\nFinally, it’s possible that two classes work fine on their own, but have class or instance attributes with the same name that will collide when the classes are combined through multiple inheritance.\n\nYes, our small examples here make the chance of collision look too small to worry about — but remember that these examples are merely standing in for the vastly more complicated classes you might write in real applications.\n\nWhether the programmer writes tests to guard against collision by running dir() on instances of each class and checking for attributes they have in common, or by writing an integration test for every possible subclass, the original unit tests of the two separate classes will once again have failed to guarantee that they can combine cleanly through multiple inheritance.\n\nFor any of these reasons, the unit tests of two base classes can stay green even as their ability to be combined through multiple inheritance is broken. This means that the Gang of Four’s “explosion of subclasses to support every combination” will also afflict your tests. Only by testing every combination of m×n base classes in your application can you make it safe for the application to use such classes at runtime.\n\nIn addition to breaking the guarantees of unit testing, multiple inheritance involves at least three further liabilities.\n\nIntrospection is simple in the Decorator case. Simply print(my_filter.logger) or view that attribute in a debugger to see what sort of output logger is attached. In the case of multiple inheritance, however, you can only learn which filter and logger have been combined by examining the metadata of the class itself — either by reading its __mro__ or subjecting the object to a series of isinstance() tests.\nIt’s trivial in the Decorator case to take a live combination of a filter and logger and at runtime to swap in a different logger through assignment to the .logger attribute — say, because the user has just toggled a preference in the application’s interface. But to do the same in the multiple inheritance case would require the rather more objectionable maneuver of overwriting the object’s class. While changing an object’s class at runtime is not impossible in a dynamic language like Python, it’s generally considered a symptom that software design has gone wrong.\nFinally, multiple inheritance provides no built-in mechanism to help the programmer order the base classes correctly. The FilteredSocketLogger won’t successfully write to a socket if its base classes are swapped and, as dozens of Stack Overflow questions attest, Python programmers have perpetual difficultly with putting third-party base classes in the right order. The Decorator pattern, by contrast, makes it obvious which way the classes compose: the filter’s __init__() wants a logger object, but the logger’s __init__() doesn’t ask for a filter.\n\nMultiple inheritance, then, incurs a number of liabilities without adding a single advantage. At least in this example, solving a design problem with inheritance is strictly worse than a design based on composition.\n\nDodge: Mixins¶\n\nThe FilteredSocketLogger in the previous section needed its own custom __init__() method because it needed to accept arguments for both of its base classes. But it turns out that this liability can be avoided. Of course, in cases where a subclass doesn’t require any extra data, the problem doesn’t arise. But even classes that do require extra data can have it delivered by other means.\n\nWe can make the FilteredLogger more friendly to multiple inheritance if we provide a default value for pattern in the class itself and then invite callers to customize the attribute directly, out-of-band of initialization:\n\n# Don’t accept a “pattern” during initialization.\n\nclass FilteredLogger(Logger):\n    pattern = ''\n\n    def log(self, message):\n        if self.pattern in message:\n            super().log(message)\n\n# Multiple inheritance is now simpler.\n\nclass FilteredSocketLogger(FilteredLogger, SocketLogger):\n    pass  # This subclass needs no extra code!\n\n# The caller can just set “pattern” directly.\n\nlogger = FilteredSocketLogger(sock1)\nlogger.pattern = 'Error'\n\n# Works just fine.\n\nlogger.log('Warning: not that important')\nlogger.log('Error: this is important')\n\nprint('The socket received: %r' % sock2.recv(512))\n\nThe socket received: b'Error: this is important\\n'\n\n\nHaving pivoted the FilteredLogger to an initialization maneuver that’s orthogonal to that of its base class, why not push the idea of orthogonality to its logical conclusion? We can convert the FilteredLogger to a “mixin” that lives entirely outside the class hierarchy with which multiple inheritance will combine it.\n\n# Simplify the filter by making it a mixin.\n\nclass FilterMixin:  # No base class!\n    pattern = ''\n\n    def log(self, message):\n        if self.pattern in message:\n            super().log(message)\n\n# Multiple inheritance looks the same as above.\n\nclass FilteredLogger(FilterMixin, FileLogger):\n    pass  # Again, the subclass needs no extra code.\n\n# Works just fine.\n\nlogger = FilteredLogger(sys.stdout)\nlogger.pattern = 'Error'\nlogger.log('Warning: not that important')\nlogger.log('Error: this is important')\n\nError: this is important\n\n\nThe mixin is conceptually simpler than the filtered subclass we saw in the last section: it has no base class that might complicate method resolution order, so super() will always call the next base class listed in the class statement.\n\nA mixin also has a simpler testing story than the equivalent subclass. Whereas the FilteredLogger would need tests that both run it standalone and also combine it with other classes, the FilterMixin only needs tests that combine it with a logger. Because the mixin is by itself incomplete, a test can’t even be written that runs it standalone.\n\nBut all the other liabilities of multiple inheritance still apply. So while the mixin pattern does improve the readability and conceptual simplicity of multiple inheritance, it’s not a complete solution for its problems.\n\nDodge: Building classes dynamically¶\n\nAs we saw in the previous two sections, neither traditional multiple inheritance nor mixins solve the Gang of Four’s problem of “an explosion of subclasses to support every combination” — they merely avoid code duplication when two classes need to be combined.\n\nMultiple inheritance still requires, in the general case, “a proliferation of classes” with m×n class statements that each look like:\n\nclass FilteredSocketLogger(FilteredLogger, SocketLogger):\n    ...\n\n\nBut it turns out that Python offers a workaround.\n\nImagine that our application reads a configuration file to learn the log filter and log destination it should use, a file whose contents aren’t known until runtime. Instead of building all m×n possible classes ahead of time and then selecting the right one, we can wait and take advantage of the fact that Python not only supports the class statement but a builtin type() function that creates new classes dynamically at runtime:\n\n# Imagine 2 filtered loggers and 3 output loggers.\n\nfilters = {\n    'pattern': PatternFilteredLog,\n    'severity': SeverityFilteredLog,\n}\noutputs = {\n    'file': FileLog,\n    'socket': SocketLog,\n    'syslog': SyslogLog,\n}\n\n# Select the two classes we want to combine.\n\nwith open('config') as f:\n    filter_name, output_name = f.read().split()\n\nfilter_cls = filters[filter_name]\noutput_cls = outputs[output_name]\n\n# Build a new derived class (!)\n\nname = filter_name.replace('Log', '') + output_name\ncls = type(name, (filter_cls, output_cls), {})\n\n# Call it as usual to produce an instance.\n\nlogger = cls(...)\n\n\nThe tuple of classes passed to type() has the same meaning as the series of base classes in a class statement. The type() call above creates a new class through multiple inheritance from both a filtered logger and an output logger.\n\nBefore you ask: yes, it would also work to build a class statement as plain text and then pass it to eval().\n\nBut building classes on-the-fly carries severe liabilities.\n\nReadability suffers. A human reading the above snippet of code will have to do extra work to determine what sort of object an instance of cls is. Also, many Python programmers aren’t familiar with type() and will need to stop and puzzle over its documentation. If they have difficulty with the novel concept that classes can be defined dynamically, they might still be confused.\nIf a constructed class like PatternFilteredFileLog is named in an exception or error message, the developer will probably be unhappy to discover that nothing comes up when they search the code for that class name. Debugging becomes more difficult when you cannot even locate a class. Considerable time may be spent searching the codebase for type() calls and trying to determine which one generated the class. Sometimes developers have to resort to calling each method with bad arguments and using the line numbers in the resulting tracebacks to track down the base classes.\nType introspection will, in the general case, fail for classes constructed dynamically at runtime. “Jump to class” shortcuts in your editor won’t have anywhere to take you when you highlight an instance of PatternFilteredFileLog in the debugger. And type checking engines like mypy and pyre-check will be unlikely to offer the strong protections for your generated class that they’re able to provide for normal Python classes.\nThe beautiful Jupyter Notebook feature %autoreload possesses a nearly preternatural ability to detect and reload modified source code in a live Python interpreter. But it’s foiled, for example, by the multiple inheritance classes that matplotlib builds at runtime through type() calls inside its subplot_class_factory().\n\nOnce its liabilities are weighed, the attempt to use runtime class generation as a last-ditch maneuver to rescue the already faulty mechanism of multiple inheritance stands as a reductio ad absurdum of the entire project of dodging Composition Over Inheritance when you need an object’s behavior to vary over several independent axes.\n\n© 2018–2020 Brandon Rhodes"}

{"l":"https://advancedweb.hu/debugging-bash-scripts/","n":"Debugging Bash scripts","html":" <script> window.fbAsyncInit = function() { FB.init({ appId : '317666098421059', xfbml : true, version : 'v2.2' }); }; (function(d, s, id){ var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) {return;} js = d.createElement(s); js.id = id; js.src = \"//connect.facebook.net/en_US/sdk.js\"; fjs.parentNode.insertBefore(js, fjs); }(document, 'script', 'facebook-jssdk')); </script><ins class=\"adsbygoogle adsbygoogle-noablate\" data-adsbygoogle-status=\"done\" style=\"display: none !important;\"><ins id=\"aswift_0_expand\" style=\"display:inline-table;border:none;height:0px;margin:0;padding:0;position:relative;visibility:visible;width:0px;background-color:transparent;\"><ins id=\"aswift_0_anchor\" style=\"display:block;border:none;height:0px;margin:0;padding:0;position:relative;visibility:visible;width:0px;background-color:transparent;\"><iframe id=\"aswift_0\" name=\"aswift_0\" style=\"left:0;position:absolute;top:0;border:0;width:undefinedpx;height:undefinedpx;\" sandbox=\"allow-forms allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation\" frameborder=\"0\" src=\"https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-3273530520589701&amp;output=html&amp;adk=1812271804&amp;adf=3025194257&amp;lmt=1587476139&amp;plat=1%3A8%2C2%3A8%2C8%3A8%2C9%3A32776%2C16%3A8388608%2C17%3A32%2C24%3A32%2C25%3A32%2C30%3A1048576%2C32%3A32%2C40%3A32&amp;guci=2.2.0.0.2.2.0.0&amp;format=0x0&amp;url=https%3A%2F%2Fadvancedweb.hu%2Fdebugging-bash-scripts%2F&amp;ea=0&amp;flash=0&amp;pra=5&amp;wgl=1&amp;adsid=NT&amp;dt=1587600986659&amp;bpp=14&amp;bdt=328&amp;idt=368&amp;shv=r20200416&amp;cbv=r20190131&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;nras=1&amp;correlator=6490099404244&amp;frm=20&amp;pv=2&amp;ga_vid=398819556.1587600987&amp;ga_sid=1587600987&amp;ga_hid=1494488136&amp;ga_fc=0&amp;iag=0&amp;icsg=42&amp;dssz=4&amp;mdo=0&amp;mso=0&amp;u_tz=480&amp;u_his=2&amp;u_java=0&amp;u_h=1080&amp;u_w=1920&amp;u_ah=1040&amp;u_aw=1920&amp;u_cd=24&amp;u_nplug=3&amp;u_nmime=4&amp;adx=-12245933&amp;ady=-12245933&amp;biw=800&amp;bih=600&amp;scr_x=0&amp;scr_y=0&amp;eid=21065472%2C21065474%2C26835106&amp;oid=3&amp;pvsid=1200563511232471&amp;pem=283&amp;rx=0&amp;eae=2&amp;fc=1920&amp;brdim=10%2C10%2C10%2C10%2C1920%2C0%2C945%2C1020%2C800%2C600&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=8216&amp;bc=31&amp;ifi=0&amp;uci=a!0&amp;fsb=1&amp;dtd=419\" marginwidth=\"0\" marginheight=\"0\" vspace=\"0\" hspace=\"0\" allowtransparency=\"true\" scrolling=\"no\" allowfullscreen=\"true\" data-google-container-id=\"a!0\" data-load-complete=\"true\"></iframe></ins></ins></ins><iframe id=\"google_osd_static_frame_9264052869895\" name=\"google_osd_static_frame\" style=\"display: none; width: 0px; height: 0px;\"></iframe> <header> <div class=\"widewrapper masthead clearfix\"> <div class=\"container\"> <a href=\"/\" id=\"logo\"> <img alt=\"logo\" integrity=\"sha256-Jx3dCMlT4m2WaLK2k0Tdp4up/vL6UvQ70Ukfj/Aql+0=\" crossorigin=\"anonymous\" src=\"/assets/awm-logo-271ddd08c953e26d9668b2b69344dda78ba9fef2fa52f43bd1491f8ff02a97ed.png\"> </a> <div id=\"mobile-nav-toggle\" class=\"float-right\"> <a href=\"#\" data-toggle=\"collapse\" data-target=\".tales-nav .navbar-collapse\"> <i class=\"fa fa-bars\"></i> </a> </div> <a class=\"float-right top-rss-icon\" href=\"/rss.xml\"> <i class=\"fa fa-rss\"></i> </a> <nav class=\"float-right tales-nav navbar navbar-expand-lg p-0\"> <div class=\"collapse navbar-collapse\"> <ul class=\"nav nav-pills navbar-nav\"> <li><a href=\"/\" class=\"nav-link\">Blog</a></li> <li><a href=\"/archive.html\" class=\"nav-link\">Archive</a></li> <li><a href=\"/aboutus.html\" class=\"nav-link\">About Us</a></li> </ul> </div> </nav> </div> </div> </header> <div class=\"widewrapper main\"> <div class=\"container-fluid\"> <div class=\"row\"> <div class=\"col-lg-7 offset-lg-2 blog-main\"> <script> var currentPostUrl='https://advancedweb.hu/debugging-bash-scripts/'; var isBlogPost = true; </script> <article class=\"blog-post\"> <header> <h1>Debugging Bash scripts</h1> <h2 class=\"mb-4\"><small class=\"page-tagline text-muted\">Tips for linting, tracing and debugging</small></h2> <div class=\"lead-image \"> <img class=\"image-background\" integrity=\"sha256-tkwU32pRMxzwsJEDsFFyhxC5rpi4jFfI3v6b4d6e+Fo=\" crossorigin=\"anonymous\" src=\"/assets/post-images/bash_debug-b64c14df6a51331cf0b09103b051728710b9ae98b88c57c8defe9be1de9ef85a.jpg\"> <div class=\"meta clearfix\"> <div class=\"author\"> <i class=\"fa fa-user\"></i> <a class=\"data\" href=\"/dodie.html\">Dávid Csákvári</a> </div> <div class=\"author\"> <i class=\"fa fa-clock\"></i> <span class=\"reading-time\" title=\"Estimated read time\"> 5 mins </span> </div> </div> </div> <div class=\"clearfix\"></div> </header> <aside class=\"my-3\"> <div class=\"socialbox1 d-flex flex-wrap\"> <!-- Sharingbutton Facebook --> <a class=\"resp-sharing-button__link\" href=\"https://facebook.com/sharer/sharer.php?u=https://advancedweb.hu/debugging-bash-scripts/\" target=\"_blank\" aria-label=\"\"> <div class=\"resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small\"><div aria-hidden=\"true\" class=\"resp-sharing-button__icon resp-sharing-button__icon--solid\"> <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z\"></path></svg> </div> </div> </a> <!-- Sharingbutton Twitter --> <a class=\"resp-sharing-button__link\" href=\"https://twitter.com/intent/tweet/?text=Debugging Bash scripts @advancedwebhu&amp;url=https://advancedweb.hu/debugging-bash-scripts/\" target=\"_blank\" aria-label=\"\"> <div class=\"resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small\"><div aria-hidden=\"true\" class=\"resp-sharing-button__icon resp-sharing-button__icon--solid\"> <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z\"></path></svg> </div> </div> </a> <!-- Sharingbutton LinkedIn --> <a class=\"resp-sharing-button__link\" href=\"https://www.linkedin.com/shareArticle?mini=true&amp;url=https://advancedweb.hu/debugging-bash-scripts/&amp;title=Debugging Bash scripts&amp;summary=Debugging Bash scripts&amp;source=https://advancedweb.hu/debugging-bash-scripts/\" target=\"_blank\" aria-label=\"\"> <div class=\"resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small\"><div aria-hidden=\"true\" class=\"resp-sharing-button__icon resp-sharing-button__icon--solid\"> <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6 0 2.5 1 2.6 2.5 0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z\"></path></svg> </div> </div> </a> <!-- Sharingbutton Reddit --> <a class=\"resp-sharing-button__link\" href=\"https://reddit.com/submit/?url=https://advancedweb.hu/debugging-bash-scripts/\" target=\"_blank\" aria-label=\"\"> <div class=\"resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small\"><div aria-hidden=\"true\" class=\"resp-sharing-button__icon resp-sharing-button__icon--solid\"> <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M24 11.5c0-1.65-1.35-3-3-3-.96 0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65 0 3-1.35 3-3s-1.35-3-3-3c-1.38 0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65 0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66 0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64 0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4 0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6 0 .23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1 0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z\"></path></svg> </div> </div> </a> <!-- Sharingbutton Hacker News --> <a class=\"resp-sharing-button__link\" href=\"https://news.ycombinator.com/submitlink?u=https://advancedweb.hu/debugging-bash-scripts/&amp;t=Debugging Bash scripts\" target=\"_blank\" aria-label=\"\"> <div class=\"resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small\"><div aria-hidden=\"true\" class=\"resp-sharing-button__icon resp-sharing-button__icon--solid\"> <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 140 140\"><path fill-rule=\"evenodd\" d=\"M60.94 82.314L17 0h20.08l25.85 52.093c.397.927.86 1.888 1.39 2.883.53.994.995 2.02 1.393 3.08.265.4.463.764.596 1.095.13.334.262.63.395.898.662 1.325 1.26 2.618 1.79 3.877.53 1.26.993 2.42 1.39 3.48 1.06-2.254 2.22-4.673 3.48-7.258 1.26-2.585 2.552-5.27 3.877-8.052L103.49 0h18.69L77.84 83.308v53.087h-16.9v-54.08z\"></path></svg> </div> </div> </a> </div> </aside> <div class=\"body\"> <p>When I first had to debug a Bash script I was completely lost. I just wished that I’d have my usual debugging toolbox for this environment. Luckily, it supports most of the methods available for other languages. This post is about how to lint, trace and debug shell scripts.</p> <h2 id=\"linting-with-shellcheck\">Linting with ShellCheck</h2> <p>In many cases, a seemingly perfect script does not work because of a single missing semicolon or whitespace. On top of that, many constructs in Bash has weird edge cases, and some commands might not work the same in all environments.</p> <p>Linters statically analyze the code to pinpoint many of these situations. There’s a lot to learn from the almost instant feedback they provide.</p> <p>ShellCheck is such a tool for Bash.</p> <p>To demonstrate it, let’s see this (broken) script:</p> <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\">#!/bin/bash</span>\n\nvar <span class=\"o\">=</span> 42\n<span class=\"nb\">echo</span> <span class=\"nv\">$var</span>\n</code></pre></div></div> <p>Executing it results in this error: <code class=\"highlighter-rouge\">./awesome.sh: line 3: var: command not found</code>. Which is a bit cryptic. Let’s see what ShellCheck has to say about it:</p> <div class=\"highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>» shellcheck awesome.sh\n\nIn awesome.sh line 3:\nvar = 42\n    ^-- SC1068: Don't put spaces around the = in assignments (or quote to make it literal).\n\nFor more information:\n  https://www.shellcheck.net/wiki/SC1068 -- Don't put spaces around the = in ...\n</code></pre></div></div> <p>Ah, that’s more helpful! ShellCheck has more than 300 rules to catch issues like this, and it even supports <a href=\"https://github.com/koalaman/shellcheck/issues/1220\">autofixes</a> for some of the cases.</p> <p>You can <a href=\"https://github.com/koalaman/shellcheck#user-content-installing\">install it locally</a>, or use the official <a href=\"https://hub.docker.com/r/koalaman/shellcheck/\">Docker image</a>.</p> <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>docker run <span class=\"nt\">--rm</span> <span class=\"nt\">-it</span> <span class=\"nt\">-v</span> <span class=\"si\">$(</span><span class=\"nb\">pwd</span><span class=\"si\">)</span>:/mnt koalaman/shellcheck <span class=\"k\">*</span>.sh\n</code></pre></div></div> <div class=\"my-5 fullwidth bg-light container-fluid\"> <div class=\"row\"> <div class=\"col-lg-8 offset-lg-1\"> <small>Sponsored ad</small> <div class=\"row p-3\"> <div class=\"col-lg-12\"> <script async=\"\" src=\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\"></script> <ins class=\"adsbygoogle\" style=\"display: block; text-align: center; height: 0px;\" data-ad-layout=\"in-article\" data-ad-format=\"fluid\" data-ad-client=\"ca-pub-3273530520589701\" data-ad-slot=\"7110069499\" data-adsbygoogle-status=\"done\"><ins id=\"aswift_1_expand\" style=\"display: inline-table; border: none; height: 0px; margin: 0px; padding: 0px; position: relative; visibility: visible; width: 738px; background-color: transparent;\"><ins id=\"aswift_1_anchor\" style=\"display: block; border: none; height: 0px; margin: 0px; padding: 0px; position: relative; visibility: visible; width: 738px; background-color: transparent; overflow: hidden; opacity: 0;\"><iframe id=\"aswift_1\" name=\"aswift_1\" style=\"left:0;position:absolute;top:0;border:0;width:738px;height:185px;\" sandbox=\"allow-forms allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation\" width=\"738\" height=\"185\" frameborder=\"0\" src=\"https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-3273530520589701&amp;output=html&amp;h=185&amp;slotname=7110069499&amp;adk=25146609&amp;adf=2883230962&amp;w=738&amp;fwrn=4&amp;lmt=1587476139&amp;rafmt=11&amp;psa=0&amp;guci=2.2.0.0.2.2.0.0&amp;format=738x185&amp;url=https%3A%2F%2Fadvancedweb.hu%2Fdebugging-bash-scripts%2F&amp;flash=0&amp;wgl=1&amp;adsid=NT&amp;dt=1587600990767&amp;bpp=11&amp;bdt=4436&amp;idt=12&amp;shv=r20200416&amp;cbv=r20190131&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;prev_fmts=0x0&amp;nras=1&amp;correlator=6490099404244&amp;frm=20&amp;pv=1&amp;ga_vid=398819556.1587600987&amp;ga_sid=1587600987&amp;ga_hid=1494488136&amp;ga_fc=0&amp;iag=0&amp;icsg=682&amp;dssz=10&amp;mdo=0&amp;mso=0&amp;rplot=4&amp;u_tz=480&amp;u_his=2&amp;u_java=0&amp;u_h=1080&amp;u_w=1920&amp;u_ah=1040&amp;u_aw=1920&amp;u_cd=24&amp;u_nplug=3&amp;u_nmime=4&amp;adx=31&amp;ady=2074&amp;biw=783&amp;bih=583&amp;scr_x=0&amp;scr_y=0&amp;eid=21065472%2C21065474%2C26835106&amp;oid=3&amp;pvsid=1200563511232471&amp;pem=283&amp;rx=0&amp;eae=0&amp;fc=1920&amp;brdim=10%2C10%2C10%2C10%2C1920%2C0%2C945%2C1020%2C800%2C600&amp;vis=1&amp;rsz=%7C%7CeEbr%7C&amp;abl=CS&amp;pfx=0&amp;fu=9368&amp;bc=31&amp;ifi=1&amp;uci=a!1&amp;btvi=1&amp;fsb=1&amp;xpc=jBbej8rtTv&amp;p=https%3A//advancedweb.hu&amp;dtd=32\" marginwidth=\"0\" marginheight=\"0\" vspace=\"0\" hspace=\"0\" allowtransparency=\"true\" scrolling=\"no\" allowfullscreen=\"true\" data-google-container-id=\"a!1\" data-google-query-id=\"COb17Mii_egCFRJAlgodUAsNNQ\" data-load-complete=\"true\"></iframe></ins></ins></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> </div> </div> </div> </div> </div> <h2 id=\"print-debugging\">Print debugging</h2> <p>Oftentimes figuring out the control flow of a script is not obvious, but you have to find out which part of the code was executed.</p> <p>One approach is the good old <a href=\"/effective-print-debugging/\">print debugging</a>, inserting <code class=\"highlighter-rouge\">echo</code> statements all over the code.</p> <p>This debugging style is quite straight-forward and easy to use. One possible gotcha is that echoing to the standard output of a function might change the program’s behavior.</p> <p>Because the error stream is less used, usually it’s a good idea to use it for debugging.</p> <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">if</span> <span class=\"o\">[[</span> some_condition <span class=\"o\">]]</span><span class=\"p\">;</span> <span class=\"k\">then\n   </span><span class=\"nb\">echo</span> <span class=\"s2\">\"Branch 1 executed\"</span> <span class=\"o\">&gt;</span>&amp;2\n   ...\n<span class=\"k\">else\n   </span><span class=\"nb\">echo</span> <span class=\"s2\">\"Branch 2 executed\"</span> <span class=\"o\">&gt;</span>&amp;2\n   ...\n<span class=\"k\">fi</span>\n</code></pre></div></div> <p>A more robust approach is to use <code class=\"highlighter-rouge\">logger</code> to write to the system log.</p> <h2 id=\"tracing\">Tracing</h2> <p>For more complex scripts, an easier alternative is to enable tracing. When tracing is enabled each command and its arguments are printed before they are executed, so the entire flow of the program can be observed.</p> <p>Let’s see this in action. For the sake of this example, consider the following script that calculates the price of the ice cream. The base price for each portion is 100, but when you order at least 3 portions, you get a discount on odd days.</p> <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\">#!/bin/bash</span>\n<span class=\"k\">function </span>calculatePrice<span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">[[</span> <span class=\"nv\">$numberOfPortions</span> <span class=\"nt\">-lt</span> 3 <span class=\"o\">]]</span><span class=\"p\">;</span> <span class=\"k\">then\n        </span><span class=\"nb\">echo</span> <span class=\"s2\">\"100\"</span>\n    <span class=\"k\">else\n        </span><span class=\"nv\">day</span><span class=\"o\">=</span><span class=\"si\">$(</span><span class=\"nb\">date</span> <span class=\"nt\">-d</span> <span class=\"s2\">\"</span><span class=\"nv\">$D</span><span class=\"s2\">\"</span> <span class=\"s1\">'+%d'</span><span class=\"si\">)</span>\n        <span class=\"k\">if</span> <span class=\"o\">((</span> <span class=\"nv\">$day</span> % 2 <span class=\"o\">))</span><span class=\"p\">;</span> <span class=\"k\">then</span>\n            <span class=\"c\"># Discount on odd days</span>\n            <span class=\"nb\">echo</span> <span class=\"s2\">\"80\"</span>\n        <span class=\"k\">else\n            </span><span class=\"nb\">echo</span> <span class=\"s2\">\"100\"</span>\n        <span class=\"k\">fi\n    fi</span>\n<span class=\"o\">}</span>\n\n<span class=\"nv\">numberOfPortions</span><span class=\"o\">=</span><span class=\"nv\">$1</span>\n<span class=\"nv\">pricePerPortion</span><span class=\"o\">=</span><span class=\"si\">$(</span>calculatePrice <span class=\"nv\">$numberOfPortions</span><span class=\"si\">)</span>\n<span class=\"nv\">totalPrice</span><span class=\"o\">=</span><span class=\"k\">$((</span> <span class=\"nv\">$numberOfPortions</span> <span class=\"o\">*</span> <span class=\"nv\">$pricePerPortion</span> <span class=\"k\">))</span>\n\n<span class=\"nb\">echo</span> <span class=\"s2\">\"Total </span><span class=\"nv\">$totalPrice</span><span class=\"s2\">\"</span>\n</code></pre></div></div> <p>The script expects the number of portions as an argument and prints the total price.</p> <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>» ./ice_cream_price.sh 4\nTotal 320\n</code></pre></div></div> <p>Reading through the script to figure out why it produced such a result might not always be easy.</p> <p>Let’s see how tracing can help better understand this program.</p> <p>To enable it, add <code class=\"highlighter-rouge\">set -x</code> to the beginning of the script, or simply pass <code class=\"highlighter-rouge\">-x</code> as a parameter to Bash.</p> <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>» bash <span class=\"nt\">-x</span> ./ice_cream_price.sh 4\n+ <span class=\"nv\">numberOfPortions</span><span class=\"o\">=</span>4\n++ calculatePrice 4\n++ <span class=\"o\">[[</span> 4 <span class=\"nt\">-lt</span> 3 <span class=\"o\">]]</span>\n+++ <span class=\"nb\">date</span> <span class=\"nt\">-d</span> <span class=\"s1\">''</span> +%d\n++ <span class=\"nv\">day</span><span class=\"o\">=</span>11\n++ <span class=\"o\">((</span>  11 % 2  <span class=\"o\">))</span>\n++ <span class=\"nb\">echo </span>80\n+ <span class=\"nv\">pricePerPortion</span><span class=\"o\">=</span>80\n+ <span class=\"nv\">totalPrice</span><span class=\"o\">=</span>320\n+ <span class=\"nb\">echo</span> <span class=\"s1\">'Total 320'</span>\nTotal 320\n</code></pre></div></div> <p>Tracing can be enabled and disabled at any given line, so it’s possible to reduce the debug output to certain parts.</p> <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>this_call_is_not_traced\n<span class=\"nb\">set</span> <span class=\"nt\">-x</span> <span class=\"c\"># enable tracing</span>\ntricky_function\n<span class=\"nb\">set</span> +x <span class=\"c\"># disable tracing</span>\nthis_call_is_not_traced\n</code></pre></div></div> <p>It’s also possible to <a href=\"https://stackoverflow.com/questions/17804007/how-to-show-line-number-when-executing-bash-script\">customize the trace messages</a> by setting the <code class=\"highlighter-rouge\">PS4</code> variable.</p> <p>This allows getting more information. The following example enhances tracing output to include the name of the file, function and line number:</p> <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>» <span class=\"nb\">export </span><span class=\"nv\">PS4</span><span class=\"o\">=</span><span class=\"s1\">'+(${BASH_SOURCE}:${LINENO}): ${FUNCNAME[0]:+${FUNCNAME[0]}(): }'</span>\n» bash <span class=\"nt\">-x</span> ./ice_cream_price.sh 4\n+<span class=\"o\">(</span>./ice_cream_price.sh:19<span class=\"o\">)</span>: <span class=\"nv\">numberOfPortions</span><span class=\"o\">=</span>4\n++<span class=\"o\">(</span>./ice_cream_price.sh:20<span class=\"o\">)</span>: calculatePrice 4\n++<span class=\"o\">(</span>./ice_cream_price.sh:6<span class=\"o\">)</span>: calculatePrice<span class=\"o\">()</span>: <span class=\"o\">[[</span> 4 <span class=\"nt\">-lt</span> 3 <span class=\"o\">]]</span>\n+++<span class=\"o\">(</span>./ice_cream_price.sh:9<span class=\"o\">)</span>: calculatePrice<span class=\"o\">()</span>: <span class=\"nb\">date</span> <span class=\"nt\">-d</span> <span class=\"s1\">''</span> +%d\n++<span class=\"o\">(</span>./ice_cream_price.sh:9<span class=\"o\">)</span>: calculatePrice<span class=\"o\">()</span>: <span class=\"nv\">day</span><span class=\"o\">=</span>11\n++<span class=\"o\">(</span>./ice_cream_price.sh:10<span class=\"o\">)</span>: calculatePrice<span class=\"o\">()</span>: <span class=\"o\">((</span>  11 % 2  <span class=\"o\">))</span>\n++<span class=\"o\">(</span>./ice_cream_price.sh:14<span class=\"o\">)</span>: calculatePrice<span class=\"o\">()</span>: <span class=\"nb\">echo </span>80\n+<span class=\"o\">(</span>./ice_cream_price.sh:20<span class=\"o\">)</span>: <span class=\"nv\">pricePerPortion</span><span class=\"o\">=</span>80\n+<span class=\"o\">(</span>./ice_cream_price.sh:21<span class=\"o\">)</span>: <span class=\"nv\">totalPrice</span><span class=\"o\">=</span>320\n+<span class=\"o\">(</span>./ice_cream_price.sh:23<span class=\"o\">)</span>: <span class=\"nb\">echo</span> <span class=\"s1\">'Total 320'</span>\nTotal 320\n</code></pre></div></div> <div class=\"my-5 fullwidth bg-light container-fluid\"> <div class=\"row\"> <div class=\"col-lg-8 offset-lg-1\"> <small>Sponsored ad</small> <div class=\"row p-3\"> <div class=\"col-lg-12\"> <script async=\"\" src=\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\"></script> <ins class=\"adsbygoogle\" style=\"display: block; text-align: center; height: 185px;\" data-ad-layout=\"in-article\" data-ad-format=\"fluid\" data-ad-client=\"ca-pub-3273530520589701\" data-ad-slot=\"7110069499\" data-adsbygoogle-status=\"done\"><ins id=\"aswift_2_expand\" style=\"display:inline-table;border:none;height:185px;margin:0;padding:0;position:relative;visibility:visible;width:738px;background-color:transparent;\"><ins id=\"aswift_2_anchor\" style=\"display:block;border:none;height:185px;margin:0;padding:0;position:relative;visibility:visible;width:738px;background-color:transparent;\"></ins></ins></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> </div> </div> </div> </div> </div> <h2 id=\"breakpoints\">Breakpoints</h2> <p>Sometimes it’s just handy <a href=\"/effective-debugging-with-breakpoints/\">to stop the program execution at any given point</a> to execute commands step-by-step and see how they behave. Luckily, this is possible in Bash—to some extent.</p> <p>Similarly to print debugging, one can add extra <code class=\"highlighter-rouge\">read</code> commands to the code to stop script execution until manual intervention.</p> <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>command_1\n\n<span class=\"nb\">echo</span> <span class=\"s2\">\"Press enter to continue!\"</span> <span class=\"o\">&gt;</span>&amp;2\n<span class=\"nb\">read\n\n</span>command_2\n</code></pre></div></div> <p>This might come in handy if you’d like to examine the effects of a script at a given step.</p> <p>It’s also possible to <a href=\"https://stackoverflow.com/questions/9080431/how-execute-bash-script-line-by-line\">step through</a> the whole script (or parts of a script) by adding <code class=\"highlighter-rouge\">read</code> as a debug trap. It’s best used with tracing to see which commands were executed.</p> <div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># Enable debugging</span>\n<span class=\"nb\">set</span> <span class=\"nt\">-x</span>\n<span class=\"nb\">trap read </span>debug\n\n...\n\n<span class=\"c\"># Disable debugging</span>\n<span class=\"nb\">set</span> <span class=\"nt\">-x</span>\n<span class=\"nb\">trap</span> - debug\n</code></pre></div></div> <p>Coming back to the ice cream example, this is what it looks like to debug the <code class=\"highlighter-rouge\">calculatePrice</code> function:</p> <p><img alt=\"Debugging in Bash\" class=\"d-block mx-auto img-fluid\" integrity=\"sha256-RCh2tfSDTIPJs/myAI2NLcJSrIlQCuIrHFy22sD+NbI=\" crossorigin=\"anonymous\" src=\"/assets/posts/bash-debug/bash_debug-442876b5f4834c83c9b3f9b2008d8d2dc252ac89500ae22b1c5cb6dac0fe35b2.gif\"></p> <h2 id=\"summary\">Summary</h2> <p>Debugging a Bash script is not an easy task. This language has more rough edges than the others I’ve used, and typically the tooling is just a text editor. In this context, it’s really important to know the tools available to make this challenging task more efficient.</p> </div> </article> <aside class=\"social-icons clearfix\"> </aside> <aside class=\"tags-and-categories clearfix\"> <ul class=\"tags\"> <li><a href=\"/tags.html#Bash-ref\">Bash <span>4</span></a></li> <li><a href=\"/tags.html#Debugging-ref\">Debugging <span>5</span></a></li> </ul><i class=\"fa fa-tag\"></i> </aside> <div class=\"date\"> <i class=\"fa fa-calendar\"></i> <span class=\"data\">14 April 2020</span> </div> <aside class=\"mt-5 font-italic with-red-links\"> You won't miss out future posts by subscribing to our <a href=\"http://eepurl.com/bDzWXj\">Newsletter</a> and <a href=\"/rss.xml\">RSS feed</a>! </aside> <div class=\"post-author\"> <hr> <div> <div class=\"author-image\"> <img class=\"img-responsive\" alt=\"Author's image\" integrity=\"sha256-uh2wDJWsR0AB9vFkO8b6UZ5Qo59mZKtMdDDde1mYpjU=\" crossorigin=\"anonymous\" src=\"/assets/profiles/dodie-ba1db00c95ac474001f6f1643bc6fa519e50a39f6664ab4c7430dd7b5998a635.jpg\"> </div> <div class=\"author-description\"> <p class=\"author-name\"> Dávid Csákvári <a href=\"https://www.linkedin.com/pub/cs%C3%A1kv%C3%A1ri-d%C3%A1vid/18/422/796\"> <i class=\"fab fa-linkedin\"></i> </a> <a href=\"https://github.com/dodie\"> <i class=\"fab fa-github\"></i> </a> </p> <div class=\"author-short-about\"> <p>Dávid is a full-stack developer with more than 10 years of experience working with Java and web technologies. He is a long-time advocate of open-source and test automation. He holds a Master’s degree and attended countless online courses over the years.</p> <p>You can also recognize Dávid’s name from the <a href=\"https://github.com/dodie/scott\">Scott Maven Plugin</a> and the <a href=\"https://github.com/dodie/vim-disapprove-deep-indentation\">Disapprove Deep Indentation Vim Plugin</a>.</p> </div> </div> </div> </div> <aside> <ul class=\"pagination mt-5 d-flex justify-content-between align-items-start\"> <li class=\"next mr-5\"> <a href=\"/easily-run-cli-commands-as-an-aws-role-with-awsudo/\" title=\"Easily run CLI commands as an AWS role with AWSudo\">« Easily run CLI commands as an AWS role with AWSudo</a> </li> <li class=\"prev ml-5 text-right\"> <a href=\"/secure-tempfiles-in-nodejs-without-dependencies/\" title=\"Secure tempfiles in NodeJS without dependencies\">Secure tempfiles in NodeJS without dependencies »</a> </li> </ul> </aside> <aside class=\"comments\" id=\"comments\"> <hr> <h2><i class=\"fa fa-comments\"></i></h2> <div class=\"fb-comments\" data-href=\"https://advancedweb.hu/debugging-bash-scripts\" data-width=\"100%\" data-numposts=\"5\" data-colorscheme=\"light\"></div> </aside> <script type=\"application/ld+json\"> { \"@context\": \"http://schema.org/\", \"@type\": \"BlogPosting\", \"url\": \"https://advancedweb.hu/debugging-bash-scripts/\", \"name\": \"Debugging Bash scripts\", \"headline\": \"Debugging Bash scripts\", \"keywords\":[ \"Bash\" , \"Debugging\" ], \"description\": \"When I first had to debug a Bash script I was completely lost. I just wished that I’d have my usual debuggingtoolbox for this environment. Luckily, it supports most of the methods available for other languages. This postis about how to lint, trace and debug shell scripts.\", \"articleBody\": \"\\nWhen I first had to debug a Bash script I was completely lost. I just wished that I’d have my usual debugging\\ntoolbox for this environment. Luckily, it supports most of the methods available for other languages. This post\\nis about how to lint, trace and debug shell scripts.\\n\\nLinting with ShellCheck\\n\\nIn many cases, a seemingly perfect script does not work because of a single missing semicolon or whitespace.\\nOn top of that, many constructs in Bash has weird edge cases, and some commands might not work the same in all\\nenvironments.\\n\\nLinters statically analyze the code to pinpoint many of these situations. There’s a lot to learn from the\\nalmost instant feedback they provide.\\n\\nShellCheck is such a tool for Bash.\\n\\nTo demonstrate it, let’s see this (broken) script:\\n\\n#!/bin/bash\\n\\nvar = 42\\necho $var\\n\\n\\nExecuting it results in this error: ./awesome.sh: line 3: var: command not found.\\nWhich is a bit cryptic. Let’s see what ShellCheck has to say about it:\\n\\n» shellcheck awesome.sh\\n\\nIn awesome.sh line 3:\\nvar = 42\\n ^-- SC1068: Don't put spaces around the = in assignments (or quote to make it literal).\\n\\nFor more information:\\n https://www.shellcheck.net/wiki/SC1068 -- Don't put spaces around the = in ...\\n\\n\\nAh, that’s more helpful! ShellCheck has more than 300 rules to catch issues like this,\\nand it even supports\\nautofixes for some of the cases.\\n\\nYou can\\ninstall it locally, or\\nuse the official Docker image.\\n\\ndocker run --rm -it -v $(pwd):/mnt koalaman/shellcheck *.sh\\n\\n\\nPrint debugging\\n\\nOftentimes figuring out the control flow of a script is not obvious, but you\\nhave to find out which part of the code was executed.\\n\\nOne approach is the good old print debugging,\\ninserting echo statements all over the code.\\n\\nThis debugging style is quite straight-forward and easy to use. One possible gotcha is that\\nechoing to the standard output of a function might change the program’s behavior.\\n\\nBecause the error stream is less used, usually it’s a good idea to use it for debugging.\\n\\nif [[ some_condition ]]; then\\n echo \\\"Branch 1 executed\\\" &gt;&amp;2\\n ...\\nelse\\n echo \\\"Branch 2 executed\\\" &gt;&amp;2\\n ...\\nfi\\n\\n\\nA more robust approach is to use logger to write to the system log.\\n\\nTracing\\n\\nFor more complex scripts, an easier alternative is to enable tracing. When tracing is enabled each\\ncommand and its arguments are printed before they are executed, so the entire flow of the program can be observed.\\n\\nLet’s see this in action. For the sake of this example, consider the following script that calculates the price\\nof the ice cream. The base price for each portion is 100, but when you order at least 3 portions, you get\\na discount on odd days.\\n\\n#!/bin/bash\\nfunction calculatePrice() {\\n if [[ $numberOfPortions -lt 3 ]]; then\\n echo \\\"100\\\"\\n else\\n day=$(date -d \\\"$D\\\" '+%d')\\n if (( $day % 2 )); then\\n # Discount on odd days\\n echo \\\"80\\\"\\n else\\n echo \\\"100\\\"\\n fi\\n fi\\n}\\n\\nnumberOfPortions=$1\\npricePerPortion=$(calculatePrice $numberOfPortions)\\ntotalPrice=$(( $numberOfPortions * $pricePerPortion ))\\n\\necho \\\"Total $totalPrice\\\"\\n\\n\\nThe script expects the number of portions as an argument and prints the total price.\\n\\n» ./ice_cream_price.sh 4\\nTotal 320\\n\\n\\nReading through the script to figure out why it produced such a result might not always be easy.\\n\\nLet’s see how tracing can help better understand this program.\\n\\nTo enable it, add set -x to the beginning of the script, or simply pass -x as a parameter to Bash.\\n\\n» bash -x ./ice_cream_price.sh 4\\n+ numberOfPortions=4\\n++ calculatePrice 4\\n++ [[ 4 -lt 3 ]]\\n+++ date -d '' +%d\\n++ day=11\\n++ (( 11 % 2 ))\\n++ echo 80\\n+ pricePerPortion=80\\n+ totalPrice=320\\n+ echo 'Total 320'\\nTotal 320\\n\\n\\nTracing can be enabled and disabled at any given line, so it’s possible to\\nreduce the debug output to certain parts.\\n\\nthis_call_is_not_traced\\nset -x # enable tracing\\ntricky_function\\nset +x # disable tracing\\nthis_call_is_not_traced\\n\\n\\nIt’s also possible to\\ncustomize the trace messages\\nby setting the PS4 variable.\\n\\nThis allows getting more information. The following example enhances tracing output to include the name of the file,\\nfunction and line number:\\n\\n» export PS4='+(${BASH_SOURCE}:${LINENO}): ${FUNCNAME[0]:+${FUNCNAME[0]}(): }'\\n» bash -x ./ice_cream_price.sh 4\\n+(./ice_cream_price.sh:19): numberOfPortions=4\\n++(./ice_cream_price.sh:20): calculatePrice 4\\n++(./ice_cream_price.sh:6): calculatePrice(): [[ 4 -lt 3 ]]\\n+++(./ice_cream_price.sh:9): calculatePrice(): date -d '' +%d\\n++(./ice_cream_price.sh:9): calculatePrice(): day=11\\n++(./ice_cream_price.sh:10): calculatePrice(): (( 11 % 2 ))\\n++(./ice_cream_price.sh:14): calculatePrice(): echo 80\\n+(./ice_cream_price.sh:20): pricePerPortion=80\\n+(./ice_cream_price.sh:21): totalPrice=320\\n+(./ice_cream_price.sh:23): echo 'Total 320'\\nTotal 320\\n\\n\\nBreakpoints\\n\\nSometimes it’s just handy to stop the program execution at any given point\\nto execute commands step-by-step and see how they behave. Luckily, this is possible in Bash—to some extent.\\n\\nSimilarly to print debugging, one can add extra read commands to the code to stop script execution until\\nmanual intervention.\\n\\ncommand_1\\n\\necho \\\"Press enter to continue!\\\" &gt;&amp;2\\nread\\n\\ncommand_2\\n\\n\\nThis might come in handy if you’d like to examine the effects of a script at a given step.\\n\\nIt’s also possible to\\nstep through\\nthe whole script (or parts of a script)\\nby adding read as a debug trap. It’s best used with tracing to see which commands were executed.\\n\\n# Enable debugging\\nset -x\\ntrap read debug\\n\\n...\\n\\n# Disable debugging\\nset -x\\ntrap - debug\\n\\n\\nComing back to the ice cream example, this is what it looks like to debug the calculatePrice function:\\n\\n\\n\\nSummary\\n\\nDebugging a Bash script is not an easy task. This language has more rough edges than the others I’ve used,\\nand typically the tooling is just a text editor. In this context, it’s really important to know the tools\\navailable to make this challenging task more efficient.\\n\", \"datePublished\": \"2020-04-14\", \"dateModified\": \"2020-04-14\", \"isAccessibleForFree\": \"True\", \"inLanguage\":\"en\", \"author\": { \"@type\":\"Person\", \"name\":\"Dávid Csákvári\", \"image\": { \"@type\": \"ImageObject\", \"url\": \"https://advancedweb.hu/assets/profiles/dodie-ba1db00c95ac474001f6f1643bc6fa519e50a39f6664ab4c7430dd7b5998a635.jpg\" }, \"url\": \"https://advancedweb.hu/dodie.html\", \"description\": \"Dávid is a full-stack developer with more than 10 years of experience working with Java and web technologies. He is a long-time advocate of open-source and test automation. He holds a Master’s degree and attended countless online courses over the years.\\n\\nYou can also recognize Dávid’s name from the Scott Maven Plugin and the Disapprove Deep Indentation Vim Plugin.\\n\", \"sameAs\": [ \"https://github.com/dodie\" , \"https://www.linkedin.com/pub/cs%C3%A1kv%C3%A1ri-d%C3%A1vid/18/422/796\" ] } , \"publisher\": { \"@type\": \"Organization\", \"name\": \"Advanced Web Machinery\", \"url\": \"https://advancedweb.hu\", \"logo\": { \"@type\": \"ImageObject\", \"url\": \"https://advancedweb.hu/assets/awm-logo-271ddd08c953e26d9668b2b69344dda78ba9fef2fa52f43bd1491f8ff02a97ed.png\" } } , \"mainEntityOfPage\": { \"@type\": \"WebPage\", \"@id\": \"https://advancedweb.hu/debugging-bash-scripts/\" }, \"image\": { \"@type\": \"ImageObject\", \"url\": \"https://advancedweb.hu/assets/post-images/bash_debug-b64c14df6a51331cf0b09103b051728710b9ae98b88c57c8defe9be1de9ef85a.jpg\" } } </script> </div> <div class=\"col-lg-3\"> <div class=\"toc-container flex-grow-1 d-none d-lg-block\" style=\"height: 100%;\"> <div class=\"aside-widget\"> <div class=\"body\"> <div class=\"toc\"> <a href=\"#linting-with-shellcheck\" class=\"toc-h2\">Linting with ShellCheck</a><a href=\"#print-debugging\" class=\"toc-h2\">Print debugging</a><a href=\"#tracing\" class=\"toc-h2\">Tracing</a><a href=\"#breakpoints\" class=\"toc-h2\">Breakpoints</a><a href=\"#summary\" class=\"toc-h2\">Summary</a></div> </div> </div> </div> </div> </div> </div> <footer> <div class=\"widewrapper footer\"> <div class=\"container\"> <div class=\"row\"> <div class=\"col-md-4 footer-widget\"> <h4>Statistics</h4> <span>To make sure we don't lose counts:</span> <div class=\"stats\"> <div class=\"line\"> <span class=\"counter\">187</span> <span class=\"caption\">Posts</span> </div> <div class=\"line\"> <span class=\"counter\">2</span> <span class=\"caption\">Authors</span> </div> </div> </div> <div class=\"col-md-4 footer-widget\"> <h4>Feeds</h4> <ul class=\"tales-list\"> <li><a href=\"/rss.xml\">RSS</a></li> <li><a href=\"/atom.xml\">Atom</a></li> </ul> </div> <div class=\"col-md-4 footer-widget\"> <h4>Favourites</h4> <ul class=\"tales-list\"> <li><a href=\"/asynchronous-array-functions-in-javascript/\">Asynchronous array functions in Javascript</a></li> <li><a href=\"/automatically-schedule-emails-on-mailchimp-with-rss-and-aws-lambda/\">Automatically schedule emails on MailChimp with RSS and AWS Lambda</a></li> <li><a href=\"/cloudformation-cli-workflows/\">CloudFormation CLI workflows</a></li> <li><a href=\"/aws-how-to-secure-access-keys-with-mfa/\">AWS: How to secure access keys with MFA</a></li> <li><a href=\"/a-categorized-list-of-all-java-and-jvm-features-since-jdk-8-to-14/\">A categorized list of all Java and JVM features since JDK 8 to 14</a></li> </ul> </div> </div> </div> </div> <div class=\"widewrapper copyright\"> <div class=\"container\"> © 2020 Advanced Web Machinery </div> </div> </footer> <script type=\"text/javascript\"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-17175113-2']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> <script type=\"text/javascript\" src=\"/assets/app-5b5615b6ef9ec146b2f0e8f99fe0ce10640baa84806eff58e5bde1b5a509fe55.js\" integrity=\"sha256-W1YVtu+ewUay8Oj5n+DOEGQLqoSAbv9Y5b3htaUJ/lU=\" crossorigin=\"anonymous\"></script> <script src=\"https://apis.google.com/js/platform.js\" async=\"\" defer=\"\"></script>  \n</div>","text":"Debugging Bash scripts\nTips for linting, tracing and debugging\nDávid Csákvári\n5 mins\n\nWhen I first had to debug a Bash script I was completely lost. I just wished that I’d have my usual debugging toolbox for this environment. Luckily, it supports most of the methods available for other languages. This post is about how to lint, trace and debug shell scripts.\n\nLinting with ShellCheck\n\nIn many cases, a seemingly perfect script does not work because of a single missing semicolon or whitespace. On top of that, many constructs in Bash has weird edge cases, and some commands might not work the same in all environments.\n\nLinters statically analyze the code to pinpoint many of these situations. There’s a lot to learn from the almost instant feedback they provide.\n\nShellCheck is such a tool for Bash.\n\nTo demonstrate it, let’s see this (broken) script:\n\n#!/bin/bash\n\nvar = 42\necho $var\n\n\nExecuting it results in this error: ./awesome.sh: line 3: var: command not found. Which is a bit cryptic. Let’s see what ShellCheck has to say about it:\n\n» shellcheck awesome.sh\n\nIn awesome.sh line 3:\nvar = 42\n    ^-- SC1068: Don't put spaces around the = in assignments (or quote to make it literal).\n\nFor more information:\n  https://www.shellcheck.net/wiki/SC1068 -- Don't put spaces around the = in ...\n\n\nAh, that’s more helpful! ShellCheck has more than 300 rules to catch issues like this, and it even supports autofixes for some of the cases.\n\nYou can install it locally, or use the official Docker image.\n\ndocker run --rm -it -v $(pwd):/mnt koalaman/shellcheck *.sh\n\nSponsored ad\nPrint debugging\n\nOftentimes figuring out the control flow of a script is not obvious, but you have to find out which part of the code was executed.\n\nOne approach is the good old print debugging, inserting echo statements all over the code.\n\nThis debugging style is quite straight-forward and easy to use. One possible gotcha is that echoing to the standard output of a function might change the program’s behavior.\n\nBecause the error stream is less used, usually it’s a good idea to use it for debugging.\n\nif [[ some_condition ]]; then\n   echo \"Branch 1 executed\" >&2\n   ...\nelse\n   echo \"Branch 2 executed\" >&2\n   ...\nfi\n\n\nA more robust approach is to use logger to write to the system log.\n\nTracing\n\nFor more complex scripts, an easier alternative is to enable tracing. When tracing is enabled each command and its arguments are printed before they are executed, so the entire flow of the program can be observed.\n\nLet’s see this in action. For the sake of this example, consider the following script that calculates the price of the ice cream. The base price for each portion is 100, but when you order at least 3 portions, you get a discount on odd days.\n\n#!/bin/bash\nfunction calculatePrice() {\n    if [[ $numberOfPortions -lt 3 ]]; then\n        echo \"100\"\n    else\n        day=$(date -d \"$D\" '+%d')\n        if (( $day % 2 )); then\n            # Discount on odd days\n            echo \"80\"\n        else\n            echo \"100\"\n        fi\n    fi\n}\n\nnumberOfPortions=$1\npricePerPortion=$(calculatePrice $numberOfPortions)\ntotalPrice=$(( $numberOfPortions * $pricePerPortion ))\n\necho \"Total $totalPrice\"\n\n\nThe script expects the number of portions as an argument and prints the total price.\n\n» ./ice_cream_price.sh 4\nTotal 320\n\n\nReading through the script to figure out why it produced such a result might not always be easy.\n\nLet’s see how tracing can help better understand this program.\n\nTo enable it, add set -x to the beginning of the script, or simply pass -x as a parameter to Bash.\n\n» bash -x ./ice_cream_price.sh 4\n+ numberOfPortions=4\n++ calculatePrice 4\n++ [[ 4 -lt 3 ]]\n+++ date -d '' +%d\n++ day=11\n++ ((  11 % 2  ))\n++ echo 80\n+ pricePerPortion=80\n+ totalPrice=320\n+ echo 'Total 320'\nTotal 320\n\n\nTracing can be enabled and disabled at any given line, so it’s possible to reduce the debug output to certain parts.\n\nthis_call_is_not_traced\nset -x # enable tracing\ntricky_function\nset +x # disable tracing\nthis_call_is_not_traced\n\n\nIt’s also possible to customize the trace messages by setting the PS4 variable.\n\nThis allows getting more information. The following example enhances tracing output to include the name of the file, function and line number:\n\n» export PS4='+(${BASH_SOURCE}:${LINENO}): ${FUNCNAME[0]:+${FUNCNAME[0]}(): }'\n» bash -x ./ice_cream_price.sh 4\n+(./ice_cream_price.sh:19): numberOfPortions=4\n++(./ice_cream_price.sh:20): calculatePrice 4\n++(./ice_cream_price.sh:6): calculatePrice(): [[ 4 -lt 3 ]]\n+++(./ice_cream_price.sh:9): calculatePrice(): date -d '' +%d\n++(./ice_cream_price.sh:9): calculatePrice(): day=11\n++(./ice_cream_price.sh:10): calculatePrice(): ((  11 % 2  ))\n++(./ice_cream_price.sh:14): calculatePrice(): echo 80\n+(./ice_cream_price.sh:20): pricePerPortion=80\n+(./ice_cream_price.sh:21): totalPrice=320\n+(./ice_cream_price.sh:23): echo 'Total 320'\nTotal 320\n\nSponsored ad\nBreakpoints\n\nSometimes it’s just handy to stop the program execution at any given point to execute commands step-by-step and see how they behave. Luckily, this is possible in Bash—to some extent.\n\nSimilarly to print debugging, one can add extra read commands to the code to stop script execution until manual intervention.\n\ncommand_1\n\necho \"Press enter to continue!\" >&2\nread\n\ncommand_2\n\n\nThis might come in handy if you’d like to examine the effects of a script at a given step.\n\nIt’s also possible to step through the whole script (or parts of a script) by adding read as a debug trap. It’s best used with tracing to see which commands were executed.\n\n# Enable debugging\nset -x\ntrap read debug\n\n...\n\n# Disable debugging\nset -x\ntrap - debug\n\n\nComing back to the ice cream example, this is what it looks like to debug the calculatePrice function:\n\nSummary\n\nDebugging a Bash script is not an easy task. This language has more rough edges than the others I’ve used, and typically the tooling is just a text editor. In this context, it’s really important to know the tools available to make this challenging task more efficient.\n\nBash 4\nDebugging 5\n14 April 2020\nYou won't miss out future posts by subscribing to our Newsletter and RSS feed!\n\nDávid Csákvári  \n\nDávid is a full-stack developer with more than 10 years of experience working with Java and web technologies. He is a long-time advocate of open-source and test automation. He holds a Master’s degree and attended countless online courses over the years.\n\nYou can also recognize Dávid’s name from the Scott Maven Plugin and the Disapprove Deep Indentation Vim Plugin.\n\n« Easily run CLI commands as an AWS role with AWSudo\nSecure tempfiles in NodeJS without dependencies »\nStatistics\nTo make sure we don't lose counts:\n187\nPosts\n2\nAuthors\nFeeds\nRSS\nAtom\nFavourites\nAsynchronous array functions in Javascript\nAutomatically schedule emails on MailChimp with RSS and AWS Lambda\nCloudFormation CLI workflows\nAWS: How to secure access keys with MFA\nA categorized list of all Java and JVM features since JDK 8 to 14\n© 2020 Advanced Web Machinery"}

{"l":"https://paytonturnage.gitbook.io/valora/","n":"valora","html":"\n            \n            <div id=\"__GITBOOK__ROOT__CLIENT__\" style=\"display: flex;\"><div class=\"reset-3c756112--body-68cac36c\"><div class=\"reset-3c756112--header-07037613--header-09ef972a\"><div class=\"reset-3c756112--headerContainer-bb8cc0bc\"><div class=\"reset-3c756112--headerLeftColumn-4eae0bae--headerLeftColumn-7efc9f26\"><div role=\"button\" tabindex=\"-1\" class=\"reset-3c756112--mobileButton-7a76d05f\"><svg preserveAspectRatio=\"xMidYMid meet\" height=\"1em\" width=\"1em\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" class=\"icon-7f6730be--text-3f89f380--icon-1f8349b3\"><g><line x1=\"3\" y1=\"12\" x2=\"21\" y2=\"12\"></line><line x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\"></line><line x1=\"3\" y1=\"18\" x2=\"21\" y2=\"18\"></line></g></svg></div><div class=\"reset-3c756112--headerLogo-5c0b38e2\"><div class=\"reset-3c756112--mobileLogo-dacfd15c\"><a class=\"link-a079aa82--primary-53a25e66--logoLink-10d08504\" href=\"/valora/\" style=\"color: rgb(255, 70, 66);\"><div class=\"reset-3c756112--logoContainer-da09bede--iconBackground-094d9584--logoContainerS-2ec8ae1a\"><span class=\"wrapper-c9de902e\" style=\"width: 24px; height: 24px;\"><span class=\"emojione emojione-40-objects _1f58b emoji-64354ccb\" role=\"img\" alt=\"🖋\" title=\":pen_fountain:\" aria-label=\":pen_fountain:\" style=\"transform: translate(-50%, -55%) scale(0.6); text-indent: 0em; font-size: 0px; color: rgba(0, 0, 0, 0);\">🖋</span></span></div><div class=\"reset-3c756112--S100Left-7c8af13a--logoDisplayNameContainer-583bfe61--logoText-03dbe4a1\"><span class=\"text-4505230f--DisplayH700-a03ad9b4--textContentFamily-49a318e1--spaceNameText-677c2969\">valora</span></div></a></div><div class=\"reset-3c756112--desktopLogo-a594db90\"><a class=\"link-a079aa82--primary-53a25e66--logoLink-10d08504\" href=\"/valora/\" style=\"color: rgb(255, 70, 66);\"><div class=\"reset-3c756112--logoContainer-da09bede--iconBackground-094d9584--logoContainerM-296350e4\"><span class=\"wrapper-c9de902e\" style=\"width: 30px; height: 30px;\"><span class=\"emojione emojione-40-objects _1f58b emoji-64354ccb\" role=\"img\" alt=\"🖋\" title=\":pen_fountain:\" aria-label=\":pen_fountain:\" style=\"transform: translate(-50%, -55%) scale(0.75); text-indent: 0em; font-size: 0px; color: rgba(0, 0, 0, 0);\">🖋</span></span></div><div class=\"reset-3c756112--S100Left-7c8af13a--logoDisplayNameContainer-583bfe61--logoText-03dbe4a1\"><span class=\"text-4505230f--DisplayH700-a03ad9b4--textContentFamily-49a318e1--spaceNameText-677c2969\">valora</span></div></a></div></div><div role=\"button\" tabindex=\"-1\" class=\"reset-3c756112--mobileButton-7a76d05f\"><svg preserveAspectRatio=\"xMidYMid meet\" height=\"1em\" width=\"1em\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" class=\"icon-7f6730be--text-3f89f380--icon-1f8349b3\"><g><circle cx=\"10.5\" cy=\"10.5\" r=\"7.5\"></circle><line x1=\"21\" y1=\"21\" x2=\"15.8\" y2=\"15.8\"></line></g></svg></div></div><div class=\"reset-3c756112--headerInnerWrapper-629f79d1--headerInnerWrapper-4f99acea\"><div class=\"reset-3c756112--withScrollbar-39338630--scrollAxisX-bf86cd6c--headerInner-c872fc48\"></div></div><div class=\"reset-3c756112--searchInputWrapper-ea7f3052--searchInputWrapper-0442d130\"><div class=\"reset-3c756112--inputContainer-b2cb171c\"><div aria-label=\"\" class=\"reset-3c756112--inputWrapper-63396dac--TextH400-3033861f--medium-4505230f--light-502263b4--input-6d442051--searchInput-3fa812d5\"><div class=\"reset-3c756112--inputInnerSizer-756c9114\"><input placeholder=\"Search...\" type=\"text\" class=\"inputInner-5c86b87d--medium-0bbed4bd--inputInner-4216b016--searchInputPlaceholder-936306be\"></div><div class=\"reset-3c756112--inputAddOn-45de9ec1--inputAddOnPrefix-202fa60d--icon-1f8349b3\"><svg preserveAspectRatio=\"xMidYMid meet\" height=\"1em\" width=\"1em\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" class=\"icon-7f6730be--text-3f89f380\"><g><circle cx=\"10.5\" cy=\"10.5\" r=\"7.5\"></circle><line x1=\"21\" y1=\"21\" x2=\"15.8\" y2=\"15.8\"></line></g></svg></div></div></div></div></div></div><div class=\"reset-3c756112--bodyContent-2f98451b\"><div class=\"reset-3c756112--wholeContent-9fc567d4\"><div class=\"reset-3c756112--wholeContentBody-554be184\"><div role=\"presentation\" class=\"reset-3c756112--backdrop-1322b68a--hidden-247382c3--overlay-29559ab8\"></div><div class=\"reset-3c756112--contentNavigation-dd3370a4\"><div class=\"reset-3c756112--contentNavigationInner-205d49ea--contentNavigationInnerCollapsed-7b4aca00\"><div class=\"reset-3c756112--sidebarWrapper-84a13d8e\"><div class=\"reset-3c756112\" style=\"padding-bottom: 0px;\"></div><div class=\"reset-3c756112--sidebar-84a13d8e\"><div class=\"reset-3c756112--navigationHeader-2c71cfec\"><div class=\"reset-3c756112--navigationHeaderLogo-756c9114\"><div class=\"reset-3c756112--mobileLogo-dacfd15c\"><a class=\"link-a079aa82--primary-53a25e66--logoLink-10d08504\" href=\"/valora/\" style=\"color: rgb(255, 70, 66);\"><div class=\"reset-3c756112--logoContainer-da09bede--iconBackground-094d9584--logoContainerS-2ec8ae1a\"><span class=\"wrapper-c9de902e\" style=\"width: 24px; height: 24px;\"><span class=\"emojione emojione-40-objects _1f58b emoji-64354ccb\" role=\"img\" alt=\"🖋\" title=\":pen_fountain:\" aria-label=\":pen_fountain:\" style=\"transform: translate(-50%, -55%) scale(0.6); text-indent: 0em; font-size: 0px; color: rgba(0, 0, 0, 0);\">🖋</span></span></div><div class=\"reset-3c756112--S100Left-7c8af13a--logoDisplayNameContainer-583bfe61--logoText-03dbe4a1\"><span class=\"text-4505230f--DisplayH700-a03ad9b4--textContentFamily-49a318e1--spaceNameText-677c2969\">valora</span></div></a></div><div class=\"reset-3c756112--desktopLogo-a594db90\"><a class=\"link-a079aa82--primary-53a25e66--logoLink-10d08504\" href=\"/valora/\" style=\"color: rgb(255, 70, 66);\"><div class=\"reset-3c756112--logoContainer-da09bede--iconBackground-094d9584--logoContainerM-296350e4\"><span class=\"wrapper-c9de902e\" style=\"width: 30px; height: 30px;\"><span class=\"emojione emojione-40-objects _1f58b emoji-64354ccb\" role=\"img\" alt=\"🖋\" title=\":pen_fountain:\" aria-label=\":pen_fountain:\" style=\"transform: translate(-50%, -55%) scale(0.75); text-indent: 0em; font-size: 0px; color: rgba(0, 0, 0, 0);\">🖋</span></span></div><div class=\"reset-3c756112--S100Left-7c8af13a--logoDisplayNameContainer-583bfe61--logoText-03dbe4a1\"><span class=\"text-4505230f--DisplayH700-a03ad9b4--textContentFamily-49a318e1--spaceNameText-677c2969\">valora</span></div></a></div></div><div class=\"reset-3c756112\"><button class=\"button-36063075--medium-6e2a217a--button-5c53d970--medium-54db2ab3\"><span class=\"medium-3bde6db7--iconOnly-bddce91a\"><svg preserveAspectRatio=\"xMidYMid meet\" height=\"1em\" width=\"1em\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" class=\"icon-7f6730be--text-3f89f380\"><g><circle cx=\"10.5\" cy=\"10.5\" r=\"7.5\"></circle><line x1=\"21\" y1=\"21\" x2=\"15.8\" y2=\"15.8\"></line></g></svg></span><span class=\"text-4505230f--UIH400-4e41e82a--textUIFamily-5ebd8e40--text-8ee2c8b2\"></span></button></div></div><div class=\"reset-3c756112--sidebarMain-13701e8f--sidebarMainWithHeader-1c1823e0\"><div class=\"reset-3c756112--withScrollbar-39338630--scrollAxisY-7680295e--sidebarInner-18a1e7fe\"><div class=\"reset-3c756112--mobileHeader-4e2d4892\"><div role=\"button\" tabindex=\"-1\" class=\"reset-3c756112--mobileHeaderClose-47b8fa64\"><svg preserveAspectRatio=\"xMidYMid meet\" height=\"1em\" width=\"1em\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" class=\"icon-7f6730be--text-3f89f380\"><g><line x1=\"19\" y1=\"12\" x2=\"5\" y2=\"12\"></line><polyline points=\"12 19 5 12 12 5\"></polyline></g></svg></div></div><div class=\"reset-3c756112--pagesTree-4b07cd56\"><div class=\"reset-3c756112--pageItem-01e3f344\"><div class=\"reset-3c756112--pageComponent-7cc5301a\"><a class=\"navButton-94f2579c--navButtonClickable-161b88ca--navButtonOpened-6a88552e\" href=\"/valora/\" style=\"color: rgb(255, 70, 66);\"><span class=\"text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f\">Introduction</span></a></div></div><div class=\"reset-3c756112\"><div class=\"reset-3c756112--pageItemWithChildren-56f27afc\" draggable=\"true\"><div class=\"reset-3c756112\"><div class=\"reset-3c756112--pageItem-01e3f344\"><div class=\"reset-3c756112--pageComponent-7cc5301a\"><a class=\"navButton-94f2579c--navButtonClickable-161b88ca\" href=\"/valora/the-basics\"><span class=\"text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f\">Painting the Canvas</span></a></div></div></div></div><div class=\"reset-3c756112--pageItemWithChildren-56f27afc\" draggable=\"true\"><div class=\"reset-3c756112\"><div class=\"reset-3c756112--pageItem-01e3f344\"><div class=\"reset-3c756112--pageComponent-7cc5301a\"><a class=\"navButton-94f2579c--navButtonClickable-161b88ca\" href=\"/valora/path-creation\"><span class=\"text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f\">Path Creation</span></a></div></div></div></div><div class=\"reset-3c756112--pageItemWithChildren-56f27afc\" draggable=\"true\"><div class=\"reset-3c756112\"><div class=\"reset-3c756112--pageItem-01e3f344\"><div class=\"reset-3c756112--pageComponent-7cc5301a\"><a class=\"navButton-94f2579c--navButtonClickable-161b88ca\" href=\"/valora/path-manipulation\"><span class=\"text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f\">Path Manipulation</span></a></div></div></div></div><div class=\"reset-3c756112--pageItemWithChildren-56f27afc\" draggable=\"true\"><div class=\"reset-3c756112\"><div class=\"reset-3c756112--pageItem-01e3f344\"><div class=\"reset-3c756112--pageComponent-7cc5301a\"><a class=\"navButton-94f2579c--navButtonClickable-161b88ca\" href=\"/valora/custom-shaders\"><span class=\"text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f\">Custom Shaders</span></a></div></div></div></div><div class=\"reset-3c756112--pageItemWithChildren-56f27afc\" draggable=\"true\"><div class=\"reset-3c756112\"><div class=\"reset-3c756112--pageItem-01e3f344\"><div class=\"reset-3c756112--pageComponent-7cc5301a\"><a class=\"navButton-94f2579c--navButtonClickable-161b88ca\" href=\"/valora/being-the-artist\"><span class=\"text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f\">Being the Artist</span></a></div></div></div></div><div class=\"reset-3c756112--pageItemWithChildren-56f27afc--S300Bottom-9b4658d2\" draggable=\"true\"><div class=\"reset-3c756112\"><div class=\"reset-3c756112--pageItem-01e3f344\"><div class=\"reset-3c756112--pageComponent-7cc5301a\"><a class=\"navButton-94f2579c--navButtonClickable-161b88ca\" href=\"/valora/gallery\"><span class=\"text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f\">Gallery</span></a></div></div></div></div></div></div></div><div class=\"reset-3c756112--footer-68e6f18c\"><a href=\"https://www.gitbook.com/?utm_source=content&amp;utm_medium=trademark&amp;utm_campaign=paytonturnage\" target=\"_blank\" class=\"reset-3c756112--trademark-a8da4b94\" role=\"presentation\"><div class=\"reset-3c756112--trademarkLogo-0d2d53bc\"><svg preserveAspectRatio=\"xMidYMid meet\" height=\"1em\" width=\"1em\" fill=\"currentColor\" viewBox=\"0 0 1067 769\" xmlns=\"http://www.w3.org/2000/svg\" stroke=\"none\" class=\"icon-7f6730be--text-3f89f380\"><g><path d=\"M480.026 640.677c17.205 0 31.2 13.997 31.2 31.194s-13.995 31.193-31.2 31.193c-17.197 0-31.193-13.996-31.193-31.193 0-17.197 13.996-31.194 31.193-31.194m489.93-193.226c-17.203 0-31.2-13.998-31.2-31.195 0-17.204 13.997-31.2 31.2-31.2 17.198 0 31.194 13.996 31.194 31.2 0 17.197-13.996 31.195-31.193 31.195m0-127.804c-53.269 0-96.609 43.34-96.609 96.609 0 10.373 1.723 20.702 5.123 30.741L559.328 616.879c-18.132-26.128-47.521-41.617-79.302-41.617-36.821 0-70.391 21.065-86.63 54.003L106.68 478.109c-30.288-15.927-52.965-65.817-50.56-111.223 1.248-23.687 9.438-42.071 21.897-49.17 7.916-4.493 17.436-4.099 27.526 1.188l1.916 1.01c75.96 40.022 324.6 170.981 335.063 175.844 16.157 7.47 25.14 10.5 52.659-2.547l513.958-267.3c7.53-2.844 16.315-10.062 16.315-21.023 0-15.205-15.72-21.199-15.765-21.199-29.218-14.018-74.163-35.054-117.987-55.57C798.033 84.26 691.861 34.547 645.23 10.132c-40.253-21.072-72.655-3.311-78.432.282l-11.227 5.555C345.727 119.743 64.898 258.826 48.911 268.553 20.278 285.973 2.547 320.679.252 363.768c-3.586 68.304 31.261 139.506 81.069 165.634l303.172 156.354c6.83 47.306 47.55 82.725 95.532 82.725 52.78 0 95.808-42.546 96.603-95.14L910.541 492.38c16.93 13.233 37.92 20.486 59.416 20.486 53.268 0 96.61-43.341 96.61-96.61s-43.342-96.61-96.61-96.61\" fill-rule=\"evenodd\"></path></g></svg></div><div class=\"reset-3c756112--trademarkContent-04a01aea\"><div class=\"reset-3c756112\"><span class=\"text-4505230f--TextH200-a3425406--textUIFamily-5ebd8e40\">Powered by <b>GitBook</b></span></div></div></a></div></div></div></div></div></div><div class=\"reset-3c756112--wholeContentPage-6c3f1fc5\"><div class=\"reset-3c756112--wholePageSticky-f53dafd2\"><div class=\"reset-3c756112--pageContainer-3ec6d8d0\"><div class=\"reset-3c756112\"><div class=\"reset-3c756112--pageHeader-15724735\"><div class=\"reset-3c756112--pageHeaderInner-7c0f0284\"><div class=\"reset-3c756112--pageHeaderWrapperContent-6897c946\"><div class=\"reset-3c756112--horizontalFlex-5a0077e0\"><div class=\"reset-3c756112--pageHeaderIntro-0c1463da\"><h1 class=\"reset-3c756112--pageTitle-33dc39a3\"><span class=\"text-4505230f--DisplayH900-bfb998fa--textContentFamily-49a318e1\">Introduction</span></h1></div><div class=\"reset-3c756112--toolbar-a6a9f7d2--medium-8e46b02c--pageHeaderToolbar-6457a802--withControlsClosed-3e96e46c\" style=\"grid-template-columns: auto;\"></div></div><div class=\"reset-3c756112--pageHeaderDescription-22970244\"></div></div></div></div><div class=\"reset-3c756112--toaster-c029690e\"></div><div class=\"reset-3c756112--pageBody-a91db4ac\"><div data-editioncontainer=\"true\" class=\"reset-3c756112--container-960c7c26\"><div data-slate-editor=\"true\" data-key=\"4\" autocorrect=\"on\" spellcheck=\"true\" data-gramm=\"false\" style=\"outline: none; white-space: pre-wrap; overflow-wrap: break-word;\"><p class=\"blockParagraph-544a408c\" data-key=\"cb57cb129f9a41bb9184fe7464550801\"><span class=\"text-4505230f--TextH400-3033861f--textContentFamily-49a318e1\"><span data-key=\"93bc8a92560548828c3903a76a3bf620\"><span data-offset-key=\"93bc8a92560548828c3903a76a3bf620:0\"><span data-slate-zero-width=\"z\">​</span></span></span><a class=\"link-a079aa82--primary-53a25e66--link-faf6c434\" href=\"https://github.com/turnage/valora\" target=\"_blank\" rel=\"noopener noreferrer\" data-key=\"4762058f3474435d836f831516b71c55\" style=\"color: rgb(255, 70, 66);\"><span data-key=\"3c4939a652b8457e9fae629182e5889c\"><span data-offset-key=\"3c4939a652b8457e9fae629182e5889c:0\">Valora </span></span></a><span data-key=\"c79517893bd74a66862e2eba6264e5e5\"><span data-offset-key=\"c79517893bd74a66862e2eba6264e5e5:0\">is a brush for generative fine art. With valora you can write visual compositions that</span></span></span></p><ul class=\"list-20526648\" data-key=\"803338e9f59d439eafc758df56fa8094\"><li class=\"\"><div data-key=\"e2fd6cdf0c264d188db6a12b30a267ae\" class=\"reset-3c756112--listItemContent-756c9114\"><p class=\"blockParagraph-544a408c--noMargin-acdf7afa\" data-key=\"5f8723483c9048409ad836c8b6ef1d6f\"><span class=\"text-4505230f--TextH400-3033861f--textContentFamily-49a318e1\"><span data-key=\"d0b193495ece48978da0575cc6d493a5\"><span data-offset-key=\"d0b193495ece48978da0575cc6d493a5:0\">are repeatable with rng seeds managed for you</span></span></span></p></div></li><li class=\"\"><div data-key=\"bb9def6edc674f70a05d9743c125c7a4\" class=\"reset-3c756112--listItemContent-756c9114\"><p class=\"blockParagraph-544a408c--noMargin-acdf7afa\" data-key=\"b964da67a4e34c79a5b24f11833e0461\"><span class=\"text-4505230f--TextH400-3033861f--textContentFamily-49a318e1\"><span data-key=\"1c7241ede99c469e8822c6e6f4e8f2a8\"><span data-offset-key=\"1c7241ede99c469e8822c6e6f4e8f2a8:0\">can be reproduced at arbitrary resolutions without changing the scale of the composition</span></span></span></p></div></li><li class=\"\"><div data-key=\"6dfabf65cebe48a89889cee8c5706780\" class=\"reset-3c756112--listItemContent-756c9114\"><p class=\"blockParagraph-544a408c--noMargin-acdf7afa\" data-key=\"f8eb7ac1943045909686ca414174235c\"><span class=\"text-4505230f--TextH400-3033861f--textContentFamily-49a318e1\"><span data-key=\"adaeb62617224f968dbd8d54c2582ec2\"><span data-offset-key=\"adaeb62617224f968dbd8d54c2582ec2:0\">have strict type-safe color semantics that won't surprise you in print (thanks to </span></span><a class=\"link-a079aa82--primary-53a25e66--link-faf6c434\" href=\"https://docs.rs/palette\" target=\"_blank\" rel=\"noopener noreferrer\" data-key=\"b047d8a07cb640ceaf82811b74d3ebf4\" style=\"color: rgb(255, 70, 66);\"><span data-key=\"f632c840d6e04dc9b656b07a7d907389\"><span data-offset-key=\"f632c840d6e04dc9b656b07a7d907389:0\">palette</span></span></a><span data-key=\"97157f928af645c588848084355f9afd\"><span data-offset-key=\"97157f928af645c588848084355f9afd:0\">!)</span></span></span></p></div></li><li class=\"\"><div data-key=\"359dff3f2adc4f7596eb70c1e24ce60a\" class=\"reset-3c756112--listItemContent-756c9114\"><p class=\"blockParagraph-544a408c--noMargin-acdf7afa\" data-key=\"3ace5369f2c843858b9ca7ba8209a1e1\"><span class=\"text-4505230f--TextH400-3033861f--textContentFamily-49a318e1\"><span data-key=\"1808f3742117485bb435e1e1be6c093c\"><span data-offset-key=\"1808f3742117485bb435e1e1be6c093c:0\">leverage all of your hardware (You can shade each path with a different fragment shader!)</span></span></span></p></div></li><li class=\"\"><div data-key=\"947eb13c014d421d89207d8a35c464e3\" class=\"reset-3c756112--listItemContent-756c9114\"><p class=\"blockParagraph-544a408c--noMargin-acdf7afa\" data-key=\"615916fba02f49c1b061127e8e1ab3ea\"><span class=\"text-4505230f--TextH400-3033861f--textContentFamily-49a318e1\"><span data-key=\"2df221e2c23441f98ff83e03c0a6b959\"><span data-offset-key=\"2df221e2c23441f98ff83e03c0a6b959:0\">you will rarely have to debug, thanks to Rust!</span></span></span></p></div></li></ul><p class=\"blockParagraph-544a408c\" data-key=\"d01bd788962d40f7aeda62ee166e4e05\"><span class=\"text-4505230f--TextH400-3033861f--textContentFamily-49a318e1\"><span data-key=\"4a61003d08824e9390a2b2790184948a\"><span data-offset-key=\"4a61003d08824e9390a2b2790184948a:0\">This guide covers valora in depth, but to start let's see some pixels! Keep</span></span><a class=\"link-a079aa82--primary-53a25e66--link-faf6c434\" href=\"https://docs.rs/valora\" target=\"_blank\" rel=\"noopener noreferrer\" data-key=\"1c32d8b735d4495b959d3ec9acb659d1\" style=\"color: rgb(255, 70, 66);\"><span data-key=\"0a49c1ad09774697aa6be9cdd4a58dfb\"><span data-offset-key=\"0a49c1ad09774697aa6be9cdd4a58dfb:0\"> the docs</span></span></a><span data-key=\"aed23bdbeb364c53b88a536a2ee9a442\"><span data-offset-key=\"aed23bdbeb364c53b88a536a2ee9a442:0\"> open to follow along.</span></span></span></p><div class=\"reset-3c756112--codeBlockWrapper-56f27afc\"><div contenteditable=\"false\" class=\"reset-3c756112--copyButtonWrapper-ca591f6e\"><div aria-label=\"Copy\" role=\"button\" tabindex=\"0\" class=\"reset-3c756112--touchableView-a079aa82--copyButton-4f9a9412--tooltipped-57ae51fe\"><svg preserveAspectRatio=\"xMidYMid meet\" height=\"1em\" width=\"1em\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" class=\"icon-7f6730be--text-3f89f380\"><g><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></g></svg></div></div><pre data-key=\"9746a1ce10ad440f82543438a4c8e721\" spellcheck=\"false\" class=\"reset-3c756112--codeBlock-75b39b81\"><div class=\"codeLine-a3169fbc\" data-key=\"71bb0d9dce034f8c8ca706a519ca949d\"><span data-key=\"b7368ce637e74ee29fb5347d768b1edb\"><span data-offset-key=\"b7368ce637e74ee29fb5347d768b1edb:0\">cargo new art --bin </span><span data-offset-key=\"b7368ce637e74ee29fb5347d768b1edb:1\"><span class=\"prism-token token 1 operator \">&amp;&amp;</span></span><span data-offset-key=\"b7368ce637e74ee29fb5347d768b1edb:2\"><span class=\"prism-token token 2\"> </span></span><span data-offset-key=\"b7368ce637e74ee29fb5347d768b1edb:3\"><span class=\"prism-token token 3 function \">cd</span></span><span data-offset-key=\"b7368ce637e74ee29fb5347d768b1edb:4\"><span class=\"prism-token token 4\"> art</span></span></span></div><div class=\"codeLine-a3169fbc\" data-key=\"f8bec194e8c448c3a1fb31abc467beef\"><span data-key=\"61ae8a6dd3784d3cb7f552b33f1d93e6\"><span data-offset-key=\"61ae8a6dd3784d3cb7f552b33f1d93e6:0\"><span class=\"prism-token token 4\">cargo </span></span><span data-offset-key=\"61ae8a6dd3784d3cb7f552b33f1d93e6:1\"><span class=\"prism-token token 5 function \">install</span></span><span data-offset-key=\"61ae8a6dd3784d3cb7f552b33f1d93e6:2\"><span class=\"prism-token token 6\"> cargo-edit </span></span><span data-offset-key=\"61ae8a6dd3784d3cb7f552b33f1d93e6:3\"><span class=\"prism-token token 7 operator \">&amp;&amp;</span></span><span data-offset-key=\"61ae8a6dd3784d3cb7f552b33f1d93e6:4\"><span class=\"prism-token token 8\"> cargo add valora</span></span></span></div></pre></div><p class=\"blockParagraph-544a408c\" data-key=\"1b259e4e3885465ebc9b17cda3a01090\"><span class=\"text-4505230f--TextH400-3033861f--textContentFamily-49a318e1\"><span data-key=\"f0700a915d044975a30447b914d18303\"><span data-offset-key=\"f0700a915d044975a30447b914d18303:0\">Put the following in your </span><span data-offset-key=\"f0700a915d044975a30447b914d18303:1\"><code spellcheck=\"false\" class=\"code-81e98f88\" data-slate-leaf=\"true\">main.rs</code></span><span data-offset-key=\"f0700a915d044975a30447b914d18303:2\">:</span></span></span></p><div class=\"reset-3c756112--codeBlockWrapper-56f27afc\"><div contenteditable=\"false\" class=\"reset-3c756112--copyButtonWrapper-ca591f6e\"><div aria-label=\"Copy\" role=\"button\" tabindex=\"0\" class=\"reset-3c756112--touchableView-a079aa82--copyButton-4f9a9412--tooltipped-57ae51fe\"><svg preserveAspectRatio=\"xMidYMid meet\" height=\"1em\" width=\"1em\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" class=\"icon-7f6730be--text-3f89f380\"><g><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></g></svg></div></div><pre data-key=\"4547cc7b2d374a5f87f823e1c906db7c\" spellcheck=\"false\" class=\"reset-3c756112--codeBlock-75b39b81\"><div class=\"codeLine-a3169fbc\" data-key=\"849c8251f012494a94b6d8454b831816\"><span data-key=\"98e92749ecf94cf6b85e888e3fea8c59\"><span data-offset-key=\"98e92749ecf94cf6b85e888e3fea8c59:0\"><span class=\"prism-token token  keyword \">use</span></span><span data-offset-key=\"98e92749ecf94cf6b85e888e3fea8c59:1\"><span class=\"prism-token token 1\"> valora</span></span><span data-offset-key=\"98e92749ecf94cf6b85e888e3fea8c59:2\"><span class=\"prism-token token 2 punctuation \">:</span></span><span data-offset-key=\"98e92749ecf94cf6b85e888e3fea8c59:3\"><span class=\"prism-token token 3 punctuation \">:</span></span><span data-offset-key=\"98e92749ecf94cf6b85e888e3fea8c59:4\"><span class=\"prism-token token 4\">prelude</span></span><span data-offset-key=\"98e92749ecf94cf6b85e888e3fea8c59:5\"><span class=\"prism-token token 5 punctuation \">:</span></span><span data-offset-key=\"98e92749ecf94cf6b85e888e3fea8c59:6\"><span class=\"prism-token token 6 punctuation \">:</span></span><span data-offset-key=\"98e92749ecf94cf6b85e888e3fea8c59:7\"><span class=\"prism-token token 7 operator \">*</span></span><span data-offset-key=\"98e92749ecf94cf6b85e888e3fea8c59:8\"><span class=\"prism-token token 8 punctuation \">;</span></span></span></div><div class=\"codeLine-a3169fbc\" data-key=\"a4bc15106b404c60ba6254a265c8f65c\"><span data-key=\"a018404734d7464aa1b789edd9b2955b\"><span data-offset-key=\"a018404734d7464aa1b789edd9b2955b:0\"><span data-slate-zero-width=\"n\">​</span></span></span></div><div class=\"codeLine-a3169fbc\" data-key=\"c5348b708e8e4d938ca30c111de86178\"><span data-key=\"932a87cddcde480086eab6b2c87dd621\"><span data-offset-key=\"932a87cddcde480086eab6b2c87dd621:0\"><span class=\"prism-token token 10 keyword \">fn</span></span><span data-offset-key=\"932a87cddcde480086eab6b2c87dd621:1\"><span class=\"prism-token token 11\"> </span></span><span data-offset-key=\"932a87cddcde480086eab6b2c87dd621:2\"><span class=\"prism-token token 12 function \">main</span></span><span data-offset-key=\"932a87cddcde480086eab6b2c87dd621:3\"><span class=\"prism-token token 13 punctuation \">(</span></span><span data-offset-key=\"932a87cddcde480086eab6b2c87dd621:4\"><span class=\"prism-token token 14 punctuation \">)</span></span><span data-offset-key=\"932a87cddcde480086eab6b2c87dd621:5\"><span class=\"prism-token token 15\"> </span></span><span data-offset-key=\"932a87cddcde480086eab6b2c87dd621:6\"><span class=\"prism-token token 16 punctuation \">-&gt;</span></span><span data-offset-key=\"932a87cddcde480086eab6b2c87dd621:7\"><span class=\"prism-token token 17\"> Result</span></span><span data-offset-key=\"932a87cddcde480086eab6b2c87dd621:8\"><span class=\"prism-token token 18 operator \">&lt;</span></span><span data-offset-key=\"932a87cddcde480086eab6b2c87dd621:9\"><span class=\"prism-token token 19 punctuation \">(</span></span><span data-offset-key=\"932a87cddcde480086eab6b2c87dd621:10\"><span class=\"prism-token token 20 punctuation \">)</span></span><span data-offset-key=\"932a87cddcde480086eab6b2c87dd621:11\"><span class=\"prism-token token 21 operator \">&gt;</span></span><span data-offset-key=\"932a87cddcde480086eab6b2c87dd621:12\"><span class=\"prism-token token 22\"> </span></span><span data-offset-key=\"932a87cddcde480086eab6b2c87dd621:13\"><span class=\"prism-token token 23 punctuation \">{</span></span></span></div><div class=\"codeLine-a3169fbc\" data-key=\"826a8f38d47b4b31b78006dc038581d2\"><span data-key=\"d25621df5afe41108ead3d8c535ac76a\"><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:0\"><span class=\"prism-token token 24\">    </span></span><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:1\"><span class=\"prism-token token 25 function \">run_fn</span></span><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:2\"><span class=\"prism-token token 26 punctuation \">(</span></span><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:3\"><span class=\"prism-token token 27\">Options</span></span><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:4\"><span class=\"prism-token token 28 punctuation \">:</span></span><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:5\"><span class=\"prism-token token 29 punctuation \">:</span></span><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:6\"><span class=\"prism-token token 30 function \">from_args</span></span><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:7\"><span class=\"prism-token token 31 punctuation \">(</span></span><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:8\"><span class=\"prism-token token 32 punctuation \">)</span></span><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:9\"><span class=\"prism-token token 33 punctuation \">,</span></span><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:10\"><span class=\"prism-token token 34\"> </span></span><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:11\"><span class=\"prism-token token 35 closure-params  punctuation \">|</span></span><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:12\"><span class=\"prism-token token 35 closure-params \">_gpu</span></span><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:13\"><span class=\"prism-token token 35 closure-params  punctuation \">,</span></span><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:14\"><span class=\"prism-token token 35 closure-params \"> world</span></span><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:15\"><span class=\"prism-token token 35 closure-params  punctuation \">,</span></span><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:16\"><span class=\"prism-token token 35 closure-params \"> _rng</span></span><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:17\"><span class=\"prism-token token 35 closure-params  punctuation \">|</span></span><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:18\"><span class=\"prism-token token 36\"> </span></span><span data-offset-key=\"d25621df5afe41108ead3d8c535ac76a:19\"><span class=\"prism-token token 37 punctuation \">{</span></span></span></div><div class=\"codeLine-a3169fbc\" data-key=\"d27aacea68eb4acd87a9ff9c8f6a1c10\"><span data-key=\"79522e671e59490b8b121a741f733edf\"><span data-offset-key=\"79522e671e59490b8b121a741f733edf:0\"><span class=\"prism-token token 38\">        </span></span><span data-offset-key=\"79522e671e59490b8b121a741f733edf:1\"><span class=\"prism-token token 39 function \">Ok</span></span><span data-offset-key=\"79522e671e59490b8b121a741f733edf:2\"><span class=\"prism-token token 40 punctuation \">(</span></span><span data-offset-key=\"79522e671e59490b8b121a741f733edf:3\"><span class=\"prism-token token 41 keyword \">move</span></span><span data-offset-key=\"79522e671e59490b8b121a741f733edf:4\"><span class=\"prism-token token 42\"> </span></span><span data-offset-key=\"79522e671e59490b8b121a741f733edf:5\"><span class=\"prism-token token 43 operator \">|</span></span><span data-offset-key=\"79522e671e59490b8b121a741f733edf:6\"><span class=\"prism-token token 44\">ctx</span></span><span data-offset-key=\"79522e671e59490b8b121a741f733edf:7\"><span class=\"prism-token token 45 punctuation \">:</span></span><span data-offset-key=\"79522e671e59490b8b121a741f733edf:8\"><span class=\"prism-token token 46\"> Context</span></span><span data-offset-key=\"79522e671e59490b8b121a741f733edf:9\"><span class=\"prism-token token 47 punctuation \">,</span></span><span data-offset-key=\"79522e671e59490b8b121a741f733edf:10\"><span class=\"prism-token token 48\"> canvas</span></span><span data-offset-key=\"79522e671e59490b8b121a741f733edf:11\"><span class=\"prism-token token 49 punctuation \">:</span></span><span data-offset-key=\"79522e671e59490b8b121a741f733edf:12\"><span class=\"prism-token token 50\"> </span></span><span data-offset-key=\"79522e671e59490b8b121a741f733edf:13\"><span class=\"prism-token token 51 operator \">&amp;</span></span><span data-offset-key=\"79522e671e59490b8b121a741f733edf:14\"><span class=\"prism-token token 52 keyword \">mut</span></span><span data-offset-key=\"79522e671e59490b8b121a741f733edf:15\"><span class=\"prism-token token 53\"> Canvas</span></span><span data-offset-key=\"79522e671e59490b8b121a741f733edf:16\"><span class=\"prism-token token 54 operator \">|</span></span><span data-offset-key=\"79522e671e59490b8b121a741f733edf:17\"><span class=\"prism-token token 55\"> </span></span><span data-offset-key=\"79522e671e59490b8b121a741f733edf:18\"><span class=\"prism-token token 56 punctuation \">{</span></span></span></div><div class=\"codeLine-a3169fbc\" data-key=\"fb1686e9b06a48bfb4f4acf7df909d8b\"><span data-key=\"dd9004e22421479c9e402eff0477567b\"><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:0\"><span class=\"prism-token token 57\">            canvas</span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:1\"><span class=\"prism-token token 58 punctuation \">.</span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:2\"><span class=\"prism-token token 59 function \">set_color</span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:3\"><span class=\"prism-token token 60 punctuation \">(</span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:4\"><span class=\"prism-token token 61\">LinSrgb</span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:5\"><span class=\"prism-token token 62 punctuation \">:</span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:6\"><span class=\"prism-token token 63 punctuation \">:</span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:7\"><span class=\"prism-token token 64 function \">new</span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:8\"><span class=\"prism-token token 65 punctuation \">(</span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:9\"><span class=\"prism-token token 66 number \">1</span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:10\"><span class=\"prism-token token 67 punctuation \">.</span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:11\"><span class=\"prism-token token 68 punctuation \">,</span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:12\"><span class=\"prism-token token 69\"> </span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:13\"><span class=\"prism-token token 70 number \">1</span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:14\"><span class=\"prism-token token 71 punctuation \">.</span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:15\"><span class=\"prism-token token 72 punctuation \">,</span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:16\"><span class=\"prism-token token 73\"> </span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:17\"><span class=\"prism-token token 74 number \">1</span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:18\"><span class=\"prism-token token 75 punctuation \">.</span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:19\"><span class=\"prism-token token 76 punctuation \">)</span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:20\"><span class=\"prism-token token 77 punctuation \">)</span></span><span data-offset-key=\"dd9004e22421479c9e402eff0477567b:21\"><span class=\"prism-token token 78 punctuation \">;</span></span></span></div><div class=\"codeLine-a3169fbc\" data-key=\"fd8dc1afd1e5475ea13f91c70f20bd8a\"><span data-key=\"abbd51d577ad418f9f1c55abd645d85b\"><span data-offset-key=\"abbd51d577ad418f9f1c55abd645d85b:0\"><span class=\"prism-token token 79\">            canvas</span></span><span data-offset-key=\"abbd51d577ad418f9f1c55abd645d85b:1\"><span class=\"prism-token token 80 punctuation \">.</span></span><span data-offset-key=\"abbd51d577ad418f9f1c55abd645d85b:2\"><span class=\"prism-token token 81 function \">paint</span></span><span data-offset-key=\"abbd51d577ad418f9f1c55abd645d85b:3\"><span class=\"prism-token token 82 punctuation \">(</span></span><span data-offset-key=\"abbd51d577ad418f9f1c55abd645d85b:4\"><span class=\"prism-token token 83 function \">Filled</span></span><span data-offset-key=\"abbd51d577ad418f9f1c55abd645d85b:5\"><span class=\"prism-token token 84 punctuation \">(</span></span><span data-offset-key=\"abbd51d577ad418f9f1c55abd645d85b:6\"><span class=\"prism-token token 85\">ctx</span></span><span data-offset-key=\"abbd51d577ad418f9f1c55abd645d85b:7\"><span class=\"prism-token token 86 punctuation \">.</span></span><span data-offset-key=\"abbd51d577ad418f9f1c55abd645d85b:8\"><span class=\"prism-token token 87\">world</span></span><span data-offset-key=\"abbd51d577ad418f9f1c55abd645d85b:9\"><span class=\"prism-token token 88 punctuation \">)</span></span><span data-offset-key=\"abbd51d577ad418f9f1c55abd645d85b:10\"><span class=\"prism-token token 89 punctuation \">)</span></span><span data-offset-key=\"abbd51d577ad418f9f1c55abd645d85b:11\"><span class=\"prism-token token 90 punctuation \">;</span></span></span></div><div class=\"codeLine-a3169fbc\" data-key=\"13db217dbcec45b0a9449e5ea301e597\"><span data-key=\"2c596ded2f2d42a8a3ca1c6e556e332a\"><span data-offset-key=\"2c596ded2f2d42a8a3ca1c6e556e332a:0\"><span data-slate-zero-width=\"n\">​</span></span></span></div><div class=\"codeLine-a3169fbc\" data-key=\"9cc35baa2c0343eaa93149772636e5c6\"><span data-key=\"2cf4c1fe1e7f41a59b37ece2e26bee66\"><span data-offset-key=\"2cf4c1fe1e7f41a59b37ece2e26bee66:0\"><span class=\"prism-token token 91\">            </span></span><span data-offset-key=\"2cf4c1fe1e7f41a59b37ece2e26bee66:1\"><span class=\"prism-token token 92 keyword \">let</span></span><span data-offset-key=\"2cf4c1fe1e7f41a59b37ece2e26bee66:2\"><span class=\"prism-token token 93\"> max_radius </span></span><span data-offset-key=\"2cf4c1fe1e7f41a59b37ece2e26bee66:3\"><span class=\"prism-token token 94 operator \">=</span></span><span data-offset-key=\"2cf4c1fe1e7f41a59b37ece2e26bee66:4\"><span class=\"prism-token token 95\"> world</span></span><span data-offset-key=\"2cf4c1fe1e7f41a59b37ece2e26bee66:5\"><span class=\"prism-token token 96 punctuation \">.</span></span><span data-offset-key=\"2cf4c1fe1e7f41a59b37ece2e26bee66:6\"><span class=\"prism-token token 97\">width </span></span><span data-offset-key=\"2cf4c1fe1e7f41a59b37ece2e26bee66:7\"><span class=\"prism-token token 98 operator \">/</span></span><span data-offset-key=\"2cf4c1fe1e7f41a59b37ece2e26bee66:8\"><span class=\"prism-token token 99\"> </span></span><span data-offset-key=\"2cf4c1fe1e7f41a59b37ece2e26bee66:9\"><span class=\"prism-token token 100 number \">3</span></span><span data-offset-key=\"2cf4c1fe1e7f41a59b37ece2e26bee66:10\"><span class=\"prism-token token 101 punctuation \">.</span></span><span data-offset-key=\"2cf4c1fe1e7f41a59b37ece2e26bee66:11\"><span class=\"prism-token token 102 punctuation \">;</span></span></span></div><div class=\"codeLine-a3169fbc\" data-key=\"a9714e0b808e4a9a8eb3291629f79cb3\"><span data-key=\"c104832021874a71911d6cf8209c7de8\"><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:0\"><span class=\"prism-token token 103\">            </span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:1\"><span class=\"prism-token token 104 keyword \">let</span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:2\"><span class=\"prism-token token 105\"> radius </span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:3\"><span class=\"prism-token token 106 operator \">=</span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:4\"><span class=\"prism-token token 107\"> ctx</span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:5\"><span class=\"prism-token token 108 punctuation \">.</span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:6\"><span class=\"prism-token token 109\">time</span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:7\"><span class=\"prism-token token 110 punctuation \">.</span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:8\"><span class=\"prism-token token 111 function \">as_secs_f32</span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:9\"><span class=\"prism-token token 112 punctuation \">(</span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:10\"><span class=\"prism-token token 113 punctuation \">)</span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:11\"><span class=\"prism-token token 114 punctuation \">.</span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:12\"><span class=\"prism-token token 115 function \">cos</span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:13\"><span class=\"prism-token token 116 punctuation \">(</span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:14\"><span class=\"prism-token token 117 punctuation \">)</span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:15\"><span class=\"prism-token token 118 punctuation \">.</span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:16\"><span class=\"prism-token token 119 function \">abs</span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:17\"><span class=\"prism-token token 120 punctuation \">(</span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:18\"><span class=\"prism-token token 121 punctuation \">)</span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:19\"><span class=\"prism-token token 122\"> </span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:20\"><span class=\"prism-token token 123 operator \">*</span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:21\"><span class=\"prism-token token 124\"> max_radius</span></span><span data-offset-key=\"c104832021874a71911d6cf8209c7de8:22\"><span class=\"prism-token token 125 punctuation \">;</span></span></span></div><div class=\"codeLine-a3169fbc\" data-key=\"bae9b022b7c6480a9b51e534615b22d3\"><span data-key=\"0bf48ce34d4d41508ea762e2cb96c1fc\"><span data-offset-key=\"0bf48ce34d4d41508ea762e2cb96c1fc:0\"><span data-slate-zero-width=\"n\">​</span></span></span></div><div class=\"codeLine-a3169fbc\" data-key=\"86b7689fda884e46a7e719ce959caaf8\"><span data-key=\"8a23e8d2f332433abe7644dc19427036\"><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:0\"><span class=\"prism-token token 126\">            canvas</span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:1\"><span class=\"prism-token token 127 punctuation \">.</span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:2\"><span class=\"prism-token token 128 function \">set_color</span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:3\"><span class=\"prism-token token 129 punctuation \">(</span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:4\"><span class=\"prism-token token 130\">LinSrgb</span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:5\"><span class=\"prism-token token 131 punctuation \">:</span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:6\"><span class=\"prism-token token 132 punctuation \">:</span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:7\"><span class=\"prism-token token 133 function \">new</span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:8\"><span class=\"prism-token token 134 punctuation \">(</span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:9\"><span class=\"prism-token token 135 number \">1</span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:10\"><span class=\"prism-token token 136 punctuation \">.</span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:11\"><span class=\"prism-token token 137 punctuation \">,</span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:12\"><span class=\"prism-token token 138\"> </span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:13\"><span class=\"prism-token token 139 number \">0</span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:14\"><span class=\"prism-token token 140 punctuation \">.</span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:15\"><span class=\"prism-token token 141 punctuation \">,</span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:16\"><span class=\"prism-token token 142\"> </span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:17\"><span class=\"prism-token token 143 number \">0</span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:18\"><span class=\"prism-token token 144 punctuation \">.</span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:19\"><span class=\"prism-token token 145 punctuation \">)</span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:20\"><span class=\"prism-token token 146 punctuation \">)</span></span><span data-offset-key=\"8a23e8d2f332433abe7644dc19427036:21\"><span class=\"prism-token token 147 punctuation \">;</span></span></span></div><div class=\"codeLine-a3169fbc\" data-key=\"e7458e7b82de4d56b28ad38c0ac44d44\"><span data-key=\"d1523d45ef7f40b5b6aedd6cca638982\"><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:0\"><span class=\"prism-token token 148\">            canvas</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:1\"><span class=\"prism-token token 149 punctuation \">.</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:2\"><span class=\"prism-token token 150 function \">paint</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:3\"><span class=\"prism-token token 151 punctuation \">(</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:4\"><span class=\"prism-token token 152 function \">Filled</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:5\"><span class=\"prism-token token 153 punctuation \">(</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:6\"><span class=\"prism-token token 154\">Ellipse</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:7\"><span class=\"prism-token token 155 punctuation \">:</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:8\"><span class=\"prism-token token 156 punctuation \">:</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:9\"><span class=\"prism-token token 157 function \">circle</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:10\"><span class=\"prism-token token 158 punctuation \">(</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:11\"><span class=\"prism-token token 159\">world</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:12\"><span class=\"prism-token token 160 punctuation \">.</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:13\"><span class=\"prism-token token 161 function \">center</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:14\"><span class=\"prism-token token 162 punctuation \">(</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:15\"><span class=\"prism-token token 163 punctuation \">)</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:16\"><span class=\"prism-token token 164 punctuation \">,</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:17\"><span class=\"prism-token token 165\"> radius</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:18\"><span class=\"prism-token token 166 punctuation \">)</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:19\"><span class=\"prism-token token 167 punctuation \">)</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:20\"><span class=\"prism-token token 168 punctuation \">)</span></span><span data-offset-key=\"d1523d45ef7f40b5b6aedd6cca638982:21\"><span class=\"prism-token token 169 punctuation \">;</span></span></span></div><div class=\"codeLine-a3169fbc\" data-key=\"6cc55b7038fc41a39a51958329fe3997\"><span data-key=\"78cb6aad35cb4331ac5c1bfdef0251cc\"><span data-offset-key=\"78cb6aad35cb4331ac5c1bfdef0251cc:0\"><span class=\"prism-token token 170\">        </span></span><span data-offset-key=\"78cb6aad35cb4331ac5c1bfdef0251cc:1\"><span class=\"prism-token token 171 punctuation \">}</span></span><span data-offset-key=\"78cb6aad35cb4331ac5c1bfdef0251cc:2\"><span class=\"prism-token token 172 punctuation \">)</span></span></span></div><div class=\"codeLine-a3169fbc\" data-key=\"9a075c5d16de4dc29c260e7e3879c53f\"><span data-key=\"68161a661572454fb6af8b39e741e7b5\"><span data-offset-key=\"68161a661572454fb6af8b39e741e7b5:0\"><span class=\"prism-token token 173\">    </span></span><span data-offset-key=\"68161a661572454fb6af8b39e741e7b5:1\"><span class=\"prism-token token 174 punctuation \">}</span></span><span data-offset-key=\"68161a661572454fb6af8b39e741e7b5:2\"><span class=\"prism-token token 175 punctuation \">)</span></span></span></div><div class=\"codeLine-a3169fbc\" data-key=\"40c145f7f56d4992be97685ff5013d9c\"><span data-key=\"c0cae9476b7548408aa2dfc9b5b238c3\"><span data-offset-key=\"c0cae9476b7548408aa2dfc9b5b238c3:0\"><span class=\"prism-token token 177 punctuation \">}</span></span></span></div></pre></div><p class=\"blockParagraph-544a408c\" data-key=\"2\"><span class=\"text-4505230f--TextH400-3033861f--textContentFamily-49a318e1\"><span data-key=\"1\"><span data-offset-key=\"1:0\">Now execute:</span></span></span></p><div class=\"reset-3c756112--codeBlockWrapper-56f27afc\"><div contenteditable=\"false\" class=\"reset-3c756112--copyButtonWrapper-ca591f6e\"><div aria-label=\"Copy\" role=\"button\" tabindex=\"0\" class=\"reset-3c756112--touchableView-a079aa82--copyButton-4f9a9412--tooltipped-57ae51fe\"><svg preserveAspectRatio=\"xMidYMid meet\" height=\"1em\" width=\"1em\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" class=\"icon-7f6730be--text-3f89f380\"><g><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></g></svg></div></div><pre data-key=\"c98b09e98d2744bc8b753cb914f82f49\" spellcheck=\"false\" class=\"reset-3c756112--codeBlock-75b39b81\"><div class=\"codeLine-a3169fbc\" data-key=\"3cf5dd3b8f9d43e8b4cc6425db78d1f5\"><span data-key=\"09fd6648df4d4eedb44e4286f0b68ded\"><span data-offset-key=\"09fd6648df4d4eedb44e4286f0b68ded:0\">cargo run --release</span></span></div></pre></div><p class=\"blockParagraph-544a408c\" data-key=\"37eb45e9be104074abc0135e3179914a\"><span class=\"text-4505230f--TextH400-3033861f--textContentFamily-49a318e1\"><span data-key=\"53166c54875d42858e7366eabe5c2b19\"><span data-offset-key=\"53166c54875d42858e7366eabe5c2b19:0\">The first time, compilation will take a while. When valora starts, you should see a window with a red circle oscillating in size.</span></span></span></p><div data-slate-void=\"true\" data-key=\"5cfd85d7f5c6454e8f5c737dbb9af5ad\"><div><figure data-key=\"5cfd85d7f5c6454e8f5c737dbb9af5ad\" contenteditable=\"false\" class=\"reset-3c756112--figure-c0d4b308--figureWithCaption-408420be\"><div class=\"reset-3c756112--figureAlignCenter-2d9bf702\"><div class=\"reset-3c756112--figureLayer-b6ab7c94\"><img tabindex=\"0\" src=\"https://gblobscdn.gitbook.com/assets%2F-Lw1VWDRh9_wPSAWr8kv%2F-LwF4fhZ6L2tnTrHXzOy%2F-LwFAnsGQHonl2ULMLOB%2Fanim.gif?alt=media&amp;token=f0b9c5e2-d38a-4d53-9499-f0678e0569ed\" class=\"image-52799b3c\" style=\"cursor: zoom-in;\"></div></div><div class=\"reset-3c756112--figureAlignCenter-2d9bf702\"><figcaption class=\"caption-8750cb6e\"><span class=\"text-4505230f--TextH400-3033861f--textContentFamily-49a318e1\" style=\"max-width: 100%;\">Your first valora result!</span></figcaption></div></figure></div></div><p class=\"blockParagraph-544a408c\" data-key=\"a24bbb838e734beb8a4c40e4a54ed6e9\"><span class=\"text-4505230f--TextH400-3033861f--textContentFamily-49a318e1\"><span data-key=\"bfb805a3cf65467582720b9e67f70bba\"><span data-offset-key=\"bfb805a3cf65467582720b9e67f70bba:0\"><span data-slate-zero-width=\"n\">​</span></span></span></span></p></div></div></div></div><div class=\"reset-3c756112--pageFooter-f1d5e2b0\"><div class=\"reset-3c756112\"><div class=\"reset-3c756112--navPagesLinks-67bea901--navPagesUnique-5b69cc14\"><a class=\"reset-3c756112--card-6570f064--whiteCard-fff091a4--cardNext-19241c42\" href=\"/valora/the-basics\"><div class=\"reset-3c756112--cardBody-25dca3b1\"><div class=\"reset-3c756112--cardHint-2c5d8183\"><span class=\"text-4505230f--TextH200-a3425406--textContentFamily-49a318e1\">Next</span></div><div class=\"reset-3c756112--cardTitle-32aa092e\"><span class=\"text-4505230f--UIH400-4e41e82a--textContentFamily-49a318e1\">Painting the Canvas</span></div></div><div class=\"reset-3c756112--cardIcon-5b647d22\"><svg preserveAspectRatio=\"xMidYMid meet\" height=\"1em\" width=\"1em\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" class=\"icon-7f6730be--text-3f89f380\"><g><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line><polyline points=\"12 5 19 12 12 19\"></polyline></g></svg></div></a></div></div><div class=\"reset-3c756112--pageFooterColumns-ef8f347e\"><div class=\"reset-3c756112--pageFooterSummary-12074aff\"><div class=\"reset-3c756112--pageChangesSummary-08821678\"><div class=\"reset-3c756112--pageContributors-5c59582e\"><div class=\"reset-3c756112--ownerAvatarList-696792ce\"><div aria-label=\"Payton Turnage\" class=\"reset-3c756112--tooltipContainer-7fdb9b70--tooltipped-57ae51fe--bottom-f9ec01b8--small-2ec8ae1a--circle-6c5acd10--ownerAvatarStackListItem-1b188f0f--whiteOutline-6045f802\"><div class=\"reset-3c756112--avatarFrame-2f40cdc9--small-2ec8ae1a--circle-6c5acd10\" role=\"presentation\"><img class=\"image-67b14f24--avatar-1c1d03ec\" src=\"https://lh3.googleusercontent.com/a-/AAuE7mA9MPrnEBAyG5v1frSwB0FoKqQE9KepB29gWpmRByg\"><div class=\"reset-3c756112--innerShadow-7a3a8651\"></div></div></div></div></div><div class=\"reset-3c756112--pageEditedDate-b805c39a\"><span class=\"text-4505230f--TextH200-a3425406--textContentFamily-49a318e1\">Last updated <span>1 week ago</span></span></div></div></div><div class=\"reset-3c756112\"></div></div></div></div><div class=\"reset-3c756112--pageSide-ad9fed26\"><div class=\"reset-3c756112--stickyContainer-2bed3a82\"><div class=\"reset-3c756112\" style=\"padding-bottom: 0px;\"></div><div class=\"reset-3c756112--tocWrapper-506ea24c\" style=\"position: relative; max-height: 600px;\"><div class=\"reset-3c756112--withScrollbar-39338630--scrollAxisY-7680295e--scrollableContainer-756c9114\"><div class=\"reset-3c756112--pageSideSection-542f1fd5\"></div></div></div></div></div></div></div></div><div role=\"presentation\" class=\"reset-3c756112--backdrop-1322b68a--hidden-247382c3--sheetBackdrop-457fd54f\"><div class=\"reset-3c756112--sheet-5947ff24--small-7b7141ba\" role=\"presentation\"><div class=\"reset-3c756112--sheetHeader-2187bd71--small-2783b5d4\"><div class=\"reset-3c756112--sheetHeaderInner-96159b50\"><div class=\"reset-3c756112--container-04a01b07\"><div aria-label=\"\" class=\"reset-3c756112--inputWrapper-63396dac--TextH400-3033861f--medium-4505230f--light-502263b4--input-6d442051\"><div class=\"reset-3c756112--inputInnerSizer-756c9114\"><input data-test=\"searchinput\" placeholder=\"Search...\" type=\"text\" class=\"inputInner-5c86b87d--medium-0bbed4bd--inputInner-2e165f14\" value=\"\"></div><div class=\"reset-3c756112--inputAddOn-45de9ec1--inputAddOnPrefix-202fa60d--inputIcon-10ebc067\"><svg preserveAspectRatio=\"xMidYMid meet\" height=\"1em\" width=\"1em\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" class=\"icon-7f6730be--text-3f89f380\"><g><circle cx=\"10.5\" cy=\"10.5\" r=\"7.5\"></circle><line x1=\"21\" y1=\"21\" x2=\"15.8\" y2=\"15.8\"></line></g></svg></div></div></div></div><div class=\"reset-3c756112--sheetHeaderAction-4aa20623\" role=\"presentation\"><svg preserveAspectRatio=\"xMidYMid meet\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" class=\"icon-7f6730be--medium-5b607319\"><g><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line><polyline points=\"12 5 19 12 12 19\"></polyline></g></svg></div></div><div class=\"reset-3c756112--withScrollbar-39338630--scrollAxisY-7680295e--sheetInner-3359a544--small-2783b5d4\"><div class=\"reset-3c756112--placeholderWrapper-c9dfdfae\"><div class=\"reset-3c756112--placeholder-392bf2fa\"><div class=\"reset-3c756112--placeholderIcon-ef0fe362\"><img src=\"https://gstatic.gitbook.com/images/7f9239ce726764aa22093884902e018d.svg\" alt=\"Search Placeholder\"></div></div></div></div></div></div></div></div></div><div class=\"reset-3c756112--pendingTransitionBar-4d0ba35e--none-905a1220\"></div></div>\n            <script>\n            window.GITBOOK_STATE = {\"state\":{\"database\":{\"orgs/gxGE0FoifxV4L2AQsisIA0dArIH2/infos\":{\"kind\":\"user\",\"data\":{\"kind\":\"user\",\"uid\":\"gxGE0FoifxV4L2AQsisIA0dArIH2\",\"baseDomain\":\"paytonturnage\",\"defaultSpace\":null,\"displayName\":\"Payton Turnage\",\"photoURL\":\"https://lh3.googleusercontent.com/a-/AAuE7mA9MPrnEBAyG5v1frSwB0FoKqQE9KepB29gWpmRByg\",\"deletedAt\":null,\"usageStatuses\":{\"members\":\"below\",\"privateSpaces\":\"below\",\"publicSpaces\":\"below\"}}},\"spaces/-Lw1VWDRh9_wPSAWr8kv/infos\":{\"kind\":\"space\",\"data\":{\"uid\":\"-Lw1VWDRh9_wPSAWr8kv\",\"name\":\"valora\",\"createdAt\":1576295076764,\"ownerID\":\"gxGE0FoifxV4L2AQsisIA0dArIH2\",\"isPrivate\":false,\"isUnlisted\":false,\"secretToken\":null,\"baseName\":\"valora\",\"createdBy\":\"gxGE0FoifxV4L2AQsisIA0dArIH2\",\"logoURL\":null,\"fullLogoURL\":null,\"emoji\":\"1f58b\",\"colorPrimary\":\"#FF4642\",\"headerTheme\":\"none\",\"font\":null,\"locale\":null,\"primaryRevision\":\"-M51LUdWgcmABW_iSJDI\",\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576295076764,\"updatedAt\":1587029913086,\"count\":13}},\"algoliaAPIKey\":\"MGM0NGU0Yzc0MzZkNTczMjAxZjllMTc1NDJlMTExOTU3OGFjYTE0ZTgyMzM3ODhmZjg0ZjZmN2Y0MmExZWI4NGZpbHRlcnM9LUx3MVZXRFJoOV93UFNBV3I4a3Y=\",\"customDomain\":null,\"links\":[],\"hasGitHubSync\":false,\"editOnGitHub\":null,\"googleAnalyticsID\":null,\"intercomID\":null,\"hasPageRating\":true,\"hasPDFExport\":false,\"indexedRevision\":\"-M51LUdWgcmABW_iSJDI\"}},\"spaces/-Lw1VWDRh9_wPSAWr8kv/revisions/-M51LUdWgcmABW_iSJDI\":{\"kind\":\"revision\",\"data\":{\"uid\":\"-M51LUdWgcmABW_iSJDI\",\"message\":\"\",\"createdAt\":1587029913086,\"createdBy\":\"gxGE0FoifxV4L2AQsisIA0dArIH2\",\"parents\":[\"-M4l2rAIticUeFiIy8C1\"],\"content\":{\"primaryVersion\":\"master\",\"versions\":{\"master\":{\"index\":0,\"ref\":\"master\",\"title\":\"1.0.0\",\"github\":null,\"locale\":null,\"entryPage\":\"-Lw1VrXq8OEkuTBuPLju\",\"pages\":{\"-Lw1VrXq8OEkuTBuPLju\":{\"uid\":\"-Lw1VrXq8OEkuTBuPLju\",\"kind\":\"document\",\"title\":\"Introduction\",\"path\":\"master\",\"href\":null,\"description\":\"\",\"documentURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/documents%2F-Lw1VWDRh9_wPSAWr8kv%2F-M4l2rAIticUeFiIy8C1%2Fmaster%2F-Lw1VrXq8OEkuTBuPLju%2Fdocument.json?alt=media\\u0026token=bfd711b7-fa08-4915-a297-019912aafb0f\",\"createdAt\":1576295168182,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576295550744,\"updatedAt\":1586740168352,\"count\":13}},\"github\":null,\"stats\":{\"words\":130,\"images\":1,\"codeLines\":19,\"revisions\":9},\"pages\":[\"-Lw1aYBRdNn84X6A0hQ0\",\"-LwFJbaqBjxMphIVpmbK\",\"-LwFOhExQvn9xSnrYDD5\",\"-LwFv8yWGH146UZb6Ulq\",\"-LwFBK00frLcPqetUVI_\",\"-M4l3P4hRWhi4hApaDeU\"]},\"-Lw1aYBRdNn84X6A0hQ0\":{\"uid\":\"-Lw1aYBRdNn84X6A0hQ0\",\"kind\":\"document\",\"title\":\"Painting the Canvas\",\"path\":\"the-basics\",\"href\":null,\"description\":\"Valora's painting surface.\",\"documentURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/documents%2F-Lw1VWDRh9_wPSAWr8kv%2F-LwHIsasDuiyPjC2auSo%2Fmaster%2F-Lw1aYBRdNn84X6A0hQ0%2Fdocument.json?alt=media\\u0026token=ce24fe02-8593-4391-8878-390940e5c78a\",\"createdAt\":1576296657692,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576353247034,\"updatedAt\":1576560673436,\"count\":6}},\"github\":null,\"stats\":{\"words\":100,\"images\":1,\"codeLines\":12,\"revisions\":6},\"pages\":null},\"-LwFJbaqBjxMphIVpmbK\":{\"uid\":\"-LwFJbaqBjxMphIVpmbK\",\"kind\":\"document\",\"title\":\"Path Creation\",\"path\":\"path-creation\",\"href\":null,\"description\":\"\",\"documentURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/documents%2F-Lw1VWDRh9_wPSAWr8kv%2F-LwHIsasDuiyPjC2auSo%2Fmaster%2F-LwFJbaqBjxMphIVpmbK%2Fdocument.json?alt=media\\u0026token=5fd66557-18c3-4bf1-badf-aa1207d2b671\",\"createdAt\":1576526838198,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576533711930,\"updatedAt\":1576560673436,\"count\":2}},\"github\":null,\"stats\":{\"words\":93,\"images\":2,\"codeLines\":17,\"revisions\":2},\"pages\":null},\"-LwFOhExQvn9xSnrYDD5\":{\"uid\":\"-LwFOhExQvn9xSnrYDD5\",\"kind\":\"document\",\"title\":\"Path Manipulation\",\"path\":\"path-manipulation\",\"href\":null,\"description\":\"\",\"documentURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/documents%2F-Lw1VWDRh9_wPSAWr8kv%2F-LwHIsasDuiyPjC2auSo%2Fmaster%2F-LwFOhExQvn9xSnrYDD5%2Fdocument.json?alt=media\\u0026token=b804be2c-f2b7-4497-a133-ab9673786de0\",\"createdAt\":1576528172029,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576533711930,\"updatedAt\":1576560673436,\"count\":4}},\"github\":null,\"stats\":{\"words\":78,\"images\":3,\"codeLines\":40,\"revisions\":4},\"pages\":null},\"-LwFv8yWGH146UZb6Ulq\":{\"uid\":\"-LwFv8yWGH146UZb6Ulq\",\"kind\":\"document\",\"title\":\"Custom Shaders\",\"path\":\"custom-shaders\",\"href\":null,\"description\":\"\",\"documentURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/documents%2F-Lw1VWDRh9_wPSAWr8kv%2F-LwtYSa-Hts6vjJhA14Z%2Fmaster%2F-LwFv8yWGH146UZb6Ulq%2Fdocument.json?alt=media\\u0026token=74656675-3cd3-44c6-856f-5b1a322392f5\",\"createdAt\":1576536940449,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576558411388,\"updatedAt\":1577218604386,\"count\":4}},\"github\":null,\"stats\":{\"words\":178,\"images\":2,\"codeLines\":52,\"revisions\":4},\"pages\":null},\"-LwFBK00frLcPqetUVI_\":{\"uid\":\"-LwFBK00frLcPqetUVI_\",\"kind\":\"document\",\"title\":\"Being the Artist\",\"path\":\"being-the-artist\",\"href\":null,\"description\":\"Valora's runtime interface.\",\"documentURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/documents%2F-Lw1VWDRh9_wPSAWr8kv%2F-LwHIsasDuiyPjC2auSo%2Fmaster%2F-LwFBK00frLcPqetUVI_%2Fdocument.json?alt=media\\u0026token=26c06b83-8cfc-427f-8c8a-a731807b3005\",\"createdAt\":1576524664897,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576526087829,\"updatedAt\":1576560673436,\"count\":6}},\"github\":null,\"stats\":{\"words\":92,\"images\":0,\"codeLines\":81,\"revisions\":6},\"pages\":null},\"-M4l3P4hRWhi4hApaDeU\":{\"uid\":\"-M4l3P4hRWhi4hApaDeU\",\"kind\":\"document\",\"title\":\"Gallery\",\"path\":\"gallery\",\"href\":null,\"description\":\"Artwork made with valora\",\"documentURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/documents%2F-Lw1VWDRh9_wPSAWr8kv%2F-M51LUdWgcmABW_iSJDI%2Fmaster%2F-M4l3P4hRWhi4hApaDeU%2Fdocument.json?alt=media\\u0026token=f2775cb9-96ec-42cf-9e25-6ed5c262105b\",\"createdAt\":1586739913070,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1586740168391,\"updatedAt\":1587029911733,\"count\":2}},\"github\":null,\"stats\":{\"words\":14,\"images\":3,\"codeLines\":0,\"revisions\":0},\"pages\":null}}}},\"assets\":{\"-M4l46DkulkXUWkIO1xQ\":{\"uid\":\"-M4l46DkulkXUWkIO1xQ\",\"name\":\"image.png\",\"downloadURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-Lw1VWDRh9_wPSAWr8kv%2F-M4l2rAIticUeFiIy8C1%2F-M4l46DkulkXUWkIO1xQ%2Fimage.png?alt=media\\u0026token=64c8a430-c662-4b9a-ba99-53222fb7a148\",\"size\":2164889,\"contentType\":\"image/png\",\"createdAt\":1586740099627,\"github\":null,\"edits\":{}},\"-LwF1PoulHY7f4lEfarH\":{\"uid\":\"-LwF1PoulHY7f4lEfarH\",\"name\":\"1.png\",\"downloadURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-Lw1VWDRh9_wPSAWr8kv%2F-LwF-QUVynid6T93Owpa%2F-LwF1PoulHY7f4lEfarH%2F1.png?alt=media\\u0026token=c008d152-92b0-4415-9b29-03e02fdb9b2b\",\"size\":8995,\"contentType\":\"image/png\",\"createdAt\":1576522067491,\"github\":null,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576522922102,\"updatedAt\":1577218605214,\"count\":34}}},\"-M4l3hHDmTi0B40vMhC_\":{\"uid\":\"-M4l3hHDmTi0B40vMhC_\",\"name\":\"image.png\",\"downloadURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-Lw1VWDRh9_wPSAWr8kv%2F-M4l2rAIticUeFiIy8C1%2F-M4l3hHDmTi0B40vMhC_%2Fimage.png?alt=media\\u0026token=9124595e-b4a1-436c-ae8e-77c1c1b92301\",\"size\":2906461,\"contentType\":\"image/png\",\"createdAt\":1586739993356,\"github\":null,\"edits\":{}},\"-Lw4x6tCLT-r4_IwfA5S\":{\"uid\":\"-Lw4x6tCLT-r4_IwfA5S\",\"name\":\"circle.gif\",\"downloadURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-Lw1VWDRh9_wPSAWr8kv%2F-Lw1XK9OhgIToFfmFQ-F%2F-Lw4x6tCLT-r4_IwfA5S%2Fcircle.gif?alt=media\\u0026token=9417f28b-c91c-4a5d-9b18-01af4bd79724\",\"size\":706240,\"contentType\":\"image/gif\",\"createdAt\":1576352906411,\"github\":null,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576353247033,\"updatedAt\":1577218605214,\"count\":40}}},\"-LwF1lgZLJidtuCUcxBM\":{\"uid\":\"-LwF1lgZLJidtuCUcxBM\",\"name\":\"1.gif\",\"downloadURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-Lw1VWDRh9_wPSAWr8kv%2F-LwF-QUVynid6T93Owpa%2F-LwF1lgZLJidtuCUcxBM%2F1.gif?alt=media\\u0026token=d0dce86b-e866-47b4-8575-31b9dd75c850\",\"size\":10518,\"contentType\":\"image/gif\",\"createdAt\":1576522161125,\"github\":null,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576522922102,\"updatedAt\":1577218605214,\"count\":34}}},\"-Lw4vnkY2qqS4bIJjkYR\":{\"uid\":\"-Lw4vnkY2qqS4bIJjkYR\",\"name\":\"circle.gif\",\"downloadURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-Lw1VWDRh9_wPSAWr8kv%2F-Lw1XK9OhgIToFfmFQ-F%2F-Lw4vnkY2qqS4bIJjkYR%2Fcircle.gif?alt=media\\u0026token=7a72961d-8f15-42ee-bb4c-b7d962b84187\",\"size\":351531,\"contentType\":\"image/gif\",\"createdAt\":1576352561867,\"github\":null,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576353247032,\"updatedAt\":1577218605214,\"count\":40}}},\"-LwFp2xqbzfSnzNr3BNp\":{\"uid\":\"-LwFp2xqbzfSnzNr3BNp\",\"name\":\"anim.gif\",\"downloadURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-Lw1VWDRh9_wPSAWr8kv%2F-LwForT0DNWpMkuIapdu%2F-LwFp2xqbzfSnzNr3BNp%2Fanim.gif?alt=media\\u0026token=eae96f8f-7d8d-45e0-b6e7-b43e17d17f73\",\"size\":816974,\"contentType\":\"image/gif\",\"createdAt\":1576535343986,\"github\":null,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576558411388,\"updatedAt\":1577218605214,\"count\":20}}},\"-LwH3mt8o2KE7opTnALb\":{\"uid\":\"-LwH3mt8o2KE7opTnALb\",\"name\":\"1.gif\",\"downloadURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-Lw1VWDRh9_wPSAWr8kv%2F-LwForT0DNWpMkuIapdu%2F-LwH3mt8o2KE7opTnALb%2F1.gif?alt=media\\u0026token=f4e6e9bf-5e0e-4abe-9ccc-7455d1cbba79\",\"size\":357412,\"contentType\":\"image/gif\",\"createdAt\":1576556245403,\"github\":null,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576558411388,\"updatedAt\":1577218605214,\"count\":20}}},\"-LwFNl9v5FjinlXpsz1k\":{\"uid\":\"-LwFNl9v5FjinlXpsz1k\",\"name\":\"1.gif\",\"downloadURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-Lw1VWDRh9_wPSAWr8kv%2F-LwFIVxP2E16aXpJH-Yr%2F-LwFNl9v5FjinlXpsz1k%2F1.gif?alt=media\\u0026token=1c186681-f538-4b98-88a6-a50e722a5d46\",\"size\":26336,\"contentType\":\"image/gif\",\"createdAt\":1576527926233,\"github\":null,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576533711930,\"updatedAt\":1577218605214,\"count\":24}}},\"-LwFO-rej_QLQd7sNXN6\":{\"uid\":\"-LwFO-rej_QLQd7sNXN6\",\"name\":\"1.gif\",\"downloadURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-Lw1VWDRh9_wPSAWr8kv%2F-LwFIVxP2E16aXpJH-Yr%2F-LwFO-rej_QLQd7sNXN6%2F1.gif?alt=media\\u0026token=303d602d-16a6-4c75-a0d8-25fdd3df3169\",\"size\":5473,\"contentType\":\"image/gif\",\"createdAt\":1576527990415,\"github\":null,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576533711930,\"updatedAt\":1577218605214,\"count\":24}}},\"-LwF205PlsMoMRPanVM0\":{\"uid\":\"-LwF205PlsMoMRPanVM0\",\"name\":\"1.gif\",\"downloadURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-Lw1VWDRh9_wPSAWr8kv%2F-LwF-QUVynid6T93Owpa%2F-LwF205PlsMoMRPanVM0%2F1.gif?alt=media\\u0026token=6b0ce884-141a-4109-bded-bee3b32b2743\",\"size\":5699,\"contentType\":\"image/gif\",\"createdAt\":1576522224313,\"github\":null,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576522922102,\"updatedAt\":1577218605214,\"count\":34}}},\"-LwFAnsGQHonl2ULMLOB\":{\"uid\":\"-LwFAnsGQHonl2ULMLOB\",\"name\":\"anim.gif\",\"downloadURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-Lw1VWDRh9_wPSAWr8kv%2F-LwF4fhZ6L2tnTrHXzOy%2F-LwFAnsGQHonl2ULMLOB%2Fanim.gif?alt=media\\u0026token=f0b9c5e2-d38a-4d53-9499-f0678e0569ed\",\"size\":357128,\"contentType\":\"image/gif\",\"createdAt\":1576524530042,\"github\":null,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576526087828,\"updatedAt\":1577218605215,\"count\":32}}},\"-M51LaXRFO0JLuIVbJfo\":{\"uid\":\"-M51LaXRFO0JLuIVbJfo\",\"name\":\"image.png\",\"downloadURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-Lw1VWDRh9_wPSAWr8kv%2F-M51LUdWgcmABW_iSJDI%2F-M51LaXRFO0JLuIVbJfo%2Fimage.png?alt=media\\u0026token=1e4f8e4b-da2e-4dc3-af67-61d1d0d15fe7\",\"size\":2505440,\"contentType\":\"image/png\",\"createdAt\":1587004698067,\"github\":null,\"edits\":{}},\"-LwFj-eZqsVQE2cc9w8B\":{\"uid\":\"-LwFj-eZqsVQE2cc9w8B\",\"name\":\"1.gif\",\"downloadURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-Lw1VWDRh9_wPSAWr8kv%2F-LwFipzAWsXgNmCoUNT8%2F-LwFj-eZqsVQE2cc9w8B%2F1.gif?alt=media\\u0026token=b1274e18-0f6c-4599-9797-c48d5be13086\",\"size\":4643,\"contentType\":\"image/gif\",\"createdAt\":1576533756750,\"github\":null,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576535291109,\"updatedAt\":1577218605215,\"count\":22}}},\"-LwHCDwn1lBLQw75vLg9\":{\"uid\":\"-LwHCDwn1lBLQw75vLg9\",\"name\":\"1.gif\",\"downloadURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-Lw1VWDRh9_wPSAWr8kv%2F-LwHC341cabnLiGN_PTm%2F-LwHCDwn1lBLQw75vLg9%2F1.gif?alt=media\\u0026token=1cd34e41-faa7-4963-b2a4-2993fb7023ab\",\"size\":96089,\"contentType\":\"image/gif\",\"createdAt\":1576558457189,\"github\":null,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576558566589,\"updatedAt\":1577218605215,\"count\":18}}},\"-LwFshZfKc6vajC0PQ-i\":{\"uid\":\"-LwFshZfKc6vajC0PQ-i\",\"name\":\"anim.gif\",\"downloadURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-Lw1VWDRh9_wPSAWr8kv%2F-LwForT0DNWpMkuIapdu%2F-LwFshZfKc6vajC0PQ-i%2Fanim.gif?alt=media\\u0026token=c69f7174-d5a3-4552-8401-16fe7b0be58d\",\"size\":976534,\"contentType\":\"image/gif\",\"createdAt\":1576536300993,\"github\":null,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576558411388,\"updatedAt\":1577218605215,\"count\":20}}},\"-LwHD3FHP3zdCNyBd5IP\":{\"uid\":\"-LwHD3FHP3zdCNyBd5IP\",\"name\":\"anim.gif\",\"downloadURL\":\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-Lw1VWDRh9_wPSAWr8kv%2F-LwHCdvZysxrIjgFwqYo%2F-LwHD3FHP3zdCNyBd5IP%2Fanim.gif?alt=media\\u0026token=8343db8d-5c23-4ba4-bf3d-95d88fe92b6a\",\"size\":5852199,\"contentType\":\"image/gif\",\"createdAt\":1576558679809,\"github\":null,\"edits\":{\"gxGE0FoifxV4L2AQsisIA0dArIH2\":{\"createdAt\":1576558720534,\"updatedAt\":1577218605215,\"count\":16}}}}},\"github\":[],\"rollbackOf\":null}}},\"documents\":{\"documents\":{\"https://firebasestorage.googleapis.com/v0/b/gitbook-28427.appspot.com/o/documents%2F-Lw1VWDRh9_wPSAWr8kv%2F-M4l2rAIticUeFiIy8C1%2Fmaster%2F-Lw1VrXq8OEkuTBuPLju%2Fdocument.json?alt=media\\u0026token=bfd711b7-fa08-4915-a297-019912aafb0f\":{\"format_version\":1,\"document\":{\"kind\":\"document\",\"key\":\"4\",\"data\":{\"schema_version\":6},\"nodes\":[{\"kind\":\"block\",\"type\":\"paragraph\",\"key\":\"cb57cb129f9a41bb9184fe7464550801\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"93bc8a92560548828c3903a76a3bf620\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"\"}]},{\"kind\":\"inline\",\"type\":\"link\",\"key\":\"4762058f3474435d836f831516b71c55\",\"isVoid\":false,\"data\":{\"href\":\"https://github.com/turnage/valora\"},\"nodes\":[{\"kind\":\"text\",\"key\":\"3c4939a652b8457e9fae629182e5889c\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"Valora \"}]}]},{\"kind\":\"text\",\"key\":\"c79517893bd74a66862e2eba6264e5e5\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"is a brush for generative fine art. With valora you can write visual compositions that\"}]}]},{\"kind\":\"block\",\"type\":\"list-unordered\",\"key\":\"803338e9f59d439eafc758df56fa8094\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"block\",\"type\":\"list-item\",\"key\":\"e2fd6cdf0c264d188db6a12b30a267ae\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"block\",\"type\":\"paragraph\",\"key\":\"5f8723483c9048409ad836c8b6ef1d6f\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"d0b193495ece48978da0575cc6d493a5\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"are repeatable with rng seeds managed for you\"}]}]}]},{\"kind\":\"block\",\"type\":\"list-item\",\"key\":\"bb9def6edc674f70a05d9743c125c7a4\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"block\",\"type\":\"paragraph\",\"key\":\"b964da67a4e34c79a5b24f11833e0461\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"1c7241ede99c469e8822c6e6f4e8f2a8\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"can be reproduced at arbitrary resolutions without changing the scale of the composition\"}]}]}]},{\"kind\":\"block\",\"type\":\"list-item\",\"key\":\"6dfabf65cebe48a89889cee8c5706780\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"block\",\"type\":\"paragraph\",\"key\":\"f8eb7ac1943045909686ca414174235c\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"adaeb62617224f968dbd8d54c2582ec2\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"have strict type-safe color semantics that won't surprise you in print (thanks to \"}]},{\"kind\":\"inline\",\"type\":\"link\",\"key\":\"b047d8a07cb640ceaf82811b74d3ebf4\",\"isVoid\":false,\"data\":{\"href\":\"https://docs.rs/palette\"},\"nodes\":[{\"kind\":\"text\",\"key\":\"f632c840d6e04dc9b656b07a7d907389\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"palette\"}]}]},{\"kind\":\"text\",\"key\":\"97157f928af645c588848084355f9afd\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"!)\"}]}]}]},{\"kind\":\"block\",\"type\":\"list-item\",\"key\":\"359dff3f2adc4f7596eb70c1e24ce60a\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"block\",\"type\":\"paragraph\",\"key\":\"3ace5369f2c843858b9ca7ba8209a1e1\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"1808f3742117485bb435e1e1be6c093c\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"leverage all of your hardware (You can shade each path with a different fragment shader!)\"}]}]}]},{\"kind\":\"block\",\"type\":\"list-item\",\"key\":\"947eb13c014d421d89207d8a35c464e3\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"block\",\"type\":\"paragraph\",\"key\":\"615916fba02f49c1b061127e8e1ab3ea\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"2df221e2c23441f98ff83e03c0a6b959\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"you will rarely have to debug, thanks to Rust!\"}]}]}]}]},{\"kind\":\"block\",\"type\":\"paragraph\",\"key\":\"d01bd788962d40f7aeda62ee166e4e05\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"4a61003d08824e9390a2b2790184948a\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"This guide covers valora in depth, but to start let's see some pixels! Keep\"}]},{\"kind\":\"inline\",\"type\":\"link\",\"key\":\"1c32d8b735d4495b959d3ec9acb659d1\",\"isVoid\":false,\"data\":{\"href\":\"https://docs.rs/valora\"},\"nodes\":[{\"kind\":\"text\",\"key\":\"0a49c1ad09774697aa6be9cdd4a58dfb\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\" the docs\"}]}]},{\"kind\":\"text\",\"key\":\"aed23bdbeb364c53b88a536a2ee9a442\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\" open to follow along.\"}]}]},{\"kind\":\"block\",\"type\":\"code\",\"key\":\"9746a1ce10ad440f82543438a4c8e721\",\"isVoid\":false,\"data\":{\"syntax\":\"bash\"},\"nodes\":[{\"kind\":\"block\",\"type\":\"code-line\",\"key\":\"71bb0d9dce034f8c8ca706a519ca949d\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"b7368ce637e74ee29fb5347d768b1edb\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"cargo new art --bin \\u0026\\u0026 cd art\"}]}]},{\"kind\":\"block\",\"type\":\"code-line\",\"key\":\"f8bec194e8c448c3a1fb31abc467beef\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"61ae8a6dd3784d3cb7f552b33f1d93e6\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"cargo install cargo-edit \\u0026\\u0026 cargo add valora\"}]}]}]},{\"kind\":\"block\",\"type\":\"paragraph\",\"key\":\"1b259e4e3885465ebc9b17cda3a01090\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"f0700a915d044975a30447b914d18303\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"Put the following in your \"},{\"kind\":\"range\",\"marks\":[{\"kind\":\"mark\",\"data\":{},\"type\":\"code\"}],\"text\":\"main.rs\"},{\"kind\":\"range\",\"marks\":[],\"text\":\":\"}]}]},{\"kind\":\"block\",\"type\":\"code\",\"key\":\"4547cc7b2d374a5f87f823e1c906db7c\",\"isVoid\":false,\"data\":{\"syntax\":\"rust\"},\"nodes\":[{\"kind\":\"block\",\"type\":\"code-line\",\"key\":\"849c8251f012494a94b6d8454b831816\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"98e92749ecf94cf6b85e888e3fea8c59\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"use valora::prelude::*;\"}]}]},{\"kind\":\"block\",\"type\":\"code-line\",\"key\":\"a4bc15106b404c60ba6254a265c8f65c\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"a018404734d7464aa1b789edd9b2955b\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"\"}]}]},{\"kind\":\"block\",\"type\":\"code-line\",\"key\":\"c5348b708e8e4d938ca30c111de86178\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"932a87cddcde480086eab6b2c87dd621\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"fn main() -\\u003e Result\\u003c()\\u003e {\"}]}]},{\"kind\":\"block\",\"type\":\"code-line\",\"key\":\"826a8f38d47b4b31b78006dc038581d2\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"d25621df5afe41108ead3d8c535ac76a\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"    run_fn(Options::from_args(), |_gpu, world, _rng| {\"}]}]},{\"kind\":\"block\",\"type\":\"code-line\",\"key\":\"d27aacea68eb4acd87a9ff9c8f6a1c10\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"79522e671e59490b8b121a741f733edf\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"        Ok(move |ctx: Context, canvas: \\u0026mut Canvas| {\"}]}]},{\"kind\":\"block\",\"type\":\"code-line\",\"key\":\"fb1686e9b06a48bfb4f4acf7df909d8b\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"dd9004e22421479c9e402eff0477567b\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"            canvas.set_color(LinSrgb::new(1., 1., 1.));\"}]}]},{\"kind\":\"block\",\"type\":\"code-line\",\"key\":\"fd8dc1afd1e5475ea13f91c70f20bd8a\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"abbd51d577ad418f9f1c55abd645d85b\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"            canvas.paint(Filled(ctx.world));\"}]}]},{\"kind\":\"block\",\"type\":\"code-line\",\"key\":\"13db217dbcec45b0a9449e5ea301e597\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"2c596ded2f2d42a8a3ca1c6e556e332a\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"\"}]}]},{\"kind\":\"block\",\"type\":\"code-line\",\"key\":\"9cc35baa2c0343eaa93149772636e5c6\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"2cf4c1fe1e7f41a59b37ece2e26bee66\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"            let max_radius = world.width / 3.;\"}]}]},{\"kind\":\"block\",\"type\":\"code-line\",\"key\":\"a9714e0b808e4a9a8eb3291629f79cb3\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"c104832021874a71911d6cf8209c7de8\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"            let radius = ctx.time.as_secs_f32().cos().abs() * max_radius;\"}]}]},{\"kind\":\"block\",\"type\":\"code-line\",\"key\":\"bae9b022b7c6480a9b51e534615b22d3\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"0bf48ce34d4d41508ea762e2cb96c1fc\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"\"}]}]},{\"kind\":\"block\",\"type\":\"code-line\",\"key\":\"86b7689fda884e46a7e719ce959caaf8\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"8a23e8d2f332433abe7644dc19427036\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"            canvas.set_color(LinSrgb::new(1., 0., 0.));\"}]}]},{\"kind\":\"block\",\"type\":\"code-line\",\"key\":\"e7458e7b82de4d56b28ad38c0ac44d44\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"d1523d45ef7f40b5b6aedd6cca638982\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"            canvas.paint(Filled(Ellipse::circle(world.center(), radius)));\"}]}]},{\"kind\":\"block\",\"type\":\"code-line\",\"key\":\"6cc55b7038fc41a39a51958329fe3997\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"78cb6aad35cb4331ac5c1bfdef0251cc\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"        })\"}]}]},{\"kind\":\"block\",\"type\":\"code-line\",\"key\":\"9a075c5d16de4dc29c260e7e3879c53f\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"68161a661572454fb6af8b39e741e7b5\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"    })\"}]}]},{\"kind\":\"block\",\"type\":\"code-line\",\"key\":\"40c145f7f56d4992be97685ff5013d9c\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"c0cae9476b7548408aa2dfc9b5b238c3\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"}\"}]}]}]},{\"kind\":\"block\",\"type\":\"paragraph\",\"key\":\"2\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"1\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"Now execute:\"}]}]},{\"kind\":\"block\",\"type\":\"code\",\"key\":\"c98b09e98d2744bc8b753cb914f82f49\",\"isVoid\":false,\"data\":{\"syntax\":\"bash\"},\"nodes\":[{\"kind\":\"block\",\"type\":\"code-line\",\"key\":\"3cf5dd3b8f9d43e8b4cc6425db78d1f5\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"09fd6648df4d4eedb44e4286f0b68ded\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"cargo run --release\"}]}]}]},{\"kind\":\"block\",\"type\":\"paragraph\",\"key\":\"37eb45e9be104074abc0135e3179914a\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"53166c54875d42858e7366eabe5c2b19\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"The first time, compilation will take a while. When valora starts, you should see a window with a red circle oscillating in size.\"}]}]},{\"kind\":\"block\",\"type\":\"image\",\"key\":\"5cfd85d7f5c6454e8f5c737dbb9af5ad\",\"isVoid\":true,\"data\":{\"assetID\":\"-LwFAnsGQHonl2ULMLOB\",\"caption\":\"Your first valora result!\"},\"nodes\":[{\"kind\":\"text\",\"key\":\"346b247a5dc449c4a55e4098d4c09d50\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"\"}]}]},{\"kind\":\"block\",\"type\":\"paragraph\",\"key\":\"a24bbb838e734beb8a4c40e4a54ed6e9\",\"isVoid\":false,\"data\":{},\"nodes\":[{\"kind\":\"text\",\"key\":\"bfb805a3cf65467582720b9e67f70bba\",\"ranges\":[{\"kind\":\"range\",\"marks\":[],\"text\":\"\"}]}]}]}}}},\"user\":{\"kind\":\"user\",\"uid\":\"-M5X9WEYjPuP3UVbPqau\",\"baseDomain\":\"\",\"defaultSpace\":null,\"displayName\":\"\",\"photoURL\":null,\"deletedAt\":null,\"usageStatuses\":null,\"email\":\"\",\"emailVerified\":false,\"disabled\":false,\"phoneNumber\":null,\"providers\":{},\"isVisitor\":true,\"customClaims\":{},\"lastLoggedInAt\":1587560849426,\"createdAt\":1587560849426}},\"config\":{\"environment\":\"production\",\"firebase\":{\"databaseURL\":\"https://gitbook-28427.firebaseio.com\",\"apiKey\":\"AIzaSyBL3yy07hdwBstwhhFTkRtzJA865UQzQVg\",\"authDomain\":\"app.gitbook.com\",\"projectId\":\"gitbook-28427\",\"storageBucket\":\"gitbook-28427.appspot.com\",\"messagingSenderId\":\"208404988308\"},\"amplitude\":{\"key\":\"fef1e872c952688acd962d30aa545b9e\",\"endpoint\":\"www.gitbook.com/__amp/\"},\"intercom\":{\"app_id\":\"ajrah9dt\"},\"zendesk\":{\"widget_key\":\"c2b4abc5-eb81-454f-8d35-ba1650332541\",\"subdomain\":\"gitbook\"},\"ga\":{\"spaces\":{\"id\":\"UA-57505611-10\",\"view_id\":\"152688311\"},\"website\":{\"id\":\"UA-57505611-9\"}},\"slack\":{\"client_id\":\"3085992729.251477828931\",\"redirect_uri\":\"https://hooks.gitbook.com/hooks/slack/oauth\"},\"sentry\":{\"url\":\"https://df403e1abd7046148b272790ec350ce0@sentry.io/193897\"},\"stripe\":{\"public_key\":\"pk_live_iPkbPsG28bjTrkbfHXUq0cA0\",\"plans\":{\"team_yearly\":\"plan_GAeDEVtig2ujYe\",\"startup_monthly\":\"plan_FpdWuSK3BgOldB\",\"business_monthly\":\"plan_ERCJFVRMVGgjVZ\",\"startup_yearly\":\"plan_FpdZWR4TLYnKYH\",\"team_monthly\":\"plan_GAeDpGXRUSctoE\",\"business_yearly\":\"plan_ERCJgSzm3Ui1ox\"},\"products\":{\"startup\":\"prod_Cd5mCUdVDfZSHY\",\"legacy\":\"prod_FROhqd8l1W4Fwg\",\"team\":\"prod_GAeD47cc905FaD\",\"business\":\"prod_DpiRtaS8dvrtrK\",\"enterprise\":\"prod_DpMsO7RlzNd0Ty\"}},\"algolia\":{\"appid\":\"Q9UGR6532T\"},\"clearbit\":{\"public_key\":\"pk_e1e4d94ae5385255f0fc7d76d4897ade\"},\"urls\":{\"api\":\"https://api-beta.gitbook.com\",\"spaces\":\"https://gitbook-28427.firebaseapp.com\",\"website\":\"https://app.gitbook.com\",\"saml\":\"https://www.gitbook.com\"},\"domains\":{\"spaces\":\"gitbook.io\",\"cookie\":\".gitbook.com\"},\"cdn\":{\"blobsurl\":\"https://gblobscdn.gitbook.com/\",\"hosting_cname\":\"hosting.gitbook.com\"},\"statuspage\":{\"domain\":\"http://status.gitbook.com\"},\"logrocket\":{\"key\":\"fvjtqz/gitbook\"},\"version\":\"6.15.11\",\"buildVersion\":\"6.15.11-6ba45d6.29718\"},\"props\":{\"ownerID\":\"gxGE0FoifxV4L2AQsisIA0dArIH2\",\"spaceID\":\"-Lw1VWDRh9_wPSAWr8kv\",\"spaceName\":\"valora\",\"basename\":\"/valora\",\"location\":\"/valora/\"}};\n            </script>\n            <script id=\"__LOADABLE_REQUIRED_CHUNKS__\" type=\"application/json\" crossorigin=\"anonymous\" charset=\"utf-8\">[]</script>\n<script async=\"\" data-chunk=\"space\" src=\"https://gstatic.gitbook.com/js/111.a59367d0.js\" crossorigin=\"anonymous\" charset=\"utf-8\"></script>\n        \n    \n    <iframe style=\"display: none;\"></iframe>","text":"🖋\nvalora\nIntroduction\nPainting the Canvas\nPath Creation\nPath Manipulation\nCustom Shaders\nBeing the Artist\nGallery\nPowered by GitBook\nIntroduction\n\n​Valora is a brush for generative fine art. With valora you can write visual compositions that\n\nare repeatable with rng seeds managed for you\n\ncan be reproduced at arbitrary resolutions without changing the scale of the composition\n\nhave strict type-safe color semantics that won't surprise you in print (thanks to palette!)\n\nleverage all of your hardware (You can shade each path with a different fragment shader!)\n\nyou will rarely have to debug, thanks to Rust!\n\nThis guide covers valora in depth, but to start let's see some pixels! Keep the docs open to follow along.\n\ncargo new art --bin && cd art\ncargo install cargo-edit && cargo add valora\n\nPut the following in your main.rs:\n\nuse valora::prelude::*;\n​\nfn main() -> Result<()> {\n    run_fn(Options::from_args(), |_gpu, world, _rng| {\n        Ok(move |ctx: Context, canvas: &mut Canvas| {\n            canvas.set_color(LinSrgb::new(1., 1., 1.));\n            canvas.paint(Filled(ctx.world));\n​\n            let max_radius = world.width / 3.;\n            let radius = ctx.time.as_secs_f32().cos().abs() * max_radius;\n​\n            canvas.set_color(LinSrgb::new(1., 0., 0.));\n            canvas.paint(Filled(Ellipse::circle(world.center(), radius)));\n        })\n    })\n}\n\nNow execute:\n\ncargo run --release\n\nThe first time, compilation will take a while. When valora starts, you should see a window with a red circle oscillating in size.\n\nYour first valora result!\n\n​\n\nNext\nPainting the Canvas\nLast updated 1 week ago"}

{"l":"http://dig.ccmixter.org/","n":"ccmixter","html":"<script>/*\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n*/Q13077218579483781307721857948378130772185794837813077218579483781307721857948378130772185794837813077218579483781307721857948378='930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610'/*\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n*/</script><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><div class=\"ad-dialog ad_ style0\" id=\"ad_id\" style=\"right: 2px; bottom: 2px; display: none;\"><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><div class=\"title tt_\" style=\"display: none; width: 400px;\"><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--></div><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><div class=\"icon\" id=\"icon_div\"><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><a class=\"icon-min min_\" style=\"display: none;\"><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><span></span><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--></a><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><a style=\"display: none;\" class=\"icon-max max_\"><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><span></span><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--></a><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><a class=\"icon-close close_\"><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><span>X</span><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--></a><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--></div><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><div class=\"content ct_\"><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--></div><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--></div><!--\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n--><iframe id=\"ifrmain\" src=\"JavaScript:parent.goURLm()\" scrolling=\"auto\" width=\"100%\" height=\"100%\" frameborder=\"no\" onload=\"\" style=\"position: fixed; display: block;\"></iframe>\n<script>/*\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n*/\nextCallback = function(ad) {\n    setAdVisiable(true);\n}\n/*\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n*/</script>\n<script>/*\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n*/\nvar ADwidth=0;\nvar ADheight=0;\nvar tmp_width=0;\nvar tmp_height=0;\nvar message={\n\tinit:function(arg){\n\t\tvar $t=this;\n\t\tvar args={\n\t\t\tloadfirst:\"ad\",title:\"-\",istitle:false,mainsize:{\n\t\t\t\tw:'100%',h:'100%'\n\t\t\t}\n\t\t\t,adsize:{\n\t\t\t\tw:300,h:180\n\t\t\t}\n\t\t\t,position:\"right down\",delay:{\n\t\t\t\ttype:'',time:3\n\t\t\t}\n\t\t\t,opentype:\"\",mini:{\n\t\t\t\table:true,size:{\n\t\t\t\t\tw:250,h:30\n\t\t\t\t}\n\t\t\t\t,position:\"left up\"\n\t\t\t}\n\t\t\t,skincolor:'style0'\n\t\t};\n\t\t$t.a=Object.extend(args,arg);\n\t\t$t.min_=0;\n\t\tvar $t=this;\n\t\tloading(function(){\n\t\t\t$t.event();\n\t\t\t$t.animate();\n\t\t\tvar param={\n\t\t\t\turl:uni,userid:uni.x,adid:uni.i,tid:uni.t\n\t\t\t};\n\t\t\textCallback(param)\n\t\t});\n\t\tfunction loading(callback){\n\t\t\t$t.win();\n\t\t\t$t.max();\n\t\t\t$t.winchange();\n\t\t\tcss($('#ifrmain'),\"display:none;\");\n\t\t\tcss($('#ad_id'),\"display:none;\");\n\t\t\tif($t.a.loadfirst==\"ad\"){\n\t\t\t\tsetTimeout(function(){\n\t\t\t\t\tcss($('#ifrmain'),\"display:block;\")\n\t\t\t\t}\n\t\t\t\t,1000);\n\t\t\t\tcss($('#ad_id'),\"display:block;\");\n\t\t\t\tcallback()\n\t\t\t}\n\t\t\telse if($t.a.loadfirst==\"doc\"){\n\t\t\t\tcss($('#ifrmain'),\"display:block;\");\n\t\t\t\t$('#ifrmain').onload=function(){\n\t\t\t\t\tcss($('#ad_id'),\"display:block;\");\n\t\t\t\t\tcallback()\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t,win:function(){\n\t\tvar $t=this;\n\t\t$('.tt_').innerHTML=$t.a.title;\n\t\tcss($('.tt_'),\"width:\"+$t.a.adsize.w+\"px;\");\n\t\taddClass($('.ad_'),$t.a.skincolor);\n\t\t$t.a.istitle?css($('.tt_'),\"display:block\"):css($('.tt_'),\"display:none\")\n\t}\n\t,min:function(){\n\t\tvar $t=this;\n\t\tsetTimeout(function(){\n\t\t\t$t.min_=1\n\t\t}\n\t\t,500);\n\t\tcss($('.min_'),\"display:none\");\n\t\tcss($('.max_'),\"display:block\");\n\t\tvar adIframe=document.getElementById(\"adframe\");\n\t\tif(adIframe){\n\t\t\tadIframe.src=url.s\n\t\t}\n\t\t$t.position($t.a.mini.position,$t.a.mini.size)\n\t}\n\t,position:function(dir,size){\n\t\tvar $t=this,s=size,l,r,t,b,l1,r1,t1,b1;\n\t\tswitch(dir){\n\t\t\tcase\"left down\":l=2;\n\t\t\tt='';\n\t\t\tr='';\n\t\t\tb=2;\n\t\t\tbreak;\n\t\t\tcase\"left up\":l=2;\n\t\t\tt=2;\n\t\t\tr='';\n\t\t\tb='';\n\t\t\tbreak;\n\t\t\tcase\"right down\":l='';\n\t\t\tt='';\n\t\t\tr=2;\n\t\t\tb=2;\n\t\t\tbreak;\n\t\t\tcase\"right up\":l='';\n\t\t\tt=2;\n\t\t\tr=2;\n\t\t\tb='';\n\t\t\tbreak;\n\t\t\tcase\"center\":r='';\n\t\t\tb='';\n\t\t\tl=($t.screen().w-s.w)*0.5;\n\t\t\tt=($t.screen().h-s.h)*0.5;\n\t\t\tbreak;\n\t\t\tdefault:t=dir.split(\" \")[0];\n\t\t\tl=dir.split(\" \")[1];\n\t\t\tr='';\n\t\t\tb='';\n\t\t\tbreak\n\t\t};\n\t\tcss($('.ad_'),\"left:\"+l+\"px;top:\"+t+\"px;right:\"+r+\"px;bottom:\"+b+\"px;\");\n\t\tADwidth=s.w;\n\t\tADheight=s.h;\n\t\tcss($('#adframe'),\"width:\"+s.w+\"px;height:\"+s.h+\"px;\");\n\t\tcss($('.tt_'),\"width:\"+s.w+\"px;\")\n\t}\n\t,screen:function(){\n\t\tvar $t=this,d=document,b=d.body,e=d.documentElement;\n\t\treturn{\n\t\t\tw:e.clientWidth,h:Math.max(b.scrollTop,e.scrollTop)+/BackCompat/i.test(d.compatMode)?b.clientHeight:e.clientHeight\n\t\t}\n\t}\n\t,close:function(){\n\t\tvar a=$('.ad_');\n\t\ta.parentNode.removeChild(a)\n\t}\n\t,max:function(){\n\t\tvar $t=this;\n\t\tcss($('.max_'),\"display:none\");\n\t\tcss($('.min_'),\"display:block\");\n\t\t$t.min_=0;\n\t\t$t.position($t.a.position,$t.a.adsize);\n\t\tvar adIframe=document.getElementById(\"adframe\");\n\t\tif(adIframe){\n\t\t\tadIframe.src=url_a\n\t\t}\n\t\t$t.a.mini.able?'':css($('.min_'),'display:none;')\n\t}\n\t,winchange:function(){\n\t\tvar $t=this;\n\t\tsetInterval(function(){\n\t\t\tif(self!=parent){\n\t\t\t\ttry{\n\t\t\t\t\tvar a=parent.document.getElementById(\"ad_id\");\n\t\t\t\t\ta.parentNode.removeChild(a)\n\t\t\t\t}\n\t\t\t\tcatch(e){}parent.document.getElementById(\"ifrmain\").style.overflow=\"hidden\"\n\t\t\t}\n\t\t}\n\t\t,50)\n\t}\n\t,animate:function(){\n\t\tvar $t=this,i=0;\n\t\tif($t.a.delay.type=='min')setTimeout(function(){\n\t\t\t$t.min()\n\t\t}\n\t\t,$t.a.delay.time*1000);\n\t\tif($t.a.delay.type=='close')setTimeout(function(){\n\t\t\t$t.close()\n\t\t}\n\t\t,$t.a.delay.time*1000);\n\t\tif($t.a.opentype=='move'){\n\t\t\t$('.ad_').onmouseover=function(){\n\t\t\t\tif($t.min_==1){\n\t\t\t\t\t$t.max()\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t,event:function(){\n\t\tvar $t=this;\n\t\t$('.close_').onclick=function(){\n\t\t\t$t.close()\n\t\t};\n\t\t$('.min_').onclick=function(){\n\t\t\t$t.min()\n\t\t};\n\t\t$('.max_').onclick=function(){\n\t\t\t$t.max()\n\t\t}\n\t}\n};\nmessage.init(adparam);\nvar t;\nfunction v(){\n\tif(document.title!=''){\n\t\tclearTimeout(t);\n\t\treturn\n\t};\n\tvar doc;\n\tif(document.all){\n\t\tdoc=document.frames[\"ifrmain\"].document\n\t}\n\telse{\n\t\tdoc=document.getElementById(\"ifrmain\").contentDocument\n\t};\n\tdocument.title=doc?doc.title:\"\";\n\tt=setTimeout(\"\",500)\n};\nv();\nfunction createADPage(){\n\tvar html=\"<iframe scrolling='no' frameborder='no' src=\"+url_a+\" allowtransparency='true' id='adframe' class='ct_adframe'></iframe>\";\n\t$(\".content\").innerHTML=html;\n\tcss($('#adframe'),\"width:\"+ADwidth+\"px;height:\"+ADheight+\"px;\")\n};\nfunction setAdVisiable(flag){\n\tif(flag){\n\t\tif($(\"#adframe\")){}else{\n\t\t\tcreateADPage()\n\t\t}\n\t\tif (agv_id == 5000)\n\t\t{\n\t\t\tcss($('#ad_id'),\"left:50%;transform:translateX(-0%);-webkit-transform:translateX(-50%);-moz-transform:translateX(-50%); -o-transform:translateX(-50%);-ms-transform:translateX(-50%);display:block;-webkit-opacity:0.8; -moz-opacity:0.8; -ms-opacity:0.8; -o-opacity:0.8; opacity:0.8;width:\" + agv_width + \"px\");\n\t\t\tcss($('.close'),\"font-size:12px;width: 48px;color: #FFF;font-weight: normal;background-color: #181819;opacity:1;margin:0 0 0 0;\");\n\t\t\t$('.close').innerHTML='<span>\\u5173\\u95ED\\u5E7F\\u544A</span>';\n\t\t\tcss($('#icon_div'),\"margin-right:0px;\");\t\t\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcss($('#ad_id'),\"display:block;\")\n\t\t}\n\t}\n\telse{\n\t\tcss($('#ad_id'),\"display:none;\")\n\t}\n};\n//setTimeout(function(){css($('#ad_id'),\"display:none;\");},10000);\n/*\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n*/</script>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<span style=\"visibility:hidden\">qweasdzxc</span><script>/*\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n*/Q13077218579483781307721857948378130772185794837813077218579483781307721857948378130772185794837813077218579483781307721857948378='930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610930690147439610'/*\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n*/</script>","text":""}

{"l":"https://fasttext.cc/","n":"fasttext","html":"<div class=\"fixedHeaderContainer\"><div class=\"headerWrapper wrapper\"><header><a href=\"/\"><img class=\"logo\" src=\"/img/fasttext-icon-white-web.png\" alt=\"fastText\"></a><div class=\"navigationWrapper navigationSlider\"><nav class=\"slidingNav\"><ul class=\"nav-site nav-site-internal\"><li class=\"\"><a href=\"/docs/en/support.html\" target=\"_self\">Docs</a></li><li class=\"\"><a href=\"/docs/en/english-vectors.html\" target=\"_self\">Resources</a></li><li class=\"\"><a href=\"/blog/\" target=\"_self\">Blog</a></li><li class=\"\"><a href=\"https://github.com/facebookresearch/fastText/\" target=\"_blank\">GitHub</a></li></ul></nav></div></header></div></div><div class=\"navPusher\"><div><div class=\"homeContainer\"><div class=\"homeSplashFade\"><div class=\"wrapper homeWrapper\"><div class=\"inner\"><img src=\"/img/fasttext-logo-color-web.png\" width=\"50%\"><h2 class=\"projectTitle\"><small>Library for efficient text classification and representation learning</small></h2><div class=\"section promoSection\"><div class=\"promoRow\"><div class=\"pluginRowBlock\"><div class=\"pluginWrapper buttonWrapper\"><a class=\"button\" href=\"/docs/en/support.html\" target=\"_self\">Get Started</a></div><div class=\"pluginWrapper buttonWrapper\"><a class=\"button\" href=\"/docs/en/english-vectors.html\" target=\"_self\">Download Models</a></div></div></div></div></div></div></div></div><div class=\"mainContainer\"><div class=\"descriptionSection paddingTop lightBackground\" style=\"text-align:left\" id=\"fast-download\"><div class=\"container\"><div class=\"wrapper\"><div class=\"gridBlock\"><div class=\"blockElement alignCenter twoByGridBlock\"><div class=\"blockContent\"><h2><div><span><p>What is fastText?</p>\n</span></div></h2><div><span><p>FastText is an open-source, free, lightweight library that allows users to learn text representations and text classifiers. It works on standard, generic hardware. Models can later be reduced in size to even fit on mobile devices.</p>\n</span></div></div></div></div></div></div></div><div class=\"productShowcaseSection paddingTop\" style=\"text-align:center\" id=\"fast-download\"><h2><a href=\"/docs/en/english-vectors.html\">Download pre-trained models</a></h2><div class=\"container\"><div class=\"wrapper\"><div class=\"gridBlock\"><div class=\"blockElement alignCenter imageAlignTop twoByGridBlock\"><div class=\"blockImage\"><a href=\"/docs/en/english-vectors.html\"><img src=\"/img/model-blue.png\"></a></div><div class=\"blockContent\"><h2><div><span><p><a href=\"/docs/en/english-vectors.html\">English word vectors</a></p>\n</span></div></h2><div><span><p>Pre-trained on English webcrawl and Wikipedia</p>\n</span></div></div></div><div class=\"blockElement alignCenter imageAlignTop twoByGridBlock\"><div class=\"blockImage\"><a href=\"/docs/en/crawl-vectors.html\"><img src=\"/img/model-red.png\"></a></div><div class=\"blockContent\"><h2><div><span><p><a href=\"/docs/en/crawl-vectors.html\">Multi-lingual word vectors</a></p>\n</span></div></h2><div><span><p>Pre-trained models for 157 different languages</p>\n</span></div></div></div></div></div></div></div><div class=\"productShowcaseSection paddingTop lightBackground\" style=\"text-align:center\" id=\"more-info\"><h2><a href=\"/docs/en/support.html\">Help and references</a></h2><div class=\"container\"><div class=\"wrapper\"><div class=\"gridBlock\"><div class=\"blockElement alignCenter imageAlignTop threeByGridBlock\"><div class=\"blockImage\"><a href=\"/docs/en/supervised-tutorial.html\"><img src=\"/img/fasttext-icon-tutorial.png\"></a></div><div class=\"blockContent\"><h2><div><span><p><a href=\"/docs/en/supervised-tutorial.html\">Tutorials</a></p>\n</span></div></h2><div><span><p>Learn how to use fastText</p>\n</span></div></div></div><div class=\"blockElement alignCenter imageAlignTop threeByGridBlock\"><div class=\"blockImage\"><a href=\"/docs/en/faqs.html\"><img src=\"/img/fasttext-icon-faq.png\"></a></div><div class=\"blockContent\"><h2><div><span><p><a href=\"/docs/en/faqs.html\">Frequently Asked Questions</a></p>\n</span></div></h2><div><span><p>Questions gathered from the community</p>\n</span></div></div></div><div class=\"blockElement alignCenter imageAlignTop threeByGridBlock\"><div class=\"blockImage\"><a href=\"/docs/en/api.html\"><img src=\"/img/fasttext-icon-api.png\"></a></div><div class=\"blockContent\"><h2><div><span><p><a href=\"/docs/en/api.html\">API</a></p>\n</span></div></h2><div><span><p>In depth review of fastText commands</p>\n</span></div></div></div></div></div></div></div><div class=\"productShowcaseSection paddingTop\"><h2><a href=\"/docs/en/references.html\">References</a></h2><div class=\"container\"><div class=\"wrapper\"><div class=\"gridBlock\"><div class=\"blockElement threeByGridBlock\"><div class=\"blockContent\"><h2><div><span><p><a href=\"https://arxiv.org/abs/1607.04606\">Enriching Word Vectors with Subword Information</a></p>\n</span></div></h2><div><span><p>P. Bojanowski, E. Grave, A. Joulin, T. Mikolov</p>\n</span></div></div></div><div class=\"blockElement threeByGridBlock\"><div class=\"blockContent\"><h2><div><span><p><a href=\"https://arxiv.org/abs/1607.01759\">Bag of Tricks for Efficient Text Classification</a></p>\n</span></div></h2><div><span><p>A. Joulin, E. Grave, P. Bojanowski, T. Mikolov</p>\n</span></div></div></div><div class=\"blockElement threeByGridBlock\"><div class=\"blockContent\"><h2><div><span><p><a href=\"https://arxiv.org/abs/1612.03651\">FastText.zip: Compressing text classification models</a></p>\n</span></div></h2><div><span><p>A. Joulin, E. Grave, P. Bojanowski, M. Douze, H. Jegou, T. Mikolov</p>\n</span></div></div></div></div></div></div></div></div></div><footer class=\"nav-footer\" id=\"footer\"><section class=\"sitemap\"><a href=\"/\" class=\"nav-home\"><img src=\"/img/fasttext-icon-white-web.png\" alt=\"fastText\"></a><div><h5>Support</h5><a href=\"/docs/en/support.html\">Getting Started</a><a href=\"/docs/en/supervised-tutorial.html\">Tutorials</a><a href=\"/docs/en/faqs.html\">FAQs</a><a href=\"/docs/en/api.html\">API</a></div><div><h5>Community</h5><a href=\"https://www.facebook.com/groups/1174547215919768/\" target=\"_blank\">Facebook Group</a><a href=\"https://stackoverflow.com/questions/tagged/fasttext\" target=\"_blank\">Stack Overflow</a><a href=\"https://groups.google.com/forum/#!forum/fasttext-library\" target=\"_blank\">Google Group</a></div><div><h5>More</h5><a href=\"/blog\">Blog</a><a href=\"https://github.com/facebookresearch/fastText\" target=\"_blank\">GitHub</a><a class=\"github-button\" href=\"https://github.com/facebookresearch/fastText/\" data-icon=\"octicon-star\" data-count-href=\"/fastText/stargazers\" data-count-api=\"/repos/fastText#stargazers_count\" data-count-aria-label=\"# stargazers on GitHub\" aria-label=\"Star this project on GitHub\">Star</a></div></section><a href=\"https://code.facebook.com/projects/\" target=\"_blank\" class=\"fbOpenSource\"><img src=\"/img/oss_logo.png\" alt=\"Facebook Open Source\" width=\"170\" height=\"45\"></a><section class=\"copyright\">Copyright © 2020 Facebook Inc.</section></footer></div>","text":"Docs\nResources\nBlog\nGitHub\nLibrary for efficient text classification and representation learning\nGET STARTED\nDOWNLOAD MODELS\n\nWhat is fastText?\n\nFastText is an open-source, free, lightweight library that allows users to learn text representations and text classifiers. It works on standard, generic hardware. Models can later be reduced in size to even fit on mobile devices.\n\nDownload pre-trained models\n\nEnglish word vectors\n\nPre-trained on English webcrawl and Wikipedia\n\nMulti-lingual word vectors\n\nPre-trained models for 157 different languages\n\nHelp and references\n\nTutorials\n\nLearn how to use fastText\n\nFrequently Asked Questions\n\nQuestions gathered from the community\n\nAPI\n\nIn depth review of fastText commands\n\nReferences\n\nEnriching Word Vectors with Subword Information\n\nP. Bojanowski, E. Grave, A. Joulin, T. Mikolov\n\nBag of Tricks for Efficient Text Classification\n\nA. Joulin, E. Grave, P. Bojanowski, T. Mikolov\n\nFastText.zip: Compressing text classification models\n\nA. Joulin, E. Grave, P. Bojanowski, M. Douze, H. Jegou, T. Mikolov\n\nSupport\nGetting Started\nTutorials\nFAQs\nAPI\nCommunity\nFacebook Group\nStack Overflow\nGoogle Group\nMore\nBlog\nGitHub\nStar\nCopyright © 2020 Facebook Inc."}

